(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[200],{3702:function(e,t,s){Promise.resolve().then(s.bind(s,4842))},4842:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return b}});var n=s(7437),i=s(2265),a=s(2869),r=s(6070),l=s(5395),c=s(7168),o=s(1723),d=s(91),h=s(525),m=s(3478);s(257);class x{async setupServiceWorker(){if(this.wb){this.wb.addEventListener("waiting",e=>{console.log("New service worker is waiting to activate"),this.showUpdateNotification()}),this.wb.addEventListener("controlling",e=>{console.log("New service worker is now controlling the app"),window.location.reload()}),this.wb.addEventListener("message",e=>{"CACHE_UPDATED"===e.data.type&&console.log("Cache updated:",e.data.payload)});try{this.registration=await this.wb.register()||null,console.log("Service worker registered successfully")}catch(e){console.error("Service worker registration failed:",e)}}}showUpdateNotification(){let e=document.createElement("div");e.className="fixed bottom-4 left-4 right-4 z-50 mx-auto max-w-sm",e.innerHTML='\n      <div class="bg-blue-600 text-white p-4 rounded-lg shadow-lg">\n        <div class="flex items-center justify-between">\n          <div>\n            <h4 class="font-medium">Update Available</h4>\n            <p class="text-sm text-blue-100">A new version is ready to install</p>\n          </div>\n          <button id="update-btn" class="bg-blue-500 hover:bg-blue-400 px-3 py-1 rounded text-sm">\n            Update\n          </button>\n        </div>\n      </div>\n    ',document.body.appendChild(e);let t=e.querySelector("#update-btn");null==t||t.addEventListener("click",async()=>{var t;this.wb&&(null===(t=this.registration)||void 0===t?void 0:t.waiting)&&(this.wb.messageSkipWaiting(),document.body.removeChild(e))}),setTimeout(()=>{document.body.contains(e)&&document.body.removeChild(e)},1e4)}async skipWaiting(){var e;this.wb&&(null===(e=this.registration)||void 0===e?void 0:e.waiting)&&this.wb.messageSkipWaiting()}getRegistration(){return this.registration}constructor(){this.wb=null,this.registration=null,"serviceWorker"in navigator&&(this.wb=new m.ZW("/sw.js"),this.setupServiceWorker())}}class u{async init(){return new Promise((e,t)=>{let s=indexedDB.open(this.dbName,this.version);s.onerror=()=>t(s.error),s.onsuccess=()=>{this.db=s.result,e()},s.onupgradeneeded=e=>{let t=e.target.result;if(!t.objectStoreNames.contains("analytics")){let e=t.createObjectStore("analytics",{keyPath:"id"});e.createIndex("timestamp","timestamp"),e.createIndex("businessId","businessId")}if(!t.objectStoreNames.contains("attributions")){let e=t.createObjectStore("attributions",{keyPath:"id"});e.createIndex("businessId","businessId"),e.createIndex("bookingId","bookingId")}if(!t.objectStoreNames.contains("pendingActions")){let e=t.createObjectStore("pendingActions",{keyPath:"id",autoIncrement:!0});e.createIndex("timestamp","timestamp"),e.createIndex("type","type")}}})}async storeAnalyticsData(e,t){this.db||await this.init();let s=this.db.transaction(["analytics"],"readwrite").objectStore("analytics"),n={id:"analytics_".concat(e,"_").concat(Date.now()),businessId:e,data:t,timestamp:Date.now(),cached:!0};return s.put(n)}async getCachedAnalyticsData(e){this.db||await this.init();let t=this.db.transaction(["analytics"],"readonly").objectStore("analytics").index("businessId");return new Promise((s,n)=>{let i=t.getAll(e);i.onsuccess=()=>{let e=i.result.sort((e,t)=>t.timestamp-e.timestamp)[0];s((null==e?void 0:e.data)||null)},i.onerror=()=>n(i.error)})}async queueAction(e,t){this.db||await this.init();let s=this.db.transaction(["pendingActions"],"readwrite").objectStore("pendingActions"),n={type:e,data:t,timestamp:Date.now(),retries:0};return s.add(n)}async getPendingActions(){this.db||await this.init();let e=this.db.transaction(["pendingActions"],"readonly").objectStore("pendingActions");return new Promise((t,s)=>{let n=e.getAll();n.onsuccess=()=>t(n.result),n.onerror=()=>s(n.error)})}async removeAction(e){return this.db||await this.init(),this.db.transaction(["pendingActions"],"readwrite").objectStore("pendingActions").delete(e)}async clearOldCache(){this.db||await this.init();let e=Date.now()-6048e5;this.db.transaction(["analytics"],"readwrite").objectStore("analytics").index("timestamp").openCursor(IDBKeyRange.upperBound(e)).onsuccess=e=>{let t=e.target.result;t&&(t.delete(),t.continue())}}constructor(){this.dbName="BookingBridgeOfflineDB",this.version=1,this.db=null}}new x;let g=new u;function b(){let[e,t]=(0,i.useState)(null),[s,m]=(0,i.useState)(0),[x,u]=(0,i.useState)(!1);(0,i.useEffect)(()=>{b()},[]);let b=async()=>{if(g)try{let e=localStorage.getItem("currentBusinessId");if(e){let s=await g.getCachedAnalyticsData(e);t(s)}let s=await g.getPendingActions();m(s.length)}catch(e){console.error("Failed to load offline data:",e)}},p=async()=>{u(!0);try{if((await fetch("/api/health",{cache:"no-cache",signal:AbortSignal.timeout(5e3)})).ok)window.location.href="/dashboard";else throw Error("Server not responding")}catch(e){console.log("Still offline"),setTimeout(()=>u(!1),2e3)}},w=async()=>{if("serviceWorker"in navigator&&"sync"in window.ServiceWorkerRegistration.prototype)try{let e=await navigator.serviceWorker.ready;await e.sync.register("background-sync");let t=document.createElement("div");t.className="fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg z-50",t.textContent="Data will sync automatically when online",document.body.appendChild(t),setTimeout(()=>document.body.removeChild(t),3e3)}catch(e){console.error("Background sync registration failed:",e)}};return(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,n.jsxs)("div",{className:"max-w-2xl w-full space-y-6",children:[(0,n.jsxs)(r.Zb,{className:"border-orange-200 bg-orange-50",children:[(0,n.jsxs)(r.Ol,{className:"text-center",children:[(0,n.jsx)("div",{className:"mx-auto w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mb-4",children:(0,n.jsx)(l.Z,{className:"w-8 h-8 text-orange-600"})}),(0,n.jsx)(r.ll,{className:"text-2xl text-orange-900",children:"You're Offline"}),(0,n.jsx)(r.SZ,{className:"text-orange-700",children:"No internet connection detected. You can still view cached data and make changes."})]}),(0,n.jsx)(r.aY,{className:"space-y-4",children:(0,n.jsxs)("div",{className:"flex justify-center space-x-4",children:[(0,n.jsx)(a.z,{onClick:p,disabled:x,className:"bg-orange-600 hover:bg-orange-700 text-white",children:x?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(c.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Retrying..."]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(c.Z,{className:"w-4 h-4 mr-2"}),"Try Again"]})}),s>0&&(0,n.jsxs)(a.z,{onClick:w,variant:"outline",className:"border-orange-300 text-orange-700 hover:bg-orange-100",children:[(0,n.jsx)(o.Z,{className:"w-4 h-4 mr-2"}),"Queue for Sync (",s,")"]})]})})]}),e&&(0,n.jsxs)(r.Zb,{children:[(0,n.jsxs)(r.Ol,{children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(d.Z,{className:"w-5 h-5 text-blue-600"}),(0,n.jsx)(r.ll,{className:"text-lg",children:"Cached Analytics"})]}),(0,n.jsxs)(r.SZ,{children:["Last updated: ",new Date(e.timestamp).toLocaleString()]})]}),(0,n.jsx)(r.aY,{children:(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,n.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(h.Z,{className:"w-4 h-4 text-blue-600"}),(0,n.jsx)("span",{className:"text-sm font-medium text-blue-900",children:"Conversions"})]}),(0,n.jsx)("p",{className:"text-2xl font-bold text-blue-900 mt-1",children:e.conversions||0}),(0,n.jsx)("p",{className:"text-xs text-blue-700",children:"This month"})]}),(0,n.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg",children:[(0,n.jsx)("div",{className:"flex items-center space-x-2",children:(0,n.jsx)("span",{className:"text-sm font-medium text-green-900",children:"Revenue"})}),(0,n.jsxs)("p",{className:"text-2xl font-bold text-green-900 mt-1",children:["$",e.revenue||0]}),(0,n.jsx)("p",{className:"text-xs text-green-700",children:"Attributed"})]}),(0,n.jsxs)("div",{className:"bg-purple-50 p-4 rounded-lg",children:[(0,n.jsx)("div",{className:"flex items-center space-x-2",children:(0,n.jsx)("span",{className:"text-sm font-medium text-purple-900",children:"Attribution Rate"})}),(0,n.jsxs)("p",{className:"text-2xl font-bold text-purple-900 mt-1",children:[e.attributionRate||0,"%"]}),(0,n.jsx)("p",{className:"text-xs text-purple-700",children:"Accuracy"})]})]})})]}),(0,n.jsxs)(r.Zb,{children:[(0,n.jsx)(r.Ol,{children:(0,n.jsx)(r.ll,{className:"text-lg",children:"What you can do offline"})}),(0,n.jsx)(r.aY,{children:(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),(0,n.jsx)("span",{children:"View cached analytics data"})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),(0,n.jsx)("span",{children:"Browse attribution reports"})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),(0,n.jsx)("span",{children:"Update business settings"})]})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("div",{className:"w-2 h-2 bg-yellow-500 rounded-full"}),(0,n.jsx)("span",{children:"Changes will sync when online"})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("div",{className:"w-2 h-2 bg-yellow-500 rounded-full"}),(0,n.jsx)("span",{children:"Background sync enabled"})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("div",{className:"w-2 h-2 bg-yellow-500 rounded-full"}),(0,n.jsx)("span",{children:"Push notifications ready"})]})]})]})})]}),(0,n.jsx)(r.Zb,{className:"bg-blue-50 border-blue-200",children:(0,n.jsxs)(r.aY,{className:"p-4",children:[(0,n.jsx)("h3",{className:"font-medium text-blue-900 mb-2",children:"\uD83D\uDCA1 Offline Tips"}),(0,n.jsxs)("ul",{className:"text-sm text-blue-800 space-y-1",children:[(0,n.jsx)("li",{children:"• Your changes are automatically saved locally"}),(0,n.jsx)("li",{children:"• Data will sync as soon as you're connected"}),(0,n.jsx)("li",{children:"• Cached reports remain accessible for up to 7 days"}),(0,n.jsx)("li",{children:"• Install this app for better offline experience"})]})]})})]})})}}},function(e){e.O(0,[216,592,971,744],function(){return e(e.s=3702)}),_N_E=e.O()}]);