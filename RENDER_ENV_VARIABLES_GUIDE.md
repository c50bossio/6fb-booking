# Render Environment Variables Setup Guide

This comprehensive guide walks you through setting up all environment variables for the 6FB Booking Platform on Render.

## Table of Contents
1. [Accessing Render Dashboard](#accessing-render-dashboard)
2. [Setting Environment Variables](#setting-environment-variables)
3. [Required Variables](#required-variables)
4. [Optional Variables](#optional-variables)
5. [Generating Secure Keys](#generating-secure-keys)
6. [Database Configuration](#database-configuration)
7. [Integration-Specific Variables](#integration-specific-variables)
8. [Troubleshooting](#troubleshooting)

## Accessing Render Dashboard

1. Log in to your Render account at https://dashboard.render.com
2. Navigate to your service (e.g., `sixfb-backend`)
3. Click on the "Environment" tab in the left sidebar
4. You'll see the "Environment Variables" section

## Setting Environment Variables

### How to Add Variables:
1. Click "Add Environment Variable"
2. Enter the variable name (e.g., `SECRET_KEY`)
3. Enter the value
4. Click "Save"
5. Your service will automatically redeploy with the new variables

### Important Notes:
- Variables are case-sensitive
- No quotes needed around values (Render handles this)
- Changes trigger automatic redeployment
- Use the "Secret files" option for sensitive multi-line content

## Required Variables

These variables MUST be set for the application to run properly:

### üîê Core Security (REQUIRED)

```bash
SECRET_KEY=<generated-64-char-key>
JWT_SECRET_KEY=<different-generated-64-char-key>
JWT_ALGORITHM=HS256
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=1440
```

### üóÑÔ∏è Database (AUTO-GENERATED by Render)

```bash
DATABASE_URL=<automatically-provided-by-render>
# Render provides this when you create a PostgreSQL database
# Format: postgresql://user:pass@host:port/database  # pragma: allowlist secret
```

### üåê Environment Settings

```bash
ENVIRONMENT=production
FRONTEND_URL=https://your-frontend-domain.com
ALLOWED_ORIGINS=https://your-frontend-domain.com,https://www.your-frontend-domain.com
```

## Optional Variables

### üí≥ Payment Processing

#### Stripe (Recommended)
```bash
# Test keys (for development/staging)
STRIPE_SECRET_KEY=sk_test_51...
STRIPE_PUBLISHABLE_KEY=pk_test_51...

# Live keys (for production)
STRIPE_SECRET_KEY=sk_live_51...
STRIPE_PUBLISHABLE_KEY=pk_live_51...

# Webhook and Connect
STRIPE_WEBHOOK_SECRET=whsec_...
STRIPE_CONNECT_CLIENT_ID=ca_...
```

#### Square (Alternative)
```bash
SQUARE_ACCESS_TOKEN=your_square_access_token
SQUARE_APPLICATION_ID=your_square_application_id
SQUARE_ENVIRONMENT=production  # or 'sandbox' for testing
SQUARE_WEBHOOK_SIGNATURE_KEY=your_square_webhook_key
```

#### Tremendous (Payouts)
```bash
TREMENDOUS_API_KEY=your_tremendous_api_key
TREMENDOUS_TEST_MODE=false  # true for testing
TREMENDOUS_WEBHOOK_SECRET=your_tremendous_webhook_secret
TREMENDOUS_FUNDING_SOURCE_ID=your_funding_source_id
TREMENDOUS_CAMPAIGN_ID=your_campaign_id
```

### üìß Email Services (Choose One)

#### Option A: SendGrid (Recommended for Production)
```bash
SENDGRID_API_KEY=SG.your-sendgrid-api-key
FROM_EMAIL=noreply@yourdomain.com
EMAIL_FROM_NAME=6FB Platform
```

#### Option B: Gmail/SMTP (Development)
```bash
SMTP_SERVER=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=your-email@gmail.com
SMTP_PASSWORD=16-digit-app-password  # NOT your regular password!
FROM_EMAIL=your-email@gmail.com
EMAIL_FROM_NAME=6FB Platform
```

#### Option C: Mailgun
```bash
MAILGUN_API_KEY=your-mailgun-api-key
MAILGUN_DOMAIN=your-mailgun-domain
FROM_EMAIL=noreply@yourdomain.com
EMAIL_FROM_NAME=6FB Platform
```

### üì± SMS Notifications (Twilio)

```bash
TWILIO_ACCOUNT_SID=your_twilio_account_sid
TWILIO_AUTH_TOKEN=your_twilio_auth_token
TWILIO_PHONE_NUMBER=+1234567890
```

### üìÖ Google Calendar Integration

```bash
GOOGLE_CALENDAR_CLIENT_ID=your_google_client_id.apps.googleusercontent.com
GOOGLE_CALENDAR_CLIENT_SECRET=your_google_client_secret
GOOGLE_CALENDAR_REDIRECT_URI=https://yourdomain.com/api/v1/google-calendar/oauth/callback
```

### üîç Monitoring & Analytics

```bash
# Sentry Error Tracking
SENTRY_DSN=https://your-key@sentry.io/project-id
SENTRY_ENVIRONMENT=production
SENTRY_TRACES_SAMPLE_RATE=0.1

# Google Analytics
GOOGLE_ANALYTICS_ID=GA-XXXXX-X
GA4_MEASUREMENT_ID=G-XXXXXXXXXX

# Uptime Monitoring
UPTIME_ROBOT_API_KEY=your-uptime-robot-api-key
```

### üóÑÔ∏è Redis (If using external Redis)

```bash
REDIS_URL=redis://default:pass@redis-host:6379  # pragma: allowlist secret
REDIS_PASSWORD=your_redis_password
REDIS_DB=0
```

### üîí Data Encryption

```bash
DATA_ENCRYPTION_KEY=<generated-fernet-key>
# OR
MASTER_PASSWORD=<strong-master-password>
```

### üìÇ File Storage (AWS S3)

```bash
AWS_ACCESS_KEY_ID=your_aws_access_key
AWS_SECRET_ACCESS_KEY=your_aws_secret_key
AWS_S3_BUCKET=your-s3-bucket-name
AWS_S3_REGION=us-east-1
```

### üîß Performance & Logging

```bash
# Logging
LOG_LEVEL=INFO
LOG_FORMAT=json
SQLALCHEMY_LOG_LEVEL=WARNING

# Workers (adjust based on your Render plan)
WORKERS=2  # Start with 2, increase if needed
REQUEST_TIMEOUT=30
```

### üö¶ Feature Flags

```bash
FEATURE_GOOGLE_CALENDAR_SYNC=true
FEATURE_PAYMENT_SPLITS=true
FEATURE_ANALYTICS_DASHBOARD=true
FEATURE_AUTOMATED_REMINDERS=true
```

## Generating Secure Keys

### Generate SECRET_KEY and JWT_SECRET_KEY

Run this command in your terminal:

```bash
python3 -c 'import secrets; print(secrets.token_urlsafe(64))'
```

Run it twice to get two different keys:
- First result ‚Üí `SECRET_KEY`
- Second result ‚Üí `JWT_SECRET_KEY`

### Generate DATA_ENCRYPTION_KEY (for Fernet encryption)

```bash
python3 -c 'from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())'
```

### Example Generated Keys:
```
SECRET_KEY=Ks7PmR4e9nW2Qx8Lv3Ht6Yb5Fc0Aj1Gd4Kn7Ps0Wm3Ex6Lz9Vc2Bn5Mq8Rt1Ye4
JWT_SECRET_KEY=Nm2Ws5Ex8Lz1Vc4Bn7Mq0Rt3Ye6Uf9Ih2Ol5Pj8Sk1Aw4Dx7Gz0Jc3Fm6Kn9Qp2
DATA_ENCRYPTION_KEY=gAAAAABhZ5K3Q9W8R4T2Y1U6I0O5P3A7S2D6F9G4H1J7K3L8Z5X2C1V0B6N9M8Q=
```

‚ö†Ô∏è **NEVER use these example keys! Always generate your own!**

## Database Configuration

### Render PostgreSQL Setup

1. In Render Dashboard, click "New +" ‚Üí "PostgreSQL"
2. Configure:
   - Name: `sixfb-database`
   - Database: `sixfb_production`
   - User: (auto-generated)
   - Region: Same as your web service
   - Plan: Choose based on needs
3. Click "Create Database"
4. Render automatically adds `DATABASE_URL` to connected services

### Database Pool Settings (Optional)

```bash
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=30
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600
DB_POOL_PRE_PING=true
```

## Integration-Specific Variables

### Development vs Production Values

#### Development/Staging:
```bash
ENVIRONMENT=staging
STRIPE_SECRET_KEY=sk_test_...
STRIPE_PUBLISHABLE_KEY=pk_test_...
FRONTEND_URL=https://sixfb-staging.onrender.com
```

#### Production:
```bash
ENVIRONMENT=production
STRIPE_SECRET_KEY=sk_live_...
STRIPE_PUBLISHABLE_KEY=pk_live_...
FRONTEND_URL=https://yourdomain.com
```

### Setting Up Each Integration

#### Stripe Setup:
1. Log in to Stripe Dashboard
2. Get API keys from Developers ‚Üí API keys
3. Set up webhook endpoint: `https://your-backend.onrender.com/api/v1/payments/stripe/webhook`
4. Copy webhook signing secret

#### SendGrid Setup:
1. Create SendGrid account
2. Generate API key with "Mail Send" permissions
3. Verify sender domain/email
4. Set FROM_EMAIL to verified address

#### Google Calendar Setup:
1. Go to Google Cloud Console
2. Create OAuth 2.0 credentials
3. Add authorized redirect URI: `https://your-backend.onrender.com/api/v1/google-calendar/oauth/callback`
4. Copy client ID and secret

## Troubleshooting

### Common Issues and Solutions

#### 1. "SECRET_KEY must be set to a secure random value"
**Solution**: Generate a proper key using the command above. Don't use placeholder values.

#### 2. "DATABASE_URL cannot be empty"
**Solution**: Create a PostgreSQL database in Render and connect it to your service.

#### 3. Email not sending
**Solution**:
- Check email service credentials
- Verify FROM_EMAIL is authorized
- Check logs for specific error messages

#### 4. "Using test Stripe key in production"
**Solution**: Update to live Stripe keys (sk_live_*, pk_live_*) for production.

#### 5. CORS errors
**Solution**:
- Add your frontend URL to ALLOWED_ORIGINS
- Include both with and without www
- Separate multiple origins with commas

### Verifying Configuration

After setting variables, verify by:

1. Check service logs:
   ```
   Settings validated successfully for production environment
   ```

2. Visit health endpoint:
   ```
   https://your-backend.onrender.com/health
   ```

3. Check specific integrations:
   - Email: Test password reset
   - Stripe: Check webhook endpoint
   - Google Calendar: Test OAuth flow

### Environment Variable Best Practices

1. **Never commit secrets**: Keep them only in Render dashboard
2. **Use different keys**: Don't reuse keys across environments
3. **Rotate regularly**: Update keys periodically
4. **Monitor access**: Check Render audit logs
5. **Document changes**: Note when/why variables change

### Quick Checklist

Before going live, ensure you have:

- [ ] Generated unique SECRET_KEY and JWT_SECRET_KEY
- [ ] Set ENVIRONMENT to "production"
- [ ] Configured payment processor (Stripe/Square)
- [ ] Set up email service (SendGrid recommended)
- [ ] Added frontend URL to ALLOWED_ORIGINS
- [ ] Connected PostgreSQL database
- [ ] Set up monitoring (Sentry)
- [ ] Configured any needed integrations
- [ ] Tested health endpoint

## Support

If you encounter issues:

1. Check Render logs for specific error messages
2. Verify all required variables are set
3. Ensure values don't have extra spaces or quotes
4. Test with minimal configuration first
5. Contact Render support for platform-specific issues

Remember: Render automatically redeploys when you change environment variables, so changes take effect within minutes.
