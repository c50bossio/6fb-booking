# =============================================================================
# Fluent-bit Parsers Configuration for BookedBarber V2
# =============================================================================
# üîç Custom parsers for FastAPI, Next.js, Nginx, and PostgreSQL logs
# üìä Structured logging with proper field extraction
# =============================================================================

# FastAPI JSON Logs
[PARSER]
    Name        fastapi_json
    Format      json
    Time_Key    timestamp
    Time_Format %Y-%m-%dT%H:%M:%S.%L%z
    Time_Keep   On

# Next.js JSON Logs
[PARSER]
    Name        nextjs_json
    Format      json
    Time_Key    timestamp
    Time_Format %Y-%m-%dT%H:%M:%S.%L%z
    Time_Keep   On

# Standard JSON Parser
[PARSER]
    Name        json
    Format      json
    Time_Key    time
    Time_Format %d/%b/%Y:%H:%M:%S %z
    Time_Keep   On

# Nginx Access Logs
[PARSER]
    Name        nginx
    Format      regex
    Regex       ^(?<remote>[^ ]*) (?<host>[^ ]*) (?<user>[^ ]*) \[(?<time>[^\]]*)\] "(?<method>\S+)(?: +(?<path>[^\"]*?)(?: +\S*)?)?" (?<code>[^ ]*) (?<size>[^ ]*)(?: "(?<referer>[^\"]*)" "(?<agent>[^\"]*)")?$
    Time_Key    time
    Time_Format %d/%b/%Y:%H:%M:%S %z

# Nginx Error Logs
[PARSER]
    Name        nginx_error
    Format      regex
    Regex       ^(?<time>[^ ]* [^ ]*) \[(?<level>[^\]]*)\] (?<pid>[^#]*#[^:]*): (?<message>.*)$
    Time_Key    time
    Time_Format %Y/%m/%d %H:%M:%S

# PostgreSQL Logs
[PARSER]
    Name        postgres
    Format      regex
    Regex       ^(?<time>[^ ]* [^ ]*) (?<timezone>\w+) \[(?<pid>[^\]]*)\] (?<level>[^:]*): (?<message>.*)$
    Time_Key    time
    Time_Format %Y-%m-%d %H:%M:%S

# Docker Container Logs
[PARSER]
    Name        docker
    Format      json
    Time_Key    time
    Time_Format %Y-%m-%dT%H:%M:%S.%L%z
    Time_Keep   On

# Syslog Format
[PARSER]
    Name        syslog
    Format      regex
    Regex       ^\<(?<pri>[0-9]+)\>(?<time>[^ ]* {1,2}[^ ]* [^ ]*) (?<host>[^ ]*) (?<ident>[a-zA-Z0-9_\/\.\-]*)(?:\[(?<pid>[0-9]+)\])?(?:[^\:]*\:)? *(?<message>.*)$
    Time_Key    time
    Time_Format %b %d %H:%M:%S

# Apache Access Logs
[PARSER]
    Name        apache
    Format      regex
    Regex       ^(?<host>[^ ]*) [^ ]* (?<user>[^ ]*) \[(?<time>[^\]]*)\] "(?<method>\S+)(?: +(?<path>[^ ]*) +\S*)?" (?<code>[^ ]*) (?<size>[^ ]*)(?: "(?<referer>[^\"]*)" "(?<agent>[^\"]*)")?$
    Time_Key    time
    Time_Format %d/%b/%Y:%H:%M:%S %z

# Apache Error Logs
[PARSER]
    Name        apache_error
    Format      regex
    Regex       ^\[[^ ]* (?<time>[^\]]*)\] \[(?<level>[^\]]*)\](?: \[pid (?<pid>[^\]]*)\])? \[client (?<client>[^\]]*)\] (?<message>.*)$

# MongoDB Logs
[PARSER]
    Name        mongodb
    Format      regex
    Regex       ^(?<time>[^ ]*)\s+(?<severity>\w)\s+(?<component>[^ ]+)\s+\[(?<context>[^\]]+)\]\s+(?<message>.*)$
    Time_Key    time
    Time_Format %Y-%m-%dT%H:%M:%S.%L%z

# Redis Logs
[PARSER]
    Name        redis
    Format      regex
    Regex       ^(?<pid>[^ ]*):(?<role>[^ ]*) (?<time>[^ ]* [^ ]*) (?<level>[^ ]*) (?<message>.*)$
    Time_Key    time
    Time_Format %d %b %H:%M:%S

# Custom Application Error Parser
[PARSER]
    Name        app_error
    Format      regex
    Regex       ^(?<timestamp>\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d{3}Z) (?<level>\w+) (?<logger>[^ ]*): (?<message>.*?) (?<error_type>\w+Error): (?<error_message>.*?)( at (?<stack_trace>.*))?$
    Time_Key    timestamp
    Time_Format %Y-%m-%dT%H:%M:%S.%LZ

# Performance Metrics Parser
[PARSER]
    Name        metrics
    Format      regex
    Regex       ^METRIC: (?<metric_name>[^ ]*) (?<metric_value>[^ ]*) (?<metric_unit>[^ ]*) (?<timestamp>\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d{3}Z)( (?<tags>.*))?$
    Time_Key    timestamp
    Time_Format %Y-%m-%dT%H:%M:%S.%LZ