"""add_business_intelligence_agent_models

Revision ID: 47c3f8761124
Revises: 7f6a84ba137c
Create Date: 2025-07-29 14:24:11.865440

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import sqlite

# revision identifiers, used by Alembic.
revision: str = '47c3f8761124'
down_revision: Union[str, Sequence[str], None] = '7f6a84ba137c'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index('ix_cookie_consents_id', table_name='cookie_consents')
    op.drop_index('ix_cookie_consents_session_id', table_name='cookie_consents')
    op.drop_table('cookie_consents')
    op.drop_index('ix_insight_templates_id', table_name='insight_templates')
    op.drop_table('insight_templates')
    op.drop_index('ix_client_tier_data_id', table_name='client_tier_data')
    op.drop_table('client_tier_data')
    op.drop_index('ix_subscription_template_services_id', table_name='subscription_template_services')
    op.drop_table('subscription_template_services')
    op.drop_index('ix_gift_certificates_code', table_name='gift_certificates')
    op.drop_index('ix_gift_certificates_id', table_name='gift_certificates')
    op.drop_table('gift_certificates')
    op.drop_index('ix_barber_profiles_user_id', table_name='barber_profiles')
    op.drop_table('barber_profiles')
    op.drop_index('ix_message_personalizations_id', table_name='message_personalizations')
    op.drop_table('message_personalizations')
    op.drop_index('ix_cancellation_policy_history_id', table_name='cancellation_policy_history')
    op.drop_table('cancellation_policy_history')
    op.drop_index('ix_google_calendar_settings_id', table_name='google_calendar_settings')
    op.drop_index('ix_google_calendar_settings_is_connected', table_name='google_calendar_settings')
    op.drop_index('ix_google_calendar_settings_user_id', table_name='google_calendar_settings')
    op.drop_table('google_calendar_settings')
    op.drop_index('ix_waitlist_entries_id', table_name='waitlist_entries')
    op.drop_table('waitlist_entries')
    op.drop_index('ix_ai_intervention_learning_id', table_name='ai_intervention_learning')
    op.drop_table('ai_intervention_learning')
    op.drop_index('ix_email_deliverability_tests_id', table_name='email_deliverability_tests')
    op.drop_table('email_deliverability_tests')
    op.drop_index('idx_api_keys_expires_at', table_name='api_keys')
    op.drop_index('idx_api_keys_type_status', table_name='api_keys')
    op.drop_index('idx_api_keys_user_status', table_name='api_keys')
    op.drop_index('ix_api_keys_id', table_name='api_keys')
    op.drop_index('ix_api_keys_key_hash', table_name='api_keys')
    op.drop_table('api_keys')
    op.drop_index('idx_conversation_client_agent', table_name='agent_conversations')
    op.drop_index('idx_conversation_status_scheduled', table_name='agent_conversations')
    op.drop_index('ix_agent_conversations_conversation_id', table_name='agent_conversations')
    op.drop_index('ix_agent_conversations_id', table_name='agent_conversations')
    op.drop_index('ix_agent_conversations_status', table_name='agent_conversations')
    op.drop_table('agent_conversations')
    op.drop_table('ai_learning_patterns')
    op.drop_index('ix_recommendation_categories_id', table_name='recommendation_categories')
    op.drop_table('recommendation_categories')
    op.drop_index('ix_legal_consent_audit_id', table_name='legal_consent_audit')
    op.drop_index('ix_legal_consent_audit_timestamp', table_name='legal_consent_audit')
    op.drop_table('legal_consent_audit')
    op.drop_index('idx_franchise_compliance_entity', table_name='franchise_compliance')
    op.drop_index('idx_franchise_compliance_jurisdiction', table_name='franchise_compliance')
    op.drop_index('idx_franchise_compliance_review_date', table_name='franchise_compliance')
    op.drop_index('idx_franchise_compliance_status', table_name='franchise_compliance')
    op.drop_index('ix_franchise_compliance_id', table_name='franchise_compliance')
    op.drop_table('franchise_compliance')
    op.drop_index('ix_notification_preferences_v2_id', table_name='notification_preferences_v2')
    op.drop_index('ix_notification_preferences_v2_unsubscribe_token', table_name='notification_preferences_v2')
    op.drop_table('notification_preferences_v2')
    op.drop_index('idx_device_trust_fingerprint', table_name='mfa_device_trusts')
    op.drop_index('idx_device_trust_token', table_name='mfa_device_trusts')
    op.drop_index('idx_device_trust_user', table_name='mfa_device_trusts')
    op.drop_index('ix_mfa_device_trusts_id', table_name='mfa_device_trusts')
    op.drop_table('mfa_device_trusts')
    op.drop_index('idx_engagement_quality', table_name='six_fb_client_engagement_history')
    op.drop_index('idx_engagement_type_value', table_name='six_fb_client_engagement_history')
    op.drop_index('idx_engagement_user_client_date', table_name='six_fb_client_engagement_history')
    op.drop_index('ix_six_fb_client_engagement_history_client_id', table_name='six_fb_client_engagement_history')
    op.drop_index('ix_six_fb_client_engagement_history_id', table_name='six_fb_client_engagement_history')
    op.drop_index('ix_six_fb_client_engagement_history_user_id', table_name='six_fb_client_engagement_history')
    op.drop_table('six_fb_client_engagement_history')
    op.drop_index('ix_six_fb_operational_excellence_id', table_name='six_fb_operational_excellence')
    op.drop_index('ix_six_fb_operational_excellence_user_id', table_name='six_fb_operational_excellence')
    op.drop_table('six_fb_operational_excellence')
    op.drop_index('ix_external_transactions_appointment_id', table_name='external_transactions')
    op.drop_index('ix_external_transactions_connection_id', table_name='external_transactions')
    op.drop_index('ix_external_transactions_external_transaction_id', table_name='external_transactions')
    op.drop_index('ix_external_transactions_id', table_name='external_transactions')
    op.drop_table('external_transactions')
    op.drop_index('ix_booking_rules_id', table_name='booking_rules')
    op.drop_table('booking_rules')
    op.drop_index('idx_user_achievement_unlocked_at', table_name='user_achievements')
    op.drop_index('idx_user_achievement_user_unlocked', table_name='user_achievements')
    op.drop_index('ix_user_achievements_achievement_id', table_name='user_achievements')
    op.drop_index('ix_user_achievements_id', table_name='user_achievements')
    op.drop_index('ix_user_achievements_is_unlocked', table_name='user_achievements')
    op.drop_index('ix_user_achievements_user_id', table_name='user_achievements')
    op.drop_table('user_achievements')
    op.drop_index('ix_inventory_items_external_id', table_name='inventory_items')
    op.drop_index('ix_inventory_items_id', table_name='inventory_items')
    op.drop_table('inventory_items')
    op.drop_index('ix_insight_metrics_id', table_name='insight_metrics')
    op.drop_index('ix_insight_metrics_metric_name', table_name='insight_metrics')
    op.drop_index('ix_insight_metrics_user_id', table_name='insight_metrics')
    op.drop_index('ix_insight_metrics_weekly_insight_id', table_name='insight_metrics')
    op.drop_table('insight_metrics')
    op.drop_index('ix_data_processing_logs_id', table_name='data_processing_logs')
    op.drop_table('data_processing_logs')
    op.drop_index('ix_six_fb_revenue_goals_id', table_name='six_fb_revenue_goals')
    op.drop_index('ix_six_fb_revenue_goals_user_id', table_name='six_fb_revenue_goals')
    op.drop_table('six_fb_revenue_goals')
    op.drop_index('idx_xp_transaction_source', table_name='xp_transactions')
    op.drop_index('idx_xp_transaction_user_date', table_name='xp_transactions')
    op.drop_index('ix_xp_transactions_id', table_name='xp_transactions')
    op.drop_index('ix_xp_transactions_transaction_date', table_name='xp_transactions')
    op.drop_index('ix_xp_transactions_user_id', table_name='xp_transactions')
    op.drop_index('ix_xp_transactions_xp_source', table_name='xp_transactions')
    op.drop_table('xp_transactions')
    op.drop_index('ix_business_insights_agent_id', table_name='business_insights')
    op.drop_index('ix_business_insights_coaching_session_id', table_name='business_insights')
    op.drop_index('ix_business_insights_created_at', table_name='business_insights')
    op.drop_index('ix_business_insights_id', table_name='business_insights')
    op.drop_index('ix_business_insights_insight_category', table_name='business_insights')
    op.drop_index('ix_business_insights_priority', table_name='business_insights')
    op.drop_index('ix_business_insights_user_id', table_name='business_insights')
    op.drop_table('business_insights')
    op.drop_index('ix_notification_preference_audit_id', table_name='notification_preference_audit')
    op.drop_table('notification_preference_audit')
    op.drop_index('ix_service_templates_category', table_name='service_templates')
    op.drop_index('ix_service_templates_id', table_name='service_templates')
    op.drop_index('ix_service_templates_name', table_name='service_templates')
    op.drop_index('ix_service_templates_six_fb_tier', table_name='service_templates')
    op.drop_table('service_templates')
    op.drop_index('idx_payouts_barber_status', table_name='payouts')
    op.drop_index('idx_payouts_created_status', table_name='payouts')
    op.drop_index('idx_payouts_period', table_name='payouts')
    op.drop_index('ix_payouts_id', table_name='payouts')
    op.drop_table('payouts')
    op.drop_index('ix_insight_email_deliveries_id', table_name='insight_email_deliveries')
    op.drop_index('ix_insight_email_deliveries_user_id', table_name='insight_email_deliveries')
    op.drop_index('ix_insight_email_deliveries_weekly_insight_id', table_name='insight_email_deliveries')
    op.drop_table('insight_email_deliveries')
    op.drop_index('ix_staff_invitations_email', table_name='staff_invitations')
    op.drop_index('ix_staff_invitations_id', table_name='staff_invitations')
    op.drop_index('ix_staff_invitations_token', table_name='staff_invitations')
    op.drop_table('staff_invitations')
    op.drop_index('ix_service_subscriptions_id', table_name='service_subscriptions')
    op.drop_table('service_subscriptions')
    op.drop_index('ix_review_responses_id', table_name='review_responses')
    op.drop_index('ix_review_responses_template_id', table_name='review_responses')
    op.drop_table('review_responses')
    op.drop_index('ix_email_analytics_events_email_address', table_name='email_analytics_events')
    op.drop_index('ix_email_analytics_events_event_type', table_name='email_analytics_events')
    op.drop_index('ix_email_analytics_events_id', table_name='email_analytics_events')
    op.drop_index('ix_email_analytics_events_message_id', table_name='email_analytics_events')
    op.drop_index('ix_email_analytics_events_timestamp', table_name='email_analytics_events')
    op.drop_table('email_analytics_events')
    op.drop_index('idx_appointments_barber_id', table_name='appointments')
    op.drop_index('idx_appointments_barber_start', table_name='appointments')
    op.drop_index('idx_appointments_barber_starttime', table_name='appointments')
    op.drop_index('idx_appointments_barber_status_start', table_name='appointments')
    op.drop_index('idx_appointments_client_id', table_name='appointments')
    op.drop_index('idx_appointments_client_starttime', table_name='appointments')
    op.drop_index('idx_appointments_client_status', table_name='appointments')
    op.drop_index('idx_appointments_org_start', table_name='appointments')
    op.drop_index('idx_appointments_service_id', table_name='appointments')
    op.drop_index('idx_appointments_service_start', table_name='appointments')
    op.drop_index('idx_appointments_start_time', table_name='appointments')
    op.drop_index('idx_appointments_status', table_name='appointments')
    op.drop_index('idx_appointments_status_start', table_name='appointments')
    op.drop_index('idx_appointments_status_starttime', table_name='appointments')
    op.drop_index('idx_appointments_user_id', table_name='appointments')
    op.drop_index('idx_appointments_user_start', table_name='appointments')
    op.drop_index('idx_appointments_user_status', table_name='appointments')
    op.drop_table('appointments')
    op.drop_index('ix_organizations_id', table_name='organizations')
    op.drop_index('ix_organizations_name', table_name='organizations')
    op.drop_index('ix_organizations_slug', table_name='organizations')
    op.drop_table('organizations')
    op.drop_index('idx_list_contact_unique', table_name='contact_list_members')
    op.drop_index('ix_contact_list_members_id', table_name='contact_list_members')
    op.drop_table('contact_list_members')
    op.drop_index('ix_email_ab_tests_id', table_name='email_ab_tests')
    op.drop_table('email_ab_tests')
    op.drop_index('ix_six_fb_client_journeys_client_id', table_name='six_fb_client_journeys')
    op.drop_index('ix_six_fb_client_journeys_current_stage', table_name='six_fb_client_journeys')
    op.drop_index('ix_six_fb_client_journeys_id', table_name='six_fb_client_journeys')
    op.drop_index('ix_six_fb_client_journeys_user_id', table_name='six_fb_client_journeys')
    op.drop_table('six_fb_client_journeys')
    op.drop_index('ix_client_sentiments_id', table_name='client_sentiments')
    op.drop_table('client_sentiments')
    op.drop_index('ix_contact_segments_id', table_name='contact_segments')
    op.drop_table('contact_segments')
    op.drop_index('ix_ai_performance_metrics_date', table_name='ai_performance_metrics')
    op.drop_index('ix_ai_performance_metrics_id', table_name='ai_performance_metrics')
    op.drop_table('ai_performance_metrics')
    op.drop_index('ix_chair_inventory_id', table_name='chair_inventory')
    op.drop_table('chair_inventory')
    op.drop_index('idx_conversion_appointment', table_name='upsell_conversions')
    op.drop_index('idx_conversion_attempt', table_name='upsell_conversions')
    op.drop_index('idx_conversion_date', table_name='upsell_conversions')
    op.drop_index('idx_conversion_success', table_name='upsell_conversions')
    op.drop_index('ix_upsell_conversions_appointment_id', table_name='upsell_conversions')
    op.drop_index('ix_upsell_conversions_attempt_id', table_name='upsell_conversions')
    op.drop_index('ix_upsell_conversions_id', table_name='upsell_conversions')
    op.drop_table('upsell_conversions')
    op.drop_index('ix_idempotency_expires_created', table_name='idempotency_keys')
    op.drop_index('ix_idempotency_keys_expires_at', table_name='idempotency_keys')
    op.drop_index('ix_idempotency_keys_id', table_name='idempotency_keys')
    op.drop_index('ix_idempotency_keys_key', table_name='idempotency_keys')
    op.drop_index('ix_idempotency_keys_operation_type', table_name='idempotency_keys')
    op.drop_index('ix_idempotency_keys_user_id', table_name='idempotency_keys')
    op.drop_index('ix_idempotency_operation_user', table_name='idempotency_keys')
    op.drop_table('idempotency_keys')
    op.drop_index('idx_franchise_network_brand_status', table_name='franchise_networks')
    op.drop_index('idx_franchise_network_type', table_name='franchise_networks')
    op.drop_index('ix_franchise_networks_brand', table_name='franchise_networks')
    op.drop_index('ix_franchise_networks_id', table_name='franchise_networks')
    op.drop_index('ix_franchise_networks_name', table_name='franchise_networks')
    op.drop_table('franchise_networks')
    op.drop_index('ix_booking_settings_id', table_name='booking_settings')
    op.drop_table('booking_settings')
    op.drop_index('ix_orders_external_id', table_name='orders')
    op.drop_index('ix_orders_id', table_name='orders')
    op.drop_index('ix_orders_order_number', table_name='orders')
    op.drop_table('orders')
    op.drop_index('idx_appointment_date_org', table_name='guest_bookings')
    op.drop_index('idx_guest_email_org', table_name='guest_bookings')
    op.drop_index('idx_guest_phone_org', table_name='guest_bookings')
    op.drop_index('idx_status_org', table_name='guest_bookings')
    op.drop_index('ix_guest_bookings_confirmation_code', table_name='guest_bookings')
    op.drop_index('ix_guest_bookings_created_at', table_name='guest_bookings')
    op.drop_index('ix_guest_bookings_guest_email', table_name='guest_bookings')
    op.drop_index('ix_guest_bookings_guest_name', table_name='guest_bookings')
    op.drop_index('ix_guest_bookings_id', table_name='guest_bookings')
    op.drop_table('guest_bookings')
    op.drop_index('idx_franchise_group_franchisee', table_name='franchise_groups')
    op.drop_index('idx_franchise_group_region_status', table_name='franchise_groups')
    op.drop_index('idx_franchise_group_type', table_name='franchise_groups')
    op.drop_index('ix_franchise_groups_code', table_name='franchise_groups')
    op.drop_index('ix_franchise_groups_id', table_name='franchise_groups')
    op.drop_table('franchise_groups')
    op.drop_index('idx_agent_instance_next_run', table_name='agent_instances')
    op.drop_index('idx_agent_instance_user_status', table_name='agent_instances')
    op.drop_index('ix_agent_instances_id', table_name='agent_instances')
    op.drop_index('ix_agent_instances_status', table_name='agent_instances')
    op.drop_table('agent_instances')
    op.drop_index('idx_expiry_cleanup', table_name='ai_insights_cache')
    op.drop_index('idx_insight_type', table_name='ai_insights_cache')
    op.drop_index('idx_priority', table_name='ai_insights_cache')
    op.drop_index('idx_user_insights', table_name='ai_insights_cache')
    op.drop_index('ix_ai_insights_cache_business_segment', table_name='ai_insights_cache')
    op.drop_index('ix_ai_insights_cache_expires_at', table_name='ai_insights_cache')
    op.drop_index('ix_ai_insights_cache_id', table_name='ai_insights_cache')
    op.drop_index('ix_ai_insights_cache_insight_type', table_name='ai_insights_cache')
    op.drop_index('ix_ai_insights_cache_is_active', table_name='ai_insights_cache')
    op.drop_index('ix_ai_insights_cache_user_id', table_name='ai_insights_cache')
    op.drop_table('ai_insights_cache')
    op.drop_table('service_package_items')
    op.drop_index('ix_recurring_appointment_patterns_id', table_name='recurring_appointment_patterns')
    op.drop_table('recurring_appointment_patterns')
    op.drop_index('idx_usage_period_unique', table_name='marketing_usage')
    op.drop_index('ix_marketing_usage_id', table_name='marketing_usage')
    op.drop_table('marketing_usage')
    op.drop_index('ix_gamification_analytics_id', table_name='gamification_analytics')
    op.drop_table('gamification_analytics')
    op.drop_index('ix_weather_data_id', table_name='weather_data')
    op.drop_table('weather_data')
    op.drop_index('ix_contact_lists_id', table_name='contact_lists')
    op.drop_table('contact_lists')
    op.drop_index('ix_campaign_analytics_id', table_name='campaign_analytics')
    op.drop_table('campaign_analytics')
    op.drop_index('idx_agent_type_active', table_name='agents')
    op.drop_index('ix_agents_agent_type', table_name='agents')
    op.drop_index('ix_agents_id', table_name='agents')
    op.drop_table('agents')
    op.drop_index('ix_barber_locations_id', table_name='barber_locations')
    op.drop_table('barber_locations')
    op.drop_index('idx_analytics_period', table_name='six_fb_client_analytics_summaries')
    op.drop_index('idx_analytics_user_date', table_name='six_fb_client_analytics_summaries')
    op.drop_index('ix_six_fb_client_analytics_summaries_id', table_name='six_fb_client_analytics_summaries')
    op.drop_index('ix_six_fb_client_analytics_summaries_summary_date', table_name='six_fb_client_analytics_summaries')
    op.drop_index('ix_six_fb_client_analytics_summaries_user_id', table_name='six_fb_client_analytics_summaries')
    op.drop_table('six_fb_client_analytics_summaries')
    op.drop_index('idx_active_models', table_name='predictive_models')
    op.drop_index('idx_model_performance', table_name='predictive_models')
    op.drop_index('ix_predictive_models_id', table_name='predictive_models')
    op.drop_index('ix_predictive_models_model_name', table_name='predictive_models')
    op.drop_table('predictive_models')
    op.drop_index('ix_marketing_campaigns_id', table_name='marketing_campaigns')
    op.drop_table('marketing_campaigns')
    op.drop_index('idx_upsell_attempt_barber_date', table_name='upsell_attempts')
    op.drop_index('idx_upsell_attempt_client_date', table_name='upsell_attempts')
    op.drop_index('idx_upsell_attempt_status', table_name='upsell_attempts')
    op.drop_index('idx_upsell_opportunity', table_name='upsell_attempts')
    op.drop_index('ix_upsell_attempts_barber_id', table_name='upsell_attempts')
    op.drop_index('ix_upsell_attempts_client_id', table_name='upsell_attempts')
    op.drop_index('ix_upsell_attempts_id', table_name='upsell_attempts')
    op.drop_index('ix_upsell_attempts_opportunity_id', table_name='upsell_attempts')
    op.drop_table('upsell_attempts')
    op.drop_index('ix_product_variants_external_id', table_name='product_variants')
    op.drop_index('ix_product_variants_id', table_name='product_variants')
    op.drop_index('ix_product_variants_sku', table_name='product_variants')
    op.drop_table('product_variants')
    op.drop_index('ix_message_templates_id', table_name='message_templates')
    op.drop_table('message_templates')
    op.drop_index('idx_holiday_date_location', table_name='holiday_calendar')
    op.drop_index('ix_holiday_calendar_holiday_date', table_name='holiday_calendar')
    op.drop_index('ix_holiday_calendar_id', table_name='holiday_calendar')
    op.drop_table('holiday_calendar')
    op.drop_index('ix_six_figure_barber_principle_tracking_id', table_name='six_figure_barber_principle_tracking')
    op.drop_index('ix_six_figure_barber_principle_tracking_overall_compliance_score', table_name='six_figure_barber_principle_tracking')
    op.drop_index('ix_six_figure_barber_principle_tracking_user_id', table_name='six_figure_barber_principle_tracking')
    op.drop_table('six_figure_barber_principle_tracking')
    op.drop_index('idx_workflow_success_rate', table_name='six_fb_automated_workflows')
    op.drop_index('idx_workflow_trigger', table_name='six_fb_automated_workflows')
    op.drop_index('idx_workflow_user_active', table_name='six_fb_automated_workflows')
    op.drop_index('ix_six_fb_automated_workflows_id', table_name='six_fb_automated_workflows')
    op.drop_index('ix_six_fb_automated_workflows_user_id', table_name='six_fb_automated_workflows')
    op.drop_table('six_fb_automated_workflows')
    op.drop_index('ix_notification_preferences_id', table_name='notification_preferences')
    op.drop_table('notification_preferences')
    op.drop_index('idx_franchise_analytics_computed', table_name='franchise_analytics')
    op.drop_index('idx_franchise_analytics_entity_period', table_name='franchise_analytics')
    op.drop_index('ix_franchise_analytics_id', table_name='franchise_analytics')
    op.drop_table('franchise_analytics')
    op.drop_index('idx_comm_profile_engagement', table_name='six_fb_client_communication_profiles')
    op.drop_index('idx_comm_profile_user_client', table_name='six_fb_client_communication_profiles')
    op.drop_index('ix_six_fb_client_communication_profiles_client_id', table_name='six_fb_client_communication_profiles')
    op.drop_index('ix_six_fb_client_communication_profiles_id', table_name='six_fb_client_communication_profiles')
    op.drop_index('ix_six_fb_client_communication_profiles_user_id', table_name='six_fb_client_communication_profiles')
    op.drop_table('six_fb_client_communication_profiles')
    op.drop_index('ix_coaching_action_items_category', table_name='coaching_action_items')
    op.drop_index('ix_coaching_action_items_coaching_session_id', table_name='coaching_action_items')
    op.drop_index('ix_coaching_action_items_id', table_name='coaching_action_items')
    op.drop_index('ix_coaching_action_items_status', table_name='coaching_action_items')
    op.drop_index('ix_coaching_action_items_user_id', table_name='coaching_action_items')
    op.drop_table('coaching_action_items')
    op.drop_index('idx_participation_completed', table_name='challenge_participations')
    op.drop_index('idx_participation_user_challenge', table_name='challenge_participations')
    op.drop_index('ix_challenge_participations_challenge_id', table_name='challenge_participations')
    op.drop_index('ix_challenge_participations_id', table_name='challenge_participations')
    op.drop_index('ix_challenge_participations_user_id', table_name='challenge_participations')
    op.drop_table('challenge_participations')
    op.drop_index('ix_integrations_id', table_name='integrations')
    op.drop_table('integrations')
    op.drop_index('ix_sms_messages_id', table_name='sms_messages')
    op.drop_index('ix_sms_messages_twilio_sid', table_name='sms_messages')
    op.drop_table('sms_messages')
    op.drop_index('ix_platform_collections_barber_id', table_name='platform_collections')
    op.drop_index('ix_platform_collections_connection_id', table_name='platform_collections')
    op.drop_index('ix_platform_collections_external_transaction_id', table_name='platform_collections')
    op.drop_index('ix_platform_collections_id', table_name='platform_collections')
    op.drop_table('platform_collections')
    op.drop_index('ix_sms_conversations_customer_phone', table_name='sms_conversations')
    op.drop_index('ix_sms_conversations_id', table_name='sms_conversations')
    op.drop_table('sms_conversations')
    op.drop_index('idx_benchmark_lookup', table_name='performance_benchmarks')
    op.drop_index('idx_benchmark_region', table_name='performance_benchmarks')
    op.drop_index('idx_benchmark_temporal', table_name='performance_benchmarks')
    op.drop_index('ix_performance_benchmarks_business_segment', table_name='performance_benchmarks')
    op.drop_index('ix_performance_benchmarks_category', table_name='performance_benchmarks')
    op.drop_index('ix_performance_benchmarks_id', table_name='performance_benchmarks')
    op.drop_index('ix_performance_benchmarks_metric_name', table_name='performance_benchmarks')
    op.drop_index('ix_performance_benchmarks_month', table_name='performance_benchmarks')
    op.drop_index('ix_performance_benchmarks_region', table_name='performance_benchmarks')
    op.drop_index('ix_performance_benchmarks_year', table_name='performance_benchmarks')
    op.drop_table('performance_benchmarks')
    op.drop_index('idx_mfa_events_type', table_name='mfa_events')
    op.drop_index('idx_mfa_events_user', table_name='mfa_events')
    op.drop_index('ix_mfa_events_id', table_name='mfa_events')
    op.drop_table('mfa_events')
    op.drop_index('ix_pos_transactions_id', table_name='pos_transactions')
    op.drop_index('ix_pos_transactions_transaction_number', table_name='pos_transactions')
    op.drop_table('pos_transactions')
    op.drop_index('idx_tier_history_client_date', table_name='six_fb_client_value_tier_history')
    op.drop_index('idx_tier_history_user_tier', table_name='six_fb_client_value_tier_history')
    op.drop_index('ix_six_fb_client_value_tier_history_client_id', table_name='six_fb_client_value_tier_history')
    op.drop_index('ix_six_fb_client_value_tier_history_id', table_name='six_fb_client_value_tier_history')
    op.drop_index('ix_six_fb_client_value_tier_history_user_id', table_name='six_fb_client_value_tier_history')
    op.drop_table('six_fb_client_value_tier_history')
    op.drop_index('ix_weekly_insights_id', table_name='weekly_insights')
    op.drop_index('ix_weekly_insights_user_id', table_name='weekly_insights')
    op.drop_index('ix_weekly_insights_week_start_date', table_name='weekly_insights')
    op.drop_table('weekly_insights')
    op.drop_index('ix_user_consents_id', table_name='user_consents')
    op.drop_table('user_consents')
    op.drop_index('ix_timezone_cache_id', table_name='timezone_cache')
    op.drop_index('ix_timezone_cache_timezone_name', table_name='timezone_cache')
    op.drop_table('timezone_cache')
    op.drop_index('ix_webhook_events_event_id', table_name='webhook_events')
    op.drop_index('ix_webhook_events_event_type', table_name='webhook_events')
    op.drop_index('ix_webhook_events_id', table_name='webhook_events')
    op.drop_index('ix_webhook_events_provider', table_name='webhook_events')
    op.drop_table('webhook_events')
    op.drop_index('ix_six_fb_service_standards_id', table_name='six_fb_service_standards')
    op.drop_index('ix_six_fb_service_standards_user_id', table_name='six_fb_service_standards')
    op.drop_table('six_fb_service_standards')
    op.drop_index('idx_excellence_score', table_name='six_fb_service_excellence_metrics')
    op.drop_index('idx_excellence_user_date_area', table_name='six_fb_service_excellence_metrics')
    op.drop_index('ix_six_fb_service_excellence_metrics_appointment_id', table_name='six_fb_service_excellence_metrics')
    op.drop_index('ix_six_fb_service_excellence_metrics_client_id', table_name='six_fb_service_excellence_metrics')
    op.drop_index('ix_six_fb_service_excellence_metrics_id', table_name='six_fb_service_excellence_metrics')
    op.drop_index('ix_six_fb_service_excellence_metrics_service_date', table_name='six_fb_service_excellence_metrics')
    op.drop_index('ix_six_fb_service_excellence_metrics_user_id', table_name='six_fb_service_excellence_metrics')
    op.drop_table('six_fb_service_excellence_metrics')
    op.drop_index('idx_cross_user_analysis', table_name='cross_user_metrics')
    op.drop_index('idx_pattern_analysis', table_name='cross_user_metrics')
    op.drop_index('idx_temporal_analysis', table_name='cross_user_metrics')
    op.drop_index('ix_cross_user_metrics_business_segment', table_name='cross_user_metrics')
    op.drop_index('ix_cross_user_metrics_date', table_name='cross_user_metrics')
    op.drop_index('ix_cross_user_metrics_id', table_name='cross_user_metrics')
    op.drop_index('ix_cross_user_metrics_location_type', table_name='cross_user_metrics')
    op.drop_index('ix_cross_user_metrics_service_category', table_name='cross_user_metrics')
    op.drop_table('cross_user_metrics')
    op.drop_index('ix_order_items_external_id', table_name='order_items')
    op.drop_index('ix_order_items_id', table_name='order_items')
    op.drop_table('order_items')
    op.drop_index('ix_cancellation_policies_id', table_name='cancellation_policies')
    op.drop_table('cancellation_policies')
    op.drop_index('ix_hybrid_payment_configs_barber_id', table_name='hybrid_payment_configs')
    op.drop_index('ix_hybrid_payment_configs_id', table_name='hybrid_payment_configs')
    op.drop_table('hybrid_payment_configs')
    op.drop_index('ix_payment_processor_connections_barber_id', table_name='payment_processor_connections')
    op.drop_index('ix_payment_processor_connections_id', table_name='payment_processor_connections')
    op.drop_table('payment_processor_connections')
    op.drop_index('ix_data_export_requests_id', table_name='data_export_requests')
    op.drop_table('data_export_requests')
    op.drop_index('ix_subscription_billing_events_id', table_name='subscription_billing_events')
    op.drop_table('subscription_billing_events')
    op.drop_index('idx_pattern_exception_date', table_name='recurring_appointment_exceptions')
    op.drop_index('ix_recurring_appointment_exceptions_exception_date', table_name='recurring_appointment_exceptions')
    op.drop_index('ix_recurring_appointment_exceptions_id', table_name='recurring_appointment_exceptions')
    op.drop_table('recurring_appointment_exceptions')
    op.drop_index('ix_user_service_templates_id', table_name='user_service_templates')
    op.drop_table('user_service_templates')
    op.drop_index('idx_conversion_events_campaign', table_name='conversion_events')
    op.drop_index('idx_conversion_events_channel_date', table_name='conversion_events')
    op.drop_index('idx_conversion_events_type_date', table_name='conversion_events')
    op.drop_index('idx_conversion_events_user_date', table_name='conversion_events')
    op.drop_index('ix_conversion_events_channel', table_name='conversion_events')
    op.drop_index('ix_conversion_events_client_id', table_name='conversion_events')
    op.drop_index('ix_conversion_events_event_id', table_name='conversion_events')
    op.drop_index('ix_conversion_events_event_name', table_name='conversion_events')
    op.drop_index('ix_conversion_events_event_type', table_name='conversion_events')
    op.drop_index('ix_conversion_events_id', table_name='conversion_events')
    op.drop_index('ix_conversion_events_organization_id', table_name='conversion_events')
    op.drop_index('ix_conversion_events_session_id', table_name='conversion_events')
    op.drop_index('ix_conversion_events_user_id', table_name='conversion_events')
    op.drop_table('conversion_events')
    op.drop_index('ix_barber_time_off_end_date', table_name='barber_time_off')
    op.drop_index('ix_barber_time_off_id', table_name='barber_time_off')
    op.drop_index('ix_barber_time_off_start_date', table_name='barber_time_off')
    op.drop_table('barber_time_off')
    op.drop_table('services')
    op.drop_index('ix_six_fb_professional_development_plans_id', table_name='six_fb_professional_development_plans')
    op.drop_index('ix_six_fb_professional_development_plans_user_id', table_name='six_fb_professional_development_plans')
    op.drop_table('six_fb_professional_development_plans')
    op.drop_index('idx_webhook_active', table_name='webhook_endpoints')
    op.drop_index('idx_webhook_events', table_name='webhook_endpoints')
    op.drop_table('webhook_endpoints')
    op.drop_index('idx_user_org_organization_id', table_name='user_organizations')
    op.drop_index('idx_user_org_primary', table_name='user_organizations')
    op.drop_index('idx_user_org_role', table_name='user_organizations')
    op.drop_index('idx_user_org_user_id', table_name='user_organizations')
    op.drop_index('ix_user_organizations_id', table_name='user_organizations')
    op.drop_table('user_organizations')
    op.drop_index('ix_barbershop_locations_id', table_name='barbershop_locations')
    op.drop_index('ix_barbershop_locations_name', table_name='barbershop_locations')
    op.drop_table('barbershop_locations')
    op.drop_index('idx_growth_progress', table_name='six_fb_growth_metrics')
    op.drop_index('idx_growth_user_date_type', table_name='six_fb_growth_metrics')
    op.drop_index('ix_six_fb_growth_metrics_date', table_name='six_fb_growth_metrics')
    op.drop_index('ix_six_fb_growth_metrics_id', table_name='six_fb_growth_metrics')
    op.drop_index('ix_six_fb_growth_metrics_metric_type', table_name='six_fb_growth_metrics')
    op.drop_index('ix_six_fb_growth_metrics_user_id', table_name='six_fb_growth_metrics')
    op.drop_table('six_fb_growth_metrics')
    op.drop_index('ix_weekly_recommendations_category', table_name='weekly_recommendations')
    op.drop_index('ix_weekly_recommendations_id', table_name='weekly_recommendations')
    op.drop_index('ix_weekly_recommendations_priority', table_name='weekly_recommendations')
    op.drop_index('ix_weekly_recommendations_user_id', table_name='weekly_recommendations')
    op.drop_index('ix_weekly_recommendations_weekly_insight_id', table_name='weekly_recommendations')
    op.drop_table('weekly_recommendations')
    op.drop_index('idx_payments_appointment_id', table_name='payments')
    op.drop_index('idx_payments_appointment_status', table_name='payments')
    op.drop_index('idx_payments_barber_created', table_name='payments')
    op.drop_index('idx_payments_barber_status', table_name='payments')
    op.drop_index('idx_payments_org_created', table_name='payments')
    op.drop_index('idx_payments_status_amount', table_name='payments')
    op.drop_index('idx_payments_status_created', table_name='payments')
    op.drop_index('idx_payments_stripe_intent', table_name='payments')
    op.drop_index('idx_payments_user_status', table_name='payments')
    op.drop_index('ix_payments_id', table_name='payments')
    op.drop_table('payments')
    op.drop_index('idx_guest_booking_type', table_name='guest_booking_notifications')
    op.drop_index('ix_guest_booking_notifications_id', table_name='guest_booking_notifications')
    op.drop_table('guest_booking_notifications')
    op.drop_index('ix_recurring_appointment_series_id', table_name='recurring_appointment_series')
    op.drop_table('recurring_appointment_series')
    op.drop_index('ix_business_coaching_sessions_agent_id', table_name='business_coaching_sessions')
    op.drop_index('ix_business_coaching_sessions_id', table_name='business_coaching_sessions')
    op.drop_index('ix_business_coaching_sessions_session_type', table_name='business_coaching_sessions')
    op.drop_index('ix_business_coaching_sessions_status', table_name='business_coaching_sessions')
    op.drop_index('ix_business_coaching_sessions_user_id', table_name='business_coaching_sessions')
    op.drop_table('business_coaching_sessions')
    op.drop_index('ix_google_calendar_webhook_notifications_google_channel_id', table_name='google_calendar_webhook_notifications')
    op.drop_index('ix_google_calendar_webhook_notifications_google_resource_id', table_name='google_calendar_webhook_notifications')
    op.drop_index('ix_google_calendar_webhook_notifications_id', table_name='google_calendar_webhook_notifications')
    op.drop_index('ix_google_calendar_webhook_notifications_message_number', table_name='google_calendar_webhook_notifications')
    op.drop_index('ix_google_calendar_webhook_notifications_received_at', table_name='google_calendar_webhook_notifications')
    op.drop_index('ix_google_calendar_webhook_notifications_status', table_name='google_calendar_webhook_notifications')
    op.drop_index('ix_google_calendar_webhook_notifications_subscription_id', table_name='google_calendar_webhook_notifications')
    op.drop_table('google_calendar_webhook_notifications')
    op.drop_index('idx_barber_availability_barber_active', table_name='barber_availability')
    op.drop_index('idx_barber_availability_barber_day', table_name='barber_availability')
    op.drop_index('idx_barber_availability_day_active', table_name='barber_availability')
    op.drop_index('ix_barber_availability_day_of_week', table_name='barber_availability')
    op.drop_index('ix_barber_availability_id', table_name='barber_availability')
    op.drop_table('barber_availability')
    op.drop_index('ix_compensation_plans_id', table_name='compensation_plans')
    op.drop_table('compensation_plans')
    op.drop_index('ix_email_previews_id', table_name='email_previews')
    op.drop_index('ix_email_previews_template_name', table_name='email_previews')
    op.drop_table('email_previews')
    op.drop_index('idx_leaderboard_type_active', table_name='leaderboards')
    op.drop_index('idx_leaderboard_update', table_name='leaderboards')
    op.drop_index('ix_leaderboards_id', table_name='leaderboards')
    op.drop_index('ix_leaderboards_leaderboard_type', table_name='leaderboards')
    op.drop_table('leaderboards')
    op.drop_index('idx_subscription_status_tier', table_name='agent_subscriptions')
    op.drop_index('ix_agent_subscriptions_id', table_name='agent_subscriptions')
    op.drop_index('ix_agent_subscriptions_status', table_name='agent_subscriptions')
    op.drop_index('ix_agent_subscriptions_tier', table_name='agent_subscriptions')
    op.drop_table('agent_subscriptions')
    op.drop_index('idx_comm_campaign', table_name='six_fb_client_communications')
    op.drop_index('idx_comm_touchpoint', table_name='six_fb_client_communications')
    op.drop_index('idx_comm_type_status', table_name='six_fb_client_communications')
    op.drop_index('idx_comm_user_client_date', table_name='six_fb_client_communications')
    op.drop_index('ix_six_fb_client_communications_client_id', table_name='six_fb_client_communications')
    op.drop_index('ix_six_fb_client_communications_id', table_name='six_fb_client_communications')
    op.drop_index('ix_six_fb_client_communications_user_id', table_name='six_fb_client_communications')
    op.drop_table('six_fb_client_communications')
    op.drop_index('ix_chair_assignment_history_id', table_name='chair_assignment_history')
    op.drop_table('chair_assignment_history')
    op.drop_index('idx_franchise_region_code', table_name='franchise_regions')
    op.drop_index('idx_franchise_region_network_status', table_name='franchise_regions')
    op.drop_index('ix_franchise_regions_code', table_name='franchise_regions')
    op.drop_index('ix_franchise_regions_id', table_name='franchise_regions')
    op.drop_table('franchise_regions')
    op.drop_index('ix_email_campaigns_id', table_name='email_campaigns')
    op.drop_table('email_campaigns')
    op.drop_index('idx_xp_daily_weekly', table_name='user_xp_profiles')
    op.drop_index('idx_xp_total_level', table_name='user_xp_profiles')
    op.drop_index('ix_user_xp_profiles_current_level', table_name='user_xp_profiles')
    op.drop_index('ix_user_xp_profiles_id', table_name='user_xp_profiles')
    op.drop_index('ix_user_xp_profiles_total_xp', table_name='user_xp_profiles')
    op.drop_index('ix_user_xp_profiles_user_id', table_name='user_xp_profiles')
    op.drop_table('user_xp_profiles')
    op.drop_index('ix_ai_intervention_campaigns_id', table_name='ai_intervention_campaigns')
    op.drop_table('ai_intervention_campaigns')
    op.drop_index('idx_client_value_lifetime', table_name='six_fb_client_value_profiles')
    op.drop_index('idx_client_value_risk', table_name='six_fb_client_value_profiles')
    op.drop_index('idx_client_value_user_tier', table_name='six_fb_client_value_profiles')
    op.drop_index('ix_six_fb_client_value_profiles_client_id', table_name='six_fb_client_value_profiles')
    op.drop_index('ix_six_fb_client_value_profiles_id', table_name='six_fb_client_value_profiles')
    op.drop_index('ix_six_fb_client_value_profiles_user_id', table_name='six_fb_client_value_profiles')
    op.drop_index('ix_six_fb_client_value_profiles_value_tier', table_name='six_fb_client_value_profiles')
    op.drop_table('six_fb_client_value_profiles')
    op.drop_index('idx_template_type_active', table_name='agent_templates')
    op.drop_index('ix_agent_templates_agent_type', table_name='agent_templates')
    op.drop_index('ix_agent_templates_id', table_name='agent_templates')
    op.drop_table('agent_templates')
    op.drop_index('ix_notification_templates_id', table_name='notification_templates')
    op.drop_index('ix_notification_templates_name', table_name='notification_templates')
    op.drop_table('notification_templates')
    op.drop_index('idx_search_analytics_performance', table_name='search_analytics')
    op.drop_index('idx_search_analytics_query_time', table_name='search_analytics')
    op.drop_index('idx_search_analytics_type_time', table_name='search_analytics')
    op.drop_index('idx_search_analytics_user_time', table_name='search_analytics')
    op.drop_index('ix_search_analytics_created_at', table_name='search_analytics')
    op.drop_index('ix_search_analytics_id', table_name='search_analytics')
    op.drop_index('ix_search_analytics_query', table_name='search_analytics')
    op.drop_index('ix_search_analytics_query_hash', table_name='search_analytics')
    op.drop_index('ix_search_analytics_search_type', table_name='search_analytics')
    op.drop_index('ix_search_analytics_session_id', table_name='search_analytics')
    op.drop_index('ix_search_analytics_user_id', table_name='search_analytics')
    op.drop_table('search_analytics')
    op.drop_index('ix_service_subscription_templates_id', table_name='service_subscription_templates')
    op.drop_table('service_subscription_templates')
    op.drop_index('ix_semantic_search_config_id', table_name='semantic_search_config')
    op.drop_table('semantic_search_config')
    op.drop_index('idx_mfa_user_enabled', table_name='user_mfa_secrets')
    op.drop_index('ix_user_mfa_secrets_id', table_name='user_mfa_secrets')
    op.drop_table('user_mfa_secrets')
    op.drop_index('ix_timezone_conversion_log_appointment_id', table_name='timezone_conversion_log')
    op.drop_index('ix_timezone_conversion_log_id', table_name='timezone_conversion_log')
    op.drop_index('ix_timezone_conversion_log_user_id', table_name='timezone_conversion_log')
    op.drop_table('timezone_conversion_log')
    op.drop_index('idx_custom_perms_org_id', table_name='custom_role_permissions')
    op.drop_index('idx_custom_perms_org_role', table_name='custom_role_permissions')
    op.drop_index('idx_custom_perms_permission', table_name='custom_role_permissions')
    op.drop_index('idx_custom_perms_role', table_name='custom_role_permissions')
    op.drop_index('ix_custom_role_permissions_id', table_name='custom_role_permissions')
    op.drop_table('custom_role_permissions')
    op.drop_index('ix_search_query_suggestions_id', table_name='search_query_suggestions')
    op.drop_index('ix_search_query_suggestions_normalized_query', table_name='search_query_suggestions')
    op.drop_index('ix_search_query_suggestions_query', table_name='search_query_suggestions')
    op.drop_table('search_query_suggestions')
    op.drop_index('idx_campaign_tracking_active', table_name='campaign_tracking')
    op.drop_index('idx_campaign_tracking_dates', table_name='campaign_tracking')
    op.drop_index('ix_campaign_tracking_campaign_id', table_name='campaign_tracking')
    op.drop_index('ix_campaign_tracking_id', table_name='campaign_tracking')
    op.drop_index('ix_campaign_tracking_user_id', table_name='campaign_tracking')
    op.drop_table('campaign_tracking')
    op.drop_index('idx_clients_barber_created', table_name='clients')
    op.drop_index('idx_clients_email', table_name='clients')
    op.drop_index('idx_clients_phone', table_name='clients')
    op.drop_index('ix_clients_email', table_name='clients')
    op.drop_index('ix_clients_id', table_name='clients')
    op.drop_index('ix_clients_phone', table_name='clients')
    op.drop_table('clients')
    op.drop_index('idx_retention_dates', table_name='six_fb_retention_campaigns')
    op.drop_index('idx_retention_roi', table_name='six_fb_retention_campaigns')
    op.drop_index('idx_retention_user_status', table_name='six_fb_retention_campaigns')
    op.drop_index('ix_six_fb_retention_campaigns_id', table_name='six_fb_retention_campaigns')
    op.drop_index('ix_six_fb_retention_campaigns_user_id', table_name='six_fb_retention_campaigns')
    op.drop_table('six_fb_retention_campaigns')
    op.drop_index('ix_refunds_id', table_name='refunds')
    op.drop_table('refunds')
    op.drop_index('ix_business_intelligence_agents_agent_type', table_name='business_intelligence_agents')
    op.drop_index('ix_business_intelligence_agents_id', table_name='business_intelligence_agents')
    op.drop_index('ix_business_intelligence_agents_is_active', table_name='business_intelligence_agents')
    op.drop_table('business_intelligence_agents')
    op.drop_index('ix_tracking_configurations_id', table_name='tracking_configurations')
    op.drop_table('tracking_configurations')
    op.drop_index('ix_appointment_cancellations_id', table_name='appointment_cancellations')
    op.drop_table('appointment_cancellations')
    op.drop_index('idx_touchpoint_effectiveness', table_name='six_fb_client_touchpoint_plans')
    op.drop_index('idx_touchpoint_type_status', table_name='six_fb_client_touchpoint_plans')
    op.drop_index('idx_touchpoint_user_client_date', table_name='six_fb_client_touchpoint_plans')
    op.drop_index('ix_six_fb_client_touchpoint_plans_client_id', table_name='six_fb_client_touchpoint_plans')
    op.drop_index('ix_six_fb_client_touchpoint_plans_id', table_name='six_fb_client_touchpoint_plans')
    op.drop_index('ix_six_fb_client_touchpoint_plans_user_id', table_name='six_fb_client_touchpoint_plans')
    op.drop_table('six_fb_client_touchpoint_plans')
    op.drop_index('idx_behavior_churn_risk', table_name='six_fb_client_behavior_analytics')
    op.drop_index('idx_behavior_growth_potential', table_name='six_fb_client_behavior_analytics')
    op.drop_index('idx_behavior_user_client_date', table_name='six_fb_client_behavior_analytics')
    op.drop_index('ix_six_fb_client_behavior_analytics_analysis_date', table_name='six_fb_client_behavior_analytics')
    op.drop_index('ix_six_fb_client_behavior_analytics_client_id', table_name='six_fb_client_behavior_analytics')
    op.drop_index('ix_six_fb_client_behavior_analytics_id', table_name='six_fb_client_behavior_analytics')
    op.drop_index('ix_six_fb_client_behavior_analytics_user_id', table_name='six_fb_client_behavior_analytics')
    op.drop_table('six_fb_client_behavior_analytics')
    op.drop_index('idx_challenge_dates', table_name='gamification_challenges')
    op.drop_index('idx_challenge_type_active', table_name='gamification_challenges')
    op.drop_index('ix_gamification_challenges_challenge_type', table_name='gamification_challenges')
    op.drop_index('ix_gamification_challenges_end_date', table_name='gamification_challenges')
    op.drop_index('ix_gamification_challenges_id', table_name='gamification_challenges')
    op.drop_index('ix_gamification_challenges_start_date', table_name='gamification_challenges')
    op.drop_table('gamification_challenges')
    op.drop_index('idx_embedding_cache_active_used', table_name='embedding_cache')
    op.drop_index('idx_embedding_cache_model_dimension', table_name='embedding_cache')
    op.drop_index('idx_embedding_cache_type_entity', table_name='embedding_cache')
    op.drop_index('ix_embedding_cache_content_hash', table_name='embedding_cache')
    op.drop_index('ix_embedding_cache_content_type', table_name='embedding_cache')
    op.drop_index('ix_embedding_cache_entity_id', table_name='embedding_cache')
    op.drop_index('ix_embedding_cache_id', table_name='embedding_cache')
    op.drop_index('ix_embedding_cache_is_active', table_name='embedding_cache')
    op.drop_table('embedding_cache')
    op.drop_index('ix_ai_experiments_id', table_name='ai_experiments')
    op.drop_table('ai_experiments')
    op.drop_index('ix_products_external_id', table_name='products')
    op.drop_index('ix_products_handle', table_name='products')
    op.drop_index('ix_products_id', table_name='products')
    op.drop_index('ix_products_sku', table_name='products')
    op.drop_table('products')
    op.drop_index('idx_blackout_date_barber', table_name='blackout_dates')
    op.drop_index('idx_blackout_date_location', table_name='blackout_dates')
    op.drop_index('ix_blackout_dates_blackout_date', table_name='blackout_dates')
    op.drop_index('ix_blackout_dates_id', table_name='blackout_dates')
    op.drop_table('blackout_dates')
    op.drop_index('ix_google_calendar_conflict_resolutions_appointment_id', table_name='google_calendar_conflict_resolutions')
    op.drop_index('ix_google_calendar_conflict_resolutions_conflict_type', table_name='google_calendar_conflict_resolutions')
    op.drop_index('ix_google_calendar_conflict_resolutions_id', table_name='google_calendar_conflict_resolutions')
    op.drop_index('ix_google_calendar_conflict_resolutions_requires_manual_review', table_name='google_calendar_conflict_resolutions')
    op.drop_index('ix_google_calendar_conflict_resolutions_status', table_name='google_calendar_conflict_resolutions')
    op.drop_index('ix_google_calendar_conflict_resolutions_sync_event_id', table_name='google_calendar_conflict_resolutions')
    op.drop_index('ix_google_calendar_conflict_resolutions_user_id', table_name='google_calendar_conflict_resolutions')
    op.drop_table('google_calendar_conflict_resolutions')
    op.drop_index('idx_achievement_active_visible', table_name='achievement_definitions')
    op.drop_index('idx_achievement_category_rarity', table_name='achievement_definitions')
    op.drop_index('ix_achievement_definitions_category', table_name='achievement_definitions')
    op.drop_index('ix_achievement_definitions_id', table_name='achievement_definitions')
    op.drop_index('ix_achievement_definitions_rarity', table_name='achievement_definitions')
    op.drop_table('achievement_definitions')
    op.drop_index('ix_marketing_templates_id', table_name='marketing_templates')
    op.drop_table('marketing_templates')
    op.drop_index('idx_conversion_goals_user_active', table_name='conversion_goals')
    op.drop_index('ix_conversion_goals_id', table_name='conversion_goals')
    op.drop_index('ix_conversion_goals_user_id', table_name='conversion_goals')
    op.drop_table('conversion_goals')
    op.drop_index('idx_webhook_log_created', table_name='webhook_logs')
    op.drop_index('idx_webhook_log_endpoint', table_name='webhook_logs')
    op.drop_index('idx_webhook_log_event', table_name='webhook_logs')
    op.drop_index('idx_webhook_log_status', table_name='webhook_logs')
    op.drop_table('webhook_logs')
    op.drop_index('ix_service_template_categories_id', table_name='service_template_categories')
    op.drop_index('ix_service_template_categories_name', table_name='service_template_categories')
    op.drop_table('service_template_categories')
    op.drop_index('idx_metrics_instance_date', table_name='agent_metrics')
    op.drop_index('ix_agent_metrics_date', table_name='agent_metrics')
    op.drop_index('ix_agent_metrics_id', table_name='agent_metrics')
    op.drop_table('agent_metrics')
    op.drop_table('ai_memory_records')
    op.drop_index('idx_analytics_barber_period', table_name='upsell_analytics')
    op.drop_index('idx_analytics_period_type', table_name='upsell_analytics')
    op.drop_index('ix_upsell_analytics_barber_id', table_name='upsell_analytics')
    op.drop_index('ix_upsell_analytics_id', table_name='upsell_analytics')
    op.drop_table('upsell_analytics')
    op.drop_index('ix_ai_message_generations_id', table_name='ai_message_generations')
    op.drop_table('ai_message_generations')
    op.drop_index('idx_backup_codes_hash', table_name='mfa_backup_codes')
    op.drop_index('idx_backup_codes_user_unused', table_name='mfa_backup_codes')
    op.drop_index('ix_mfa_backup_codes_id', table_name='mfa_backup_codes')
    op.drop_table('mfa_backup_codes')
    op.drop_index('ix_password_reset_tokens_id', table_name='password_reset_tokens')
    op.drop_index('ix_password_reset_tokens_token', table_name='password_reset_tokens')
    op.drop_table('password_reset_tokens')
    op.drop_index('ix_reviews_business_id', table_name='reviews')
    op.drop_index('ix_reviews_created_at', table_name='reviews')
    op.drop_index('ix_reviews_external_id', table_name='reviews')
    op.drop_index('ix_reviews_external_review_id', table_name='reviews')
    op.drop_index('ix_reviews_id', table_name='reviews')
    op.drop_index('ix_reviews_platform', table_name='reviews')
    op.drop_index('ix_reviews_response_status', table_name='reviews')
    op.drop_index('ix_reviews_review_date', table_name='reviews')
    op.drop_index('ix_reviews_sentiment', table_name='reviews')
    op.drop_index('ix_reviews_source', table_name='reviews')
    op.drop_index('ix_reviews_status', table_name='reviews')
    op.drop_table('reviews')
    op.drop_index('ix_payment_mode_history_barber_id', table_name='payment_mode_history')
    op.drop_index('ix_payment_mode_history_id', table_name='payment_mode_history')
    op.drop_table('payment_mode_history')
    op.drop_index('idx_dashboard_score', table_name='six_fb_methodology_dashboards')
    op.drop_index('idx_dashboard_user_date', table_name='six_fb_methodology_dashboards')
    op.drop_index('ix_six_fb_methodology_dashboards_dashboard_date', table_name='six_fb_methodology_dashboards')
    op.drop_index('ix_six_fb_methodology_dashboards_id', table_name='six_fb_methodology_dashboards')
    op.drop_index('ix_six_fb_methodology_dashboards_user_id', table_name='six_fb_methodology_dashboards')
    op.drop_table('six_fb_methodology_dashboards')
    op.drop_index('idx_users_created_active', table_name='users')
    op.drop_index('idx_users_email', table_name='users')
    op.drop_index('idx_users_email_active', table_name='users')
    op.drop_index('idx_users_role_active', table_name='users')
    op.drop_table('users')
    op.drop_index('ix_unsubscribe_requests_email_address', table_name='unsubscribe_requests')
    op.drop_index('ix_unsubscribe_requests_id', table_name='unsubscribe_requests')
    op.drop_index('ix_unsubscribe_requests_phone_number', table_name='unsubscribe_requests')
    op.drop_table('unsubscribe_requests')
    op.drop_index('idx_knowledge_category', table_name='ai_knowledge_base')
    op.drop_index('idx_knowledge_performance', table_name='ai_knowledge_base')
    op.drop_index('ix_ai_knowledge_base_category', table_name='ai_knowledge_base')
    op.drop_index('ix_ai_knowledge_base_id', table_name='ai_knowledge_base')
    op.drop_table('ai_knowledge_base')
    op.drop_table('pattern_memory_links')
    op.drop_index('ix_recurring_appointment_conflicts_conflict_date', table_name='recurring_appointment_conflicts')
    op.drop_index('ix_recurring_appointment_conflicts_id', table_name='recurring_appointment_conflicts')
    op.drop_table('recurring_appointment_conflicts')
    op.drop_table('barber_services')
    op.drop_index('idx_notification_expires', table_name='gamification_notifications')
    op.drop_index('idx_notification_sent_read', table_name='gamification_notifications')
    op.drop_index('idx_notification_user_type', table_name='gamification_notifications')
    op.drop_index('ix_gamification_notifications_id', table_name='gamification_notifications')
    op.drop_index('ix_gamification_notifications_notification_type', table_name='gamification_notifications')
    op.drop_index('ix_gamification_notifications_user_id', table_name='gamification_notifications')
    op.drop_table('gamification_notifications')
    op.drop_index('ix_google_calendar_sync_events_appointment_id', table_name='google_calendar_sync_events')
    op.drop_index('ix_google_calendar_sync_events_google_event_id', table_name='google_calendar_sync_events')
    op.drop_index('ix_google_calendar_sync_events_id', table_name='google_calendar_sync_events')
    op.drop_index('ix_google_calendar_sync_events_notification_id', table_name='google_calendar_sync_events')
    op.drop_index('ix_google_calendar_sync_events_operation_type', table_name='google_calendar_sync_events')
    op.drop_index('ix_google_calendar_sync_events_sync_direction', table_name='google_calendar_sync_events')
    op.drop_index('ix_google_calendar_sync_events_sync_status', table_name='google_calendar_sync_events')
    op.drop_index('ix_google_calendar_sync_events_user_id', table_name='google_calendar_sync_events')
    op.drop_table('google_calendar_sync_events')
    op.drop_index('ix_google_calendar_webhook_subscriptions_expiration_time', table_name='google_calendar_webhook_subscriptions')
    op.drop_index('ix_google_calendar_webhook_subscriptions_google_calendar_id', table_name='google_calendar_webhook_subscriptions')
    op.drop_index('ix_google_calendar_webhook_subscriptions_google_subscription_id', table_name='google_calendar_webhook_subscriptions')
    op.drop_index('ix_google_calendar_webhook_subscriptions_id', table_name='google_calendar_webhook_subscriptions')
    op.drop_index('ix_google_calendar_webhook_subscriptions_is_active', table_name='google_calendar_webhook_subscriptions')
    op.drop_index('ix_google_calendar_webhook_subscriptions_user_id', table_name='google_calendar_webhook_subscriptions')
    op.drop_table('google_calendar_webhook_subscriptions')
    op.drop_index('ix_service_booking_rules_id', table_name='service_booking_rules')
    op.drop_table('service_booking_rules')
    op.drop_index('ix_google_calendar_sync_logs_appointment_id', table_name='google_calendar_sync_logs')
    op.drop_index('ix_google_calendar_sync_logs_created_at', table_name='google_calendar_sync_logs')
    op.drop_index('ix_google_calendar_sync_logs_direction', table_name='google_calendar_sync_logs')
    op.drop_index('ix_google_calendar_sync_logs_google_event_id', table_name='google_calendar_sync_logs')
    op.drop_index('ix_google_calendar_sync_logs_id', table_name='google_calendar_sync_logs')
    op.drop_index('ix_google_calendar_sync_logs_operation', table_name='google_calendar_sync_logs')
    op.drop_index('ix_google_calendar_sync_logs_status', table_name='google_calendar_sync_logs')
    op.drop_index('ix_google_calendar_sync_logs_user_id', table_name='google_calendar_sync_logs')
    op.drop_table('google_calendar_sync_logs')
    op.drop_index('idx_journey_progression', table_name='six_fb_client_journey_stages')
    op.drop_index('idx_journey_risk', table_name='six_fb_client_journey_stages')
    op.drop_index('idx_journey_user_client_stage', table_name='six_fb_client_journey_stages')
    op.drop_index('ix_six_fb_client_journey_stages_client_id', table_name='six_fb_client_journey_stages')
    op.drop_index('ix_six_fb_client_journey_stages_current_stage', table_name='six_fb_client_journey_stages')
    op.drop_index('ix_six_fb_client_journey_stages_id', table_name='six_fb_client_journey_stages')
    op.drop_index('ix_six_fb_client_journey_stages_user_id', table_name='six_fb_client_journey_stages')
    op.drop_table('six_fb_client_journey_stages')
    op.drop_index('idx_execution_client_status', table_name='six_fb_workflow_executions')
    op.drop_index('idx_execution_revenue', table_name='six_fb_workflow_executions')
    op.drop_index('idx_execution_workflow_date', table_name='six_fb_workflow_executions')
    op.drop_index('ix_six_fb_workflow_executions_client_id', table_name='six_fb_workflow_executions')
    op.drop_index('ix_six_fb_workflow_executions_execution_id', table_name='six_fb_workflow_executions')
    op.drop_index('ix_six_fb_workflow_executions_id', table_name='six_fb_workflow_executions')
    op.drop_index('ix_six_fb_workflow_executions_user_id', table_name='six_fb_workflow_executions')
    op.drop_index('ix_six_fb_workflow_executions_workflow_id', table_name='six_fb_workflow_executions')
    op.drop_table('six_fb_workflow_executions')
    op.drop_index('idx_analytics_period_template', table_name='email_analytics_summaries')
    op.drop_index('ix_email_analytics_summaries_campaign_id', table_name='email_analytics_summaries')
    op.drop_index('ix_email_analytics_summaries_date', table_name='email_analytics_summaries')
    op.drop_index('ix_email_analytics_summaries_hour', table_name='email_analytics_summaries')
    op.drop_index('ix_email_analytics_summaries_id', table_name='email_analytics_summaries')
    op.drop_index('ix_email_analytics_summaries_template_name', table_name='email_analytics_summaries')
    op.drop_table('email_analytics_summaries')
    op.drop_index('ix_review_templates_category', table_name='review_templates')
    op.drop_index('ix_review_templates_id', table_name='review_templates')
    op.drop_table('review_templates')
    op.drop_index('ix_subscription_usage_records_id', table_name='subscription_usage_records')
    op.drop_table('subscription_usage_records')
    op.drop_index('idx_efficiency_user_date_type', table_name='six_fb_efficiency_metrics')
    op.drop_index('idx_efficiency_value', table_name='six_fb_efficiency_metrics')
    op.drop_index('ix_six_fb_efficiency_metrics_date', table_name='six_fb_efficiency_metrics')
    op.drop_index('ix_six_fb_efficiency_metrics_id', table_name='six_fb_efficiency_metrics')
    op.drop_index('ix_six_fb_efficiency_metrics_metric_type', table_name='six_fb_efficiency_metrics')
    op.drop_index('ix_six_fb_efficiency_metrics_user_id', table_name='six_fb_efficiency_metrics')
    op.drop_table('six_fb_efficiency_metrics')
    op.drop_index('ix_service_pricing_rules_id', table_name='service_pricing_rules')
    op.drop_table('service_pricing_rules')
    op.drop_index('ix_short_urls_id', table_name='short_urls')
    op.drop_index('ix_short_urls_short_code', table_name='short_urls')
    op.drop_table('short_urls')
    op.drop_index('idx_revenue_date_amount', table_name='six_fb_revenue_metrics')
    op.drop_index('idx_revenue_user_date_type', table_name='six_fb_revenue_metrics')
    op.drop_index('ix_six_fb_revenue_metrics_date', table_name='six_fb_revenue_metrics')
    op.drop_index('ix_six_fb_revenue_metrics_id', table_name='six_fb_revenue_metrics')
    op.drop_index('ix_six_fb_revenue_metrics_metric_type', table_name='six_fb_revenue_metrics')
    op.drop_index('ix_six_fb_revenue_metrics_user_id', table_name='six_fb_revenue_metrics')
    op.drop_table('six_fb_revenue_metrics')
    op.drop_index('ix_weekly_insight_archives_archive_end_date', table_name='weekly_insight_archives')
    op.drop_index('ix_weekly_insight_archives_archive_start_date', table_name='weekly_insight_archives')
    op.drop_index('ix_weekly_insight_archives_id', table_name='weekly_insight_archives')
    op.drop_index('ix_weekly_insight_archives_user_id', table_name='weekly_insight_archives')
    op.drop_table('weekly_insight_archives')
    op.drop_index('ix_notification_channels_id', table_name='notification_channels')
    op.drop_table('notification_channels')
    op.drop_index('ix_attribution_paths_id', table_name='attribution_paths')
    op.drop_index('ix_attribution_paths_user_id', table_name='attribution_paths')
    op.drop_table('attribution_paths')
    op.drop_index('idx_leaderboard_entry_position', table_name='leaderboard_entries')
    op.drop_index('idx_leaderboard_entry_score', table_name='leaderboard_entries')
    op.drop_index('idx_leaderboard_entry_user', table_name='leaderboard_entries')
    op.drop_index('ix_leaderboard_entries_current_position', table_name='leaderboard_entries')
    op.drop_index('ix_leaderboard_entries_id', table_name='leaderboard_entries')
    op.drop_index('ix_leaderboard_entries_leaderboard_id', table_name='leaderboard_entries')
    op.drop_index('ix_leaderboard_entries_user_id', table_name='leaderboard_entries')
    op.drop_table('leaderboard_entries')
    op.drop_index('idx_report_type', table_name='business_intelligence_reports')
    op.drop_index('idx_user_reports', table_name='business_intelligence_reports')
    op.drop_index('ix_business_intelligence_reports_id', table_name='business_intelligence_reports')
    op.drop_index('ix_business_intelligence_reports_user_id', table_name='business_intelligence_reports')
    op.drop_table('business_intelligence_reports')
    op.drop_index('ix_barber_special_availability_date', table_name='barber_special_availability')
    op.drop_index('ix_barber_special_availability_id', table_name='barber_special_availability')
    op.drop_table('barber_special_availability')
    op.drop_index('ix_notification_queue_id', table_name='notification_queue')
    op.drop_table('notification_queue')
    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('notification_queue',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=True),
    sa.Column('appointment_id', sa.INTEGER(), nullable=True),
    sa.Column('notification_type', sa.VARCHAR(), nullable=True),
    sa.Column('template_name', sa.VARCHAR(), nullable=True),
    sa.Column('recipient', sa.VARCHAR(), nullable=True),
    sa.Column('subject', sa.VARCHAR(), nullable=True),
    sa.Column('body', sa.TEXT(), nullable=True),
    sa.Column('status', sa.VARCHAR(length=9), nullable=True),
    sa.Column('scheduled_for', sa.DATETIME(), nullable=True),
    sa.Column('sent_at', sa.DATETIME(), nullable=True),
    sa.Column('attempts', sa.INTEGER(), nullable=True),
    sa.Column('error_message', sa.TEXT(), nullable=True),
    sa.Column('notification_metadata', sqlite.JSON(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['appointment_id'], ['appointments.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_notification_queue_id', 'notification_queue', ['id'], unique=False)
    op.create_table('barber_special_availability',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('barber_id', sa.INTEGER(), nullable=False),
    sa.Column('date', sa.DATE(), nullable=False),
    sa.Column('start_time', sa.TIME(), nullable=False),
    sa.Column('end_time', sa.TIME(), nullable=False),
    sa.Column('availability_type', sa.VARCHAR(), nullable=True),
    sa.Column('notes', sa.TEXT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['barber_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_barber_special_availability_id', 'barber_special_availability', ['id'], unique=False)
    op.create_index('ix_barber_special_availability_date', 'barber_special_availability', ['date'], unique=False)
    op.create_table('business_intelligence_reports',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('report_type', sa.VARCHAR(length=50), nullable=False),
    sa.Column('title', sa.VARCHAR(length=200), nullable=False),
    sa.Column('executive_summary', sa.TEXT(), nullable=False),
    sa.Column('key_insights', sqlite.JSON(), nullable=False),
    sa.Column('recommendations', sqlite.JSON(), nullable=False),
    sa.Column('benchmarks', sqlite.JSON(), nullable=True),
    sa.Column('predictions', sqlite.JSON(), nullable=True),
    sa.Column('date_range_start', sa.DATETIME(), nullable=False),
    sa.Column('date_range_end', sa.DATETIME(), nullable=False),
    sa.Column('business_areas_covered', sqlite.JSON(), nullable=False),
    sa.Column('insight_count', sa.INTEGER(), nullable=False),
    sa.Column('data_freshness_score', sa.FLOAT(), nullable=False),
    sa.Column('confidence_score', sa.FLOAT(), nullable=False),
    sa.Column('generated_at', sa.DATETIME(), nullable=False),
    sa.Column('viewed_at', sa.DATETIME(), nullable=True),
    sa.Column('downloaded_at', sa.DATETIME(), nullable=True),
    sa.Column('user_rating', sa.INTEGER(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_business_intelligence_reports_user_id', 'business_intelligence_reports', ['user_id'], unique=False)
    op.create_index('ix_business_intelligence_reports_id', 'business_intelligence_reports', ['id'], unique=False)
    op.create_index('idx_user_reports', 'business_intelligence_reports', ['user_id', 'generated_at'], unique=False)
    op.create_index('idx_report_type', 'business_intelligence_reports', ['report_type', 'generated_at'], unique=False)
    op.create_table('leaderboard_entries',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('leaderboard_id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('current_position', sa.INTEGER(), nullable=False),
    sa.Column('previous_position', sa.INTEGER(), nullable=True),
    sa.Column('position_change', sa.INTEGER(), nullable=True),
    sa.Column('highest_position_ever', sa.INTEGER(), nullable=True),
    sa.Column('current_score', sa.FLOAT(), nullable=False),
    sa.Column('previous_score', sa.FLOAT(), nullable=True),
    sa.Column('score_change', sa.FLOAT(), nullable=True),
    sa.Column('percentile_rank', sa.FLOAT(), nullable=True),
    sa.Column('position_milestones', sqlite.JSON(), nullable=True),
    sa.Column('score_milestones', sqlite.JSON(), nullable=True),
    sa.Column('time_in_top_10', sa.INTEGER(), nullable=True),
    sa.Column('time_in_top_100', sa.INTEGER(), nullable=True),
    sa.Column('score_breakdown', sqlite.JSON(), nullable=True),
    sa.Column('contributing_factors', sqlite.JSON(), nullable=True),
    sa.Column('performance_trends', sqlite.JSON(), nullable=True),
    sa.Column('position_rewards_earned', sqlite.JSON(), nullable=True),
    sa.Column('milestone_rewards_earned', sqlite.JSON(), nullable=True),
    sa.Column('recognition_badges', sqlite.JSON(), nullable=True),
    sa.Column('entry_date', sa.DATETIME(), nullable=True),
    sa.Column('last_score_update', sa.DATETIME(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['leaderboard_id'], ['leaderboards.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_leaderboard_entries_user_id', 'leaderboard_entries', ['user_id'], unique=False)
    op.create_index('ix_leaderboard_entries_leaderboard_id', 'leaderboard_entries', ['leaderboard_id'], unique=False)
    op.create_index('ix_leaderboard_entries_id', 'leaderboard_entries', ['id'], unique=False)
    op.create_index('ix_leaderboard_entries_current_position', 'leaderboard_entries', ['current_position'], unique=False)
    op.create_index('idx_leaderboard_entry_user', 'leaderboard_entries', ['user_id', 'current_position'], unique=False)
    op.create_index('idx_leaderboard_entry_score', 'leaderboard_entries', ['current_score'], unique=False)
    op.create_index('idx_leaderboard_entry_position', 'leaderboard_entries', ['leaderboard_id', 'current_position'], unique=False)
    op.create_table('attribution_paths',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('conversion_event_id', sa.INTEGER(), nullable=False),
    sa.Column('touchpoints', sqlite.JSON(), nullable=False),
    sa.Column('first_touch_channel', sa.VARCHAR(length=50), nullable=True),
    sa.Column('last_touch_channel', sa.VARCHAR(length=50), nullable=True),
    sa.Column('path_length', sa.INTEGER(), nullable=True),
    sa.Column('attribution_model', sa.VARCHAR(length=14), nullable=True),
    sa.Column('attribution_weights', sqlite.JSON(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['conversion_event_id'], ['conversion_events.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('conversion_event_id')
    )
    op.create_index('ix_attribution_paths_user_id', 'attribution_paths', ['user_id'], unique=False)
    op.create_index('ix_attribution_paths_id', 'attribution_paths', ['id'], unique=False)
    op.create_table('notification_channels',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(length=50), nullable=False),
    sa.Column('display_name', sa.VARCHAR(length=100), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('requires_consent', sa.BOOLEAN(), nullable=True),
    sa.Column('supports_marketing', sa.BOOLEAN(), nullable=True),
    sa.Column('supports_transactional', sa.BOOLEAN(), nullable=True),
    sa.Column('rate_limit_per_hour', sa.INTEGER(), nullable=True),
    sa.Column('rate_limit_per_day', sa.INTEGER(), nullable=True),
    sa.Column('configuration', sqlite.JSON(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('name')
    )
    op.create_index('ix_notification_channels_id', 'notification_channels', ['id'], unique=False)
    op.create_table('weekly_insight_archives',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('archive_start_date', sa.DATETIME(), nullable=False),
    sa.Column('archive_end_date', sa.DATETIME(), nullable=False),
    sa.Column('insights_count', sa.INTEGER(), nullable=False),
    sa.Column('insights_data', sqlite.JSON(), nullable=False),
    sa.Column('aggregated_metrics', sqlite.JSON(), nullable=True),
    sa.Column('compression_ratio', sa.FLOAT(), nullable=True),
    sa.Column('original_size_bytes', sa.INTEGER(), nullable=True),
    sa.Column('compressed_size_bytes', sa.INTEGER(), nullable=True),
    sa.Column('archived_at', sa.DATETIME(), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_weekly_insight_archives_user_id', 'weekly_insight_archives', ['user_id'], unique=False)
    op.create_index('ix_weekly_insight_archives_id', 'weekly_insight_archives', ['id'], unique=False)
    op.create_index('ix_weekly_insight_archives_archive_start_date', 'weekly_insight_archives', ['archive_start_date'], unique=False)
    op.create_index('ix_weekly_insight_archives_archive_end_date', 'weekly_insight_archives', ['archive_end_date'], unique=False)
    op.create_table('six_fb_revenue_metrics',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('date', sa.DATE(), nullable=False),
    sa.Column('metric_type', sa.VARCHAR(length=25), nullable=False),
    sa.Column('amount', sa.NUMERIC(precision=10, scale=2), nullable=False),
    sa.Column('target_amount', sa.NUMERIC(precision=10, scale=2), nullable=True),
    sa.Column('variance_amount', sa.NUMERIC(precision=10, scale=2), nullable=True),
    sa.Column('variance_percentage', sa.FLOAT(), nullable=True),
    sa.Column('service_count', sa.INTEGER(), nullable=True),
    sa.Column('client_count', sa.INTEGER(), nullable=True),
    sa.Column('average_ticket', sa.NUMERIC(precision=10, scale=2), nullable=True),
    sa.Column('upsell_revenue', sa.NUMERIC(precision=10, scale=2), nullable=True),
    sa.Column('retail_revenue', sa.NUMERIC(precision=10, scale=2), nullable=True),
    sa.Column('premium_service_percentage', sa.FLOAT(), nullable=True),
    sa.Column('client_lifetime_value_impact', sa.NUMERIC(precision=10, scale=2), nullable=True),
    sa.Column('pricing_strategy_effectiveness', sa.FLOAT(), nullable=True),
    sa.Column('insights', sqlite.JSON(), nullable=True),
    sa.Column('optimization_opportunities', sqlite.JSON(), nullable=True),
    sa.Column('competitive_positioning', sqlite.JSON(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_six_fb_revenue_metrics_user_id', 'six_fb_revenue_metrics', ['user_id'], unique=False)
    op.create_index('ix_six_fb_revenue_metrics_metric_type', 'six_fb_revenue_metrics', ['metric_type'], unique=False)
    op.create_index('ix_six_fb_revenue_metrics_id', 'six_fb_revenue_metrics', ['id'], unique=False)
    op.create_index('ix_six_fb_revenue_metrics_date', 'six_fb_revenue_metrics', ['date'], unique=False)
    op.create_index('idx_revenue_user_date_type', 'six_fb_revenue_metrics', ['user_id', 'date', 'metric_type'], unique=False)
    op.create_index('idx_revenue_date_amount', 'six_fb_revenue_metrics', ['date', 'amount'], unique=False)
    op.create_table('short_urls',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('short_code', sa.VARCHAR(length=10), nullable=False),
    sa.Column('original_url', sa.TEXT(), nullable=False),
    sa.Column('title', sa.VARCHAR(length=200), nullable=True),
    sa.Column('description', sa.VARCHAR(length=500), nullable=True),
    sa.Column('click_count', sa.INTEGER(), nullable=True),
    sa.Column('last_clicked', sa.DATETIME(), nullable=True),
    sa.Column('created_by', sa.VARCHAR(length=100), nullable=True),
    sa.Column('expires_at', sa.DATETIME(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_short_urls_short_code', 'short_urls', ['short_code'], unique=1)
    op.create_index('ix_short_urls_id', 'short_urls', ['id'], unique=False)
    op.create_table('service_pricing_rules',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('service_id', sa.INTEGER(), nullable=False),
    sa.Column('rule_type', sa.VARCHAR(), nullable=False),
    sa.Column('start_time', sa.TIME(), nullable=True),
    sa.Column('end_time', sa.TIME(), nullable=True),
    sa.Column('day_of_week', sa.INTEGER(), nullable=True),
    sa.Column('start_date', sa.DATE(), nullable=True),
    sa.Column('end_date', sa.DATE(), nullable=True),
    sa.Column('price_adjustment_type', sa.VARCHAR(), nullable=False),
    sa.Column('price_adjustment_value', sa.FLOAT(), nullable=False),
    sa.Column('priority', sa.INTEGER(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['service_id'], ['services.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_service_pricing_rules_id', 'service_pricing_rules', ['id'], unique=False)
    op.create_table('six_fb_efficiency_metrics',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('date', sa.DATE(), nullable=False),
    sa.Column('metric_type', sa.VARCHAR(length=27), nullable=False),
    sa.Column('value', sa.FLOAT(), nullable=False),
    sa.Column('target_value', sa.FLOAT(), nullable=True),
    sa.Column('variance', sa.FLOAT(), nullable=True),
    sa.Column('variance_percentage', sa.FLOAT(), nullable=True),
    sa.Column('measurement_unit', sa.VARCHAR(), nullable=True),
    sa.Column('sample_size', sa.INTEGER(), nullable=True),
    sa.Column('calculation_method', sa.VARCHAR(), nullable=True),
    sa.Column('efficiency_impact_on_revenue', sa.NUMERIC(precision=8, scale=2), nullable=True),
    sa.Column('client_experience_impact', sa.FLOAT(), nullable=True),
    sa.Column('brand_positioning_impact', sa.FLOAT(), nullable=True),
    sa.Column('contributing_factors', sqlite.JSON(), nullable=True),
    sa.Column('improvement_opportunities', sqlite.JSON(), nullable=True),
    sa.Column('best_practices_applied', sqlite.JSON(), nullable=True),
    sa.Column('industry_benchmark', sa.FLOAT(), nullable=True),
    sa.Column('six_fb_benchmark', sa.FLOAT(), nullable=True),
    sa.Column('performance_vs_benchmark', sa.FLOAT(), nullable=True),
    sa.Column('data_quality_score', sa.FLOAT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_six_fb_efficiency_metrics_user_id', 'six_fb_efficiency_metrics', ['user_id'], unique=False)
    op.create_index('ix_six_fb_efficiency_metrics_metric_type', 'six_fb_efficiency_metrics', ['metric_type'], unique=False)
    op.create_index('ix_six_fb_efficiency_metrics_id', 'six_fb_efficiency_metrics', ['id'], unique=False)
    op.create_index('ix_six_fb_efficiency_metrics_date', 'six_fb_efficiency_metrics', ['date'], unique=False)
    op.create_index('idx_efficiency_value', 'six_fb_efficiency_metrics', ['value'], unique=False)
    op.create_index('idx_efficiency_user_date_type', 'six_fb_efficiency_metrics', ['user_id', 'date', 'metric_type'], unique=False)
    op.create_table('subscription_usage_records',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('subscription_id', sa.INTEGER(), nullable=False),
    sa.Column('service_id', sa.INTEGER(), nullable=False),
    sa.Column('appointment_id', sa.INTEGER(), nullable=True),
    sa.Column('used_at', sa.DATETIME(), nullable=True),
    sa.Column('billing_period_start', sa.DATETIME(), nullable=True),
    sa.Column('billing_period_end', sa.DATETIME(), nullable=True),
    sa.Column('service_value', sa.FLOAT(), nullable=True),
    sa.Column('discount_applied', sa.FLOAT(), nullable=True),
    sa.Column('notes', sa.TEXT(), nullable=True),
    sa.Column('refunded', sa.BOOLEAN(), nullable=True),
    sa.Column('refunded_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['appointment_id'], ['appointments.id'], ),
    sa.ForeignKeyConstraint(['service_id'], ['services.id'], ),
    sa.ForeignKeyConstraint(['subscription_id'], ['service_subscriptions.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_subscription_usage_records_id', 'subscription_usage_records', ['id'], unique=False)
    op.create_table('review_templates',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(length=255), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('category', sa.VARCHAR(length=100), nullable=False),
    sa.Column('platform', sa.VARCHAR(length=9), nullable=True),
    sa.Column('template_text', sa.TEXT(), nullable=False),
    sa.Column('placeholders', sqlite.JSON(), nullable=True),
    sa.Column('min_rating', sa.FLOAT(), nullable=True),
    sa.Column('max_rating', sa.FLOAT(), nullable=True),
    sa.Column('keywords_trigger', sqlite.JSON(), nullable=True),
    sa.Column('sentiment_trigger', sa.VARCHAR(length=8), nullable=True),
    sa.Column('seo_keywords', sqlite.JSON(), nullable=True),
    sa.Column('include_business_name', sa.BOOLEAN(), nullable=True),
    sa.Column('include_cta', sa.BOOLEAN(), nullable=True),
    sa.Column('cta_text', sa.VARCHAR(length=500), nullable=True),
    sa.Column('use_count', sa.INTEGER(), nullable=True),
    sa.Column('success_rate', sa.FLOAT(), nullable=True),
    sa.Column('avg_response_time', sa.FLOAT(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('is_default', sa.BOOLEAN(), nullable=True),
    sa.Column('priority', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.Column('last_used_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_review_templates_id', 'review_templates', ['id'], unique=False)
    op.create_index('ix_review_templates_category', 'review_templates', ['category'], unique=False)
    op.create_table('email_analytics_summaries',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('date', sa.DATE(), nullable=False),
    sa.Column('hour', sa.INTEGER(), nullable=True),
    sa.Column('template_name', sa.VARCHAR(length=100), nullable=True),
    sa.Column('campaign_id', sa.VARCHAR(length=100), nullable=True),
    sa.Column('emails_sent', sa.INTEGER(), nullable=True),
    sa.Column('emails_delivered', sa.INTEGER(), nullable=True),
    sa.Column('delivery_rate', sa.FLOAT(), nullable=True),
    sa.Column('unique_opens', sa.INTEGER(), nullable=True),
    sa.Column('total_opens', sa.INTEGER(), nullable=True),
    sa.Column('open_rate', sa.FLOAT(), nullable=True),
    sa.Column('unique_clicks', sa.INTEGER(), nullable=True),
    sa.Column('total_clicks', sa.INTEGER(), nullable=True),
    sa.Column('click_rate', sa.FLOAT(), nullable=True),
    sa.Column('click_to_open_rate', sa.FLOAT(), nullable=True),
    sa.Column('bounces', sa.INTEGER(), nullable=True),
    sa.Column('bounce_rate', sa.FLOAT(), nullable=True),
    sa.Column('spam_reports', sa.INTEGER(), nullable=True),
    sa.Column('spam_rate', sa.FLOAT(), nullable=True),
    sa.Column('unsubscribes', sa.INTEGER(), nullable=True),
    sa.Column('unsubscribe_rate', sa.FLOAT(), nullable=True),
    sa.Column('avg_time_to_open', sa.INTEGER(), nullable=True),
    sa.Column('avg_time_to_click', sa.INTEGER(), nullable=True),
    sa.Column('device_stats', sqlite.JSON(), nullable=True),
    sa.Column('client_stats', sqlite.JSON(), nullable=True),
    sa.Column('location_stats', sqlite.JSON(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_email_analytics_summaries_template_name', 'email_analytics_summaries', ['template_name'], unique=False)
    op.create_index('ix_email_analytics_summaries_id', 'email_analytics_summaries', ['id'], unique=False)
    op.create_index('ix_email_analytics_summaries_hour', 'email_analytics_summaries', ['hour'], unique=False)
    op.create_index('ix_email_analytics_summaries_date', 'email_analytics_summaries', ['date'], unique=False)
    op.create_index('ix_email_analytics_summaries_campaign_id', 'email_analytics_summaries', ['campaign_id'], unique=False)
    op.create_index('idx_analytics_period_template', 'email_analytics_summaries', ['date', 'hour', 'template_name'], unique=1)
    op.create_table('six_fb_workflow_executions',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('workflow_id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('client_id', sa.INTEGER(), nullable=False),
    sa.Column('execution_id', sa.VARCHAR(), nullable=False),
    sa.Column('started_at', sa.DATETIME(), nullable=False),
    sa.Column('completed_at', sa.DATETIME(), nullable=True),
    sa.Column('status', sa.VARCHAR(), nullable=True),
    sa.Column('trigger_event_data', sqlite.JSON(), nullable=True),
    sa.Column('trigger_timestamp', sa.DATETIME(), nullable=False),
    sa.Column('trigger_source', sa.VARCHAR(), nullable=True),
    sa.Column('current_step', sa.INTEGER(), nullable=True),
    sa.Column('total_steps', sa.INTEGER(), nullable=False),
    sa.Column('completed_steps', sqlite.JSON(), nullable=True),
    sa.Column('failed_steps', sqlite.JSON(), nullable=True),
    sa.Column('personalization_data_used', sqlite.JSON(), nullable=True),
    sa.Column('dynamic_content_generated', sqlite.JSON(), nullable=True),
    sa.Column('client_context_applied', sqlite.JSON(), nullable=True),
    sa.Column('engagement_generated', sa.FLOAT(), nullable=True),
    sa.Column('response_rate', sa.FLOAT(), nullable=True),
    sa.Column('conversion_achieved', sa.BOOLEAN(), nullable=True),
    sa.Column('revenue_generated', sa.NUMERIC(precision=8, scale=2), nullable=True),
    sa.Column('client_satisfaction_score', sa.FLOAT(), nullable=True),
    sa.Column('relationship_impact_score', sa.FLOAT(), nullable=True),
    sa.Column('brand_consistency_score', sa.FLOAT(), nullable=True),
    sa.Column('error_details', sqlite.JSON(), nullable=True),
    sa.Column('retry_count', sa.INTEGER(), nullable=True),
    sa.Column('recovery_actions', sqlite.JSON(), nullable=True),
    sa.Column('success_criteria_met', sqlite.JSON(), nullable=True),
    sa.Column('execution_metrics', sqlite.JSON(), nullable=True),
    sa.Column('learnings_captured', sqlite.JSON(), nullable=True),
    sa.Column('optimization_suggestions', sqlite.JSON(), nullable=True),
    sa.Column('execution_version', sa.VARCHAR(), nullable=True),
    sa.Column('a_b_test_variant', sa.VARCHAR(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['client_id'], ['clients.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['workflow_id'], ['six_fb_automated_workflows.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_six_fb_workflow_executions_workflow_id', 'six_fb_workflow_executions', ['workflow_id'], unique=False)
    op.create_index('ix_six_fb_workflow_executions_user_id', 'six_fb_workflow_executions', ['user_id'], unique=False)
    op.create_index('ix_six_fb_workflow_executions_id', 'six_fb_workflow_executions', ['id'], unique=False)
    op.create_index('ix_six_fb_workflow_executions_execution_id', 'six_fb_workflow_executions', ['execution_id'], unique=1)
    op.create_index('ix_six_fb_workflow_executions_client_id', 'six_fb_workflow_executions', ['client_id'], unique=False)
    op.create_index('idx_execution_workflow_date', 'six_fb_workflow_executions', ['workflow_id', 'started_at'], unique=False)
    op.create_index('idx_execution_revenue', 'six_fb_workflow_executions', ['revenue_generated'], unique=False)
    op.create_index('idx_execution_client_status', 'six_fb_workflow_executions', ['client_id', 'status'], unique=False)
    op.create_table('six_fb_client_journey_stages',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('client_id', sa.INTEGER(), nullable=False),
    sa.Column('current_stage', sa.VARCHAR(length=17), nullable=False),
    sa.Column('stage_entry_date', sa.DATE(), nullable=False),
    sa.Column('days_in_current_stage', sa.INTEGER(), nullable=True),
    sa.Column('previous_stage', sa.VARCHAR(length=17), nullable=True),
    sa.Column('progression_score', sa.FLOAT(), nullable=True),
    sa.Column('stage_completion_percentage', sa.FLOAT(), nullable=True),
    sa.Column('expected_next_stage', sa.VARCHAR(length=17), nullable=True),
    sa.Column('expected_progression_date', sa.DATE(), nullable=True),
    sa.Column('required_milestones', sqlite.JSON(), nullable=True),
    sa.Column('completed_milestones', sqlite.JSON(), nullable=True),
    sa.Column('milestone_completion_rate', sa.FLOAT(), nullable=True),
    sa.Column('value_tier_alignment', sa.VARCHAR(length=12), nullable=True),
    sa.Column('relationship_quality_score', sa.FLOAT(), nullable=True),
    sa.Column('premium_positioning_readiness', sa.FLOAT(), nullable=True),
    sa.Column('recommended_touchpoints', sqlite.JSON(), nullable=True),
    sa.Column('active_touchpoint_sequences', sqlite.JSON(), nullable=True),
    sa.Column('touchpoint_effectiveness_score', sa.FLOAT(), nullable=True),
    sa.Column('regression_risk_score', sa.FLOAT(), nullable=True),
    sa.Column('acceleration_opportunity_score', sa.FLOAT(), nullable=True),
    sa.Column('intervention_required', sa.BOOLEAN(), nullable=True),
    sa.Column('intervention_type', sa.VARCHAR(), nullable=True),
    sa.Column('stage_performance_metrics', sqlite.JSON(), nullable=True),
    sa.Column('comparative_performance', sqlite.JSON(), nullable=True),
    sa.Column('optimization_suggestions', sqlite.JSON(), nullable=True),
    sa.Column('last_calculated', sa.DATETIME(), nullable=True),
    sa.Column('calculation_trigger', sa.VARCHAR(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['client_id'], ['clients.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_six_fb_client_journey_stages_user_id', 'six_fb_client_journey_stages', ['user_id'], unique=False)
    op.create_index('ix_six_fb_client_journey_stages_id', 'six_fb_client_journey_stages', ['id'], unique=False)
    op.create_index('ix_six_fb_client_journey_stages_current_stage', 'six_fb_client_journey_stages', ['current_stage'], unique=False)
    op.create_index('ix_six_fb_client_journey_stages_client_id', 'six_fb_client_journey_stages', ['client_id'], unique=False)
    op.create_index('idx_journey_user_client_stage', 'six_fb_client_journey_stages', ['user_id', 'client_id', 'current_stage'], unique=False)
    op.create_index('idx_journey_risk', 'six_fb_client_journey_stages', ['regression_risk_score'], unique=False)
    op.create_index('idx_journey_progression', 'six_fb_client_journey_stages', ['progression_score'], unique=False)
    op.create_table('google_calendar_sync_logs',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('appointment_id', sa.INTEGER(), nullable=True),
    sa.Column('operation', sa.VARCHAR(length=20), nullable=False),
    sa.Column('direction', sa.VARCHAR(length=20), nullable=False),
    sa.Column('status', sa.VARCHAR(length=20), nullable=False),
    sa.Column('google_event_id', sa.VARCHAR(length=255), nullable=True),
    sa.Column('google_calendar_id', sa.VARCHAR(length=255), nullable=True),
    sa.Column('error_message', sa.TEXT(), nullable=True),
    sa.Column('retry_count', sa.INTEGER(), nullable=True),
    sa.Column('sync_data', sa.TEXT(), nullable=True),
    sa.Column('response_data', sa.TEXT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['appointment_id'], ['appointments.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_google_calendar_sync_logs_user_id', 'google_calendar_sync_logs', ['user_id'], unique=False)
    op.create_index('ix_google_calendar_sync_logs_status', 'google_calendar_sync_logs', ['status'], unique=False)
    op.create_index('ix_google_calendar_sync_logs_operation', 'google_calendar_sync_logs', ['operation'], unique=False)
    op.create_index('ix_google_calendar_sync_logs_id', 'google_calendar_sync_logs', ['id'], unique=False)
    op.create_index('ix_google_calendar_sync_logs_google_event_id', 'google_calendar_sync_logs', ['google_event_id'], unique=False)
    op.create_index('ix_google_calendar_sync_logs_direction', 'google_calendar_sync_logs', ['direction'], unique=False)
    op.create_index('ix_google_calendar_sync_logs_created_at', 'google_calendar_sync_logs', ['created_at'], unique=False)
    op.create_index('ix_google_calendar_sync_logs_appointment_id', 'google_calendar_sync_logs', ['appointment_id'], unique=False)
    op.create_table('service_booking_rules',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('service_id', sa.INTEGER(), nullable=False),
    sa.Column('rule_type', sa.VARCHAR(), nullable=False),
    sa.Column('min_age', sa.INTEGER(), nullable=True),
    sa.Column('max_age', sa.INTEGER(), nullable=True),
    sa.Column('requires_consultation', sa.BOOLEAN(), nullable=True),
    sa.Column('requires_patch_test', sa.BOOLEAN(), nullable=True),
    sa.Column('patch_test_hours_before', sa.INTEGER(), nullable=True),
    sa.Column('max_bookings_per_day', sa.INTEGER(), nullable=True),
    sa.Column('min_days_between_bookings', sa.INTEGER(), nullable=True),
    sa.Column('blocked_days_of_week', sqlite.JSON(), nullable=True),
    sa.Column('required_service_ids', sqlite.JSON(), nullable=True),
    sa.Column('incompatible_service_ids', sqlite.JSON(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('message', sa.TEXT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['service_id'], ['services.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_service_booking_rules_id', 'service_booking_rules', ['id'], unique=False)
    op.create_table('google_calendar_webhook_subscriptions',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('google_subscription_id', sa.VARCHAR(length=255), nullable=False),
    sa.Column('google_calendar_id', sa.VARCHAR(length=255), nullable=False),
    sa.Column('google_resource_id', sa.VARCHAR(length=255), nullable=False),
    sa.Column('webhook_url', sa.VARCHAR(length=500), nullable=False),
    sa.Column('webhook_token', sa.VARCHAR(length=255), nullable=True),
    sa.Column('expiration_time', sa.DATETIME(), nullable=False),
    sa.Column('created_at', sa.DATETIME(), nullable=False),
    sa.Column('last_renewed_at', sa.DATETIME(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('last_notification_received', sa.DATETIME(), nullable=True),
    sa.Column('notification_count', sa.INTEGER(), nullable=True),
    sa.Column('error_count', sa.INTEGER(), nullable=True),
    sa.Column('last_error', sa.TEXT(), nullable=True),
    sa.Column('last_error_at', sa.DATETIME(), nullable=True),
    sa.Column('sync_token', sa.VARCHAR(length=255), nullable=True),
    sa.Column('last_sync_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_google_calendar_webhook_subscriptions_user_id', 'google_calendar_webhook_subscriptions', ['user_id'], unique=False)
    op.create_index('ix_google_calendar_webhook_subscriptions_is_active', 'google_calendar_webhook_subscriptions', ['is_active'], unique=False)
    op.create_index('ix_google_calendar_webhook_subscriptions_id', 'google_calendar_webhook_subscriptions', ['id'], unique=False)
    op.create_index('ix_google_calendar_webhook_subscriptions_google_subscription_id', 'google_calendar_webhook_subscriptions', ['google_subscription_id'], unique=1)
    op.create_index('ix_google_calendar_webhook_subscriptions_google_calendar_id', 'google_calendar_webhook_subscriptions', ['google_calendar_id'], unique=False)
    op.create_index('ix_google_calendar_webhook_subscriptions_expiration_time', 'google_calendar_webhook_subscriptions', ['expiration_time'], unique=False)
    op.create_table('google_calendar_sync_events',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('notification_id', sa.INTEGER(), nullable=True),
    sa.Column('appointment_id', sa.INTEGER(), nullable=True),
    sa.Column('google_event_id', sa.VARCHAR(length=255), nullable=False),
    sa.Column('google_calendar_id', sa.VARCHAR(length=255), nullable=False),
    sa.Column('operation_type', sa.VARCHAR(length=20), nullable=False),
    sa.Column('sync_direction', sa.VARCHAR(length=20), nullable=False),
    sa.Column('event_summary', sa.VARCHAR(length=500), nullable=True),
    sa.Column('event_start_time', sa.DATETIME(), nullable=True),
    sa.Column('event_end_time', sa.DATETIME(), nullable=True),
    sa.Column('event_status', sa.VARCHAR(length=50), nullable=True),
    sa.Column('sync_status', sa.VARCHAR(length=20), nullable=False),
    sa.Column('conflict_resolution', sa.VARCHAR(length=50), nullable=True),
    sa.Column('detected_at', sa.DATETIME(), nullable=False),
    sa.Column('processed_at', sa.DATETIME(), nullable=True),
    sa.Column('error_message', sa.TEXT(), nullable=True),
    sa.Column('changes_detected', sa.TEXT(), nullable=True),
    sa.Column('applied_changes', sa.TEXT(), nullable=True),
    sa.ForeignKeyConstraint(['appointment_id'], ['appointments.id'], ),
    sa.ForeignKeyConstraint(['notification_id'], ['google_calendar_webhook_notifications.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_google_calendar_sync_events_user_id', 'google_calendar_sync_events', ['user_id'], unique=False)
    op.create_index('ix_google_calendar_sync_events_sync_status', 'google_calendar_sync_events', ['sync_status'], unique=False)
    op.create_index('ix_google_calendar_sync_events_sync_direction', 'google_calendar_sync_events', ['sync_direction'], unique=False)
    op.create_index('ix_google_calendar_sync_events_operation_type', 'google_calendar_sync_events', ['operation_type'], unique=False)
    op.create_index('ix_google_calendar_sync_events_notification_id', 'google_calendar_sync_events', ['notification_id'], unique=False)
    op.create_index('ix_google_calendar_sync_events_id', 'google_calendar_sync_events', ['id'], unique=False)
    op.create_index('ix_google_calendar_sync_events_google_event_id', 'google_calendar_sync_events', ['google_event_id'], unique=False)
    op.create_index('ix_google_calendar_sync_events_appointment_id', 'google_calendar_sync_events', ['appointment_id'], unique=False)
    op.create_table('gamification_notifications',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('notification_type', sa.VARCHAR(length=20), nullable=False),
    sa.Column('title', sa.VARCHAR(), nullable=False),
    sa.Column('message', sa.TEXT(), nullable=False),
    sa.Column('related_achievement_id', sa.INTEGER(), nullable=True),
    sa.Column('related_challenge_id', sa.INTEGER(), nullable=True),
    sa.Column('related_xp_transaction_id', sa.INTEGER(), nullable=True),
    sa.Column('celebration_data', sqlite.JSON(), nullable=True),
    sa.Column('display_duration_seconds', sa.INTEGER(), nullable=True),
    sa.Column('priority_level', sa.VARCHAR(), nullable=True),
    sa.Column('is_sent', sa.BOOLEAN(), nullable=True),
    sa.Column('sent_at', sa.DATETIME(), nullable=True),
    sa.Column('is_read', sa.BOOLEAN(), nullable=True),
    sa.Column('read_at', sa.DATETIME(), nullable=True),
    sa.Column('is_dismissed', sa.BOOLEAN(), nullable=True),
    sa.Column('dismissed_at', sa.DATETIME(), nullable=True),
    sa.Column('show_in_app', sa.BOOLEAN(), nullable=True),
    sa.Column('send_push_notification', sa.BOOLEAN(), nullable=True),
    sa.Column('send_email', sa.BOOLEAN(), nullable=True),
    sa.Column('click_count', sa.INTEGER(), nullable=True),
    sa.Column('first_click_at', sa.DATETIME(), nullable=True),
    sa.Column('last_click_at', sa.DATETIME(), nullable=True),
    sa.Column('expires_at', sa.DATETIME(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['related_achievement_id'], ['achievement_definitions.id'], ),
    sa.ForeignKeyConstraint(['related_challenge_id'], ['gamification_challenges.id'], ),
    sa.ForeignKeyConstraint(['related_xp_transaction_id'], ['xp_transactions.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_gamification_notifications_user_id', 'gamification_notifications', ['user_id'], unique=False)
    op.create_index('ix_gamification_notifications_notification_type', 'gamification_notifications', ['notification_type'], unique=False)
    op.create_index('ix_gamification_notifications_id', 'gamification_notifications', ['id'], unique=False)
    op.create_index('idx_notification_user_type', 'gamification_notifications', ['user_id', 'notification_type'], unique=False)
    op.create_index('idx_notification_sent_read', 'gamification_notifications', ['is_sent', 'is_read'], unique=False)
    op.create_index('idx_notification_expires', 'gamification_notifications', ['expires_at'], unique=False)
    op.create_table('barber_services',
    sa.Column('barber_id', sa.INTEGER(), nullable=False),
    sa.Column('service_id', sa.INTEGER(), nullable=False),
    sa.Column('custom_price', sa.FLOAT(), nullable=True),
    sa.Column('custom_duration', sa.INTEGER(), nullable=True),
    sa.Column('is_available', sa.BOOLEAN(), nullable=True),
    sa.ForeignKeyConstraint(['barber_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['service_id'], ['services.id'], ),
    sa.PrimaryKeyConstraint('barber_id', 'service_id')
    )
    op.create_table('recurring_appointment_conflicts',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('pattern_id', sa.INTEGER(), nullable=False),
    sa.Column('conflict_date', sa.DATE(), nullable=False),
    sa.Column('conflict_time', sa.TIME(), nullable=False),
    sa.Column('conflict_type', sa.VARCHAR(), nullable=False),
    sa.Column('resolution_status', sa.VARCHAR(), nullable=True),
    sa.Column('resolution_type', sa.VARCHAR(), nullable=True),
    sa.Column('resolved_date', sa.DATE(), nullable=True),
    sa.Column('resolved_time', sa.TIME(), nullable=True),
    sa.Column('conflict_details', sqlite.JSON(), nullable=True),
    sa.Column('resolution_notes', sa.TEXT(), nullable=True),
    sa.Column('detected_at', sa.DATETIME(), nullable=True),
    sa.Column('resolved_at', sa.DATETIME(), nullable=True),
    sa.Column('resolved_by_id', sa.INTEGER(), nullable=True),
    sa.ForeignKeyConstraint(['pattern_id'], ['recurring_appointment_patterns.id'], ),
    sa.ForeignKeyConstraint(['resolved_by_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_recurring_appointment_conflicts_id', 'recurring_appointment_conflicts', ['id'], unique=False)
    op.create_index('ix_recurring_appointment_conflicts_conflict_date', 'recurring_appointment_conflicts', ['conflict_date'], unique=False)
    op.create_table('pattern_memory_links',
    sa.Column('pattern_id', sa.INTEGER(), nullable=False),
    sa.Column('memory_id', sa.INTEGER(), nullable=False),
    sa.Column('contribution_weight', sa.FLOAT(), nullable=True),
    sa.ForeignKeyConstraint(['memory_id'], ['ai_memory_records.id'], ),
    sa.ForeignKeyConstraint(['pattern_id'], ['ai_learning_patterns.id'], ),
    sa.PrimaryKeyConstraint('pattern_id', 'memory_id')
    )
    op.create_table('ai_knowledge_base',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('category', sa.VARCHAR(length=100), nullable=False),
    sa.Column('subcategory', sa.VARCHAR(length=100), nullable=True),
    sa.Column('knowledge_type', sa.VARCHAR(length=50), nullable=True),
    sa.Column('title', sa.VARCHAR(length=200), nullable=False),
    sa.Column('content', sqlite.JSON(), nullable=False),
    sa.Column('conditions', sqlite.JSON(), nullable=True),
    sa.Column('evidence_strength', sa.FLOAT(), nullable=True),
    sa.Column('sample_size', sa.INTEGER(), nullable=True),
    sa.Column('last_validated', sa.DATETIME(), nullable=True),
    sa.Column('times_used', sa.INTEGER(), nullable=True),
    sa.Column('success_rate', sa.FLOAT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.Column('deprecation_date', sa.DATETIME(), nullable=True),
    sa.Column('source_type', sa.VARCHAR(length=50), nullable=True),
    sa.Column('source_reference', sa.VARCHAR(length=200), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_ai_knowledge_base_id', 'ai_knowledge_base', ['id'], unique=False)
    op.create_index('ix_ai_knowledge_base_category', 'ai_knowledge_base', ['category'], unique=False)
    op.create_index('idx_knowledge_performance', 'ai_knowledge_base', ['success_rate', 'evidence_strength'], unique=False)
    op.create_index('idx_knowledge_category', 'ai_knowledge_base', ['category', 'subcategory'], unique=False)
    op.create_table('unsubscribe_requests',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=True),
    sa.Column('email_address', sa.VARCHAR(length=255), nullable=False),
    sa.Column('phone_number', sa.VARCHAR(length=20), nullable=True),
    sa.Column('unsubscribe_type', sa.VARCHAR(length=50), nullable=False),
    sa.Column('token_used', sa.VARCHAR(length=64), nullable=True),
    sa.Column('method', sa.VARCHAR(length=20), nullable=False),
    sa.Column('campaign_id', sa.VARCHAR(length=100), nullable=True),
    sa.Column('ip_address', sa.VARCHAR(length=45), nullable=True),
    sa.Column('user_agent', sa.VARCHAR(length=500), nullable=True),
    sa.Column('status', sa.VARCHAR(length=20), nullable=True),
    sa.Column('processed_at', sa.DATETIME(), nullable=True),
    sa.Column('reverted_at', sa.DATETIME(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_unsubscribe_requests_phone_number', 'unsubscribe_requests', ['phone_number'], unique=False)
    op.create_index('ix_unsubscribe_requests_id', 'unsubscribe_requests', ['id'], unique=False)
    op.create_index('ix_unsubscribe_requests_email_address', 'unsubscribe_requests', ['email_address'], unique=False)
    op.create_table('users',
    sa.Column('id', sa.INTEGER(), nullable=True),
    sa.Column('email', sa.VARCHAR(), nullable=False),
    sa.Column('name', sa.VARCHAR(), nullable=True),
    sa.Column('phone', sa.VARCHAR(), nullable=True),
    sa.Column('hashed_password', sa.VARCHAR(), nullable=False),
    sa.Column('role', sa.VARCHAR(), server_default=sa.text("'user'"), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), server_default=sa.text('1'), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('timezone_preference', sa.VARCHAR(length=50), nullable=True),
    sa.Column('auto_detect_timezone', sa.BOOLEAN(), server_default=sa.text('1'), nullable=True),
    sa.Column('timezone_last_updated', sa.DATETIME(), nullable=True),
    sa.Column('stripe_account_id', sa.VARCHAR(), nullable=True),
    sa.Column('stripe_account_status', sa.VARCHAR(), nullable=True),
    sa.Column('commission_rate', sa.FLOAT(), server_default=sa.text('(0.20)'), nullable=True),
    sa.Column('google_calendar_credentials', sa.TEXT(), nullable=True),
    sa.Column('google_calendar_id', sa.VARCHAR(), nullable=True),
    sa.Column('is_test_data', sa.BOOLEAN(), server_default=sa.text('0'), nullable=True),
    sa.Column('timezone', sa.VARCHAR(length=50), server_default=sa.text("'UTC'"), nullable=True),
    sa.Column('email_verified', sa.BOOLEAN(), server_default=sa.text('0'), nullable=True),
    sa.Column('verification_token', sa.VARCHAR(), nullable=True),
    sa.Column('verification_token_expires', sa.DATETIME(), nullable=True),
    sa.Column('verified_at', sa.DATETIME(), nullable=True),
    sa.Column('unified_role', sa.VARCHAR(length=50), server_default=sa.text("'client'"), nullable=True),
    sa.Column('role_migrated', sa.BOOLEAN(), server_default=sa.text('0'), nullable=True),
    sa.Column('user_type', sa.VARCHAR(), server_default=sa.text("'client'"), nullable=True),
    sa.Column('trial_started_at', sa.DATETIME(), nullable=True),
    sa.Column('trial_expires_at', sa.DATETIME(), nullable=True),
    sa.Column('trial_active', sa.BOOLEAN(), server_default=sa.text('1'), nullable=True),
    sa.Column('subscription_status', sa.VARCHAR(), server_default=sa.text("'trial'"), nullable=True),
    sa.Column('location_id', sa.INTEGER(), nullable=True),
    sa.Column('lifetime_value', sa.FLOAT(), server_default=sa.text('(0.0)'), nullable=True),
    sa.Column('onboarding_completed', sa.BOOLEAN(), server_default=sa.text('0'), nullable=True),
    sa.Column('onboarding_status', sa.TEXT(), nullable=True),
    sa.Column('is_new_user', sa.BOOLEAN(), server_default=sa.text('1'), nullable=True),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('email')
    )
    op.create_index('idx_users_role_active', 'users', ['unified_role', 'is_active'], unique=False)
    op.create_index('idx_users_email_active', 'users', ['email', 'is_active'], unique=False)
    op.create_index('idx_users_email', 'users', ['email'], unique=False)
    op.create_index('idx_users_created_active', 'users', ['created_at', 'is_active'], unique=False)
    op.create_table('six_fb_methodology_dashboards',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('dashboard_date', sa.DATE(), nullable=False),
    sa.Column('overall_methodology_score', sa.FLOAT(), nullable=True),
    sa.Column('revenue_optimization_score', sa.FLOAT(), nullable=True),
    sa.Column('client_value_score', sa.FLOAT(), nullable=True),
    sa.Column('service_excellence_score', sa.FLOAT(), nullable=True),
    sa.Column('business_efficiency_score', sa.FLOAT(), nullable=True),
    sa.Column('professional_growth_score', sa.FLOAT(), nullable=True),
    sa.Column('monthly_revenue', sa.NUMERIC(precision=10, scale=2), nullable=True),
    sa.Column('revenue_growth_rate', sa.FLOAT(), nullable=True),
    sa.Column('client_retention_rate', sa.FLOAT(), nullable=True),
    sa.Column('average_client_value', sa.NUMERIC(precision=8, scale=2), nullable=True),
    sa.Column('booking_efficiency', sa.FLOAT(), nullable=True),
    sa.Column('current_milestone_level', sa.VARCHAR(), nullable=True),
    sa.Column('next_milestone_target', sa.VARCHAR(), nullable=True),
    sa.Column('milestone_progress_percentage', sa.FLOAT(), nullable=True),
    sa.Column('estimated_days_to_next_milestone', sa.INTEGER(), nullable=True),
    sa.Column('top_opportunities', sqlite.JSON(), nullable=True),
    sa.Column('critical_improvements_needed', sqlite.JSON(), nullable=True),
    sa.Column('quick_wins_available', sqlite.JSON(), nullable=True),
    sa.Column('coaching_priorities', sqlite.JSON(), nullable=True),
    sa.Column('recommended_actions', sqlite.JSON(), nullable=True),
    sa.Column('training_suggestions', sqlite.JSON(), nullable=True),
    sa.Column('performance_trends', sqlite.JSON(), nullable=True),
    sa.Column('competitive_analysis', sqlite.JSON(), nullable=True),
    sa.Column('market_opportunities', sqlite.JSON(), nullable=True),
    sa.Column('active_goals', sqlite.JSON(), nullable=True),
    sa.Column('goal_progress', sqlite.JSON(), nullable=True),
    sa.Column('upcoming_milestones', sqlite.JSON(), nullable=True),
    sa.Column('success_stories', sqlite.JSON(), nullable=True),
    sa.Column('client_testimonials', sqlite.JSON(), nullable=True),
    sa.Column('achievement_highlights', sqlite.JSON(), nullable=True),
    sa.Column('last_updated', sa.DATETIME(), nullable=True),
    sa.Column('data_freshness_score', sa.FLOAT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_six_fb_methodology_dashboards_user_id', 'six_fb_methodology_dashboards', ['user_id'], unique=False)
    op.create_index('ix_six_fb_methodology_dashboards_id', 'six_fb_methodology_dashboards', ['id'], unique=False)
    op.create_index('ix_six_fb_methodology_dashboards_dashboard_date', 'six_fb_methodology_dashboards', ['dashboard_date'], unique=False)
    op.create_index('idx_dashboard_user_date', 'six_fb_methodology_dashboards', ['user_id', 'dashboard_date'], unique=False)
    op.create_index('idx_dashboard_score', 'six_fb_methodology_dashboards', ['overall_methodology_score'], unique=False)
    op.create_table('payment_mode_history',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('barber_id', sa.INTEGER(), nullable=False),
    sa.Column('previous_mode', sa.VARCHAR(length=13), nullable=True),
    sa.Column('new_mode', sa.VARCHAR(length=13), nullable=False),
    sa.Column('change_reason', sa.TEXT(), nullable=True),
    sa.Column('changed_by_id', sa.INTEGER(), nullable=True),
    sa.Column('effective_date', sa.DATETIME(), nullable=True),
    sa.Column('pending_collections_affected', sa.INTEGER(), nullable=True),
    sa.Column('active_connections_affected', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['barber_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['changed_by_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_payment_mode_history_id', 'payment_mode_history', ['id'], unique=False)
    op.create_index('ix_payment_mode_history_barber_id', 'payment_mode_history', ['barber_id'], unique=False)
    op.create_table('reviews',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('business_id', sa.VARCHAR(length=255), nullable=True),
    sa.Column('platform', sa.VARCHAR(length=9), nullable=True),
    sa.Column('external_review_id', sa.VARCHAR(length=255), nullable=True),
    sa.Column('review_url', sa.VARCHAR(length=1000), nullable=True),
    sa.Column('reviewer_name', sa.VARCHAR(length=255), nullable=True),
    sa.Column('reviewer_photo_url', sa.VARCHAR(length=1000), nullable=True),
    sa.Column('rating', sa.FLOAT(), nullable=False),
    sa.Column('review_text', sa.TEXT(), nullable=True),
    sa.Column('comment', sa.TEXT(), nullable=True),
    sa.Column('review_date', sa.DATETIME(), nullable=False),
    sa.Column('external_id', sa.VARCHAR(length=255), nullable=True),
    sa.Column('source', sa.VARCHAR(length=18), nullable=True),
    sa.Column('status', sa.VARCHAR(length=16), nullable=True),
    sa.Column('integration_id', sa.INTEGER(), nullable=True),
    sa.Column('sentiment_label', sa.VARCHAR(length=50), nullable=True),
    sa.Column('auto_response_sent', sa.BOOLEAN(), nullable=True),
    sa.Column('sentiment', sa.VARCHAR(length=8), nullable=True),
    sa.Column('sentiment_score', sa.FLOAT(), nullable=True),
    sa.Column('sentiment_confidence', sa.FLOAT(), nullable=True),
    sa.Column('sentiment_keywords', sqlite.JSON(), nullable=True),
    sa.Column('response_status', sa.VARCHAR(length=10), nullable=True),
    sa.Column('response_text', sa.TEXT(), nullable=True),
    sa.Column('response_date', sa.DATETIME(), nullable=True),
    sa.Column('response_author', sa.VARCHAR(length=255), nullable=True),
    sa.Column('auto_response_generated', sa.BOOLEAN(), nullable=True),
    sa.Column('platform_data', sqlite.JSON(), nullable=True),
    sa.Column('keywords_mentioned', sqlite.JSON(), nullable=True),
    sa.Column('services_mentioned', sqlite.JSON(), nullable=True),
    sa.Column('competitor_mentions', sqlite.JSON(), nullable=True),
    sa.Column('location_mentions', sqlite.JSON(), nullable=True),
    sa.Column('is_verified', sa.BOOLEAN(), nullable=True),
    sa.Column('is_flagged', sa.BOOLEAN(), nullable=True),
    sa.Column('flag_reason', sa.VARCHAR(length=500), nullable=True),
    sa.Column('is_helpful', sa.BOOLEAN(), nullable=True),
    sa.Column('helpful_count', sa.INTEGER(), nullable=True),
    sa.Column('last_synced_at', sa.DATETIME(), nullable=True),
    sa.Column('is_deleted_on_platform', sa.BOOLEAN(), nullable=True),
    sa.Column('sync_errors', sqlite.JSON(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['integration_id'], ['integrations.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_reviews_status', 'reviews', ['status'], unique=False)
    op.create_index('ix_reviews_source', 'reviews', ['source'], unique=False)
    op.create_index('ix_reviews_sentiment', 'reviews', ['sentiment'], unique=False)
    op.create_index('ix_reviews_review_date', 'reviews', ['review_date'], unique=False)
    op.create_index('ix_reviews_response_status', 'reviews', ['response_status'], unique=False)
    op.create_index('ix_reviews_platform', 'reviews', ['platform'], unique=False)
    op.create_index('ix_reviews_id', 'reviews', ['id'], unique=False)
    op.create_index('ix_reviews_external_review_id', 'reviews', ['external_review_id'], unique=False)
    op.create_index('ix_reviews_external_id', 'reviews', ['external_id'], unique=False)
    op.create_index('ix_reviews_created_at', 'reviews', ['created_at'], unique=False)
    op.create_index('ix_reviews_business_id', 'reviews', ['business_id'], unique=False)
    op.create_table('password_reset_tokens',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=True),
    sa.Column('token', sa.VARCHAR(), nullable=True),
    sa.Column('expires_at', sa.DATETIME(), nullable=True),
    sa.Column('used', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_password_reset_tokens_token', 'password_reset_tokens', ['token'], unique=1)
    op.create_index('ix_password_reset_tokens_id', 'password_reset_tokens', ['id'], unique=False)
    op.create_table('mfa_backup_codes',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('code_hash', sa.VARCHAR(length=255), nullable=False),
    sa.Column('is_used', sa.BOOLEAN(), nullable=False),
    sa.Column('used_at', sa.DATETIME(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=False),
    sa.Column('expires_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_mfa_backup_codes_id', 'mfa_backup_codes', ['id'], unique=False)
    op.create_index('idx_backup_codes_user_unused', 'mfa_backup_codes', ['user_id', 'is_used'], unique=False)
    op.create_index('idx_backup_codes_hash', 'mfa_backup_codes', ['code_hash'], unique=False)
    op.create_table('ai_message_generations',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('message_id', sa.VARCHAR(length=100), nullable=False),
    sa.Column('template_id', sa.INTEGER(), nullable=True),
    sa.Column('appointment_id', sa.INTEGER(), nullable=True),
    sa.Column('user_id', sa.INTEGER(), nullable=True),
    sa.Column('subject', sa.VARCHAR(length=500), nullable=True),
    sa.Column('body', sa.TEXT(), nullable=False),
    sa.Column('message_type', sa.VARCHAR(length=100), nullable=False),
    sa.Column('channel', sa.VARCHAR(length=50), nullable=False),
    sa.Column('ai_provider', sa.VARCHAR(length=100), nullable=True),
    sa.Column('ai_model', sa.VARCHAR(length=100), nullable=True),
    sa.Column('generation_prompt', sa.TEXT(), nullable=True),
    sa.Column('ai_confidence', sa.FLOAT(), nullable=True),
    sa.Column('generation_time_ms', sa.INTEGER(), nullable=True),
    sa.Column('personalization_data', sqlite.JSON(), nullable=True),
    sa.Column('client_segment', sa.VARCHAR(length=100), nullable=True),
    sa.Column('risk_level', sa.VARCHAR(length=50), nullable=True),
    sa.Column('was_sent', sa.BOOLEAN(), nullable=True),
    sa.Column('delivery_status', sa.VARCHAR(length=50), nullable=True),
    sa.Column('opened', sa.BOOLEAN(), nullable=True),
    sa.Column('clicked', sa.BOOLEAN(), nullable=True),
    sa.Column('responded', sa.BOOLEAN(), nullable=True),
    sa.Column('engagement_score', sa.FLOAT(), nullable=True),
    sa.Column('test_variant', sa.VARCHAR(length=50), nullable=True),
    sa.Column('control_group', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('sent_at', sa.DATETIME(), nullable=True),
    sa.Column('delivered_at', sa.DATETIME(), nullable=True),
    sa.Column('opened_at', sa.DATETIME(), nullable=True),
    sa.Column('clicked_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['appointment_id'], ['appointments.id'], ),
    sa.ForeignKeyConstraint(['template_id'], ['message_templates.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('message_id')
    )
    op.create_index('ix_ai_message_generations_id', 'ai_message_generations', ['id'], unique=False)
    op.create_table('upsell_analytics',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('barber_id', sa.INTEGER(), nullable=False),
    sa.Column('period_start', sa.DATETIME(), nullable=False),
    sa.Column('period_end', sa.DATETIME(), nullable=False),
    sa.Column('period_type', sa.VARCHAR(length=20), nullable=False),
    sa.Column('total_attempts', sa.INTEGER(), nullable=True),
    sa.Column('total_opportunities_identified', sa.INTEGER(), nullable=True),
    sa.Column('implementation_rate', sa.FLOAT(), nullable=True),
    sa.Column('total_conversions', sa.INTEGER(), nullable=True),
    sa.Column('conversion_rate', sa.FLOAT(), nullable=True),
    sa.Column('average_time_to_conversion', sa.FLOAT(), nullable=True),
    sa.Column('total_potential_revenue', sa.NUMERIC(precision=12, scale=2), nullable=True),
    sa.Column('total_actual_revenue', sa.NUMERIC(precision=12, scale=2), nullable=True),
    sa.Column('revenue_realization_rate', sa.FLOAT(), nullable=True),
    sa.Column('average_upsell_value', sa.NUMERIC(precision=10, scale=2), nullable=True),
    sa.Column('relationship_score_improvement', sa.FLOAT(), nullable=True),
    sa.Column('client_tier_upgrades', sa.INTEGER(), nullable=True),
    sa.Column('retention_rate_impact', sa.FLOAT(), nullable=True),
    sa.Column('methodology_compliance_score', sa.FLOAT(), nullable=True),
    sa.Column('best_performing_channel', sa.VARCHAR(length=16), nullable=True),
    sa.Column('channel_performance', sqlite.JSON(), nullable=True),
    sa.Column('most_successful_upsells', sqlite.JSON(), nullable=True),
    sa.Column('service_performance', sqlite.JSON(), nullable=True),
    sa.Column('calculated_at', sa.DATETIME(), nullable=False),
    sa.Column('last_updated', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['barber_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('barber_id', 'period_start', 'period_end', 'period_type')
    )
    op.create_index('ix_upsell_analytics_id', 'upsell_analytics', ['id'], unique=False)
    op.create_index('ix_upsell_analytics_barber_id', 'upsell_analytics', ['barber_id'], unique=False)
    op.create_index('idx_analytics_period_type', 'upsell_analytics', ['period_type'], unique=False)
    op.create_index('idx_analytics_barber_period', 'upsell_analytics', ['barber_id', 'period_start', 'period_end'], unique=False)
    op.create_table('ai_memory_records',
    sa.Column('id', sa.INTEGER(), nullable=True),
    sa.Column('memory_type', sa.VARCHAR(length=50), nullable=False),
    sa.Column('context_hash', sa.VARCHAR(length=64), nullable=False),
    sa.Column('input_features', sqlite.JSON(), nullable=False),
    sa.Column('outcome_data', sqlite.JSON(), nullable=False),
    sa.Column('success_score', sa.FLOAT(), nullable=False),
    sa.Column('confidence_level', sa.FLOAT(), nullable=False),
    sa.Column('client_personality', sa.VARCHAR(length=50), nullable=True),
    sa.Column('service_type', sa.VARCHAR(length=100), nullable=True),
    sa.Column('channel_used', sa.VARCHAR(length=50), nullable=True),
    sa.Column('timing_factor', sa.VARCHAR(length=50), nullable=True),
    sa.Column('seasonal_context', sa.VARCHAR(length=20), nullable=True),
    sa.Column('usage_count', sa.INTEGER(), server_default=sa.text('1'), nullable=True),
    sa.Column('accuracy_score', sa.FLOAT(), server_default=sa.text('(0.5)'), nullable=True),
    sa.Column('last_validated', sa.TIMESTAMP(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('created_at', sa.TIMESTAMP(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.TIMESTAMP(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('created_by_agent_version', sa.VARCHAR(length=20), server_default=sa.text("'v1.0'"), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('agent_metrics',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('agent_instance_id', sa.INTEGER(), nullable=False),
    sa.Column('date', sa.DATETIME(), nullable=False),
    sa.Column('conversations_started', sa.INTEGER(), nullable=True),
    sa.Column('conversations_completed', sa.INTEGER(), nullable=True),
    sa.Column('conversations_failed', sa.INTEGER(), nullable=True),
    sa.Column('messages_sent', sa.INTEGER(), nullable=True),
    sa.Column('messages_received', sa.INTEGER(), nullable=True),
    sa.Column('goals_achieved', sa.INTEGER(), nullable=True),
    sa.Column('conversion_rate', sa.FLOAT(), nullable=True),
    sa.Column('response_rate', sa.FLOAT(), nullable=True),
    sa.Column('revenue_generated', sa.FLOAT(), nullable=True),
    sa.Column('tokens_used', sa.INTEGER(), nullable=True),
    sa.Column('token_cost', sa.FLOAT(), nullable=True),
    sa.Column('roi', sa.FLOAT(), nullable=True),
    sa.Column('avg_response_time_minutes', sa.FLOAT(), nullable=True),
    sa.Column('avg_conversation_duration_minutes', sa.FLOAT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['agent_instance_id'], ['agent_instances.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_agent_metrics_id', 'agent_metrics', ['id'], unique=False)
    op.create_index('ix_agent_metrics_date', 'agent_metrics', ['date'], unique=False)
    op.create_index('idx_metrics_instance_date', 'agent_metrics', ['agent_instance_id', 'date'], unique=False)
    op.create_table('service_template_categories',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(), nullable=False),
    sa.Column('display_name', sa.VARCHAR(), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('six_fb_pathway', sa.VARCHAR(), nullable=True),
    sa.Column('business_impact', sa.VARCHAR(), nullable=False),
    sa.Column('icon_name', sa.VARCHAR(), nullable=True),
    sa.Column('color_theme', sa.VARCHAR(), nullable=True),
    sa.Column('display_order', sa.INTEGER(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_service_template_categories_name', 'service_template_categories', ['name'], unique=1)
    op.create_index('ix_service_template_categories_id', 'service_template_categories', ['id'], unique=False)
    op.create_table('webhook_logs',
    sa.Column('id', sa.VARCHAR(), nullable=False),
    sa.Column('endpoint_id', sa.VARCHAR(), nullable=False),
    sa.Column('event_type', sa.VARCHAR(), nullable=False),
    sa.Column('event_id', sa.VARCHAR(), nullable=True),
    sa.Column('status', sa.VARCHAR(length=8), nullable=True),
    sa.Column('status_code', sa.INTEGER(), nullable=True),
    sa.Column('request_url', sa.VARCHAR(), nullable=False),
    sa.Column('request_method', sa.VARCHAR(), nullable=True),
    sa.Column('request_headers', sqlite.JSON(), nullable=True),
    sa.Column('request_body', sqlite.JSON(), nullable=True),
    sa.Column('response_headers', sqlite.JSON(), nullable=True),
    sa.Column('response_body', sa.TEXT(), nullable=True),
    sa.Column('response_time_ms', sa.INTEGER(), nullable=True),
    sa.Column('error_message', sa.TEXT(), nullable=True),
    sa.Column('retry_count', sa.INTEGER(), nullable=True),
    sa.Column('next_retry_at', sa.DATETIME(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('delivered_at', sa.DATETIME(), nullable=True),
    sa.Column('completed_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['endpoint_id'], ['webhook_endpoints.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_webhook_log_status', 'webhook_logs', ['status'], unique=False)
    op.create_index('idx_webhook_log_event', 'webhook_logs', ['event_type'], unique=False)
    op.create_index('idx_webhook_log_endpoint', 'webhook_logs', ['endpoint_id'], unique=False)
    op.create_index('idx_webhook_log_created', 'webhook_logs', ['created_at'], unique=False)
    op.create_table('conversion_goals',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(length=100), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('event_name', sa.VARCHAR(length=100), nullable=False),
    sa.Column('event_type', sa.VARCHAR(length=12), nullable=False),
    sa.Column('value', sa.FLOAT(), nullable=True),
    sa.Column('value_expression', sa.TEXT(), nullable=True),
    sa.Column('conditions', sqlite.JSON(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('total_conversions', sa.INTEGER(), nullable=True),
    sa.Column('total_value', sa.FLOAT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('user_id', 'name', name='uq_user_goal_name')
    )
    op.create_index('ix_conversion_goals_user_id', 'conversion_goals', ['user_id'], unique=False)
    op.create_index('ix_conversion_goals_id', 'conversion_goals', ['id'], unique=False)
    op.create_index('idx_conversion_goals_user_active', 'conversion_goals', ['user_id', 'is_active'], unique=False)
    op.create_table('marketing_templates',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(length=100), nullable=False),
    sa.Column('description', sa.VARCHAR(length=500), nullable=True),
    sa.Column('template_type', sa.VARCHAR(length=20), nullable=False),
    sa.Column('category', sa.VARCHAR(length=50), nullable=True),
    sa.Column('subject', sa.VARCHAR(length=200), nullable=True),
    sa.Column('content', sa.TEXT(), nullable=False),
    sa.Column('variables', sqlite.JSON(), nullable=True),
    sa.Column('preview_data', sqlite.JSON(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('usage_count', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.Column('created_by_id', sa.INTEGER(), nullable=False),
    sa.ForeignKeyConstraint(['created_by_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_marketing_templates_id', 'marketing_templates', ['id'], unique=False)
    op.create_table('achievement_definitions',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(), nullable=False),
    sa.Column('title', sa.VARCHAR(), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=False),
    sa.Column('category', sa.VARCHAR(length=19), nullable=False),
    sa.Column('rarity', sa.VARCHAR(length=9), nullable=False),
    sa.Column('achievement_type', sa.VARCHAR(length=11), nullable=False),
    sa.Column('icon', sa.VARCHAR(), nullable=True),
    sa.Column('badge_design', sqlite.JSON(), nullable=True),
    sa.Column('color_scheme', sqlite.JSON(), nullable=True),
    sa.Column('requirements', sqlite.JSON(), nullable=False),
    sa.Column('target_value', sa.FLOAT(), nullable=True),
    sa.Column('measurement_criteria', sqlite.JSON(), nullable=True),
    sa.Column('sfb_principle', sa.VARCHAR(), nullable=True),
    sa.Column('business_impact', sa.TEXT(), nullable=True),
    sa.Column('coaching_insight', sa.TEXT(), nullable=True),
    sa.Column('xp_reward', sa.INTEGER(), nullable=True),
    sa.Column('tier_boost_value', sa.FLOAT(), nullable=True),
    sa.Column('special_rewards', sqlite.JSON(), nullable=True),
    sa.Column('prerequisite_achievements', sqlite.JSON(), nullable=True),
    sa.Column('next_level_achievement_id', sa.INTEGER(), nullable=True),
    sa.Column('progression_series', sa.VARCHAR(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('is_visible', sa.BOOLEAN(), nullable=True),
    sa.Column('release_date', sa.DATE(), nullable=True),
    sa.Column('expiry_date', sa.DATE(), nullable=True),
    sa.Column('total_unlocks', sa.INTEGER(), nullable=True),
    sa.Column('completion_rate', sa.FLOAT(), nullable=True),
    sa.Column('average_time_to_complete_days', sa.FLOAT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['next_level_achievement_id'], ['achievement_definitions.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('name')
    )
    op.create_index('ix_achievement_definitions_rarity', 'achievement_definitions', ['rarity'], unique=False)
    op.create_index('ix_achievement_definitions_id', 'achievement_definitions', ['id'], unique=False)
    op.create_index('ix_achievement_definitions_category', 'achievement_definitions', ['category'], unique=False)
    op.create_index('idx_achievement_category_rarity', 'achievement_definitions', ['category', 'rarity'], unique=False)
    op.create_index('idx_achievement_active_visible', 'achievement_definitions', ['is_active', 'is_visible'], unique=False)
    op.create_table('google_calendar_conflict_resolutions',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('sync_event_id', sa.INTEGER(), nullable=False),
    sa.Column('appointment_id', sa.INTEGER(), nullable=True),
    sa.Column('conflict_type', sa.VARCHAR(length=50), nullable=False),
    sa.Column('google_event_id', sa.VARCHAR(length=255), nullable=False),
    sa.Column('google_data', sa.TEXT(), nullable=True),
    sa.Column('local_data', sa.TEXT(), nullable=True),
    sa.Column('resolution_strategy', sa.VARCHAR(length=50), nullable=False),
    sa.Column('resolution_reason', sa.TEXT(), nullable=True),
    sa.Column('resolved_by', sa.VARCHAR(length=50), nullable=True),
    sa.Column('detected_at', sa.DATETIME(), nullable=False),
    sa.Column('resolved_at', sa.DATETIME(), nullable=True),
    sa.Column('status', sa.VARCHAR(length=20), nullable=False),
    sa.Column('requires_manual_review', sa.BOOLEAN(), nullable=True),
    sa.Column('final_data', sa.TEXT(), nullable=True),
    sa.Column('notes', sa.TEXT(), nullable=True),
    sa.ForeignKeyConstraint(['appointment_id'], ['appointments.id'], ),
    sa.ForeignKeyConstraint(['sync_event_id'], ['google_calendar_sync_events.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_google_calendar_conflict_resolutions_user_id', 'google_calendar_conflict_resolutions', ['user_id'], unique=False)
    op.create_index('ix_google_calendar_conflict_resolutions_sync_event_id', 'google_calendar_conflict_resolutions', ['sync_event_id'], unique=False)
    op.create_index('ix_google_calendar_conflict_resolutions_status', 'google_calendar_conflict_resolutions', ['status'], unique=False)
    op.create_index('ix_google_calendar_conflict_resolutions_requires_manual_review', 'google_calendar_conflict_resolutions', ['requires_manual_review'], unique=False)
    op.create_index('ix_google_calendar_conflict_resolutions_id', 'google_calendar_conflict_resolutions', ['id'], unique=False)
    op.create_index('ix_google_calendar_conflict_resolutions_conflict_type', 'google_calendar_conflict_resolutions', ['conflict_type'], unique=False)
    op.create_index('ix_google_calendar_conflict_resolutions_appointment_id', 'google_calendar_conflict_resolutions', ['appointment_id'], unique=False)
    op.create_table('blackout_dates',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('location_id', sa.INTEGER(), nullable=True),
    sa.Column('barber_id', sa.INTEGER(), nullable=True),
    sa.Column('blackout_date', sa.DATE(), nullable=False),
    sa.Column('end_date', sa.DATE(), nullable=True),
    sa.Column('start_time', sa.TIME(), nullable=True),
    sa.Column('end_time', sa.TIME(), nullable=True),
    sa.Column('reason', sa.VARCHAR(), nullable=False),
    sa.Column('blackout_type', sa.VARCHAR(), nullable=True),
    sa.Column('is_recurring', sa.BOOLEAN(), nullable=True),
    sa.Column('recurrence_pattern', sa.VARCHAR(), nullable=True),
    sa.Column('recurrence_end_date', sa.DATE(), nullable=True),
    sa.Column('allow_emergency_bookings', sa.BOOLEAN(), nullable=True),
    sa.Column('affects_existing_appointments', sa.BOOLEAN(), nullable=True),
    sa.Column('auto_reschedule', sa.BOOLEAN(), nullable=True),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('created_by_id', sa.INTEGER(), nullable=False),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.ForeignKeyConstraint(['barber_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['created_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['location_id'], ['barbershop_locations.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_blackout_dates_id', 'blackout_dates', ['id'], unique=False)
    op.create_index('ix_blackout_dates_blackout_date', 'blackout_dates', ['blackout_date'], unique=False)
    op.create_index('idx_blackout_date_location', 'blackout_dates', ['blackout_date', 'location_id'], unique=False)
    op.create_index('idx_blackout_date_barber', 'blackout_dates', ['blackout_date', 'barber_id'], unique=False)
    op.create_table('products',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('external_id', sa.VARCHAR(length=255), nullable=True),
    sa.Column('sku', sa.VARCHAR(length=255), nullable=True),
    sa.Column('name', sa.VARCHAR(length=500), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('product_type', sa.VARCHAR(length=11), nullable=False),
    sa.Column('vendor', sa.VARCHAR(length=255), nullable=True),
    sa.Column('tags', sqlite.JSON(), nullable=True),
    sa.Column('price', sa.NUMERIC(precision=10, scale=2), nullable=False),
    sa.Column('compare_at_price', sa.NUMERIC(precision=10, scale=2), nullable=True),
    sa.Column('cost_per_item', sa.NUMERIC(precision=10, scale=2), nullable=True),
    sa.Column('status', sa.VARCHAR(length=8), nullable=True),
    sa.Column('published', sa.BOOLEAN(), nullable=True),
    sa.Column('published_at', sa.DATETIME(), nullable=True),
    sa.Column('seo_title', sa.VARCHAR(length=255), nullable=True),
    sa.Column('seo_description', sa.TEXT(), nullable=True),
    sa.Column('handle', sa.VARCHAR(length=255), nullable=True),
    sa.Column('shopify_data', sqlite.JSON(), nullable=True),
    sa.Column('sync_status', sa.VARCHAR(length=50), nullable=True),
    sa.Column('last_synced_at', sa.DATETIME(), nullable=True),
    sa.Column('location_id', sa.INTEGER(), nullable=True),
    sa.Column('commission_rate', sa.NUMERIC(precision=5, scale=4), nullable=True),
    sa.Column('requires_shipping', sa.BOOLEAN(), nullable=True),
    sa.Column('taxable', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['location_id'], ['barbershop_locations.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_products_sku', 'products', ['sku'], unique=1)
    op.create_index('ix_products_id', 'products', ['id'], unique=False)
    op.create_index('ix_products_handle', 'products', ['handle'], unique=False)
    op.create_index('ix_products_external_id', 'products', ['external_id'], unique=False)
    op.create_table('ai_experiments',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(length=200), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('hypothesis', sa.TEXT(), nullable=True),
    sa.Column('experiment_type', sa.VARCHAR(length=50), nullable=True),
    sa.Column('control_config', sqlite.JSON(), nullable=True),
    sa.Column('variant_config', sqlite.JSON(), nullable=True),
    sa.Column('status', sa.VARCHAR(length=20), nullable=True),
    sa.Column('start_date', sa.DATETIME(), nullable=True),
    sa.Column('end_date', sa.DATETIME(), nullable=True),
    sa.Column('target_sample_size', sa.INTEGER(), nullable=True),
    sa.Column('control_performance', sqlite.JSON(), nullable=True),
    sa.Column('variant_performance', sqlite.JSON(), nullable=True),
    sa.Column('statistical_significance', sa.FLOAT(), nullable=True),
    sa.Column('winner', sa.VARCHAR(length=20), nullable=True),
    sa.Column('should_implement', sa.BOOLEAN(), nullable=True),
    sa.Column('implemented_at', sa.DATETIME(), nullable=True),
    sa.Column('implementation_notes', sa.TEXT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('created_by', sa.INTEGER(), nullable=True),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_ai_experiments_id', 'ai_experiments', ['id'], unique=False)
    op.create_table('embedding_cache',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('content_hash', sa.VARCHAR(length=64), nullable=False),
    sa.Column('content_type', sa.VARCHAR(length=20), nullable=False),
    sa.Column('entity_id', sa.INTEGER(), nullable=False),
    sa.Column('content_text', sa.TEXT(), nullable=False),
    sa.Column('embedding', sqlite.JSON(), nullable=False),
    sa.Column('embedding_model', sa.VARCHAR(length=50), server_default=sa.text("'voyage-3-large'"), nullable=False),
    sa.Column('chunk_index', sa.INTEGER(), server_default=sa.text("'0'"), nullable=True),
    sa.Column('embedding_dimension', sa.INTEGER(), server_default=sa.text("'1024'"), nullable=False),
    sa.Column('content_length', sa.INTEGER(), nullable=False),
    sa.Column('confidence_score', sa.FLOAT(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), server_default=sa.text("'true'"), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.Column('updated_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.Column('last_used_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_embedding_cache_is_active', 'embedding_cache', ['is_active'], unique=False)
    op.create_index('ix_embedding_cache_id', 'embedding_cache', ['id'], unique=False)
    op.create_index('ix_embedding_cache_entity_id', 'embedding_cache', ['entity_id'], unique=False)
    op.create_index('ix_embedding_cache_content_type', 'embedding_cache', ['content_type'], unique=False)
    op.create_index('ix_embedding_cache_content_hash', 'embedding_cache', ['content_hash'], unique=1)
    op.create_index('idx_embedding_cache_type_entity', 'embedding_cache', ['content_type', 'entity_id'], unique=False)
    op.create_index('idx_embedding_cache_model_dimension', 'embedding_cache', ['embedding_model', 'embedding_dimension'], unique=False)
    op.create_index('idx_embedding_cache_active_used', 'embedding_cache', ['is_active', 'last_used_at'], unique=False)
    op.create_table('gamification_challenges',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(), nullable=False),
    sa.Column('title', sa.VARCHAR(), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=False),
    sa.Column('challenge_type', sa.VARCHAR(length=9), nullable=False),
    sa.Column('category', sa.VARCHAR(length=19), nullable=False),
    sa.Column('start_date', sa.DATETIME(), nullable=False),
    sa.Column('end_date', sa.DATETIME(), nullable=False),
    sa.Column('registration_deadline', sa.DATETIME(), nullable=True),
    sa.Column('objective', sqlite.JSON(), nullable=False),
    sa.Column('target_value', sa.FLOAT(), nullable=True),
    sa.Column('measurement_criteria', sqlite.JSON(), nullable=False),
    sa.Column('difficulty_level', sa.VARCHAR(), nullable=True),
    sa.Column('max_participants', sa.INTEGER(), nullable=True),
    sa.Column('current_participants', sa.INTEGER(), nullable=True),
    sa.Column('is_team_challenge', sa.BOOLEAN(), nullable=True),
    sa.Column('team_size_limit', sa.INTEGER(), nullable=True),
    sa.Column('completion_rewards', sqlite.JSON(), nullable=True),
    sa.Column('ranking_rewards', sqlite.JSON(), nullable=True),
    sa.Column('participation_rewards', sqlite.JSON(), nullable=True),
    sa.Column('sfb_principle', sa.VARCHAR(), nullable=True),
    sa.Column('business_development_focus', sa.VARCHAR(), nullable=True),
    sa.Column('coaching_value', sa.TEXT(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('is_featured', sa.BOOLEAN(), nullable=True),
    sa.Column('registration_required', sa.BOOLEAN(), nullable=True),
    sa.Column('total_completions', sa.INTEGER(), nullable=True),
    sa.Column('completion_rate', sa.FLOAT(), nullable=True),
    sa.Column('average_completion_time_hours', sa.FLOAT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_gamification_challenges_start_date', 'gamification_challenges', ['start_date'], unique=False)
    op.create_index('ix_gamification_challenges_id', 'gamification_challenges', ['id'], unique=False)
    op.create_index('ix_gamification_challenges_end_date', 'gamification_challenges', ['end_date'], unique=False)
    op.create_index('ix_gamification_challenges_challenge_type', 'gamification_challenges', ['challenge_type'], unique=False)
    op.create_index('idx_challenge_type_active', 'gamification_challenges', ['challenge_type', 'is_active'], unique=False)
    op.create_index('idx_challenge_dates', 'gamification_challenges', ['start_date', 'end_date'], unique=False)
    op.create_table('six_fb_client_behavior_analytics',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('client_id', sa.INTEGER(), nullable=False),
    sa.Column('analysis_date', sa.DATE(), nullable=False),
    sa.Column('visit_pattern_consistency', sa.FLOAT(), nullable=True),
    sa.Column('booking_lead_time_days', sa.FLOAT(), nullable=True),
    sa.Column('cancellation_pattern', sqlite.JSON(), nullable=True),
    sa.Column('rescheduling_frequency', sa.FLOAT(), nullable=True),
    sa.Column('service_exploration_rate', sa.FLOAT(), nullable=True),
    sa.Column('premium_service_adoption_rate', sa.FLOAT(), nullable=True),
    sa.Column('add_on_acceptance_rate', sa.FLOAT(), nullable=True),
    sa.Column('price_sensitivity_score', sa.FLOAT(), nullable=True),
    sa.Column('website_engagement_score', sa.FLOAT(), nullable=True),
    sa.Column('social_media_engagement', sa.FLOAT(), nullable=True),
    sa.Column('review_participation_rate', sa.FLOAT(), nullable=True),
    sa.Column('referral_activity_score', sa.FLOAT(), nullable=True),
    sa.Column('churn_risk_score', sa.FLOAT(), nullable=True),
    sa.Column('upsell_receptivity_score', sa.FLOAT(), nullable=True),
    sa.Column('lifetime_value_projection', sa.NUMERIC(precision=10, scale=2), nullable=True),
    sa.Column('growth_potential_score', sa.FLOAT(), nullable=True),
    sa.Column('premium_positioning_alignment', sa.FLOAT(), nullable=True),
    sa.Column('relationship_deepening_potential', sa.FLOAT(), nullable=True),
    sa.Column('advocacy_potential_score', sa.FLOAT(), nullable=True),
    sa.Column('key_behavioral_traits', sqlite.JSON(), nullable=True),
    sa.Column('engagement_preferences', sqlite.JSON(), nullable=True),
    sa.Column('optimization_opportunities', sqlite.JSON(), nullable=True),
    sa.Column('ml_features', sqlite.JSON(), nullable=True),
    sa.Column('model_predictions', sqlite.JSON(), nullable=True),
    sa.Column('prediction_confidence', sa.FLOAT(), nullable=True),
    sa.Column('last_calculated', sa.DATETIME(), nullable=True),
    sa.Column('calculation_version', sa.VARCHAR(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['client_id'], ['clients.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_six_fb_client_behavior_analytics_user_id', 'six_fb_client_behavior_analytics', ['user_id'], unique=False)
    op.create_index('ix_six_fb_client_behavior_analytics_id', 'six_fb_client_behavior_analytics', ['id'], unique=False)
    op.create_index('ix_six_fb_client_behavior_analytics_client_id', 'six_fb_client_behavior_analytics', ['client_id'], unique=False)
    op.create_index('ix_six_fb_client_behavior_analytics_analysis_date', 'six_fb_client_behavior_analytics', ['analysis_date'], unique=False)
    op.create_index('idx_behavior_user_client_date', 'six_fb_client_behavior_analytics', ['user_id', 'client_id', 'analysis_date'], unique=False)
    op.create_index('idx_behavior_growth_potential', 'six_fb_client_behavior_analytics', ['growth_potential_score'], unique=False)
    op.create_index('idx_behavior_churn_risk', 'six_fb_client_behavior_analytics', ['churn_risk_score'], unique=False)
    op.create_table('six_fb_client_touchpoint_plans',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('client_id', sa.INTEGER(), nullable=False),
    sa.Column('journey_stage_id', sa.INTEGER(), nullable=True),
    sa.Column('touchpoint_type', sa.VARCHAR(length=18), nullable=False),
    sa.Column('touchpoint_name', sa.VARCHAR(), nullable=False),
    sa.Column('touchpoint_description', sa.TEXT(), nullable=True),
    sa.Column('planned_date', sa.DATETIME(), nullable=False),
    sa.Column('executed_date', sa.DATETIME(), nullable=True),
    sa.Column('status', sa.VARCHAR(), nullable=True),
    sa.Column('communication_channels', sqlite.JSON(), nullable=True),
    sa.Column('message_template_id', sa.VARCHAR(), nullable=True),
    sa.Column('personalization_data', sqlite.JSON(), nullable=True),
    sa.Column('automation_workflow', sa.BOOLEAN(), nullable=True),
    sa.Column('relationship_building_objective', sa.VARCHAR(), nullable=True),
    sa.Column('value_creation_goal', sa.VARCHAR(), nullable=True),
    sa.Column('premium_positioning_elements', sqlite.JSON(), nullable=True),
    sa.Column('expected_client_experience', sa.TEXT(), nullable=True),
    sa.Column('success_criteria', sqlite.JSON(), nullable=True),
    sa.Column('success_metrics', sqlite.JSON(), nullable=True),
    sa.Column('target_engagement_score', sa.FLOAT(), nullable=True),
    sa.Column('target_response_rate', sa.FLOAT(), nullable=True),
    sa.Column('actual_engagement_score', sa.FLOAT(), nullable=True),
    sa.Column('actual_response_rate', sa.FLOAT(), nullable=True),
    sa.Column('client_feedback', sa.TEXT(), nullable=True),
    sa.Column('execution_notes', sa.TEXT(), nullable=True),
    sa.Column('effectiveness_score', sa.FLOAT(), nullable=True),
    sa.Column('relationship_impact', sa.FLOAT(), nullable=True),
    sa.Column('revenue_impact', sa.NUMERIC(precision=8, scale=2), nullable=True),
    sa.Column('follow_up_touchpoints_generated', sqlite.JSON(), nullable=True),
    sa.Column('optimization_suggestions', sqlite.JSON(), nullable=True),
    sa.Column('a_b_test_data', sqlite.JSON(), nullable=True),
    sa.Column('learnings_captured', sqlite.JSON(), nullable=True),
    sa.Column('created_by', sa.VARCHAR(), nullable=True),
    sa.Column('priority_level', sa.VARCHAR(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['client_id'], ['clients.id'], ),
    sa.ForeignKeyConstraint(['journey_stage_id'], ['six_fb_client_journey_stages.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_six_fb_client_touchpoint_plans_user_id', 'six_fb_client_touchpoint_plans', ['user_id'], unique=False)
    op.create_index('ix_six_fb_client_touchpoint_plans_id', 'six_fb_client_touchpoint_plans', ['id'], unique=False)
    op.create_index('ix_six_fb_client_touchpoint_plans_client_id', 'six_fb_client_touchpoint_plans', ['client_id'], unique=False)
    op.create_index('idx_touchpoint_user_client_date', 'six_fb_client_touchpoint_plans', ['user_id', 'client_id', 'planned_date'], unique=False)
    op.create_index('idx_touchpoint_type_status', 'six_fb_client_touchpoint_plans', ['touchpoint_type', 'status'], unique=False)
    op.create_index('idx_touchpoint_effectiveness', 'six_fb_client_touchpoint_plans', ['effectiveness_score'], unique=False)
    op.create_table('appointment_cancellations',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('appointment_id', sa.INTEGER(), nullable=False),
    sa.Column('policy_id', sa.INTEGER(), nullable=True),
    sa.Column('cancelled_at', sa.DATETIME(), nullable=True),
    sa.Column('cancelled_by_id', sa.INTEGER(), nullable=True),
    sa.Column('reason', sa.VARCHAR(length=19), nullable=True),
    sa.Column('reason_details', sa.TEXT(), nullable=True),
    sa.Column('hours_before_appointment', sa.FLOAT(), nullable=False),
    sa.Column('original_appointment_time', sa.DATETIME(), nullable=False),
    sa.Column('original_amount', sa.FLOAT(), nullable=False),
    sa.Column('refund_type', sa.VARCHAR(length=14), nullable=False),
    sa.Column('refund_percentage', sa.FLOAT(), nullable=True),
    sa.Column('refund_amount', sa.FLOAT(), nullable=True),
    sa.Column('cancellation_fee', sa.FLOAT(), nullable=True),
    sa.Column('net_refund_amount', sa.FLOAT(), nullable=True),
    sa.Column('policy_rule_applied', sa.VARCHAR(length=50), nullable=True),
    sa.Column('is_emergency_exception', sa.BOOLEAN(), nullable=True),
    sa.Column('is_first_time_client_grace', sa.BOOLEAN(), nullable=True),
    sa.Column('requires_manual_approval', sa.BOOLEAN(), nullable=True),
    sa.Column('refund_processed', sa.BOOLEAN(), nullable=True),
    sa.Column('refund_processed_at', sa.DATETIME(), nullable=True),
    sa.Column('refund_processed_by_id', sa.INTEGER(), nullable=True),
    sa.Column('original_payment_id', sa.INTEGER(), nullable=True),
    sa.Column('refund_id', sa.INTEGER(), nullable=True),
    sa.Column('slot_offered_to_waitlist', sa.BOOLEAN(), nullable=True),
    sa.Column('waitlist_offered_at', sa.DATETIME(), nullable=True),
    sa.Column('slot_filled_from_waitlist', sa.BOOLEAN(), nullable=True),
    sa.Column('admin_notes', sa.TEXT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['appointment_id'], ['appointments.id'], ),
    sa.ForeignKeyConstraint(['cancelled_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['original_payment_id'], ['payments.id'], ),
    sa.ForeignKeyConstraint(['policy_id'], ['cancellation_policies.id'], ),
    sa.ForeignKeyConstraint(['refund_id'], ['refunds.id'], ),
    sa.ForeignKeyConstraint(['refund_processed_by_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('appointment_id')
    )
    op.create_index('ix_appointment_cancellations_id', 'appointment_cancellations', ['id'], unique=False)
    op.create_table('tracking_configurations',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('gtm_container_id', sa.VARCHAR(length=50), nullable=True),
    sa.Column('gtm_enabled', sa.BOOLEAN(), nullable=True),
    sa.Column('gtm_server_url', sa.VARCHAR(length=255), nullable=True),
    sa.Column('meta_pixel_id', sa.VARCHAR(length=50), nullable=True),
    sa.Column('meta_enabled', sa.BOOLEAN(), nullable=True),
    sa.Column('meta_test_event_code', sa.VARCHAR(length=50), nullable=True),
    sa.Column('google_ads_conversion_id', sa.VARCHAR(length=50), nullable=True),
    sa.Column('google_ads_enabled', sa.BOOLEAN(), nullable=True),
    sa.Column('google_ads_conversion_labels', sqlite.JSON(), nullable=True),
    sa.Column('attribution_window_days', sa.INTEGER(), nullable=True),
    sa.Column('view_attribution_window_days', sa.INTEGER(), nullable=True),
    sa.Column('default_attribution_model', sa.VARCHAR(length=14), nullable=True),
    sa.Column('conversion_value_rules', sqlite.JSON(), nullable=True),
    sa.Column('excluded_domains', sqlite.JSON(), nullable=True),
    sa.Column('custom_channel_rules', sqlite.JSON(), nullable=True),
    sa.Column('enable_enhanced_conversions', sa.BOOLEAN(), nullable=True),
    sa.Column('hash_user_data', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('user_id')
    )
    op.create_index('ix_tracking_configurations_id', 'tracking_configurations', ['id'], unique=False)
    op.create_table('business_intelligence_agents',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(length=100), nullable=False),
    sa.Column('agent_type', sa.VARCHAR(length=27), nullable=False),
    sa.Column('display_name', sa.VARCHAR(length=100), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=False),
    sa.Column('coaching_style', sa.VARCHAR(length=50), nullable=True),
    sa.Column('personality_traits', sqlite.JSON(), nullable=True),
    sa.Column('expertise_areas', sqlite.JSON(), nullable=True),
    sa.Column('six_fb_focus_areas', sqlite.JSON(), nullable=True),
    sa.Column('compliance_thresholds', sqlite.JSON(), nullable=True),
    sa.Column('methodology_weights', sqlite.JSON(), nullable=True),
    sa.Column('system_prompt', sa.TEXT(), nullable=False),
    sa.Column('coaching_prompts', sqlite.JSON(), nullable=True),
    sa.Column('example_conversations', sqlite.JSON(), nullable=True),
    sa.Column('trigger_conditions', sqlite.JSON(), nullable=True),
    sa.Column('coaching_frequency', sa.VARCHAR(length=20), nullable=True),
    sa.Column('max_sessions_per_week', sa.INTEGER(), nullable=True),
    sa.Column('min_data_points_required', sa.INTEGER(), nullable=True),
    sa.Column('success_metrics', sqlite.JSON(), nullable=True),
    sa.Column('improvement_targets', sqlite.JSON(), nullable=True),
    sa.Column('tier_requirement', sa.VARCHAR(length=20), nullable=True),
    sa.Column('is_premium_feature', sa.BOOLEAN(), nullable=True),
    sa.Column('monthly_cost', sa.FLOAT(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('is_beta', sa.BOOLEAN(), nullable=True),
    sa.Column('version', sa.VARCHAR(length=10), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_business_intelligence_agents_is_active', 'business_intelligence_agents', ['is_active'], unique=False)
    op.create_index('ix_business_intelligence_agents_id', 'business_intelligence_agents', ['id'], unique=False)
    op.create_index('ix_business_intelligence_agents_agent_type', 'business_intelligence_agents', ['agent_type'], unique=False)
    op.create_table('refunds',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('payment_id', sa.INTEGER(), nullable=True),
    sa.Column('amount', sa.FLOAT(), nullable=True),
    sa.Column('reason', sa.VARCHAR(), nullable=True),
    sa.Column('status', sa.VARCHAR(), nullable=True),
    sa.Column('stripe_refund_id', sa.VARCHAR(), nullable=True),
    sa.Column('initiated_by_id', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('processed_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['initiated_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['payment_id'], ['payments.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_refunds_id', 'refunds', ['id'], unique=False)
    op.create_table('six_fb_retention_campaigns',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('campaign_name', sa.VARCHAR(), nullable=False),
    sa.Column('campaign_description', sa.TEXT(), nullable=True),
    sa.Column('campaign_type', sa.VARCHAR(), nullable=False),
    sa.Column('target_client_criteria', sqlite.JSON(), nullable=False),
    sa.Column('target_risk_score_range', sqlite.JSON(), nullable=True),
    sa.Column('target_value_tiers', sqlite.JSON(), nullable=True),
    sa.Column('target_inactivity_days', sa.INTEGER(), nullable=True),
    sa.Column('start_date', sa.DATE(), nullable=False),
    sa.Column('end_date', sa.DATE(), nullable=True),
    sa.Column('duration_days', sa.INTEGER(), nullable=True),
    sa.Column('retention_strategy', sqlite.JSON(), nullable=False),
    sa.Column('communication_sequence', sqlite.JSON(), nullable=True),
    sa.Column('incentive_structure', sqlite.JSON(), nullable=True),
    sa.Column('personal_outreach_included', sa.BOOLEAN(), nullable=True),
    sa.Column('relationship_recovery_approach', sqlite.JSON(), nullable=True),
    sa.Column('value_re_demonstration_plan', sqlite.JSON(), nullable=True),
    sa.Column('premium_positioning_maintenance', sqlite.JSON(), nullable=True),
    sa.Column('target_clients_identified', sa.INTEGER(), nullable=True),
    sa.Column('clients_enrolled', sa.INTEGER(), nullable=True),
    sa.Column('clients_responded', sa.INTEGER(), nullable=True),
    sa.Column('clients_retained', sa.INTEGER(), nullable=True),
    sa.Column('clients_reactivated', sa.INTEGER(), nullable=True),
    sa.Column('retention_rate', sa.FLOAT(), nullable=True),
    sa.Column('reactivation_rate', sa.FLOAT(), nullable=True),
    sa.Column('revenue_recovered', sa.NUMERIC(precision=10, scale=2), nullable=True),
    sa.Column('relationship_improvement_score', sa.FLOAT(), nullable=True),
    sa.Column('a_b_test_variants', sqlite.JSON(), nullable=True),
    sa.Column('optimization_insights', sqlite.JSON(), nullable=True),
    sa.Column('success_factors', sqlite.JSON(), nullable=True),
    sa.Column('improvement_recommendations', sqlite.JSON(), nullable=True),
    sa.Column('status', sa.VARCHAR(), nullable=True),
    sa.Column('budget_allocated', sa.NUMERIC(precision=8, scale=2), nullable=True),
    sa.Column('budget_spent', sa.NUMERIC(precision=8, scale=2), nullable=True),
    sa.Column('roi_achieved', sa.FLOAT(), nullable=True),
    sa.Column('created_by', sa.VARCHAR(), nullable=True),
    sa.Column('last_optimization_date', sa.DATETIME(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_six_fb_retention_campaigns_user_id', 'six_fb_retention_campaigns', ['user_id'], unique=False)
    op.create_index('ix_six_fb_retention_campaigns_id', 'six_fb_retention_campaigns', ['id'], unique=False)
    op.create_index('idx_retention_user_status', 'six_fb_retention_campaigns', ['user_id', 'status'], unique=False)
    op.create_index('idx_retention_roi', 'six_fb_retention_campaigns', ['roi_achieved'], unique=False)
    op.create_index('idx_retention_dates', 'six_fb_retention_campaigns', ['start_date', 'end_date'], unique=False)
    op.create_table('clients',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('first_name', sa.VARCHAR(), nullable=False),
    sa.Column('last_name', sa.VARCHAR(), nullable=False),
    sa.Column('email', sa.VARCHAR(length=500), nullable=True),
    sa.Column('phone', sa.VARCHAR(length=100), nullable=True),
    sa.Column('date_of_birth', sa.DATE(), nullable=True),
    sa.Column('customer_type', sa.VARCHAR(), nullable=True),
    sa.Column('total_visits', sa.INTEGER(), nullable=True),
    sa.Column('total_spent', sa.FLOAT(), nullable=True),
    sa.Column('average_ticket', sa.FLOAT(), nullable=True),
    sa.Column('visit_frequency_days', sa.INTEGER(), nullable=True),
    sa.Column('no_show_count', sa.INTEGER(), nullable=True),
    sa.Column('cancellation_count', sa.INTEGER(), nullable=True),
    sa.Column('referral_count', sa.INTEGER(), nullable=True),
    sa.Column('first_visit_date', sa.DATETIME(), nullable=True),
    sa.Column('last_visit_date', sa.DATETIME(), nullable=True),
    sa.Column('preferred_services', sqlite.JSON(), nullable=True),
    sa.Column('notes', sa.TEXT(), nullable=True),
    sa.Column('tags', sa.VARCHAR(length=500), nullable=True),
    sa.Column('preferred_barber_id', sa.INTEGER(), nullable=True),
    sa.Column('barber_id', sa.INTEGER(), nullable=True),
    sa.Column('location_id', sa.INTEGER(), nullable=True),
    sa.Column('communication_preferences', sqlite.JSON(), nullable=True),
    sa.Column('sms_enabled', sa.BOOLEAN(), nullable=True),
    sa.Column('email_enabled', sa.BOOLEAN(), nullable=True),
    sa.Column('marketing_enabled', sa.BOOLEAN(), nullable=True),
    sa.Column('email_opt_in', sa.BOOLEAN(), nullable=True),
    sa.Column('sms_opt_in', sa.BOOLEAN(), nullable=True),
    sa.Column('is_test_data', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.Column('created_by_id', sa.INTEGER(), nullable=True),
    sa.ForeignKeyConstraint(['barber_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['created_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['preferred_barber_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_clients_phone', 'clients', ['phone'], unique=False)
    op.create_index('ix_clients_id', 'clients', ['id'], unique=False)
    op.create_index('ix_clients_email', 'clients', ['email'], unique=1)
    op.create_index('idx_clients_phone', 'clients', ['phone'], unique=False)
    op.create_index('idx_clients_email', 'clients', ['email'], unique=False)
    op.create_index('idx_clients_barber_created', 'clients', ['barber_id', 'created_at'], unique=False)
    op.create_table('campaign_tracking',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('campaign_id', sa.VARCHAR(length=100), nullable=False),
    sa.Column('campaign_name', sa.VARCHAR(length=255), nullable=False),
    sa.Column('campaign_source', sa.VARCHAR(length=50), nullable=False),
    sa.Column('campaign_medium', sa.VARCHAR(length=50), nullable=False),
    sa.Column('start_date', sa.DATETIME(), nullable=False),
    sa.Column('end_date', sa.DATETIME(), nullable=True),
    sa.Column('total_cost', sa.FLOAT(), nullable=True),
    sa.Column('currency', sa.VARCHAR(length=3), nullable=True),
    sa.Column('impressions', sa.INTEGER(), nullable=True),
    sa.Column('clicks', sa.INTEGER(), nullable=True),
    sa.Column('conversions', sa.INTEGER(), nullable=True),
    sa.Column('conversion_value', sa.FLOAT(), nullable=True),
    sa.Column('ctr', sa.FLOAT(), nullable=True),
    sa.Column('conversion_rate', sa.FLOAT(), nullable=True),
    sa.Column('cpc', sa.FLOAT(), nullable=True),
    sa.Column('cpa', sa.FLOAT(), nullable=True),
    sa.Column('roas', sa.FLOAT(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.Column('last_sync_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('user_id', 'campaign_id', 'campaign_source', name='uq_user_campaign')
    )
    op.create_index('ix_campaign_tracking_user_id', 'campaign_tracking', ['user_id'], unique=False)
    op.create_index('ix_campaign_tracking_id', 'campaign_tracking', ['id'], unique=False)
    op.create_index('ix_campaign_tracking_campaign_id', 'campaign_tracking', ['campaign_id'], unique=False)
    op.create_index('idx_campaign_tracking_dates', 'campaign_tracking', ['start_date', 'end_date'], unique=False)
    op.create_index('idx_campaign_tracking_active', 'campaign_tracking', ['user_id', 'is_active'], unique=False)
    op.create_table('search_query_suggestions',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('query', sa.VARCHAR(length=200), nullable=False),
    sa.Column('normalized_query', sa.VARCHAR(length=200), nullable=False),
    sa.Column('search_count', sa.INTEGER(), server_default=sa.text("'1'"), nullable=False),
    sa.Column('success_rate', sa.FLOAT(), server_default=sa.text("'0.0'"), nullable=False),
    sa.Column('avg_results_count', sa.FLOAT(), server_default=sa.text("'0.0'"), nullable=False),
    sa.Column('last_searched_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.Column('click_through_rate', sa.FLOAT(), server_default=sa.text("'0.0'"), nullable=False),
    sa.Column('avg_click_position', sa.FLOAT(), nullable=True),
    sa.Column('is_trending', sa.BOOLEAN(), server_default=sa.text("'false'"), nullable=False),
    sa.Column('category', sa.VARCHAR(length=50), nullable=True),
    sa.Column('intent', sa.VARCHAR(length=50), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.Column('updated_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_search_query_suggestions_query', 'search_query_suggestions', ['query'], unique=1)
    op.create_index('ix_search_query_suggestions_normalized_query', 'search_query_suggestions', ['normalized_query'], unique=False)
    op.create_index('ix_search_query_suggestions_id', 'search_query_suggestions', ['id'], unique=False)
    op.create_table('custom_role_permissions',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('organization_id', sa.INTEGER(), nullable=False),
    sa.Column('role', sa.VARCHAR(length=50), nullable=False),
    sa.Column('permission', sa.VARCHAR(length=100), nullable=False),
    sa.Column('enabled', sa.BOOLEAN(), nullable=False),
    sa.Column('created_by', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=False),
    sa.Column('updated_at', sa.DATETIME(), nullable=False),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['organization_id'], ['organizations.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('organization_id', 'role', 'permission', name='uq_org_role_permission')
    )
    op.create_index('ix_custom_role_permissions_id', 'custom_role_permissions', ['id'], unique=False)
    op.create_index('idx_custom_perms_role', 'custom_role_permissions', ['role'], unique=False)
    op.create_index('idx_custom_perms_permission', 'custom_role_permissions', ['permission'], unique=False)
    op.create_index('idx_custom_perms_org_role', 'custom_role_permissions', ['organization_id', 'role'], unique=False)
    op.create_index('idx_custom_perms_org_id', 'custom_role_permissions', ['organization_id'], unique=False)
    op.create_table('timezone_conversion_log',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=True),
    sa.Column('appointment_id', sa.INTEGER(), nullable=True),
    sa.Column('source_timezone', sa.VARCHAR(length=50), nullable=False),
    sa.Column('target_timezone', sa.VARCHAR(length=50), nullable=False),
    sa.Column('source_datetime', sa.DATETIME(), nullable=False),
    sa.Column('target_datetime', sa.DATETIME(), nullable=False),
    sa.Column('conversion_type', sa.VARCHAR(length=50), nullable=False),
    sa.Column('context', sqlite.JSON(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=False),
    sa.ForeignKeyConstraint(['appointment_id'], ['appointments.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_timezone_conversion_log_user_id', 'timezone_conversion_log', ['user_id'], unique=False)
    op.create_index('ix_timezone_conversion_log_id', 'timezone_conversion_log', ['id'], unique=False)
    op.create_index('ix_timezone_conversion_log_appointment_id', 'timezone_conversion_log', ['appointment_id'], unique=False)
    op.create_table('user_mfa_secrets',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('secret', sa.VARCHAR(length=255), nullable=False),
    sa.Column('is_enabled', sa.BOOLEAN(), nullable=False),
    sa.Column('is_verified', sa.BOOLEAN(), nullable=False),
    sa.Column('recovery_email', sa.VARCHAR(length=255), nullable=True),
    sa.Column('recovery_phone', sa.VARCHAR(length=50), nullable=True),
    sa.Column('last_used_at', sa.DATETIME(), nullable=True),
    sa.Column('failed_attempts', sa.INTEGER(), nullable=False),
    sa.Column('last_failed_at', sa.DATETIME(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=False),
    sa.Column('updated_at', sa.DATETIME(), nullable=False),
    sa.Column('enabled_at', sa.DATETIME(), nullable=True),
    sa.Column('disabled_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('user_id')
    )
    op.create_index('ix_user_mfa_secrets_id', 'user_mfa_secrets', ['id'], unique=False)
    op.create_index('idx_mfa_user_enabled', 'user_mfa_secrets', ['user_id', 'is_enabled'], unique=False)
    op.create_table('semantic_search_config',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('primary_model', sa.VARCHAR(length=50), server_default=sa.text("'voyage-3-large'"), nullable=False),
    sa.Column('query_model', sa.VARCHAR(length=50), server_default=sa.text("'voyage-3-large'"), nullable=False),
    sa.Column('content_model', sa.VARCHAR(length=50), server_default=sa.text("'voyage-3-large'"), nullable=False),
    sa.Column('min_similarity_barber', sa.FLOAT(), server_default=sa.text("'0.6'"), nullable=False),
    sa.Column('min_similarity_service', sa.FLOAT(), server_default=sa.text("'0.5'"), nullable=False),
    sa.Column('min_similarity_recommendation', sa.FLOAT(), server_default=sa.text("'0.4'"), nullable=False),
    sa.Column('max_embedding_cache_size', sa.INTEGER(), server_default=sa.text("'10000'"), nullable=False),
    sa.Column('embedding_cache_ttl_days', sa.INTEGER(), server_default=sa.text("'30'"), nullable=False),
    sa.Column('batch_size', sa.INTEGER(), server_default=sa.text("'10'"), nullable=False),
    sa.Column('enable_hybrid_search', sa.BOOLEAN(), server_default=sa.text("'true'"), nullable=False),
    sa.Column('enable_query_expansion', sa.BOOLEAN(), server_default=sa.text("'false'"), nullable=False),
    sa.Column('enable_result_reranking', sa.BOOLEAN(), server_default=sa.text("'true'"), nullable=False),
    sa.Column('enable_analytics', sa.BOOLEAN(), server_default=sa.text("'true'"), nullable=False),
    sa.Column('business_id', sa.INTEGER(), server_default=sa.text("'1'"), nullable=False),
    sa.Column('is_active', sa.BOOLEAN(), server_default=sa.text("'true'"), nullable=False),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.Column('updated_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_semantic_search_config_id', 'semantic_search_config', ['id'], unique=False)
    op.create_table('service_subscription_templates',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('subscription_type', sa.VARCHAR(length=16), nullable=False),
    sa.Column('price', sa.FLOAT(), nullable=False),
    sa.Column('original_price', sa.FLOAT(), nullable=True),
    sa.Column('billing_interval', sa.VARCHAR(length=9), nullable=False),
    sa.Column('services_per_period', sa.INTEGER(), nullable=True),
    sa.Column('rollover_unused', sa.BOOLEAN(), nullable=True),
    sa.Column('max_rollover', sa.INTEGER(), nullable=True),
    sa.Column('duration_months', sa.INTEGER(), nullable=True),
    sa.Column('min_commitment_months', sa.INTEGER(), nullable=True),
    sa.Column('early_cancellation_fee', sa.FLOAT(), nullable=True),
    sa.Column('min_days_between_services', sa.INTEGER(), nullable=True),
    sa.Column('max_advance_booking_days', sa.INTEGER(), nullable=True),
    sa.Column('blackout_dates', sqlite.JSON(), nullable=True),
    sa.Column('priority_booking', sa.BOOLEAN(), nullable=True),
    sa.Column('discount_on_additional', sa.FLOAT(), nullable=True),
    sa.Column('free_product_samples', sa.BOOLEAN(), nullable=True),
    sa.Column('vip_perks', sqlite.JSON(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('max_subscribers', sa.INTEGER(), nullable=True),
    sa.Column('requires_approval', sa.BOOLEAN(), nullable=True),
    sa.Column('barber_id', sa.INTEGER(), nullable=False),
    sa.Column('location_id', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['barber_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_service_subscription_templates_id', 'service_subscription_templates', ['id'], unique=False)
    op.create_table('search_analytics',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('query', sa.VARCHAR(length=500), nullable=False),
    sa.Column('query_hash', sa.VARCHAR(length=64), nullable=False),
    sa.Column('normalized_query', sa.VARCHAR(length=500), nullable=True),
    sa.Column('query_intent', sa.VARCHAR(length=50), nullable=True),
    sa.Column('user_id', sa.INTEGER(), nullable=True),
    sa.Column('user_role', sa.VARCHAR(length=50), nullable=True),
    sa.Column('session_id', sa.VARCHAR(length=100), nullable=True),
    sa.Column('search_type', sa.VARCHAR(length=20), nullable=False),
    sa.Column('search_category', sa.VARCHAR(length=20), nullable=True),
    sa.Column('min_similarity', sa.FLOAT(), nullable=True),
    sa.Column('limit_requested', sa.INTEGER(), server_default=sa.text("'10'"), nullable=False),
    sa.Column('results_count', sa.INTEGER(), server_default=sa.text("'0'"), nullable=False),
    sa.Column('has_semantic_results', sa.BOOLEAN(), server_default=sa.text("'false'"), nullable=False),
    sa.Column('has_keyword_results', sa.BOOLEAN(), server_default=sa.text("'false'"), nullable=False),
    sa.Column('top_similarity_score', sa.FLOAT(), nullable=True),
    sa.Column('avg_similarity_score', sa.FLOAT(), nullable=True),
    sa.Column('clicked_result_id', sa.INTEGER(), nullable=True),
    sa.Column('clicked_result_type', sa.VARCHAR(length=20), nullable=True),
    sa.Column('clicked_result_position', sa.INTEGER(), nullable=True),
    sa.Column('clicked_result_score', sa.FLOAT(), nullable=True),
    sa.Column('time_to_click_ms', sa.INTEGER(), nullable=True),
    sa.Column('search_time_ms', sa.INTEGER(), nullable=False),
    sa.Column('embedding_time_ms', sa.INTEGER(), nullable=True),
    sa.Column('similarity_time_ms', sa.INTEGER(), nullable=True),
    sa.Column('fallback_used', sa.BOOLEAN(), server_default=sa.text("'false'"), nullable=False),
    sa.Column('search_context', sqlite.JSON(), nullable=True),
    sa.Column('result_metadata', sqlite.JSON(), nullable=True),
    sa.Column('error_message', sa.VARCHAR(length=500), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_search_analytics_user_id', 'search_analytics', ['user_id'], unique=False)
    op.create_index('ix_search_analytics_session_id', 'search_analytics', ['session_id'], unique=False)
    op.create_index('ix_search_analytics_search_type', 'search_analytics', ['search_type'], unique=False)
    op.create_index('ix_search_analytics_query_hash', 'search_analytics', ['query_hash'], unique=False)
    op.create_index('ix_search_analytics_query', 'search_analytics', ['query'], unique=False)
    op.create_index('ix_search_analytics_id', 'search_analytics', ['id'], unique=False)
    op.create_index('ix_search_analytics_created_at', 'search_analytics', ['created_at'], unique=False)
    op.create_index('idx_search_analytics_user_time', 'search_analytics', ['user_id', 'created_at'], unique=False)
    op.create_index('idx_search_analytics_type_time', 'search_analytics', ['search_type', 'created_at'], unique=False)
    op.create_index('idx_search_analytics_query_time', 'search_analytics', ['query_hash', 'created_at'], unique=False)
    op.create_index('idx_search_analytics_performance', 'search_analytics', ['search_time_ms', 'results_count'], unique=False)
    op.create_table('notification_templates',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(), nullable=True),
    sa.Column('template_type', sa.VARCHAR(), nullable=True),
    sa.Column('subject', sa.VARCHAR(), nullable=True),
    sa.Column('body', sa.TEXT(), nullable=True),
    sa.Column('variables', sqlite.JSON(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_notification_templates_name', 'notification_templates', ['name'], unique=False)
    op.create_index('ix_notification_templates_id', 'notification_templates', ['id'], unique=False)
    op.create_table('agent_templates',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('agent_type', sa.VARCHAR(length=20), nullable=False),
    sa.Column('name', sa.VARCHAR(length=100), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('system_prompt', sa.TEXT(), nullable=False),
    sa.Column('initial_message_template', sa.TEXT(), nullable=False),
    sa.Column('follow_up_templates', sqlite.JSON(), nullable=True),
    sa.Column('required_variables', sqlite.JSON(), nullable=True),
    sa.Column('tone_settings', sqlite.JSON(), nullable=True),
    sa.Column('usage_count', sa.INTEGER(), nullable=True),
    sa.Column('avg_success_rate', sa.FLOAT(), nullable=True),
    sa.Column('is_system', sa.BOOLEAN(), nullable=True),
    sa.Column('created_by_id', sa.INTEGER(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['created_by_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_agent_templates_id', 'agent_templates', ['id'], unique=False)
    op.create_index('ix_agent_templates_agent_type', 'agent_templates', ['agent_type'], unique=False)
    op.create_index('idx_template_type_active', 'agent_templates', ['agent_type', 'is_active'], unique=False)
    op.create_table('six_fb_client_value_profiles',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('client_id', sa.INTEGER(), nullable=False),
    sa.Column('value_tier', sa.VARCHAR(length=12), nullable=False),
    sa.Column('tier_justification', sa.TEXT(), nullable=True),
    sa.Column('last_tier_review_date', sa.DATE(), nullable=True),
    sa.Column('lifetime_value', sa.NUMERIC(precision=10, scale=2), nullable=True),
    sa.Column('annual_value', sa.NUMERIC(precision=10, scale=2), nullable=True),
    sa.Column('average_ticket_size', sa.NUMERIC(precision=8, scale=2), nullable=True),
    sa.Column('total_revenue_generated', sa.NUMERIC(precision=10, scale=2), nullable=True),
    sa.Column('relationship_score', sa.FLOAT(), nullable=True),
    sa.Column('trust_level', sa.FLOAT(), nullable=True),
    sa.Column('loyalty_score', sa.FLOAT(), nullable=True),
    sa.Column('advocacy_potential', sa.FLOAT(), nullable=True),
    sa.Column('visit_frequency_days', sa.FLOAT(), nullable=True),
    sa.Column('appointment_consistency', sa.FLOAT(), nullable=True),
    sa.Column('upsell_receptivity', sa.FLOAT(), nullable=True),
    sa.Column('price_sensitivity', sa.FLOAT(), nullable=True),
    sa.Column('preferred_services', sqlite.JSON(), nullable=True),
    sa.Column('service_evolution', sqlite.JSON(), nullable=True),
    sa.Column('personalization_data', sqlite.JSON(), nullable=True),
    sa.Column('premium_service_adoption', sa.FLOAT(), nullable=True),
    sa.Column('brand_alignment_score', sa.FLOAT(), nullable=True),
    sa.Column('growth_potential', sa.FLOAT(), nullable=True),
    sa.Column('churn_risk_score', sa.FLOAT(), nullable=True),
    sa.Column('upsell_opportunities', sqlite.JSON(), nullable=True),
    sa.Column('retention_strategies', sqlite.JSON(), nullable=True),
    sa.Column('last_calculated', sa.DATETIME(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['client_id'], ['clients.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_six_fb_client_value_profiles_value_tier', 'six_fb_client_value_profiles', ['value_tier'], unique=False)
    op.create_index('ix_six_fb_client_value_profiles_user_id', 'six_fb_client_value_profiles', ['user_id'], unique=False)
    op.create_index('ix_six_fb_client_value_profiles_id', 'six_fb_client_value_profiles', ['id'], unique=False)
    op.create_index('ix_six_fb_client_value_profiles_client_id', 'six_fb_client_value_profiles', ['client_id'], unique=False)
    op.create_index('idx_client_value_user_tier', 'six_fb_client_value_profiles', ['user_id', 'value_tier'], unique=False)
    op.create_index('idx_client_value_risk', 'six_fb_client_value_profiles', ['churn_risk_score'], unique=False)
    op.create_index('idx_client_value_lifetime', 'six_fb_client_value_profiles', ['lifetime_value'], unique=False)
    op.create_table('ai_intervention_campaigns',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('campaign_name', sa.VARCHAR(length=255), nullable=False),
    sa.Column('campaign_type', sa.VARCHAR(length=23), nullable=False),
    sa.Column('status', sa.VARCHAR(length=9), nullable=True),
    sa.Column('appointment_id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('risk_score', sa.FLOAT(), nullable=False),
    sa.Column('risk_level', sa.VARCHAR(length=50), nullable=False),
    sa.Column('predicted_no_show_probability', sa.FLOAT(), nullable=False),
    sa.Column('ai_generated_messages', sqlite.JSON(), nullable=True),
    sa.Column('message_templates_used', sqlite.JSON(), nullable=True),
    sa.Column('personalization_factors', sqlite.JSON(), nullable=True),
    sa.Column('intervention_channels', sqlite.JSON(), nullable=True),
    sa.Column('intervention_timing', sqlite.JSON(), nullable=True),
    sa.Column('max_attempts', sa.INTEGER(), nullable=True),
    sa.Column('attempt_intervals', sqlite.JSON(), nullable=True),
    sa.Column('attempts_made', sa.INTEGER(), nullable=True),
    sa.Column('messages_sent', sa.INTEGER(), nullable=True),
    sa.Column('last_attempt_at', sa.DATETIME(), nullable=True),
    sa.Column('next_attempt_at', sa.DATETIME(), nullable=True),
    sa.Column('outcome', sa.VARCHAR(length=23), nullable=True),
    sa.Column('success_rate', sa.FLOAT(), nullable=True),
    sa.Column('engagement_metrics', sqlite.JSON(), nullable=True),
    sa.Column('client_response', sa.TEXT(), nullable=True),
    sa.Column('effectiveness_score', sa.FLOAT(), nullable=True),
    sa.Column('a_b_test_variant', sa.VARCHAR(length=50), nullable=True),
    sa.Column('optimization_notes', sa.TEXT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.Column('started_at', sa.DATETIME(), nullable=True),
    sa.Column('completed_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['appointment_id'], ['appointments.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_ai_intervention_campaigns_id', 'ai_intervention_campaigns', ['id'], unique=False)
    op.create_table('user_xp_profiles',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('total_xp', sa.INTEGER(), nullable=True),
    sa.Column('current_level', sa.INTEGER(), nullable=True),
    sa.Column('xp_in_current_level', sa.INTEGER(), nullable=True),
    sa.Column('xp_needed_for_next_level', sa.INTEGER(), nullable=True),
    sa.Column('level_progress_percentage', sa.FLOAT(), nullable=True),
    sa.Column('total_levels_gained', sa.INTEGER(), nullable=True),
    sa.Column('highest_level_achieved', sa.INTEGER(), nullable=True),
    sa.Column('xp_from_appointments', sa.INTEGER(), nullable=True),
    sa.Column('xp_from_achievements', sa.INTEGER(), nullable=True),
    sa.Column('xp_from_milestones', sa.INTEGER(), nullable=True),
    sa.Column('xp_from_streaks', sa.INTEGER(), nullable=True),
    sa.Column('xp_from_efficiency', sa.INTEGER(), nullable=True),
    sa.Column('xp_from_client_satisfaction', sa.INTEGER(), nullable=True),
    sa.Column('current_xp_multiplier', sa.FLOAT(), nullable=True),
    sa.Column('streak_bonus_multiplier', sa.FLOAT(), nullable=True),
    sa.Column('tier_bonus_multiplier', sa.FLOAT(), nullable=True),
    sa.Column('premium_bonus_multiplier', sa.FLOAT(), nullable=True),
    sa.Column('daily_xp_earned', sa.INTEGER(), nullable=True),
    sa.Column('weekly_xp_earned', sa.INTEGER(), nullable=True),
    sa.Column('monthly_xp_earned', sa.INTEGER(), nullable=True),
    sa.Column('last_xp_earned_at', sa.DATETIME(), nullable=True),
    sa.Column('xp_milestones_reached', sqlite.JSON(), nullable=True),
    sa.Column('level_rewards_claimed', sqlite.JSON(), nullable=True),
    sa.Column('next_major_milestone', sa.INTEGER(), nullable=True),
    sa.Column('global_rank', sa.INTEGER(), nullable=True),
    sa.Column('regional_rank', sa.INTEGER(), nullable=True),
    sa.Column('tier_rank', sa.INTEGER(), nullable=True),
    sa.Column('last_rank_update', sa.DATETIME(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_user_xp_profiles_user_id', 'user_xp_profiles', ['user_id'], unique=1)
    op.create_index('ix_user_xp_profiles_total_xp', 'user_xp_profiles', ['total_xp'], unique=False)
    op.create_index('ix_user_xp_profiles_id', 'user_xp_profiles', ['id'], unique=False)
    op.create_index('ix_user_xp_profiles_current_level', 'user_xp_profiles', ['current_level'], unique=False)
    op.create_index('idx_xp_total_level', 'user_xp_profiles', ['total_xp', 'current_level'], unique=False)
    op.create_index('idx_xp_daily_weekly', 'user_xp_profiles', ['daily_xp_earned', 'weekly_xp_earned'], unique=False)
    op.create_table('email_campaigns',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(length=255), nullable=False),
    sa.Column('template_name', sa.VARCHAR(length=100), nullable=False),
    sa.Column('subject', sa.VARCHAR(length=255), nullable=False),
    sa.Column('sent_count', sa.INTEGER(), nullable=True),
    sa.Column('delivered_count', sa.INTEGER(), nullable=True),
    sa.Column('delivery_rate', sa.FLOAT(), nullable=True),
    sa.Column('opened_count', sa.INTEGER(), nullable=True),
    sa.Column('unique_opens', sa.INTEGER(), nullable=True),
    sa.Column('open_rate', sa.FLOAT(), nullable=True),
    sa.Column('clicked_count', sa.INTEGER(), nullable=True),
    sa.Column('unique_clicks', sa.INTEGER(), nullable=True),
    sa.Column('click_rate', sa.FLOAT(), nullable=True),
    sa.Column('bounced_count', sa.INTEGER(), nullable=True),
    sa.Column('bounce_rate', sa.FLOAT(), nullable=True),
    sa.Column('unsubscribed_count', sa.INTEGER(), nullable=True),
    sa.Column('unsubscribe_rate', sa.FLOAT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_email_campaigns_id', 'email_campaigns', ['id'], unique=False)
    op.create_table('franchise_regions',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('network_id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(length=255), nullable=False),
    sa.Column('code', sa.VARCHAR(length=20), nullable=False),
    sa.Column('geographic_boundaries', sqlite.JSON(), nullable=True),
    sa.Column('primary_markets', sqlite.JSON(), nullable=True),
    sa.Column('market_demographics', sqlite.JSON(), nullable=True),
    sa.Column('regional_manager_id', sa.INTEGER(), nullable=True),
    sa.Column('development_coordinator_id', sa.INTEGER(), nullable=True),
    sa.Column('support_team_ids', sqlite.JSON(), nullable=True),
    sa.Column('target_locations', sa.INTEGER(), nullable=True),
    sa.Column('development_timeline', sqlite.JSON(), nullable=True),
    sa.Column('market_penetration', sa.NUMERIC(precision=5, scale=2), nullable=True),
    sa.Column('jurisdictions', sqlite.JSON(), nullable=True),
    sa.Column('regulatory_requirements', sqlite.JSON(), nullable=True),
    sa.Column('licensing_requirements', sqlite.JSON(), nullable=True),
    sa.Column('performance_metrics', sqlite.JSON(), nullable=True),
    sa.Column('benchmarking_data', sqlite.JSON(), nullable=True),
    sa.Column('status', sa.VARCHAR(length=11), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['development_coordinator_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['network_id'], ['franchise_networks.id'], ),
    sa.ForeignKeyConstraint(['regional_manager_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_franchise_regions_id', 'franchise_regions', ['id'], unique=False)
    op.create_index('ix_franchise_regions_code', 'franchise_regions', ['code'], unique=False)
    op.create_index('idx_franchise_region_network_status', 'franchise_regions', ['network_id', 'status'], unique=False)
    op.create_index('idx_franchise_region_code', 'franchise_regions', ['code'], unique=False)
    op.create_table('chair_assignment_history',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('chair_id', sa.INTEGER(), nullable=False),
    sa.Column('barber_id', sa.INTEGER(), nullable=False),
    sa.Column('location_id', sa.INTEGER(), nullable=False),
    sa.Column('start_date', sa.DATETIME(), nullable=False),
    sa.Column('end_date', sa.DATETIME(), nullable=True),
    sa.Column('total_revenue', sa.FLOAT(), nullable=True),
    sa.Column('total_appointments', sa.INTEGER(), nullable=True),
    sa.Column('avg_ticket', sa.FLOAT(), nullable=True),
    sa.Column('rental_rate', sa.FLOAT(), nullable=True),
    sa.Column('total_rent_collected', sa.FLOAT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.Column('notes', sa.VARCHAR(length=500), nullable=True),
    sa.ForeignKeyConstraint(['barber_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['chair_id'], ['chair_inventory.id'], ),
    sa.ForeignKeyConstraint(['location_id'], ['barbershop_locations.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_chair_assignment_history_id', 'chair_assignment_history', ['id'], unique=False)
    op.create_table('six_fb_client_communications',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('client_id', sa.INTEGER(), nullable=False),
    sa.Column('communication_type', sa.VARCHAR(length=17), nullable=False),
    sa.Column('communication_status', sa.VARCHAR(length=9), nullable=True),
    sa.Column('subject', sa.VARCHAR(), nullable=True),
    sa.Column('message_content', sa.TEXT(), nullable=True),
    sa.Column('sent_at', sa.DATETIME(), nullable=False),
    sa.Column('delivered_at', sa.DATETIME(), nullable=True),
    sa.Column('opened_at', sa.DATETIME(), nullable=True),
    sa.Column('clicked_at', sa.DATETIME(), nullable=True),
    sa.Column('responded_at', sa.DATETIME(), nullable=True),
    sa.Column('campaign_id', sa.VARCHAR(), nullable=True),
    sa.Column('touchpoint_type', sa.VARCHAR(length=18), nullable=True),
    sa.Column('automation_triggered', sa.BOOLEAN(), nullable=True),
    sa.Column('automation_workflow_id', sa.VARCHAR(), nullable=True),
    sa.Column('relationship_building_intent', sa.VARCHAR(), nullable=True),
    sa.Column('value_creation_focus', sa.VARCHAR(), nullable=True),
    sa.Column('premium_positioning_elements', sqlite.JSON(), nullable=True),
    sa.Column('engagement_score', sa.FLOAT(), nullable=True),
    sa.Column('sentiment_score', sa.FLOAT(), nullable=True),
    sa.Column('response_content', sa.TEXT(), nullable=True),
    sa.Column('response_sentiment', sa.FLOAT(), nullable=True),
    sa.Column('conversion_generated', sa.BOOLEAN(), nullable=True),
    sa.Column('conversion_value', sa.NUMERIC(precision=8, scale=2), nullable=True),
    sa.Column('appointment_booked', sa.BOOLEAN(), nullable=True),
    sa.Column('referral_generated', sa.BOOLEAN(), nullable=True),
    sa.Column('message_id', sa.VARCHAR(), nullable=True),
    sa.Column('delivery_metadata', sqlite.JSON(), nullable=True),
    sa.Column('error_details', sqlite.JSON(), nullable=True),
    sa.Column('personalization_data', sqlite.JSON(), nullable=True),
    sa.Column('dynamic_content_used', sqlite.JSON(), nullable=True),
    sa.Column('a_b_test_variant', sa.VARCHAR(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['client_id'], ['clients.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_six_fb_client_communications_user_id', 'six_fb_client_communications', ['user_id'], unique=False)
    op.create_index('ix_six_fb_client_communications_id', 'six_fb_client_communications', ['id'], unique=False)
    op.create_index('ix_six_fb_client_communications_client_id', 'six_fb_client_communications', ['client_id'], unique=False)
    op.create_index('idx_comm_user_client_date', 'six_fb_client_communications', ['user_id', 'client_id', 'sent_at'], unique=False)
    op.create_index('idx_comm_type_status', 'six_fb_client_communications', ['communication_type', 'communication_status'], unique=False)
    op.create_index('idx_comm_touchpoint', 'six_fb_client_communications', ['touchpoint_type'], unique=False)
    op.create_index('idx_comm_campaign', 'six_fb_client_communications', ['campaign_id'], unique=False)
    op.create_table('agent_subscriptions',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('tier', sa.VARCHAR(length=12), nullable=True),
    sa.Column('status', sa.VARCHAR(length=20), nullable=True),
    sa.Column('monthly_price', sa.FLOAT(), nullable=True),
    sa.Column('stripe_subscription_id', sa.VARCHAR(length=100), nullable=True),
    sa.Column('stripe_customer_id', sa.VARCHAR(length=100), nullable=True),
    sa.Column('conversation_limit', sa.INTEGER(), nullable=True),
    sa.Column('agent_limit', sa.INTEGER(), nullable=True),
    sa.Column('included_tokens', sa.INTEGER(), nullable=True),
    sa.Column('conversations_used', sa.INTEGER(), nullable=True),
    sa.Column('tokens_used', sa.INTEGER(), nullable=True),
    sa.Column('overage_tokens', sa.INTEGER(), nullable=True),
    sa.Column('overage_charges', sa.FLOAT(), nullable=True),
    sa.Column('trial_ends_at', sa.DATETIME(), nullable=True),
    sa.Column('current_period_start', sa.DATETIME(), nullable=True),
    sa.Column('current_period_end', sa.DATETIME(), nullable=True),
    sa.Column('cancelled_at', sa.DATETIME(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('user_id')
    )
    op.create_index('ix_agent_subscriptions_tier', 'agent_subscriptions', ['tier'], unique=False)
    op.create_index('ix_agent_subscriptions_status', 'agent_subscriptions', ['status'], unique=False)
    op.create_index('ix_agent_subscriptions_id', 'agent_subscriptions', ['id'], unique=False)
    op.create_index('idx_subscription_status_tier', 'agent_subscriptions', ['status', 'tier'], unique=False)
    op.create_table('leaderboards',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(), nullable=False),
    sa.Column('title', sa.VARCHAR(), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('leaderboard_type', sa.VARCHAR(length=19), nullable=False),
    sa.Column('scope', sa.VARCHAR(), nullable=True),
    sa.Column('filter_criteria', sqlite.JSON(), nullable=True),
    sa.Column('minimum_activity_threshold', sqlite.JSON(), nullable=True),
    sa.Column('ranking_metric', sa.VARCHAR(), nullable=False),
    sa.Column('ranking_direction', sa.VARCHAR(), nullable=True),
    sa.Column('ranking_period', sa.VARCHAR(), nullable=True),
    sa.Column('max_displayed_positions', sa.INTEGER(), nullable=True),
    sa.Column('update_frequency_minutes', sa.INTEGER(), nullable=True),
    sa.Column('last_updated', sa.DATETIME(), nullable=True),
    sa.Column('next_update_at', sa.DATETIME(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('is_public', sa.BOOLEAN(), nullable=True),
    sa.Column('access_level', sa.VARCHAR(), nullable=True),
    sa.Column('sfb_principle', sa.VARCHAR(), nullable=True),
    sa.Column('coaching_insight', sa.TEXT(), nullable=True),
    sa.Column('motivation_message', sa.TEXT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('name')
    )
    op.create_index('ix_leaderboards_leaderboard_type', 'leaderboards', ['leaderboard_type'], unique=False)
    op.create_index('ix_leaderboards_id', 'leaderboards', ['id'], unique=False)
    op.create_index('idx_leaderboard_update', 'leaderboards', ['next_update_at'], unique=False)
    op.create_index('idx_leaderboard_type_active', 'leaderboards', ['leaderboard_type', 'is_active'], unique=False)
    op.create_table('email_previews',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('template_name', sa.VARCHAR(length=100), nullable=False),
    sa.Column('template_version', sa.VARCHAR(length=50), nullable=True),
    sa.Column('client_name', sa.VARCHAR(length=100), nullable=False),
    sa.Column('device_type', sa.VARCHAR(length=50), nullable=False),
    sa.Column('viewport_width', sa.INTEGER(), nullable=True),
    sa.Column('viewport_height', sa.INTEGER(), nullable=True),
    sa.Column('preview_image_url', sa.VARCHAR(length=500), nullable=True),
    sa.Column('preview_html', sa.TEXT(), nullable=True),
    sa.Column('rendering_time_ms', sa.INTEGER(), nullable=True),
    sa.Column('rendering_issues', sqlite.JSON(), nullable=True),
    sa.Column('accessibility_score', sa.FLOAT(), nullable=True),
    sa.Column('mobile_friendly', sa.BOOLEAN(), nullable=True),
    sa.Column('status', sa.VARCHAR(length=20), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('expires_at', sa.DATETIME(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_email_previews_template_name', 'email_previews', ['template_name'], unique=False)
    op.create_index('ix_email_previews_id', 'email_previews', ['id'], unique=False)
    op.create_table('compensation_plans',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(length=255), nullable=False),
    sa.Column('description', sa.VARCHAR(length=500), nullable=True),
    sa.Column('location_id', sa.INTEGER(), nullable=False),
    sa.Column('barber_id', sa.INTEGER(), nullable=True),
    sa.Column('model_type', sa.VARCHAR(length=12), nullable=False),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('is_default', sa.BOOLEAN(), nullable=True),
    sa.Column('effective_from', sa.DATETIME(), nullable=False),
    sa.Column('effective_to', sa.DATETIME(), nullable=True),
    sa.Column('configuration', sqlite.JSON(), nullable=False),
    sa.Column('incentives', sqlite.JSON(), nullable=True),
    sa.Column('deductions', sqlite.JSON(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.Column('updated_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.Column('created_by', sa.INTEGER(), nullable=True),
    sa.ForeignKeyConstraint(['barber_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ),
    sa.ForeignKeyConstraint(['location_id'], ['barbershop_locations.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_compensation_plans_id', 'compensation_plans', ['id'], unique=False)
    op.create_table('barber_availability',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('barber_id', sa.INTEGER(), nullable=False),
    sa.Column('day_of_week', sa.INTEGER(), nullable=False),
    sa.Column('start_time', sa.TIME(), nullable=False),
    sa.Column('end_time', sa.TIME(), nullable=False),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('is_test_data', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['barber_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_barber_availability_id', 'barber_availability', ['id'], unique=False)
    op.create_index('ix_barber_availability_day_of_week', 'barber_availability', ['day_of_week'], unique=False)
    op.create_index('idx_barber_availability_day_active', 'barber_availability', ['day_of_week', 'is_active'], unique=False)
    op.create_index('idx_barber_availability_barber_day', 'barber_availability', ['barber_id', 'day_of_week'], unique=False)
    op.create_index('idx_barber_availability_barber_active', 'barber_availability', ['barber_id', 'is_active'], unique=False)
    op.create_table('google_calendar_webhook_notifications',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('subscription_id', sa.INTEGER(), nullable=False),
    sa.Column('google_channel_id', sa.VARCHAR(length=255), nullable=False),
    sa.Column('google_resource_id', sa.VARCHAR(length=255), nullable=False),
    sa.Column('google_resource_uri', sa.VARCHAR(length=500), nullable=True),
    sa.Column('google_resource_state', sa.VARCHAR(length=50), nullable=True),
    sa.Column('message_number', sa.BIGINT(), nullable=True),
    sa.Column('expiration_time', sa.DATETIME(), nullable=True),
    sa.Column('received_at', sa.DATETIME(), nullable=False),
    sa.Column('processed_at', sa.DATETIME(), nullable=True),
    sa.Column('status', sa.VARCHAR(length=20), nullable=False),
    sa.Column('sync_triggered', sa.BOOLEAN(), nullable=True),
    sa.Column('events_processed', sa.INTEGER(), nullable=True),
    sa.Column('events_created', sa.INTEGER(), nullable=True),
    sa.Column('events_updated', sa.INTEGER(), nullable=True),
    sa.Column('events_deleted', sa.INTEGER(), nullable=True),
    sa.Column('error_message', sa.TEXT(), nullable=True),
    sa.Column('retry_count', sa.INTEGER(), nullable=True),
    sa.Column('raw_headers', sa.TEXT(), nullable=True),
    sa.Column('raw_body', sa.TEXT(), nullable=True),
    sa.ForeignKeyConstraint(['subscription_id'], ['google_calendar_webhook_subscriptions.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_google_calendar_webhook_notifications_subscription_id', 'google_calendar_webhook_notifications', ['subscription_id'], unique=False)
    op.create_index('ix_google_calendar_webhook_notifications_status', 'google_calendar_webhook_notifications', ['status'], unique=False)
    op.create_index('ix_google_calendar_webhook_notifications_received_at', 'google_calendar_webhook_notifications', ['received_at'], unique=False)
    op.create_index('ix_google_calendar_webhook_notifications_message_number', 'google_calendar_webhook_notifications', ['message_number'], unique=False)
    op.create_index('ix_google_calendar_webhook_notifications_id', 'google_calendar_webhook_notifications', ['id'], unique=False)
    op.create_index('ix_google_calendar_webhook_notifications_google_resource_id', 'google_calendar_webhook_notifications', ['google_resource_id'], unique=False)
    op.create_index('ix_google_calendar_webhook_notifications_google_channel_id', 'google_calendar_webhook_notifications', ['google_channel_id'], unique=False)
    op.create_table('business_coaching_sessions',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('agent_id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('session_type', sa.VARCHAR(length=25), nullable=False),
    sa.Column('title', sa.VARCHAR(length=200), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('business_context', sqlite.JSON(), nullable=True),
    sa.Column('coaching_goals', sqlite.JSON(), nullable=True),
    sa.Column('recommended_actions', sqlite.JSON(), nullable=True),
    sa.Column('conversation_history', sqlite.JSON(), nullable=True),
    sa.Column('key_insights_discussed', sqlite.JSON(), nullable=True),
    sa.Column('user_questions', sqlite.JSON(), nullable=True),
    sa.Column('initial_metrics', sqlite.JSON(), nullable=True),
    sa.Column('target_metrics', sqlite.JSON(), nullable=True),
    sa.Column('current_metrics', sqlite.JSON(), nullable=True),
    sa.Column('status', sa.VARCHAR(length=18), nullable=True),
    sa.Column('completion_percentage', sa.FLOAT(), nullable=True),
    sa.Column('user_satisfaction_score', sa.FLOAT(), nullable=True),
    sa.Column('follow_up_required', sa.BOOLEAN(), nullable=True),
    sa.Column('next_session_date', sa.DATETIME(), nullable=True),
    sa.Column('started_at', sa.DATETIME(), nullable=True),
    sa.Column('completed_at', sa.DATETIME(), nullable=True),
    sa.Column('last_interaction_at', sa.DATETIME(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['agent_id'], ['business_intelligence_agents.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_business_coaching_sessions_user_id', 'business_coaching_sessions', ['user_id'], unique=False)
    op.create_index('ix_business_coaching_sessions_status', 'business_coaching_sessions', ['status'], unique=False)
    op.create_index('ix_business_coaching_sessions_session_type', 'business_coaching_sessions', ['session_type'], unique=False)
    op.create_index('ix_business_coaching_sessions_id', 'business_coaching_sessions', ['id'], unique=False)
    op.create_index('ix_business_coaching_sessions_agent_id', 'business_coaching_sessions', ['agent_id'], unique=False)
    op.create_table('recurring_appointment_series',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('pattern_id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('series_name', sa.VARCHAR(), nullable=True),
    sa.Column('series_description', sa.TEXT(), nullable=True),
    sa.Column('payment_type', sa.VARCHAR(), nullable=True),
    sa.Column('total_series_price', sa.FLOAT(), nullable=True),
    sa.Column('paid_amount', sa.FLOAT(), nullable=True),
    sa.Column('payment_status', sa.VARCHAR(), nullable=True),
    sa.Column('total_planned', sa.INTEGER(), nullable=True),
    sa.Column('total_completed', sa.INTEGER(), nullable=True),
    sa.Column('total_cancelled', sa.INTEGER(), nullable=True),
    sa.Column('total_rescheduled', sa.INTEGER(), nullable=True),
    sa.Column('series_status', sa.VARCHAR(), nullable=True),
    sa.Column('completion_percentage', sa.FLOAT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.Column('completed_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['pattern_id'], ['recurring_appointment_patterns.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_recurring_appointment_series_id', 'recurring_appointment_series', ['id'], unique=False)
    op.create_table('guest_booking_notifications',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('guest_booking_id', sa.INTEGER(), nullable=False),
    sa.Column('notification_type', sa.VARCHAR(), nullable=False),
    sa.Column('channel', sa.VARCHAR(), nullable=False),
    sa.Column('sent_at', sa.DATETIME(), nullable=True),
    sa.Column('delivered_at', sa.DATETIME(), nullable=True),
    sa.Column('failed_at', sa.DATETIME(), nullable=True),
    sa.Column('error_message', sa.TEXT(), nullable=True),
    sa.Column('subject', sa.VARCHAR(), nullable=True),
    sa.Column('content', sa.TEXT(), nullable=False),
    sa.Column('opened_at', sa.DATETIME(), nullable=True),
    sa.Column('clicked_at', sa.DATETIME(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['guest_booking_id'], ['guest_bookings.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_guest_booking_notifications_id', 'guest_booking_notifications', ['id'], unique=False)
    op.create_index('idx_guest_booking_type', 'guest_booking_notifications', ['guest_booking_id', 'notification_type'], unique=False)
    op.create_table('payments',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=True),
    sa.Column('appointment_id', sa.INTEGER(), nullable=True),
    sa.Column('barber_id', sa.INTEGER(), nullable=True),
    sa.Column('organization_id', sa.INTEGER(), nullable=True),
    sa.Column('amount', sa.FLOAT(), nullable=True),
    sa.Column('status', sa.VARCHAR(), nullable=True),
    sa.Column('stripe_payment_id', sa.VARCHAR(), nullable=True),
    sa.Column('stripe_payment_intent_id', sa.VARCHAR(), nullable=True),
    sa.Column('platform_fee', sa.FLOAT(), nullable=True),
    sa.Column('barber_amount', sa.FLOAT(), nullable=True),
    sa.Column('commission_rate', sa.FLOAT(), nullable=True),
    sa.Column('refund_amount', sa.FLOAT(), nullable=True),
    sa.Column('refund_reason', sa.VARCHAR(), nullable=True),
    sa.Column('refunded_at', sa.DATETIME(), nullable=True),
    sa.Column('stripe_refund_id', sa.VARCHAR(), nullable=True),
    sa.Column('gift_certificate_id', sa.INTEGER(), nullable=True),
    sa.Column('gift_certificate_amount_used', sa.FLOAT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['appointment_id'], ['appointments.id'], ),
    sa.ForeignKeyConstraint(['barber_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['gift_certificate_id'], ['gift_certificates.id'], ),
    sa.ForeignKeyConstraint(['organization_id'], ['organizations.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_payments_id', 'payments', ['id'], unique=False)
    op.create_index('idx_payments_user_status', 'payments', ['user_id', 'status'], unique=False)
    op.create_index('idx_payments_stripe_intent', 'payments', ['stripe_payment_intent_id'], unique=False)
    op.create_index('idx_payments_status_created', 'payments', ['status', 'created_at'], unique=False)
    op.create_index('idx_payments_status_amount', 'payments', ['status', 'amount'], unique=False)
    op.create_index('idx_payments_org_created', 'payments', ['organization_id', 'created_at'], unique=False)
    op.create_index('idx_payments_barber_status', 'payments', ['barber_id', 'status'], unique=False)
    op.create_index('idx_payments_barber_created', 'payments', ['barber_id', 'created_at', 'status'], unique=False)
    op.create_index('idx_payments_appointment_status', 'payments', ['appointment_id', 'status'], unique=False)
    op.create_index('idx_payments_appointment_id', 'payments', ['appointment_id'], unique=False)
    op.create_table('weekly_recommendations',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('weekly_insight_id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('category', sa.VARCHAR(length=24), nullable=False),
    sa.Column('priority', sa.VARCHAR(length=8), nullable=False),
    sa.Column('title', sa.VARCHAR(length=255), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=False),
    sa.Column('expected_impact', sa.VARCHAR(length=255), nullable=True),
    sa.Column('estimated_effort', sa.VARCHAR(length=100), nullable=True),
    sa.Column('confidence_score', sa.FLOAT(), nullable=True),
    sa.Column('six_fb_principle', sa.VARCHAR(length=100), nullable=True),
    sa.Column('methodology_alignment_score', sa.FLOAT(), nullable=True),
    sa.Column('action_items', sqlite.JSON(), nullable=True),
    sa.Column('success_metrics', sqlite.JSON(), nullable=True),
    sa.Column('status', sa.VARCHAR(length=12), nullable=False),
    sa.Column('user_feedback_rating', sa.INTEGER(), nullable=True),
    sa.Column('user_feedback_text', sa.TEXT(), nullable=True),
    sa.Column('implementation_notes', sa.TEXT(), nullable=True),
    sa.Column('implemented_date', sa.DATETIME(), nullable=True),
    sa.Column('measured_impact', sa.VARCHAR(length=255), nullable=True),
    sa.Column('roi_estimated', sa.FLOAT(), nullable=True),
    sa.Column('roi_actual', sa.FLOAT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=False),
    sa.Column('updated_at', sa.DATETIME(), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['weekly_insight_id'], ['weekly_insights.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_weekly_recommendations_weekly_insight_id', 'weekly_recommendations', ['weekly_insight_id'], unique=False)
    op.create_index('ix_weekly_recommendations_user_id', 'weekly_recommendations', ['user_id'], unique=False)
    op.create_index('ix_weekly_recommendations_priority', 'weekly_recommendations', ['priority'], unique=False)
    op.create_index('ix_weekly_recommendations_id', 'weekly_recommendations', ['id'], unique=False)
    op.create_index('ix_weekly_recommendations_category', 'weekly_recommendations', ['category'], unique=False)
    op.create_table('six_fb_growth_metrics',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('date', sa.DATE(), nullable=False),
    sa.Column('metric_type', sa.VARCHAR(length=22), nullable=False),
    sa.Column('current_value', sa.FLOAT(), nullable=False),
    sa.Column('baseline_value', sa.FLOAT(), nullable=True),
    sa.Column('target_value', sa.FLOAT(), nullable=True),
    sa.Column('growth_rate', sa.FLOAT(), nullable=True),
    sa.Column('progress_percentage', sa.FLOAT(), nullable=True),
    sa.Column('time_to_target_days', sa.INTEGER(), nullable=True),
    sa.Column('milestone_achievements', sqlite.JSON(), nullable=True),
    sa.Column('methodology_principle', sa.VARCHAR(length=27), nullable=False),
    sa.Column('coaching_focus_area', sa.VARCHAR(), nullable=True),
    sa.Column('development_stage', sa.VARCHAR(), nullable=True),
    sa.Column('revenue_impact', sa.NUMERIC(precision=10, scale=2), nullable=True),
    sa.Column('client_satisfaction_impact', sa.FLOAT(), nullable=True),
    sa.Column('brand_positioning_impact', sa.FLOAT(), nullable=True),
    sa.Column('market_competitiveness_impact', sa.FLOAT(), nullable=True),
    sa.Column('training_completed', sqlite.JSON(), nullable=True),
    sa.Column('certifications_earned', sqlite.JSON(), nullable=True),
    sa.Column('skills_developed', sqlite.JSON(), nullable=True),
    sa.Column('experience_gained', sqlite.JSON(), nullable=True),
    sa.Column('peer_recognition', sqlite.JSON(), nullable=True),
    sa.Column('client_testimonials', sqlite.JSON(), nullable=True),
    sa.Column('industry_recognition', sqlite.JSON(), nullable=True),
    sa.Column('portfolio_updates', sqlite.JSON(), nullable=True),
    sa.Column('development_plan', sqlite.JSON(), nullable=True),
    sa.Column('investment_required', sa.NUMERIC(precision=8, scale=2), nullable=True),
    sa.Column('expected_roi', sa.FLOAT(), nullable=True),
    sa.Column('timeline_milestones', sqlite.JSON(), nullable=True),
    sa.Column('assessment_method', sa.VARCHAR(), nullable=True),
    sa.Column('data_sources', sqlite.JSON(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_six_fb_growth_metrics_user_id', 'six_fb_growth_metrics', ['user_id'], unique=False)
    op.create_index('ix_six_fb_growth_metrics_metric_type', 'six_fb_growth_metrics', ['metric_type'], unique=False)
    op.create_index('ix_six_fb_growth_metrics_id', 'six_fb_growth_metrics', ['id'], unique=False)
    op.create_index('ix_six_fb_growth_metrics_date', 'six_fb_growth_metrics', ['date'], unique=False)
    op.create_index('idx_growth_user_date_type', 'six_fb_growth_metrics', ['user_id', 'date', 'metric_type'], unique=False)
    op.create_index('idx_growth_progress', 'six_fb_growth_metrics', ['progress_percentage'], unique=False)
    op.create_table('barbershop_locations',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(length=255), nullable=False),
    sa.Column('code', sa.VARCHAR(length=50), nullable=False),
    sa.Column('address', sa.VARCHAR(length=500), nullable=False),
    sa.Column('city', sa.VARCHAR(length=100), nullable=False),
    sa.Column('state', sa.VARCHAR(length=50), nullable=False),
    sa.Column('zip_code', sa.VARCHAR(length=20), nullable=False),
    sa.Column('phone', sa.VARCHAR(length=20), nullable=True),
    sa.Column('email', sa.VARCHAR(length=255), nullable=True),
    sa.Column('status', sa.VARCHAR(length=11), nullable=False),
    sa.Column('compensation_model', sa.VARCHAR(length=12), nullable=False),
    sa.Column('total_chairs', sa.INTEGER(), nullable=False),
    sa.Column('active_chairs', sa.INTEGER(), nullable=False),
    sa.Column('compensation_config', sqlite.JSON(), nullable=True),
    sa.Column('manager_id', sa.INTEGER(), nullable=True),
    sa.Column('owner_id', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.Column('updated_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.Column('business_hours', sqlite.JSON(), nullable=True),
    sa.Column('timezone', sa.VARCHAR(length=50), nullable=True),
    sa.Column('currency', sa.VARCHAR(length=10), nullable=True),
    sa.ForeignKeyConstraint(['manager_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['owner_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('code')
    )
    op.create_index('ix_barbershop_locations_name', 'barbershop_locations', ['name'], unique=False)
    op.create_index('ix_barbershop_locations_id', 'barbershop_locations', ['id'], unique=False)
    op.create_table('user_organizations',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('organization_id', sa.INTEGER(), nullable=False),
    sa.Column('role', sa.VARCHAR(length=20), nullable=False),
    sa.Column('permissions', sqlite.JSON(), nullable=True),
    sa.Column('is_primary', sa.BOOLEAN(), nullable=True),
    sa.Column('can_manage_billing', sa.BOOLEAN(), nullable=True),
    sa.Column('can_manage_staff', sa.BOOLEAN(), nullable=True),
    sa.Column('can_view_analytics', sa.BOOLEAN(), nullable=True),
    sa.Column('joined_at', sa.DATETIME(), nullable=False),
    sa.Column('created_at', sa.DATETIME(), nullable=False),
    sa.Column('last_accessed_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['organization_id'], ['organizations.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_user_organizations_id', 'user_organizations', ['id'], unique=False)
    op.create_index('idx_user_org_user_id', 'user_organizations', ['user_id'], unique=False)
    op.create_index('idx_user_org_role', 'user_organizations', ['role'], unique=False)
    op.create_index('idx_user_org_primary', 'user_organizations', ['user_id', 'is_primary'], unique=False)
    op.create_index('idx_user_org_organization_id', 'user_organizations', ['organization_id'], unique=False)
    op.create_table('webhook_endpoints',
    sa.Column('id', sa.VARCHAR(), nullable=False),
    sa.Column('url', sa.VARCHAR(), nullable=False),
    sa.Column('name', sa.VARCHAR(), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('events', sqlite.JSON(), nullable=False),
    sa.Column('auth_type', sa.VARCHAR(length=7), nullable=True),
    sa.Column('auth_config', sqlite.JSON(), nullable=True),
    sa.Column('headers', sqlite.JSON(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('secret', sa.VARCHAR(), nullable=True),
    sa.Column('max_retries', sa.INTEGER(), nullable=True),
    sa.Column('retry_delay_seconds', sa.INTEGER(), nullable=True),
    sa.Column('timeout_seconds', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.Column('created_by', sa.VARCHAR(), nullable=True),
    sa.Column('total_deliveries', sa.INTEGER(), nullable=True),
    sa.Column('successful_deliveries', sa.INTEGER(), nullable=True),
    sa.Column('failed_deliveries', sa.INTEGER(), nullable=True),
    sa.Column('last_triggered_at', sa.DATETIME(), nullable=True),
    sa.Column('last_success_at', sa.DATETIME(), nullable=True),
    sa.Column('last_failure_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_webhook_events', 'webhook_endpoints', ['events'], unique=False)
    op.create_index('idx_webhook_active', 'webhook_endpoints', ['is_active'], unique=False)
    op.create_table('six_fb_professional_development_plans',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('plan_name', sa.VARCHAR(), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('methodology_focus', sa.VARCHAR(length=27), nullable=False),
    sa.Column('start_date', sa.DATE(), nullable=False),
    sa.Column('target_completion_date', sa.DATE(), nullable=False),
    sa.Column('actual_completion_date', sa.DATE(), nullable=True),
    sa.Column('duration_weeks', sa.INTEGER(), nullable=False),
    sa.Column('primary_goals', sqlite.JSON(), nullable=False),
    sa.Column('success_criteria', sqlite.JSON(), nullable=False),
    sa.Column('key_performance_indicators', sqlite.JSON(), nullable=True),
    sa.Column('skill_development_areas', sqlite.JSON(), nullable=True),
    sa.Column('business_development_areas', sqlite.JSON(), nullable=True),
    sa.Column('personal_development_areas', sqlite.JSON(), nullable=True),
    sa.Column('development_activities', sqlite.JSON(), nullable=False),
    sa.Column('training_requirements', sqlite.JSON(), nullable=True),
    sa.Column('resource_requirements', sqlite.JSON(), nullable=True),
    sa.Column('investment_budget', sa.NUMERIC(precision=8, scale=2), nullable=True),
    sa.Column('completion_percentage', sa.FLOAT(), nullable=True),
    sa.Column('milestones_achieved', sqlite.JSON(), nullable=True),
    sa.Column('current_phase', sa.VARCHAR(), nullable=True),
    sa.Column('next_milestone', sqlite.JSON(), nullable=True),
    sa.Column('achievements', sqlite.JSON(), nullable=True),
    sa.Column('skills_acquired', sqlite.JSON(), nullable=True),
    sa.Column('business_impact', sqlite.JSON(), nullable=True),
    sa.Column('roi_calculation', sqlite.JSON(), nullable=True),
    sa.Column('coaching_integration', sqlite.JSON(), nullable=True),
    sa.Column('methodology_application', sqlite.JSON(), nullable=True),
    sa.Column('community_engagement', sqlite.JSON(), nullable=True),
    sa.Column('review_schedule', sqlite.JSON(), nullable=True),
    sa.Column('adjustment_history', sqlite.JSON(), nullable=True),
    sa.Column('lessons_learned', sqlite.JSON(), nullable=True),
    sa.Column('status', sa.VARCHAR(), nullable=True),
    sa.Column('priority_level', sa.VARCHAR(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_six_fb_professional_development_plans_user_id', 'six_fb_professional_development_plans', ['user_id'], unique=False)
    op.create_index('ix_six_fb_professional_development_plans_id', 'six_fb_professional_development_plans', ['id'], unique=False)
    op.create_table('services',
    sa.Column('id', sa.INTEGER(), nullable=True),
    sa.Column('name', sa.VARCHAR(), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('category', sa.VARCHAR(), nullable=False),
    sa.Column('sku', sa.VARCHAR(), nullable=True),
    sa.Column('base_price', sa.FLOAT(), nullable=False),
    sa.Column('min_price', sa.FLOAT(), nullable=True),
    sa.Column('max_price', sa.FLOAT(), nullable=True),
    sa.Column('duration_minutes', sa.INTEGER(), server_default=sa.text('(30)'), nullable=False),
    sa.Column('buffer_time_minutes', sa.INTEGER(), server_default=sa.text('0'), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), server_default=sa.text('1'), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('sku')
    )
    op.create_table('barber_time_off',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('barber_id', sa.INTEGER(), nullable=False),
    sa.Column('start_date', sa.DATE(), nullable=False),
    sa.Column('end_date', sa.DATE(), nullable=False),
    sa.Column('start_time', sa.TIME(), nullable=True),
    sa.Column('end_time', sa.TIME(), nullable=True),
    sa.Column('reason', sa.VARCHAR(), nullable=True),
    sa.Column('notes', sa.TEXT(), nullable=True),
    sa.Column('status', sa.VARCHAR(), nullable=True),
    sa.Column('approved_by_id', sa.INTEGER(), nullable=True),
    sa.Column('is_test_data', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['approved_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['barber_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_barber_time_off_start_date', 'barber_time_off', ['start_date'], unique=False)
    op.create_index('ix_barber_time_off_id', 'barber_time_off', ['id'], unique=False)
    op.create_index('ix_barber_time_off_end_date', 'barber_time_off', ['end_date'], unique=False)
    op.create_table('conversion_events',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('organization_id', sa.INTEGER(), nullable=True),
    sa.Column('event_id', sa.VARCHAR(length=255), nullable=True),
    sa.Column('event_name', sa.VARCHAR(length=100), nullable=False),
    sa.Column('event_type', sa.VARCHAR(length=12), nullable=False),
    sa.Column('event_value', sa.FLOAT(), nullable=True),
    sa.Column('event_currency', sa.VARCHAR(length=3), nullable=True),
    sa.Column('event_data', sqlite.JSON(), nullable=True),
    sa.Column('source_url', sa.TEXT(), nullable=True),
    sa.Column('user_agent', sa.TEXT(), nullable=True),
    sa.Column('ip_address', sa.VARCHAR(length=64), nullable=True),
    sa.Column('client_id', sa.VARCHAR(length=255), nullable=True),
    sa.Column('session_id', sa.VARCHAR(length=255), nullable=True),
    sa.Column('channel', sa.VARCHAR(length=50), nullable=True),
    sa.Column('utm_source', sa.VARCHAR(length=255), nullable=True),
    sa.Column('utm_medium', sa.VARCHAR(length=255), nullable=True),
    sa.Column('utm_campaign', sa.VARCHAR(length=255), nullable=True),
    sa.Column('utm_term', sa.VARCHAR(length=255), nullable=True),
    sa.Column('utm_content', sa.VARCHAR(length=255), nullable=True),
    sa.Column('referrer', sa.TEXT(), nullable=True),
    sa.Column('gtm_synced', sa.BOOLEAN(), nullable=True),
    sa.Column('gtm_sync_time', sa.DATETIME(), nullable=True),
    sa.Column('meta_synced', sa.BOOLEAN(), nullable=True),
    sa.Column('meta_sync_time', sa.DATETIME(), nullable=True),
    sa.Column('google_ads_synced', sa.BOOLEAN(), nullable=True),
    sa.Column('google_ads_sync_time', sa.DATETIME(), nullable=True),
    sa.Column('status', sa.VARCHAR(length=9), nullable=True),
    sa.Column('error_message', sa.TEXT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['organization_id'], ['organizations.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_conversion_events_user_id', 'conversion_events', ['user_id'], unique=False)
    op.create_index('ix_conversion_events_session_id', 'conversion_events', ['session_id'], unique=False)
    op.create_index('ix_conversion_events_organization_id', 'conversion_events', ['organization_id'], unique=False)
    op.create_index('ix_conversion_events_id', 'conversion_events', ['id'], unique=False)
    op.create_index('ix_conversion_events_event_type', 'conversion_events', ['event_type'], unique=False)
    op.create_index('ix_conversion_events_event_name', 'conversion_events', ['event_name'], unique=False)
    op.create_index('ix_conversion_events_event_id', 'conversion_events', ['event_id'], unique=1)
    op.create_index('ix_conversion_events_client_id', 'conversion_events', ['client_id'], unique=False)
    op.create_index('ix_conversion_events_channel', 'conversion_events', ['channel'], unique=False)
    op.create_index('idx_conversion_events_user_date', 'conversion_events', ['user_id', 'created_at'], unique=False)
    op.create_index('idx_conversion_events_type_date', 'conversion_events', ['event_type', 'created_at'], unique=False)
    op.create_index('idx_conversion_events_channel_date', 'conversion_events', ['channel', 'created_at'], unique=False)
    op.create_index('idx_conversion_events_campaign', 'conversion_events', ['utm_campaign', 'created_at'], unique=False)
    op.create_table('user_service_templates',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('service_template_id', sa.INTEGER(), nullable=False),
    sa.Column('service_id', sa.INTEGER(), nullable=True),
    sa.Column('applied_price', sa.FLOAT(), nullable=True),
    sa.Column('customizations', sqlite.JSON(), nullable=True),
    sa.Column('revenue_generated', sa.FLOAT(), nullable=True),
    sa.Column('bookings_count', sa.INTEGER(), nullable=True),
    sa.Column('client_satisfaction_avg', sa.FLOAT(), nullable=True),
    sa.Column('applied_at', sa.DATETIME(), nullable=True),
    sa.Column('last_used_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['service_id'], ['services.id'], ),
    sa.ForeignKeyConstraint(['service_template_id'], ['service_templates.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_user_service_templates_id', 'user_service_templates', ['id'], unique=False)
    op.create_table('recurring_appointment_exceptions',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('pattern_id', sa.INTEGER(), nullable=False),
    sa.Column('exception_date', sa.DATE(), nullable=False),
    sa.Column('exception_type', sa.VARCHAR(), nullable=False),
    sa.Column('new_date', sa.DATE(), nullable=True),
    sa.Column('new_time', sa.TIME(), nullable=True),
    sa.Column('new_duration', sa.INTEGER(), nullable=True),
    sa.Column('new_barber_id', sa.INTEGER(), nullable=True),
    sa.Column('new_service_id', sa.INTEGER(), nullable=True),
    sa.Column('reason', sa.VARCHAR(), nullable=True),
    sa.Column('notes', sa.TEXT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('created_by_id', sa.INTEGER(), nullable=True),
    sa.ForeignKeyConstraint(['created_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['new_barber_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['new_service_id'], ['services.id'], ),
    sa.ForeignKeyConstraint(['pattern_id'], ['recurring_appointment_patterns.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_recurring_appointment_exceptions_id', 'recurring_appointment_exceptions', ['id'], unique=False)
    op.create_index('ix_recurring_appointment_exceptions_exception_date', 'recurring_appointment_exceptions', ['exception_date'], unique=False)
    op.create_index('idx_pattern_exception_date', 'recurring_appointment_exceptions', ['pattern_id', 'exception_date'], unique=1)
    op.create_table('subscription_billing_events',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('subscription_id', sa.INTEGER(), nullable=False),
    sa.Column('event_type', sa.VARCHAR(), nullable=False),
    sa.Column('amount', sa.FLOAT(), nullable=True),
    sa.Column('currency', sa.VARCHAR(length=3), nullable=True),
    sa.Column('stripe_invoice_id', sa.VARCHAR(), nullable=True),
    sa.Column('stripe_payment_intent_id', sa.VARCHAR(), nullable=True),
    sa.Column('payment_method', sa.VARCHAR(), nullable=True),
    sa.Column('billing_period_start', sa.DATETIME(), nullable=True),
    sa.Column('billing_period_end', sa.DATETIME(), nullable=True),
    sa.Column('success', sa.BOOLEAN(), nullable=False),
    sa.Column('error_message', sa.TEXT(), nullable=True),
    sa.Column('retry_count', sa.INTEGER(), nullable=True),
    sa.Column('occurred_at', sa.DATETIME(), nullable=True),
    sa.Column('event_metadata', sqlite.JSON(), nullable=True),
    sa.ForeignKeyConstraint(['subscription_id'], ['service_subscriptions.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_subscription_billing_events_id', 'subscription_billing_events', ['id'], unique=False)
    op.create_table('data_export_requests',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('request_id', sa.VARCHAR(length=255), nullable=False),
    sa.Column('status', sa.VARCHAR(length=10), nullable=False),
    sa.Column('requested_at', sa.DATETIME(), nullable=False),
    sa.Column('completed_at', sa.DATETIME(), nullable=True),
    sa.Column('expires_at', sa.DATETIME(), nullable=True),
    sa.Column('file_url', sa.TEXT(), nullable=True),
    sa.Column('file_size_bytes', sa.BIGINT(), nullable=True),
    sa.Column('data_categories', sqlite.JSON(), nullable=True),
    sa.Column('format', sa.VARCHAR(length=50), nullable=True),
    sa.Column('ip_address', sa.VARCHAR(length=45), nullable=True),
    sa.Column('error_message', sa.TEXT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=False),
    sa.Column('updated_at', sa.DATETIME(), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('request_id')
    )
    op.create_index('ix_data_export_requests_id', 'data_export_requests', ['id'], unique=False)
    op.create_table('payment_processor_connections',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('barber_id', sa.INTEGER(), nullable=False),
    sa.Column('processor_type', sa.VARCHAR(length=7), nullable=False),
    sa.Column('account_id', sa.VARCHAR(length=255), nullable=False),
    sa.Column('account_name', sa.VARCHAR(length=255), nullable=True),
    sa.Column('status', sa.VARCHAR(length=12), nullable=False),
    sa.Column('connection_data', sqlite.JSON(), nullable=True),
    sa.Column('webhook_url', sa.VARCHAR(length=500), nullable=True),
    sa.Column('webhook_secret', sa.VARCHAR(length=255), nullable=True),
    sa.Column('supports_payments', sa.BOOLEAN(), nullable=True),
    sa.Column('supports_refunds', sa.BOOLEAN(), nullable=True),
    sa.Column('supports_recurring', sa.BOOLEAN(), nullable=True),
    sa.Column('default_currency', sa.VARCHAR(length=3), nullable=True),
    sa.Column('processing_fees', sqlite.JSON(), nullable=True),
    sa.Column('last_sync_at', sa.DATETIME(), nullable=True),
    sa.Column('last_transaction_at', sa.DATETIME(), nullable=True),
    sa.Column('total_transactions', sa.INTEGER(), nullable=True),
    sa.Column('total_volume', sa.FLOAT(), nullable=True),
    sa.Column('connected_at', sa.DATETIME(), nullable=True),
    sa.Column('disconnected_at', sa.DATETIME(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.Column('last_error', sa.TEXT(), nullable=True),
    sa.Column('error_count', sa.INTEGER(), nullable=True),
    sa.ForeignKeyConstraint(['barber_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_payment_processor_connections_id', 'payment_processor_connections', ['id'], unique=False)
    op.create_index('ix_payment_processor_connections_barber_id', 'payment_processor_connections', ['barber_id'], unique=False)
    op.create_table('hybrid_payment_configs',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('barber_id', sa.INTEGER(), nullable=False),
    sa.Column('payment_mode', sa.VARCHAR(length=13), nullable=False),
    sa.Column('primary_processor', sa.VARCHAR(length=7), nullable=True),
    sa.Column('fallback_to_platform', sa.BOOLEAN(), nullable=True),
    sa.Column('collection_method', sa.VARCHAR(length=50), nullable=True),
    sa.Column('collection_frequency', sa.VARCHAR(length=20), nullable=True),
    sa.Column('collection_day', sa.INTEGER(), nullable=True),
    sa.Column('auto_collection', sa.BOOLEAN(), nullable=True),
    sa.Column('minimum_collection_amount', sa.FLOAT(), nullable=True),
    sa.Column('collection_buffer_days', sa.INTEGER(), nullable=True),
    sa.Column('maximum_outstanding', sa.FLOAT(), nullable=True),
    sa.Column('notify_before_collection', sa.BOOLEAN(), nullable=True),
    sa.Column('notification_days_ahead', sa.INTEGER(), nullable=True),
    sa.Column('collection_email', sa.VARCHAR(length=255), nullable=True),
    sa.Column('collection_phone', sa.VARCHAR(length=20), nullable=True),
    sa.Column('bank_account_config', sqlite.JSON(), nullable=True),
    sa.Column('backup_payment_method', sa.VARCHAR(length=255), nullable=True),
    sa.Column('enable_installments', sa.BOOLEAN(), nullable=True),
    sa.Column('enable_early_payment_discount', sa.BOOLEAN(), nullable=True),
    sa.Column('early_payment_discount_rate', sa.FLOAT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.Column('last_collection_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['barber_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_hybrid_payment_configs_id', 'hybrid_payment_configs', ['id'], unique=False)
    op.create_index('ix_hybrid_payment_configs_barber_id', 'hybrid_payment_configs', ['barber_id'], unique=1)
    op.create_table('cancellation_policies',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(length=100), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('is_default', sa.BOOLEAN(), nullable=True),
    sa.Column('service_id', sa.INTEGER(), nullable=True),
    sa.Column('location_id', sa.INTEGER(), nullable=True),
    sa.Column('immediate_cancellation_hours', sa.INTEGER(), nullable=True),
    sa.Column('short_notice_hours', sa.INTEGER(), nullable=True),
    sa.Column('advance_notice_hours', sa.INTEGER(), nullable=True),
    sa.Column('immediate_refund_percentage', sa.FLOAT(), nullable=True),
    sa.Column('short_notice_refund_percentage', sa.FLOAT(), nullable=True),
    sa.Column('advance_refund_percentage', sa.FLOAT(), nullable=True),
    sa.Column('immediate_cancellation_fee', sa.FLOAT(), nullable=True),
    sa.Column('short_notice_cancellation_fee', sa.FLOAT(), nullable=True),
    sa.Column('advance_cancellation_fee', sa.FLOAT(), nullable=True),
    sa.Column('no_show_fee', sa.FLOAT(), nullable=True),
    sa.Column('no_show_refund_percentage', sa.FLOAT(), nullable=True),
    sa.Column('allow_emergency_exception', sa.BOOLEAN(), nullable=True),
    sa.Column('emergency_refund_percentage', sa.FLOAT(), nullable=True),
    sa.Column('emergency_requires_approval', sa.BOOLEAN(), nullable=True),
    sa.Column('max_cancellations_per_month', sa.INTEGER(), nullable=True),
    sa.Column('penalty_for_excess_cancellations', sa.FLOAT(), nullable=True),
    sa.Column('first_time_client_grace', sa.BOOLEAN(), nullable=True),
    sa.Column('first_time_client_hours', sa.INTEGER(), nullable=True),
    sa.Column('first_time_client_refund_percentage', sa.FLOAT(), nullable=True),
    sa.Column('auto_offer_to_waitlist', sa.BOOLEAN(), nullable=True),
    sa.Column('waitlist_notification_hours', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.Column('created_by_id', sa.INTEGER(), nullable=True),
    sa.Column('advanced_rules', sqlite.JSON(), nullable=True),
    sa.ForeignKeyConstraint(['created_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['location_id'], ['barbershop_locations.id'], ),
    sa.ForeignKeyConstraint(['service_id'], ['services.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_cancellation_policies_id', 'cancellation_policies', ['id'], unique=False)
    op.create_table('order_items',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('order_id', sa.INTEGER(), nullable=False),
    sa.Column('product_id', sa.INTEGER(), nullable=False),
    sa.Column('variant_id', sa.INTEGER(), nullable=True),
    sa.Column('external_id', sa.VARCHAR(length=255), nullable=True),
    sa.Column('title', sa.VARCHAR(length=500), nullable=False),
    sa.Column('variant_title', sa.VARCHAR(length=255), nullable=True),
    sa.Column('sku', sa.VARCHAR(length=255), nullable=True),
    sa.Column('price', sa.NUMERIC(precision=10, scale=2), nullable=False),
    sa.Column('quantity', sa.INTEGER(), nullable=False),
    sa.Column('total_discount', sa.NUMERIC(precision=10, scale=2), nullable=True),
    sa.Column('line_total', sa.NUMERIC(precision=10, scale=2), nullable=False),
    sa.Column('commission_rate', sa.NUMERIC(precision=5, scale=4), nullable=True),
    sa.Column('commission_amount', sa.NUMERIC(precision=10, scale=2), nullable=True),
    sa.Column('commission_paid', sa.BOOLEAN(), nullable=True),
    sa.Column('fulfillment_status', sa.VARCHAR(length=50), nullable=True),
    sa.Column('fulfillment_quantity', sa.INTEGER(), nullable=True),
    sa.Column('weight', sa.NUMERIC(precision=8, scale=2), nullable=True),
    sa.Column('requires_shipping', sa.BOOLEAN(), nullable=True),
    sa.Column('taxable', sa.BOOLEAN(), nullable=True),
    sa.Column('shopify_data', sqlite.JSON(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['order_id'], ['orders.id'], ),
    sa.ForeignKeyConstraint(['product_id'], ['products.id'], ),
    sa.ForeignKeyConstraint(['variant_id'], ['product_variants.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_order_items_id', 'order_items', ['id'], unique=False)
    op.create_index('ix_order_items_external_id', 'order_items', ['external_id'], unique=False)
    op.create_table('cross_user_metrics',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('date', sa.DATETIME(), nullable=False),
    sa.Column('period_type', sa.VARCHAR(length=20), nullable=False),
    sa.Column('business_segment', sa.VARCHAR(length=50), nullable=False),
    sa.Column('service_category', sa.VARCHAR(length=50), nullable=True),
    sa.Column('location_type', sa.VARCHAR(length=50), nullable=True),
    sa.Column('revenue_bucket', sa.VARCHAR(length=20), nullable=True),
    sa.Column('appointment_volume_bucket', sa.VARCHAR(length=20), nullable=True),
    sa.Column('client_count_bucket', sa.VARCHAR(length=20), nullable=True),
    sa.Column('efficiency_score_bucket', sa.VARCHAR(length=20), nullable=True),
    sa.Column('has_online_booking', sa.BOOLEAN(), nullable=True),
    sa.Column('uses_marketing_automation', sa.BOOLEAN(), nullable=True),
    sa.Column('offers_packages', sa.BOOLEAN(), nullable=True),
    sa.Column('has_loyalty_program', sa.BOOLEAN(), nullable=True),
    sa.Column('uses_dynamic_pricing', sa.BOOLEAN(), nullable=True),
    sa.Column('is_top_performer', sa.BOOLEAN(), nullable=False),
    sa.Column('growth_trend', sa.VARCHAR(length=20), nullable=True),
    sa.Column('noise_added', sa.BOOLEAN(), nullable=False),
    sa.Column('k_anonymity_level', sa.INTEGER(), nullable=True),
    sa.Column('aggregated_at', sa.DATETIME(), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_cross_user_metrics_service_category', 'cross_user_metrics', ['service_category'], unique=False)
    op.create_index('ix_cross_user_metrics_location_type', 'cross_user_metrics', ['location_type'], unique=False)
    op.create_index('ix_cross_user_metrics_id', 'cross_user_metrics', ['id'], unique=False)
    op.create_index('ix_cross_user_metrics_date', 'cross_user_metrics', ['date'], unique=False)
    op.create_index('ix_cross_user_metrics_business_segment', 'cross_user_metrics', ['business_segment'], unique=False)
    op.create_index('idx_temporal_analysis', 'cross_user_metrics', ['date', 'period_type', 'business_segment'], unique=False)
    op.create_index('idx_pattern_analysis', 'cross_user_metrics', ['has_online_booking', 'uses_marketing_automation', 'is_top_performer'], unique=False)
    op.create_index('idx_cross_user_analysis', 'cross_user_metrics', ['business_segment', 'date', 'is_top_performer'], unique=False)
    op.create_table('six_fb_service_excellence_metrics',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('appointment_id', sa.INTEGER(), nullable=True),
    sa.Column('client_id', sa.INTEGER(), nullable=True),
    sa.Column('service_date', sa.DATE(), nullable=False),
    sa.Column('excellence_area', sa.VARCHAR(length=20), nullable=False),
    sa.Column('score', sa.FLOAT(), nullable=False),
    sa.Column('target_score', sa.FLOAT(), nullable=True),
    sa.Column('variance', sa.FLOAT(), nullable=True),
    sa.Column('assessment_criteria', sqlite.JSON(), nullable=True),
    sa.Column('strengths_identified', sqlite.JSON(), nullable=True),
    sa.Column('improvement_areas', sqlite.JSON(), nullable=True),
    sa.Column('action_items', sqlite.JSON(), nullable=True),
    sa.Column('service_type', sa.VARCHAR(), nullable=True),
    sa.Column('service_duration_minutes', sa.INTEGER(), nullable=True),
    sa.Column('complexity_level', sa.VARCHAR(), nullable=True),
    sa.Column('client_satisfaction_score', sa.FLOAT(), nullable=True),
    sa.Column('client_feedback', sa.TEXT(), nullable=True),
    sa.Column('net_promoter_score', sa.INTEGER(), nullable=True),
    sa.Column('premium_positioning_score', sa.FLOAT(), nullable=True),
    sa.Column('brand_consistency_score', sa.FLOAT(), nullable=True),
    sa.Column('value_demonstration_score', sa.FLOAT(), nullable=True),
    sa.Column('assessment_method', sa.VARCHAR(), nullable=True),
    sa.Column('assessor_notes', sa.TEXT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['appointment_id'], ['appointments.id'], ),
    sa.ForeignKeyConstraint(['client_id'], ['clients.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_six_fb_service_excellence_metrics_user_id', 'six_fb_service_excellence_metrics', ['user_id'], unique=False)
    op.create_index('ix_six_fb_service_excellence_metrics_service_date', 'six_fb_service_excellence_metrics', ['service_date'], unique=False)
    op.create_index('ix_six_fb_service_excellence_metrics_id', 'six_fb_service_excellence_metrics', ['id'], unique=False)
    op.create_index('ix_six_fb_service_excellence_metrics_client_id', 'six_fb_service_excellence_metrics', ['client_id'], unique=False)
    op.create_index('ix_six_fb_service_excellence_metrics_appointment_id', 'six_fb_service_excellence_metrics', ['appointment_id'], unique=False)
    op.create_index('idx_excellence_user_date_area', 'six_fb_service_excellence_metrics', ['user_id', 'service_date', 'excellence_area'], unique=False)
    op.create_index('idx_excellence_score', 'six_fb_service_excellence_metrics', ['score'], unique=False)
    op.create_table('six_fb_service_standards',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('standard_name', sa.VARCHAR(), nullable=False),
    sa.Column('excellence_area', sa.VARCHAR(length=20), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=False),
    sa.Column('minimum_score', sa.FLOAT(), nullable=True),
    sa.Column('target_score', sa.FLOAT(), nullable=True),
    sa.Column('excellence_score', sa.FLOAT(), nullable=True),
    sa.Column('current_average_score', sa.FLOAT(), nullable=True),
    sa.Column('last_30_days_average', sa.FLOAT(), nullable=True),
    sa.Column('trend_direction', sa.VARCHAR(), nullable=True),
    sa.Column('total_assessments', sa.INTEGER(), nullable=True),
    sa.Column('compliant_assessments', sa.INTEGER(), nullable=True),
    sa.Column('compliance_rate', sa.FLOAT(), nullable=True),
    sa.Column('methodology_principle', sa.VARCHAR(length=27), nullable=False),
    sa.Column('business_impact', sa.TEXT(), nullable=True),
    sa.Column('client_value_impact', sa.TEXT(), nullable=True),
    sa.Column('improvement_plan', sqlite.JSON(), nullable=True),
    sa.Column('training_requirements', sqlite.JSON(), nullable=True),
    sa.Column('milestone_targets', sqlite.JSON(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('last_reviewed', sa.DATE(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_six_fb_service_standards_user_id', 'six_fb_service_standards', ['user_id'], unique=False)
    op.create_index('ix_six_fb_service_standards_id', 'six_fb_service_standards', ['id'], unique=False)
    op.create_table('webhook_events',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('provider', sa.VARCHAR(length=50), nullable=False),
    sa.Column('event_id', sa.VARCHAR(length=255), nullable=False),
    sa.Column('event_type', sa.VARCHAR(length=100), nullable=False),
    sa.Column('environment', sa.VARCHAR(length=20), nullable=False),
    sa.Column('source_ip', sa.VARCHAR(length=45), nullable=True),
    sa.Column('user_agent', sa.TEXT(), nullable=True),
    sa.Column('headers', sqlite.JSON(), nullable=True),
    sa.Column('payload', sa.TEXT(), nullable=True),
    sa.Column('signature', sa.TEXT(), nullable=True),
    sa.Column('content_length', sa.INTEGER(), nullable=True),
    sa.Column('status', sa.VARCHAR(length=20), nullable=False),
    sa.Column('processing_result', sqlite.JSON(), nullable=True),
    sa.Column('error_message', sa.TEXT(), nullable=True),
    sa.Column('signature_valid', sa.BOOLEAN(), nullable=True),
    sa.Column('is_duplicate', sa.BOOLEAN(), nullable=True),
    sa.Column('received_at', sa.DATETIME(), nullable=False),
    sa.Column('processed_at', sa.DATETIME(), nullable=True),
    sa.Column('processing_duration_ms', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=False),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_webhook_events_provider', 'webhook_events', ['provider'], unique=False)
    op.create_index('ix_webhook_events_id', 'webhook_events', ['id'], unique=False)
    op.create_index('ix_webhook_events_event_type', 'webhook_events', ['event_type'], unique=False)
    op.create_index('ix_webhook_events_event_id', 'webhook_events', ['event_id'], unique=False)
    op.create_table('timezone_cache',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('timezone_name', sa.VARCHAR(length=50), nullable=False),
    sa.Column('display_name', sa.VARCHAR(length=100), nullable=False),
    sa.Column('utc_offset', sa.VARCHAR(length=10), nullable=False),
    sa.Column('dst_offset', sa.VARCHAR(length=10), nullable=True),
    sa.Column('is_dst_active', sa.BOOLEAN(), nullable=False),
    sa.Column('is_common', sa.BOOLEAN(), nullable=False),
    sa.Column('region', sa.VARCHAR(length=50), nullable=True),
    sa.Column('country', sa.VARCHAR(length=3), nullable=True),
    sa.Column('last_updated', sa.DATETIME(), nullable=False),
    sa.Column('created_at', sa.DATETIME(), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_timezone_cache_timezone_name', 'timezone_cache', ['timezone_name'], unique=1)
    op.create_index('ix_timezone_cache_id', 'timezone_cache', ['id'], unique=False)
    op.create_table('user_consents',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('consent_type', sa.VARCHAR(length=19), nullable=False),
    sa.Column('status', sa.VARCHAR(length=9), nullable=False),
    sa.Column('consent_date', sa.DATETIME(), nullable=False),
    sa.Column('withdrawal_date', sa.DATETIME(), nullable=True),
    sa.Column('ip_address', sa.VARCHAR(length=45), nullable=True),
    sa.Column('user_agent', sa.TEXT(), nullable=True),
    sa.Column('version', sa.VARCHAR(length=50), nullable=True),
    sa.Column('notes', sa.TEXT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=False),
    sa.Column('updated_at', sa.DATETIME(), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_user_consents_id', 'user_consents', ['id'], unique=False)
    op.create_table('weekly_insights',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('week_start_date', sa.DATETIME(), nullable=False),
    sa.Column('week_end_date', sa.DATETIME(), nullable=False),
    sa.Column('generation_date', sa.DATETIME(), nullable=False),
    sa.Column('overall_score', sa.FLOAT(), nullable=False),
    sa.Column('previous_week_score', sa.FLOAT(), nullable=True),
    sa.Column('score_change', sa.FLOAT(), nullable=True),
    sa.Column('revenue_current_week', sa.FLOAT(), nullable=True),
    sa.Column('revenue_previous_week', sa.FLOAT(), nullable=True),
    sa.Column('revenue_growth_percent', sa.FLOAT(), nullable=True),
    sa.Column('appointments_current_week', sa.INTEGER(), nullable=True),
    sa.Column('appointments_previous_week', sa.INTEGER(), nullable=True),
    sa.Column('appointment_growth_percent', sa.FLOAT(), nullable=True),
    sa.Column('new_clients_count', sa.INTEGER(), nullable=True),
    sa.Column('returning_clients_count', sa.INTEGER(), nullable=True),
    sa.Column('client_retention_rate', sa.FLOAT(), nullable=True),
    sa.Column('average_ticket_size', sa.FLOAT(), nullable=True),
    sa.Column('booking_efficiency_percent', sa.FLOAT(), nullable=True),
    sa.Column('no_show_rate_percent', sa.FLOAT(), nullable=True),
    sa.Column('revenue_optimization_score', sa.FLOAT(), nullable=True),
    sa.Column('client_value_score', sa.FLOAT(), nullable=True),
    sa.Column('service_excellence_score', sa.FLOAT(), nullable=True),
    sa.Column('business_efficiency_score', sa.FLOAT(), nullable=True),
    sa.Column('professional_growth_score', sa.FLOAT(), nullable=True),
    sa.Column('trend_analysis', sqlite.JSON(), nullable=True),
    sa.Column('top_achievements', sqlite.JSON(), nullable=True),
    sa.Column('key_opportunities', sqlite.JSON(), nullable=True),
    sa.Column('risk_factors', sqlite.JSON(), nullable=True),
    sa.Column('executive_summary', sa.TEXT(), nullable=True),
    sa.Column('key_insights', sa.TEXT(), nullable=True),
    sa.Column('status', sa.VARCHAR(length=10), nullable=False),
    sa.Column('generation_duration_seconds', sa.FLOAT(), nullable=True),
    sa.Column('error_message', sa.TEXT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=False),
    sa.Column('updated_at', sa.DATETIME(), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_weekly_insights_week_start_date', 'weekly_insights', ['week_start_date'], unique=False)
    op.create_index('ix_weekly_insights_user_id', 'weekly_insights', ['user_id'], unique=False)
    op.create_index('ix_weekly_insights_id', 'weekly_insights', ['id'], unique=False)
    op.create_table('six_fb_client_value_tier_history',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('client_id', sa.INTEGER(), nullable=False),
    sa.Column('previous_tier', sa.VARCHAR(length=12), nullable=True),
    sa.Column('new_tier', sa.VARCHAR(length=12), nullable=False),
    sa.Column('change_date', sa.DATE(), nullable=False),
    sa.Column('change_reason', sa.VARCHAR(), nullable=True),
    sa.Column('triggering_event', sa.VARCHAR(), nullable=True),
    sa.Column('triggering_metrics', sqlite.JSON(), nullable=True),
    sa.Column('change_justification', sa.TEXT(), nullable=True),
    sa.Column('lifetime_value_at_change', sa.NUMERIC(precision=10, scale=2), nullable=True),
    sa.Column('relationship_score_at_change', sa.FLOAT(), nullable=True),
    sa.Column('engagement_score_at_change', sa.FLOAT(), nullable=True),
    sa.Column('revenue_impact_projected', sa.NUMERIC(precision=8, scale=2), nullable=True),
    sa.Column('relationship_building_plan', sqlite.JSON(), nullable=True),
    sa.Column('value_creation_opportunities', sqlite.JSON(), nullable=True),
    sa.Column('tier_change_communication_sent', sa.BOOLEAN(), nullable=True),
    sa.Column('tier_benefits_activated', sqlite.JSON(), nullable=True),
    sa.Column('tier_requirements_updated', sqlite.JSON(), nullable=True),
    sa.Column('change_success_metrics', sqlite.JSON(), nullable=True),
    sa.Column('tier_stability_score', sa.FLOAT(), nullable=True),
    sa.Column('progression_readiness_score', sa.FLOAT(), nullable=True),
    sa.Column('changed_by', sa.VARCHAR(), nullable=True),
    sa.Column('validation_required', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['client_id'], ['clients.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_six_fb_client_value_tier_history_user_id', 'six_fb_client_value_tier_history', ['user_id'], unique=False)
    op.create_index('ix_six_fb_client_value_tier_history_id', 'six_fb_client_value_tier_history', ['id'], unique=False)
    op.create_index('ix_six_fb_client_value_tier_history_client_id', 'six_fb_client_value_tier_history', ['client_id'], unique=False)
    op.create_index('idx_tier_history_user_tier', 'six_fb_client_value_tier_history', ['user_id', 'new_tier'], unique=False)
    op.create_index('idx_tier_history_client_date', 'six_fb_client_value_tier_history', ['client_id', 'change_date'], unique=False)
    op.create_table('pos_transactions',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('transaction_number', sa.VARCHAR(length=255), nullable=False),
    sa.Column('location_id', sa.INTEGER(), nullable=False),
    sa.Column('barber_id', sa.INTEGER(), nullable=False),
    sa.Column('cashier_id', sa.INTEGER(), nullable=True),
    sa.Column('customer_id', sa.INTEGER(), nullable=True),
    sa.Column('customer_name', sa.VARCHAR(length=255), nullable=True),
    sa.Column('customer_email', sa.VARCHAR(length=255), nullable=True),
    sa.Column('customer_phone', sa.VARCHAR(length=50), nullable=True),
    sa.Column('subtotal', sa.NUMERIC(precision=10, scale=2), nullable=False),
    sa.Column('tax_amount', sa.NUMERIC(precision=10, scale=2), nullable=False),
    sa.Column('discount_amount', sa.NUMERIC(precision=10, scale=2), nullable=False),
    sa.Column('tip_amount', sa.NUMERIC(precision=10, scale=2), nullable=False),
    sa.Column('total_amount', sa.NUMERIC(precision=10, scale=2), nullable=False),
    sa.Column('payment_method', sa.VARCHAR(length=50), nullable=False),
    sa.Column('payment_reference', sa.VARCHAR(length=255), nullable=True),
    sa.Column('commission_rate', sa.NUMERIC(precision=5, scale=4), nullable=False),
    sa.Column('commission_amount', sa.NUMERIC(precision=10, scale=2), nullable=False),
    sa.Column('commission_paid', sa.BOOLEAN(), nullable=True),
    sa.Column('commission_paid_at', sa.DATETIME(), nullable=True),
    sa.Column('notes', sa.TEXT(), nullable=True),
    sa.Column('receipt_email_sent', sa.BOOLEAN(), nullable=True),
    sa.Column('transacted_at', sa.DATETIME(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['barber_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['cashier_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['customer_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['location_id'], ['barbershop_locations.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_pos_transactions_transaction_number', 'pos_transactions', ['transaction_number'], unique=1)
    op.create_index('ix_pos_transactions_id', 'pos_transactions', ['id'], unique=False)
    op.create_table('mfa_events',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('event_type', sa.VARCHAR(length=50), nullable=False),
    sa.Column('event_status', sa.VARCHAR(length=50), nullable=False),
    sa.Column('event_details', sa.VARCHAR(length=500), nullable=True),
    sa.Column('ip_address', sa.VARCHAR(length=45), nullable=True),
    sa.Column('user_agent', sa.VARCHAR(length=500), nullable=True),
    sa.Column('device_fingerprint', sa.VARCHAR(length=255), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_mfa_events_id', 'mfa_events', ['id'], unique=False)
    op.create_index('idx_mfa_events_user', 'mfa_events', ['user_id', 'created_at'], unique=False)
    op.create_index('idx_mfa_events_type', 'mfa_events', ['event_type', 'created_at'], unique=False)
    op.create_table('performance_benchmarks',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('category', sa.VARCHAR(length=50), nullable=False),
    sa.Column('metric_name', sa.VARCHAR(length=100), nullable=False),
    sa.Column('business_segment', sa.VARCHAR(length=50), nullable=False),
    sa.Column('region', sa.VARCHAR(length=50), nullable=True),
    sa.Column('month', sa.INTEGER(), nullable=False),
    sa.Column('year', sa.INTEGER(), nullable=False),
    sa.Column('sample_size', sa.INTEGER(), nullable=False),
    sa.Column('percentile_10', sa.FLOAT(), nullable=True),
    sa.Column('percentile_25', sa.FLOAT(), nullable=True),
    sa.Column('percentile_50', sa.FLOAT(), nullable=True),
    sa.Column('percentile_75', sa.FLOAT(), nullable=True),
    sa.Column('percentile_90', sa.FLOAT(), nullable=True),
    sa.Column('mean_value', sa.FLOAT(), nullable=True),
    sa.Column('std_deviation', sa.FLOAT(), nullable=True),
    sa.Column('additional_data', sqlite.JSON(), nullable=True),
    sa.Column('anonymized_at', sa.DATETIME(), nullable=False),
    sa.Column('aggregation_period', sa.VARCHAR(length=20), nullable=False),
    sa.Column('data_source_hash', sa.VARCHAR(length=64), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_performance_benchmarks_year', 'performance_benchmarks', ['year'], unique=False)
    op.create_index('ix_performance_benchmarks_region', 'performance_benchmarks', ['region'], unique=False)
    op.create_index('ix_performance_benchmarks_month', 'performance_benchmarks', ['month'], unique=False)
    op.create_index('ix_performance_benchmarks_metric_name', 'performance_benchmarks', ['metric_name'], unique=False)
    op.create_index('ix_performance_benchmarks_id', 'performance_benchmarks', ['id'], unique=False)
    op.create_index('ix_performance_benchmarks_category', 'performance_benchmarks', ['category'], unique=False)
    op.create_index('ix_performance_benchmarks_business_segment', 'performance_benchmarks', ['business_segment'], unique=False)
    op.create_index('idx_benchmark_temporal', 'performance_benchmarks', ['year', 'month', 'category'], unique=False)
    op.create_index('idx_benchmark_region', 'performance_benchmarks', ['region', 'year', 'month'], unique=False)
    op.create_index('idx_benchmark_lookup', 'performance_benchmarks', ['category', 'metric_name', 'business_segment', 'year', 'month'], unique=False)
    op.create_table('sms_conversations',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('customer_phone', sa.VARCHAR(), nullable=False),
    sa.Column('customer_name', sa.VARCHAR(), nullable=True),
    sa.Column('client_id', sa.INTEGER(), nullable=True),
    sa.Column('barber_id', sa.INTEGER(), nullable=True),
    sa.Column('status', sa.VARCHAR(), nullable=True),
    sa.Column('last_message_at', sa.DATETIME(), nullable=True),
    sa.Column('last_message_from', sa.VARCHAR(), nullable=True),
    sa.Column('total_messages', sa.INTEGER(), nullable=True),
    sa.Column('unread_customer_messages', sa.INTEGER(), nullable=True),
    sa.Column('tags', sqlite.JSON(), nullable=True),
    sa.Column('notes', sa.TEXT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['barber_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['client_id'], ['clients.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_sms_conversations_id', 'sms_conversations', ['id'], unique=False)
    op.create_index('ix_sms_conversations_customer_phone', 'sms_conversations', ['customer_phone'], unique=False)
    op.create_table('platform_collections',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('barber_id', sa.INTEGER(), nullable=False),
    sa.Column('connection_id', sa.INTEGER(), nullable=True),
    sa.Column('external_transaction_id', sa.INTEGER(), nullable=True),
    sa.Column('collection_type', sa.VARCHAR(length=12), nullable=False),
    sa.Column('amount', sa.FLOAT(), nullable=False),
    sa.Column('currency', sa.VARCHAR(length=3), nullable=True),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('reference_id', sa.VARCHAR(length=255), nullable=True),
    sa.Column('reference_type', sa.VARCHAR(length=50), nullable=True),
    sa.Column('period_start', sa.DATETIME(), nullable=True),
    sa.Column('period_end', sa.DATETIME(), nullable=True),
    sa.Column('due_date', sa.DATETIME(), nullable=False),
    sa.Column('grace_period_days', sa.INTEGER(), nullable=True),
    sa.Column('status', sa.VARCHAR(length=10), nullable=False),
    sa.Column('collection_method', sa.VARCHAR(length=50), nullable=True),
    sa.Column('collection_account', sa.VARCHAR(length=255), nullable=True),
    sa.Column('external_collection_id', sa.VARCHAR(length=255), nullable=True),
    sa.Column('collected_at', sa.DATETIME(), nullable=True),
    sa.Column('failed_at', sa.DATETIME(), nullable=True),
    sa.Column('retry_count', sa.INTEGER(), nullable=True),
    sa.Column('next_retry_at', sa.DATETIME(), nullable=True),
    sa.Column('failure_reason', sa.TEXT(), nullable=True),
    sa.Column('dispute_reason', sa.TEXT(), nullable=True),
    sa.Column('waived_reason', sa.TEXT(), nullable=True),
    sa.Column('waived_by_id', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['barber_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['connection_id'], ['payment_processor_connections.id'], ),
    sa.ForeignKeyConstraint(['external_transaction_id'], ['external_transactions.id'], ),
    sa.ForeignKeyConstraint(['waived_by_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_platform_collections_id', 'platform_collections', ['id'], unique=False)
    op.create_index('ix_platform_collections_external_transaction_id', 'platform_collections', ['external_transaction_id'], unique=False)
    op.create_index('ix_platform_collections_connection_id', 'platform_collections', ['connection_id'], unique=False)
    op.create_index('ix_platform_collections_barber_id', 'platform_collections', ['barber_id'], unique=False)
    op.create_table('sms_messages',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('conversation_id', sa.INTEGER(), nullable=False),
    sa.Column('body', sa.TEXT(), nullable=False),
    sa.Column('direction', sa.VARCHAR(length=8), nullable=False),
    sa.Column('from_phone', sa.VARCHAR(), nullable=False),
    sa.Column('to_phone', sa.VARCHAR(), nullable=False),
    sa.Column('twilio_sid', sa.VARCHAR(), nullable=True),
    sa.Column('status', sa.VARCHAR(length=9), nullable=True),
    sa.Column('sent_by_user_id', sa.INTEGER(), nullable=True),
    sa.Column('sent_at', sa.DATETIME(), nullable=True),
    sa.Column('delivered_at', sa.DATETIME(), nullable=True),
    sa.Column('read_at', sa.DATETIME(), nullable=True),
    sa.Column('failed_at', sa.DATETIME(), nullable=True),
    sa.Column('error_code', sa.VARCHAR(), nullable=True),
    sa.Column('error_message', sa.TEXT(), nullable=True),
    sa.Column('message_metadata', sqlite.JSON(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['conversation_id'], ['sms_conversations.id'], ),
    sa.ForeignKeyConstraint(['sent_by_user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_sms_messages_twilio_sid', 'sms_messages', ['twilio_sid'], unique=False)
    op.create_index('ix_sms_messages_id', 'sms_messages', ['id'], unique=False)
    op.create_table('integrations',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('integration_type', sa.VARCHAR(length=18), nullable=False),
    sa.Column('name', sa.VARCHAR(length=255), nullable=False),
    sa.Column('access_token', sa.TEXT(), nullable=True),
    sa.Column('refresh_token', sa.TEXT(), nullable=True),
    sa.Column('token_expires_at', sa.DATETIME(), nullable=True),
    sa.Column('api_key', sa.TEXT(), nullable=True),
    sa.Column('api_secret', sa.TEXT(), nullable=True),
    sa.Column('webhook_secret', sa.TEXT(), nullable=True),
    sa.Column('config', sqlite.JSON(), nullable=True),
    sa.Column('scopes', sqlite.JSON(), nullable=True),
    sa.Column('webhook_url', sa.VARCHAR(length=500), nullable=True),
    sa.Column('status', sa.VARCHAR(length=9), nullable=True),
    sa.Column('last_sync_at', sa.DATETIME(), nullable=True),
    sa.Column('last_error', sa.TEXT(), nullable=True),
    sa.Column('error_count', sa.INTEGER(), nullable=True),
    sa.Column('health_check_data', sqlite.JSON(), nullable=True),
    sa.Column('last_health_check', sa.DATETIME(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_integrations_id', 'integrations', ['id'], unique=False)
    op.create_table('challenge_participations',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('challenge_id', sa.INTEGER(), nullable=False),
    sa.Column('registered_at', sa.DATETIME(), nullable=True),
    sa.Column('started_at', sa.DATETIME(), nullable=True),
    sa.Column('completed_at', sa.DATETIME(), nullable=True),
    sa.Column('current_progress', sa.FLOAT(), nullable=True),
    sa.Column('target_progress', sa.FLOAT(), nullable=True),
    sa.Column('progress_percentage', sa.FLOAT(), nullable=True),
    sa.Column('progress_history', sqlite.JSON(), nullable=True),
    sa.Column('final_score', sa.FLOAT(), nullable=True),
    sa.Column('ranking_position', sa.INTEGER(), nullable=True),
    sa.Column('is_completed', sa.BOOLEAN(), nullable=True),
    sa.Column('completion_verified', sa.BOOLEAN(), nullable=True),
    sa.Column('rewards_earned', sqlite.JSON(), nullable=True),
    sa.Column('xp_earned', sa.INTEGER(), nullable=True),
    sa.Column('achievements_unlocked', sqlite.JSON(), nullable=True),
    sa.Column('team_id', sa.VARCHAR(), nullable=True),
    sa.Column('team_name', sa.VARCHAR(), nullable=True),
    sa.Column('team_role', sa.VARCHAR(), nullable=True),
    sa.Column('last_progress_update', sa.DATETIME(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['challenge_id'], ['gamification_challenges.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_challenge_participations_user_id', 'challenge_participations', ['user_id'], unique=False)
    op.create_index('ix_challenge_participations_id', 'challenge_participations', ['id'], unique=False)
    op.create_index('ix_challenge_participations_challenge_id', 'challenge_participations', ['challenge_id'], unique=False)
    op.create_index('idx_participation_user_challenge', 'challenge_participations', ['user_id', 'challenge_id'], unique=False)
    op.create_index('idx_participation_completed', 'challenge_participations', ['is_completed', 'completed_at'], unique=False)
    op.create_table('coaching_action_items',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('coaching_session_id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('title', sa.VARCHAR(length=200), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=False),
    sa.Column('category', sa.VARCHAR(length=50), nullable=False),
    sa.Column('priority', sa.VARCHAR(length=13), nullable=False),
    sa.Column('estimated_effort_hours', sa.FLOAT(), nullable=True),
    sa.Column('estimated_cost', sa.FLOAT(), nullable=True),
    sa.Column('expected_roi', sa.FLOAT(), nullable=True),
    sa.Column('implementation_deadline', sa.DATETIME(), nullable=True),
    sa.Column('status', sa.VARCHAR(length=20), nullable=True),
    sa.Column('progress_percentage', sa.FLOAT(), nullable=True),
    sa.Column('started_at', sa.DATETIME(), nullable=True),
    sa.Column('completed_at', sa.DATETIME(), nullable=True),
    sa.Column('success_metrics', sqlite.JSON(), nullable=True),
    sa.Column('baseline_metrics', sqlite.JSON(), nullable=True),
    sa.Column('current_metrics', sqlite.JSON(), nullable=True),
    sa.Column('target_metrics', sqlite.JSON(), nullable=True),
    sa.Column('implementation_notes', sa.TEXT(), nullable=True),
    sa.Column('challenges_encountered', sqlite.JSON(), nullable=True),
    sa.Column('lessons_learned', sa.TEXT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['coaching_session_id'], ['business_coaching_sessions.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_coaching_action_items_user_id', 'coaching_action_items', ['user_id'], unique=False)
    op.create_index('ix_coaching_action_items_status', 'coaching_action_items', ['status'], unique=False)
    op.create_index('ix_coaching_action_items_id', 'coaching_action_items', ['id'], unique=False)
    op.create_index('ix_coaching_action_items_coaching_session_id', 'coaching_action_items', ['coaching_session_id'], unique=False)
    op.create_index('ix_coaching_action_items_category', 'coaching_action_items', ['category'], unique=False)
    op.create_table('six_fb_client_communication_profiles',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('client_id', sa.INTEGER(), nullable=False),
    sa.Column('preferred_communication_method', sa.VARCHAR(length=17), nullable=True),
    sa.Column('communication_frequency_preference', sa.VARCHAR(), nullable=True),
    sa.Column('best_contact_time', sa.VARCHAR(), nullable=True),
    sa.Column('timezone_preference', sa.VARCHAR(), nullable=True),
    sa.Column('sms_consent', sa.BOOLEAN(), nullable=True),
    sa.Column('email_consent', sa.BOOLEAN(), nullable=True),
    sa.Column('phone_consent', sa.BOOLEAN(), nullable=True),
    sa.Column('marketing_consent', sa.BOOLEAN(), nullable=True),
    sa.Column('gdpr_compliant', sa.BOOLEAN(), nullable=True),
    sa.Column('total_communications_sent', sa.INTEGER(), nullable=True),
    sa.Column('total_communications_responded', sa.INTEGER(), nullable=True),
    sa.Column('response_rate', sa.FLOAT(), nullable=True),
    sa.Column('average_response_time_hours', sa.FLOAT(), nullable=True),
    sa.Column('engagement_score', sa.FLOAT(), nullable=True),
    sa.Column('communication_sentiment', sa.FLOAT(), nullable=True),
    sa.Column('preferred_content_types', sqlite.JSON(), nullable=True),
    sa.Column('communication_patterns', sqlite.JSON(), nullable=True),
    sa.Column('premium_communication_preference', sa.BOOLEAN(), nullable=True),
    sa.Column('personal_touch_importance', sa.FLOAT(), nullable=True),
    sa.Column('relationship_building_stage', sa.VARCHAR(), nullable=True),
    sa.Column('last_communication_date', sa.DATETIME(), nullable=True),
    sa.Column('profile_last_updated', sa.DATETIME(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['client_id'], ['clients.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_six_fb_client_communication_profiles_user_id', 'six_fb_client_communication_profiles', ['user_id'], unique=False)
    op.create_index('ix_six_fb_client_communication_profiles_id', 'six_fb_client_communication_profiles', ['id'], unique=False)
    op.create_index('ix_six_fb_client_communication_profiles_client_id', 'six_fb_client_communication_profiles', ['client_id'], unique=False)
    op.create_index('idx_comm_profile_user_client', 'six_fb_client_communication_profiles', ['user_id', 'client_id'], unique=False)
    op.create_index('idx_comm_profile_engagement', 'six_fb_client_communication_profiles', ['engagement_score'], unique=False)
    op.create_table('franchise_analytics',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('entity_type', sa.VARCHAR(length=50), nullable=False),
    sa.Column('entity_id', sa.INTEGER(), nullable=False),
    sa.Column('period_type', sa.VARCHAR(length=20), nullable=False),
    sa.Column('period_start', sa.DATETIME(), nullable=False),
    sa.Column('period_end', sa.DATETIME(), nullable=False),
    sa.Column('revenue_metrics', sqlite.JSON(), nullable=True),
    sa.Column('operational_metrics', sqlite.JSON(), nullable=True),
    sa.Column('client_metrics', sqlite.JSON(), nullable=True),
    sa.Column('staff_metrics', sqlite.JSON(), nullable=True),
    sa.Column('franchise_fee_collection', sqlite.JSON(), nullable=True),
    sa.Column('brand_compliance_scores', sqlite.JSON(), nullable=True),
    sa.Column('cross_selling_performance', sqlite.JSON(), nullable=True),
    sa.Column('territory_performance', sqlite.JSON(), nullable=True),
    sa.Column('peer_comparison_metrics', sqlite.JSON(), nullable=True),
    sa.Column('network_percentile_ranking', sqlite.JSON(), nullable=True),
    sa.Column('industry_benchmark_comparison', sqlite.JSON(), nullable=True),
    sa.Column('computed_at', sa.DATETIME(), nullable=True),
    sa.Column('data_completeness_score', sa.NUMERIC(precision=3, scale=2), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_franchise_analytics_id', 'franchise_analytics', ['id'], unique=False)
    op.create_index('idx_franchise_analytics_entity_period', 'franchise_analytics', ['entity_type', 'entity_id', 'period_type', 'period_start'], unique=False)
    op.create_index('idx_franchise_analytics_computed', 'franchise_analytics', ['computed_at'], unique=False)
    op.create_table('notification_preferences',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=True),
    sa.Column('email_enabled', sa.BOOLEAN(), nullable=True),
    sa.Column('email_appointment_confirmation', sa.BOOLEAN(), nullable=True),
    sa.Column('email_appointment_reminder', sa.BOOLEAN(), nullable=True),
    sa.Column('email_appointment_changes', sa.BOOLEAN(), nullable=True),
    sa.Column('email_marketing', sa.BOOLEAN(), nullable=True),
    sa.Column('sms_enabled', sa.BOOLEAN(), nullable=True),
    sa.Column('sms_appointment_confirmation', sa.BOOLEAN(), nullable=True),
    sa.Column('sms_appointment_reminder', sa.BOOLEAN(), nullable=True),
    sa.Column('sms_appointment_changes', sa.BOOLEAN(), nullable=True),
    sa.Column('sms_marketing', sa.BOOLEAN(), nullable=True),
    sa.Column('reminder_hours', sqlite.JSON(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('user_id')
    )
    op.create_index('ix_notification_preferences_id', 'notification_preferences', ['id'], unique=False)
    op.create_table('six_fb_automated_workflows',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('workflow_name', sa.VARCHAR(), nullable=False),
    sa.Column('workflow_description', sa.TEXT(), nullable=True),
    sa.Column('workflow_type', sa.VARCHAR(), nullable=False),
    sa.Column('trigger_event', sa.VARCHAR(length=27), nullable=False),
    sa.Column('trigger_conditions', sqlite.JSON(), nullable=True),
    sa.Column('trigger_frequency', sa.VARCHAR(), nullable=True),
    sa.Column('target_client_criteria', sqlite.JSON(), nullable=True),
    sa.Column('target_client_stages', sqlite.JSON(), nullable=True),
    sa.Column('target_value_tiers', sqlite.JSON(), nullable=True),
    sa.Column('exclusion_criteria', sqlite.JSON(), nullable=True),
    sa.Column('workflow_steps', sqlite.JSON(), nullable=False),
    sa.Column('step_timing', sqlite.JSON(), nullable=True),
    sa.Column('personalization_rules', sqlite.JSON(), nullable=True),
    sa.Column('methodology_principle', sa.VARCHAR(length=27), nullable=False),
    sa.Column('relationship_building_focus', sa.VARCHAR(), nullable=True),
    sa.Column('value_creation_objective', sa.VARCHAR(), nullable=True),
    sa.Column('premium_positioning_strategy', sqlite.JSON(), nullable=True),
    sa.Column('success_metrics', sqlite.JSON(), nullable=True),
    sa.Column('optimization_criteria', sqlite.JSON(), nullable=True),
    sa.Column('a_b_testing_enabled', sa.BOOLEAN(), nullable=True),
    sa.Column('machine_learning_optimization', sa.BOOLEAN(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('priority_level', sa.VARCHAR(), nullable=True),
    sa.Column('max_concurrent_executions', sa.INTEGER(), nullable=True),
    sa.Column('total_executions', sa.INTEGER(), nullable=True),
    sa.Column('successful_executions', sa.INTEGER(), nullable=True),
    sa.Column('failed_executions', sa.INTEGER(), nullable=True),
    sa.Column('average_success_rate', sa.FLOAT(), nullable=True),
    sa.Column('total_revenue_generated', sa.NUMERIC(precision=10, scale=2), nullable=True),
    sa.Column('total_appointments_booked', sa.INTEGER(), nullable=True),
    sa.Column('average_engagement_improvement', sa.FLOAT(), nullable=True),
    sa.Column('optimization_history', sqlite.JSON(), nullable=True),
    sa.Column('created_by', sa.VARCHAR(), nullable=True),
    sa.Column('last_optimization_date', sa.DATETIME(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_six_fb_automated_workflows_user_id', 'six_fb_automated_workflows', ['user_id'], unique=False)
    op.create_index('ix_six_fb_automated_workflows_id', 'six_fb_automated_workflows', ['id'], unique=False)
    op.create_index('idx_workflow_user_active', 'six_fb_automated_workflows', ['user_id', 'is_active'], unique=False)
    op.create_index('idx_workflow_trigger', 'six_fb_automated_workflows', ['trigger_event'], unique=False)
    op.create_index('idx_workflow_success_rate', 'six_fb_automated_workflows', ['average_success_rate'], unique=False)
    op.create_table('six_figure_barber_principle_tracking',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('tracking_period_start', sa.DATETIME(), nullable=False),
    sa.Column('tracking_period_end', sa.DATETIME(), nullable=False),
    sa.Column('pricing_excellence_score', sa.FLOAT(), nullable=True),
    sa.Column('service_excellence_score', sa.FLOAT(), nullable=True),
    sa.Column('client_experience_score', sa.FLOAT(), nullable=True),
    sa.Column('business_efficiency_score', sa.FLOAT(), nullable=True),
    sa.Column('professional_growth_score', sa.FLOAT(), nullable=True),
    sa.Column('overall_compliance_score', sa.FLOAT(), nullable=True),
    sa.Column('compliance_grade', sa.VARCHAR(length=5), nullable=True),
    sa.Column('average_service_price', sa.FLOAT(), nullable=True),
    sa.Column('client_retention_rate', sa.FLOAT(), nullable=True),
    sa.Column('premium_service_ratio', sa.FLOAT(), nullable=True),
    sa.Column('client_satisfaction_average', sa.FLOAT(), nullable=True),
    sa.Column('booking_efficiency_score', sa.FLOAT(), nullable=True),
    sa.Column('improvement_from_previous_period', sa.FLOAT(), nullable=True),
    sa.Column('areas_for_improvement', sqlite.JSON(), nullable=True),
    sa.Column('strengths_identified', sqlite.JSON(), nullable=True),
    sa.Column('coaching_recommendations', sqlite.JSON(), nullable=True),
    sa.Column('action_items_completed', sqlite.JSON(), nullable=True),
    sa.Column('next_review_date', sa.DATETIME(), nullable=True),
    sa.Column('created_by_agent_id', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['created_by_agent_id'], ['business_intelligence_agents.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_six_figure_barber_principle_tracking_user_id', 'six_figure_barber_principle_tracking', ['user_id'], unique=False)
    op.create_index('ix_six_figure_barber_principle_tracking_overall_compliance_score', 'six_figure_barber_principle_tracking', ['overall_compliance_score'], unique=False)
    op.create_index('ix_six_figure_barber_principle_tracking_id', 'six_figure_barber_principle_tracking', ['id'], unique=False)
    op.create_table('holiday_calendar',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(), nullable=False),
    sa.Column('holiday_date', sa.DATE(), nullable=False),
    sa.Column('holiday_type', sa.VARCHAR(), nullable=False),
    sa.Column('country_code', sa.VARCHAR(length=2), nullable=True),
    sa.Column('region_code', sa.VARCHAR(length=10), nullable=True),
    sa.Column('location_id', sa.INTEGER(), nullable=True),
    sa.Column('is_recurring', sa.BOOLEAN(), nullable=True),
    sa.Column('recurrence_rule', sa.VARCHAR(), nullable=True),
    sa.Column('affects_appointments', sa.BOOLEAN(), nullable=True),
    sa.Column('affects_availability', sa.BOOLEAN(), nullable=True),
    sa.Column('business_closure', sa.BOOLEAN(), nullable=True),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('created_by_id', sa.INTEGER(), nullable=True),
    sa.ForeignKeyConstraint(['created_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['location_id'], ['barbershop_locations.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_holiday_calendar_id', 'holiday_calendar', ['id'], unique=False)
    op.create_index('ix_holiday_calendar_holiday_date', 'holiday_calendar', ['holiday_date'], unique=False)
    op.create_index('idx_holiday_date_location', 'holiday_calendar', ['holiday_date', 'location_id'], unique=False)
    op.create_table('message_templates',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('template_name', sa.VARCHAR(length=255), nullable=False),
    sa.Column('template_type', sa.VARCHAR(length=100), nullable=False),
    sa.Column('message_channel', sa.VARCHAR(length=50), nullable=False),
    sa.Column('subject_template', sa.TEXT(), nullable=True),
    sa.Column('body_template', sa.TEXT(), nullable=False),
    sa.Column('variables', sqlite.JSON(), nullable=True),
    sa.Column('ai_generated', sa.BOOLEAN(), nullable=True),
    sa.Column('ai_confidence', sa.FLOAT(), nullable=True),
    sa.Column('personalization_factors', sqlite.JSON(), nullable=True),
    sa.Column('usage_count', sa.INTEGER(), nullable=True),
    sa.Column('success_rate', sa.FLOAT(), nullable=True),
    sa.Column('engagement_rate', sa.FLOAT(), nullable=True),
    sa.Column('is_test_variant', sa.BOOLEAN(), nullable=True),
    sa.Column('test_group', sa.VARCHAR(length=50), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_message_templates_id', 'message_templates', ['id'], unique=False)
    op.create_table('product_variants',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('product_id', sa.INTEGER(), nullable=False),
    sa.Column('external_id', sa.VARCHAR(length=255), nullable=True),
    sa.Column('sku', sa.VARCHAR(length=255), nullable=True),
    sa.Column('title', sa.VARCHAR(length=255), nullable=False),
    sa.Column('option1', sa.VARCHAR(length=255), nullable=True),
    sa.Column('option2', sa.VARCHAR(length=255), nullable=True),
    sa.Column('option3', sa.VARCHAR(length=255), nullable=True),
    sa.Column('price', sa.NUMERIC(precision=10, scale=2), nullable=False),
    sa.Column('compare_at_price', sa.NUMERIC(precision=10, scale=2), nullable=True),
    sa.Column('cost_per_item', sa.NUMERIC(precision=10, scale=2), nullable=True),
    sa.Column('weight', sa.NUMERIC(precision=8, scale=2), nullable=True),
    sa.Column('weight_unit', sa.VARCHAR(length=10), nullable=True),
    sa.Column('requires_shipping', sa.BOOLEAN(), nullable=True),
    sa.Column('taxable', sa.BOOLEAN(), nullable=True),
    sa.Column('inventory_quantity', sa.INTEGER(), nullable=True),
    sa.Column('inventory_policy', sa.VARCHAR(length=20), nullable=True),
    sa.Column('fulfillment_service', sa.VARCHAR(length=50), nullable=True),
    sa.Column('available', sa.BOOLEAN(), nullable=True),
    sa.Column('position', sa.INTEGER(), nullable=True),
    sa.Column('shopify_data', sqlite.JSON(), nullable=True),
    sa.Column('barcode', sa.VARCHAR(length=255), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['product_id'], ['products.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_product_variants_sku', 'product_variants', ['sku'], unique=1)
    op.create_index('ix_product_variants_id', 'product_variants', ['id'], unique=False)
    op.create_index('ix_product_variants_external_id', 'product_variants', ['external_id'], unique=False)
    op.create_table('upsell_attempts',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('barber_id', sa.INTEGER(), nullable=False),
    sa.Column('client_id', sa.INTEGER(), nullable=False),
    sa.Column('current_service', sa.VARCHAR(length=255), nullable=False),
    sa.Column('suggested_service', sa.VARCHAR(length=255), nullable=False),
    sa.Column('potential_revenue', sa.NUMERIC(precision=10, scale=2), nullable=False),
    sa.Column('confidence_score', sa.FLOAT(), nullable=False),
    sa.Column('client_tier', sa.VARCHAR(length=50), nullable=True),
    sa.Column('relationship_score', sa.FLOAT(), nullable=True),
    sa.Column('reasons', sqlite.JSON(), nullable=True),
    sa.Column('methodology_alignment', sa.VARCHAR(length=100), nullable=True),
    sa.Column('status', sa.VARCHAR(length=16), nullable=False),
    sa.Column('channel', sa.VARCHAR(length=16), nullable=False),
    sa.Column('implementation_notes', sa.TEXT(), nullable=True),
    sa.Column('automation_triggered', sa.BOOLEAN(), nullable=True),
    sa.Column('opportunity_id', sa.VARCHAR(length=100), nullable=True),
    sa.Column('source_analysis', sqlite.JSON(), nullable=True),
    sa.Column('implemented_at', sa.DATETIME(), nullable=False),
    sa.Column('automation_sent_at', sa.DATETIME(), nullable=True),
    sa.Column('follow_up_completed_at', sa.DATETIME(), nullable=True),
    sa.Column('expires_at', sa.DATETIME(), nullable=True),
    sa.Column('session_id', sa.VARCHAR(length=100), nullable=True),
    sa.Column('device_info', sqlite.JSON(), nullable=True),
    sa.ForeignKeyConstraint(['barber_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['client_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_upsell_attempts_opportunity_id', 'upsell_attempts', ['opportunity_id'], unique=False)
    op.create_index('ix_upsell_attempts_id', 'upsell_attempts', ['id'], unique=False)
    op.create_index('ix_upsell_attempts_client_id', 'upsell_attempts', ['client_id'], unique=False)
    op.create_index('ix_upsell_attempts_barber_id', 'upsell_attempts', ['barber_id'], unique=False)
    op.create_index('idx_upsell_opportunity', 'upsell_attempts', ['opportunity_id'], unique=False)
    op.create_index('idx_upsell_attempt_status', 'upsell_attempts', ['status'], unique=False)
    op.create_index('idx_upsell_attempt_client_date', 'upsell_attempts', ['client_id', 'implemented_at'], unique=False)
    op.create_index('idx_upsell_attempt_barber_date', 'upsell_attempts', ['barber_id', 'implemented_at'], unique=False)
    op.create_table('marketing_campaigns',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(length=100), nullable=False),
    sa.Column('description', sa.VARCHAR(length=500), nullable=True),
    sa.Column('campaign_type', sa.VARCHAR(length=20), nullable=False),
    sa.Column('template_id', sa.INTEGER(), nullable=True),
    sa.Column('subject', sa.VARCHAR(length=200), nullable=True),
    sa.Column('content', sa.TEXT(), nullable=False),
    sa.Column('recipient_list_id', sa.INTEGER(), nullable=True),
    sa.Column('recipient_segment_id', sa.INTEGER(), nullable=True),
    sa.Column('status', sa.VARCHAR(length=20), nullable=True),
    sa.Column('scheduled_for', sa.DATETIME(), nullable=True),
    sa.Column('sent_at', sa.DATETIME(), nullable=True),
    sa.Column('tags', sqlite.JSON(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.Column('created_by_id', sa.INTEGER(), nullable=False),
    sa.ForeignKeyConstraint(['created_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['recipient_list_id'], ['contact_lists.id'], ),
    sa.ForeignKeyConstraint(['recipient_segment_id'], ['contact_segments.id'], ),
    sa.ForeignKeyConstraint(['template_id'], ['marketing_templates.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_marketing_campaigns_id', 'marketing_campaigns', ['id'], unique=False)
    op.create_table('predictive_models',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('model_name', sa.VARCHAR(length=100), nullable=False),
    sa.Column('model_type', sa.VARCHAR(length=50), nullable=False),
    sa.Column('prediction_target', sa.VARCHAR(length=100), nullable=False),
    sa.Column('version', sa.VARCHAR(length=20), nullable=False),
    sa.Column('model_hash', sa.VARCHAR(length=64), nullable=True),
    sa.Column('training_data_size', sa.INTEGER(), nullable=True),
    sa.Column('training_date', sa.DATETIME(), nullable=False),
    sa.Column('training_duration_seconds', sa.INTEGER(), nullable=True),
    sa.Column('accuracy_score', sa.FLOAT(), nullable=True),
    sa.Column('precision_score', sa.FLOAT(), nullable=True),
    sa.Column('recall_score', sa.FLOAT(), nullable=True),
    sa.Column('f1_score', sa.FLOAT(), nullable=True),
    sa.Column('mae', sa.FLOAT(), nullable=True),
    sa.Column('rmse', sa.FLOAT(), nullable=True),
    sa.Column('r2_score', sa.FLOAT(), nullable=True),
    sa.Column('hyperparameters', sqlite.JSON(), nullable=True),
    sa.Column('feature_importance', sqlite.JSON(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=False),
    sa.Column('deployed_at', sa.DATETIME(), nullable=True),
    sa.Column('last_prediction_at', sa.DATETIME(), nullable=True),
    sa.Column('prediction_count', sa.INTEGER(), nullable=False),
    sa.Column('created_at', sa.DATETIME(), nullable=False),
    sa.Column('retired_at', sa.DATETIME(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_predictive_models_model_name', 'predictive_models', ['model_name'], unique=1)
    op.create_index('ix_predictive_models_id', 'predictive_models', ['id'], unique=False)
    op.create_index('idx_model_performance', 'predictive_models', ['prediction_target', 'accuracy_score'], unique=False)
    op.create_index('idx_active_models', 'predictive_models', ['is_active', 'prediction_target'], unique=False)
    op.create_table('six_fb_client_analytics_summaries',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('summary_date', sa.DATE(), nullable=False),
    sa.Column('summary_period', sa.VARCHAR(), nullable=True),
    sa.Column('total_clients', sa.INTEGER(), nullable=True),
    sa.Column('new_clients_acquired', sa.INTEGER(), nullable=True),
    sa.Column('clients_retained', sa.INTEGER(), nullable=True),
    sa.Column('clients_lost', sa.INTEGER(), nullable=True),
    sa.Column('client_growth_rate', sa.FLOAT(), nullable=True),
    sa.Column('premium_vip_clients', sa.INTEGER(), nullable=True),
    sa.Column('core_regular_clients', sa.INTEGER(), nullable=True),
    sa.Column('developing_clients', sa.INTEGER(), nullable=True),
    sa.Column('occasional_clients', sa.INTEGER(), nullable=True),
    sa.Column('at_risk_clients', sa.INTEGER(), nullable=True),
    sa.Column('average_relationship_score', sa.FLOAT(), nullable=True),
    sa.Column('average_engagement_score', sa.FLOAT(), nullable=True),
    sa.Column('average_communication_response_rate', sa.FLOAT(), nullable=True),
    sa.Column('relationship_improvement_rate', sa.FLOAT(), nullable=True),
    sa.Column('total_client_lifetime_value', sa.NUMERIC(precision=12, scale=2), nullable=True),
    sa.Column('average_client_lifetime_value', sa.NUMERIC(precision=10, scale=2), nullable=True),
    sa.Column('revenue_per_client', sa.NUMERIC(precision=8, scale=2), nullable=True),
    sa.Column('client_acquisition_cost', sa.NUMERIC(precision=8, scale=2), nullable=True),
    sa.Column('retention_rate', sa.FLOAT(), nullable=True),
    sa.Column('churn_rate', sa.FLOAT(), nullable=True),
    sa.Column('average_churn_risk_score', sa.FLOAT(), nullable=True),
    sa.Column('clients_at_high_churn_risk', sa.INTEGER(), nullable=True),
    sa.Column('total_communications_sent', sa.INTEGER(), nullable=True),
    sa.Column('total_engagements_generated', sa.INTEGER(), nullable=True),
    sa.Column('communication_effectiveness_score', sa.FLOAT(), nullable=True),
    sa.Column('touchpoint_success_rate', sa.FLOAT(), nullable=True),
    sa.Column('premium_positioning_score', sa.FLOAT(), nullable=True),
    sa.Column('relationship_building_effectiveness', sa.FLOAT(), nullable=True),
    sa.Column('value_creation_success_rate', sa.FLOAT(), nullable=True),
    sa.Column('methodology_alignment_score', sa.FLOAT(), nullable=True),
    sa.Column('automated_workflows_executed', sa.INTEGER(), nullable=True),
    sa.Column('automation_success_rate', sa.FLOAT(), nullable=True),
    sa.Column('time_saved_through_automation_hours', sa.FLOAT(), nullable=True),
    sa.Column('manual_intervention_required', sa.INTEGER(), nullable=True),
    sa.Column('upsell_opportunities_identified', sa.INTEGER(), nullable=True),
    sa.Column('tier_progression_opportunities', sa.INTEGER(), nullable=True),
    sa.Column('referral_potential_score', sa.FLOAT(), nullable=True),
    sa.Column('expansion_revenue_potential', sa.NUMERIC(precision=10, scale=2), nullable=True),
    sa.Column('top_performing_strategies', sqlite.JSON(), nullable=True),
    sa.Column('areas_needing_attention', sqlite.JSON(), nullable=True),
    sa.Column('optimization_opportunities', sqlite.JSON(), nullable=True),
    sa.Column('recommended_actions', sqlite.JSON(), nullable=True),
    sa.Column('calculation_timestamp', sa.DATETIME(), nullable=True),
    sa.Column('data_freshness_score', sa.FLOAT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_six_fb_client_analytics_summaries_user_id', 'six_fb_client_analytics_summaries', ['user_id'], unique=False)
    op.create_index('ix_six_fb_client_analytics_summaries_summary_date', 'six_fb_client_analytics_summaries', ['summary_date'], unique=False)
    op.create_index('ix_six_fb_client_analytics_summaries_id', 'six_fb_client_analytics_summaries', ['id'], unique=False)
    op.create_index('idx_analytics_user_date', 'six_fb_client_analytics_summaries', ['user_id', 'summary_date'], unique=False)
    op.create_index('idx_analytics_period', 'six_fb_client_analytics_summaries', ['summary_period'], unique=False)
    op.create_table('barber_locations',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('barber_id', sa.INTEGER(), nullable=False),
    sa.Column('location_id', sa.INTEGER(), nullable=False),
    sa.Column('is_primary', sa.BOOLEAN(), nullable=True),
    sa.Column('chair_number', sa.VARCHAR(length=50), nullable=True),
    sa.Column('start_date', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('end_date', sa.DATETIME(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.Column('updated_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.ForeignKeyConstraint(['barber_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['location_id'], ['barbershop_locations.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_barber_locations_id', 'barber_locations', ['id'], unique=False)
    op.create_table('agents',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(length=100), nullable=False),
    sa.Column('agent_type', sa.VARCHAR(length=20), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('default_config', sqlite.JSON(), nullable=False),
    sa.Column('prompt_templates', sqlite.JSON(), nullable=False),
    sa.Column('required_permissions', sqlite.JSON(), nullable=True),
    sa.Column('supported_channels', sqlite.JSON(), nullable=True),
    sa.Column('min_interval_hours', sa.INTEGER(), nullable=True),
    sa.Column('max_attempts', sa.INTEGER(), nullable=True),
    sa.Column('base_price', sa.FLOAT(), nullable=True),
    sa.Column('token_rate', sa.FLOAT(), nullable=True),
    sa.Column('success_fee_percent', sa.FLOAT(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('is_premium', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_agents_id', 'agents', ['id'], unique=False)
    op.create_index('ix_agents_agent_type', 'agents', ['agent_type'], unique=False)
    op.create_index('idx_agent_type_active', 'agents', ['agent_type', 'is_active'], unique=False)
    op.create_table('campaign_analytics',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('campaign_id', sa.INTEGER(), nullable=False),
    sa.Column('total_recipients', sa.INTEGER(), nullable=True),
    sa.Column('sent_count', sa.INTEGER(), nullable=True),
    sa.Column('delivered_count', sa.INTEGER(), nullable=True),
    sa.Column('opened_count', sa.INTEGER(), nullable=True),
    sa.Column('clicked_count', sa.INTEGER(), nullable=True),
    sa.Column('bounced_count', sa.INTEGER(), nullable=True),
    sa.Column('unsubscribed_count', sa.INTEGER(), nullable=True),
    sa.Column('spam_reports', sa.INTEGER(), nullable=True),
    sa.Column('first_open_time', sa.DATETIME(), nullable=True),
    sa.Column('last_open_time', sa.DATETIME(), nullable=True),
    sa.Column('device_stats', sqlite.JSON(), nullable=True),
    sa.Column('client_stats', sqlite.JSON(), nullable=True),
    sa.Column('location_stats', sqlite.JSON(), nullable=True),
    sa.Column('link_clicks', sqlite.JSON(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['campaign_id'], ['marketing_campaigns.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('campaign_id')
    )
    op.create_index('ix_campaign_analytics_id', 'campaign_analytics', ['id'], unique=False)
    op.create_table('contact_lists',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(length=100), nullable=False),
    sa.Column('description', sa.VARCHAR(length=500), nullable=True),
    sa.Column('contact_count', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.Column('created_by_id', sa.INTEGER(), nullable=False),
    sa.ForeignKeyConstraint(['created_by_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_contact_lists_id', 'contact_lists', ['id'], unique=False)
    op.create_table('weather_data',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('location_name', sa.VARCHAR(length=255), nullable=False),
    sa.Column('latitude', sa.FLOAT(), nullable=True),
    sa.Column('longitude', sa.FLOAT(), nullable=True),
    sa.Column('zip_code', sa.VARCHAR(length=20), nullable=True),
    sa.Column('condition', sa.VARCHAR(length=12), nullable=False),
    sa.Column('temperature', sa.FLOAT(), nullable=True),
    sa.Column('humidity', sa.FLOAT(), nullable=True),
    sa.Column('wind_speed', sa.FLOAT(), nullable=True),
    sa.Column('precipitation_chance', sa.FLOAT(), nullable=True),
    sa.Column('precipitation_amount', sa.FLOAT(), nullable=True),
    sa.Column('comfort_index', sa.FLOAT(), nullable=True),
    sa.Column('travel_difficulty', sa.FLOAT(), nullable=True),
    sa.Column('appointment_impact_score', sa.FLOAT(), nullable=True),
    sa.Column('data_source', sa.VARCHAR(length=100), nullable=True),
    sa.Column('data_quality', sa.FLOAT(), nullable=True),
    sa.Column('is_forecast', sa.BOOLEAN(), nullable=True),
    sa.Column('recorded_at', sa.DATETIME(), nullable=False),
    sa.Column('forecast_for', sa.DATETIME(), nullable=True),
    sa.Column('valid_until', sa.DATETIME(), nullable=True),
    sa.Column('processed_by_ai', sa.BOOLEAN(), nullable=True),
    sa.Column('ai_analysis', sqlite.JSON(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_weather_data_id', 'weather_data', ['id'], unique=False)
    op.create_table('gamification_analytics',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=True),
    sa.Column('analytics_date', sa.DATE(), nullable=False),
    sa.Column('period_type', sa.VARCHAR(), nullable=True),
    sa.Column('achievements_unlocked_count', sa.INTEGER(), nullable=True),
    sa.Column('total_xp_earned', sa.INTEGER(), nullable=True),
    sa.Column('challenges_participated', sa.INTEGER(), nullable=True),
    sa.Column('challenges_completed', sa.INTEGER(), nullable=True),
    sa.Column('level_progression', sa.FLOAT(), nullable=True),
    sa.Column('tier_advancement_progress', sa.FLOAT(), nullable=True),
    sa.Column('milestone_achievements', sa.INTEGER(), nullable=True),
    sa.Column('session_engagement_score', sa.FLOAT(), nullable=True),
    sa.Column('feature_adoption_rate', sa.FLOAT(), nullable=True),
    sa.Column('competitive_participation', sa.FLOAT(), nullable=True),
    sa.Column('social_sharing_activity', sa.INTEGER(), nullable=True),
    sa.Column('revenue_correlation', sa.FLOAT(), nullable=True),
    sa.Column('efficiency_correlation', sa.FLOAT(), nullable=True),
    sa.Column('client_satisfaction_correlation', sa.FLOAT(), nullable=True),
    sa.Column('retention_impact', sa.FLOAT(), nullable=True),
    sa.Column('methodology_engagement_score', sa.FLOAT(), nullable=True),
    sa.Column('principle_focus_distribution', sqlite.JSON(), nullable=True),
    sa.Column('coaching_goal_alignment', sa.FLOAT(), nullable=True),
    sa.Column('achievement_category_breakdown', sqlite.JSON(), nullable=True),
    sa.Column('xp_source_breakdown', sqlite.JSON(), nullable=True),
    sa.Column('time_of_day_activity', sqlite.JSON(), nullable=True),
    sa.Column('device_usage_patterns', sqlite.JSON(), nullable=True),
    sa.Column('predicted_next_achievements', sqlite.JSON(), nullable=True),
    sa.Column('engagement_trend_prediction', sa.FLOAT(), nullable=True),
    sa.Column('churn_risk_indicators', sqlite.JSON(), nullable=True),
    sa.Column('optimization_opportunities', sqlite.JSON(), nullable=True),
    sa.Column('calculated_at', sa.DATETIME(), nullable=True),
    sa.Column('data_freshness_score', sa.FLOAT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_gamification_analytics_id', 'gamification_analytics', ['id'], unique=False)
    op.create_table('marketing_usage',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('period_start', sa.DATE(), nullable=False),
    sa.Column('period_end', sa.DATE(), nullable=False),
    sa.Column('emails_sent', sa.INTEGER(), nullable=True),
    sa.Column('email_limit', sa.INTEGER(), nullable=True),
    sa.Column('sms_sent', sa.INTEGER(), nullable=True),
    sa.Column('sms_limit', sa.INTEGER(), nullable=True),
    sa.Column('campaigns_created', sa.INTEGER(), nullable=True),
    sa.Column('campaigns_sent', sa.INTEGER(), nullable=True),
    sa.Column('total_contacts', sa.INTEGER(), nullable=True),
    sa.Column('new_contacts', sa.INTEGER(), nullable=True),
    sa.Column('unsubscribed_contacts', sa.INTEGER(), nullable=True),
    sa.Column('estimated_cost', sa.FLOAT(), nullable=True),
    sa.Column('cost_breakdown', sqlite.JSON(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_marketing_usage_id', 'marketing_usage', ['id'], unique=False)
    op.create_index('idx_usage_period_unique', 'marketing_usage', ['period_start', 'period_end'], unique=1)
    op.create_table('recurring_appointment_patterns',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('barber_id', sa.INTEGER(), nullable=True),
    sa.Column('client_id', sa.INTEGER(), nullable=True),
    sa.Column('service_id', sa.INTEGER(), nullable=True),
    sa.Column('location_id', sa.INTEGER(), nullable=True),
    sa.Column('pattern_type', sa.VARCHAR(), nullable=False),
    sa.Column('interval_value', sa.INTEGER(), nullable=True),
    sa.Column('interval_unit', sa.VARCHAR(), nullable=True),
    sa.Column('days_of_week', sqlite.JSON(), nullable=True),
    sa.Column('day_of_month', sa.INTEGER(), nullable=True),
    sa.Column('week_of_month', sa.INTEGER(), nullable=True),
    sa.Column('weekday_of_month', sa.INTEGER(), nullable=True),
    sa.Column('preferred_time', sa.TIME(), nullable=False),
    sa.Column('duration_minutes', sa.INTEGER(), nullable=False),
    sa.Column('buffer_time_before', sa.INTEGER(), nullable=True),
    sa.Column('buffer_time_after', sa.INTEGER(), nullable=True),
    sa.Column('start_date', sa.DATE(), nullable=False),
    sa.Column('end_date', sa.DATE(), nullable=True),
    sa.Column('occurrences', sa.INTEGER(), nullable=True),
    sa.Column('exclude_holidays', sa.BOOLEAN(), nullable=True),
    sa.Column('exclude_weekends', sa.BOOLEAN(), nullable=True),
    sa.Column('reschedule_on_conflict', sa.BOOLEAN(), nullable=True),
    sa.Column('max_advance_days', sa.INTEGER(), nullable=True),
    sa.Column('series_discount_percent', sa.FLOAT(), nullable=True),
    sa.Column('series_price_override', sa.FLOAT(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('last_generated_date', sa.DATE(), nullable=True),
    sa.Column('total_generated', sa.INTEGER(), nullable=True),
    sa.Column('total_completed', sa.INTEGER(), nullable=True),
    sa.Column('generation_notes', sa.TEXT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['barber_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['client_id'], ['clients.id'], ),
    sa.ForeignKeyConstraint(['location_id'], ['barbershop_locations.id'], ),
    sa.ForeignKeyConstraint(['service_id'], ['services.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_recurring_appointment_patterns_id', 'recurring_appointment_patterns', ['id'], unique=False)
    op.create_table('service_package_items',
    sa.Column('package_id', sa.INTEGER(), nullable=False),
    sa.Column('service_id', sa.INTEGER(), nullable=False),
    sa.Column('quantity', sa.INTEGER(), nullable=True),
    sa.Column('order', sa.INTEGER(), nullable=True),
    sa.ForeignKeyConstraint(['package_id'], ['services.id'], ),
    sa.ForeignKeyConstraint(['service_id'], ['services.id'], ),
    sa.PrimaryKeyConstraint('package_id', 'service_id')
    )
    op.create_table('ai_insights_cache',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=True),
    sa.Column('insight_type', sa.VARCHAR(length=50), nullable=False),
    sa.Column('business_segment', sa.VARCHAR(length=50), nullable=True),
    sa.Column('title', sa.VARCHAR(length=200), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=False),
    sa.Column('insight_data', sqlite.JSON(), nullable=False),
    sa.Column('confidence_score', sa.FLOAT(), nullable=False),
    sa.Column('data_freshness_score', sa.FLOAT(), nullable=False),
    sa.Column('statistical_significance', sa.FLOAT(), nullable=True),
    sa.Column('action_items', sqlite.JSON(), nullable=True),
    sa.Column('estimated_impact', sa.VARCHAR(length=20), nullable=True),
    sa.Column('priority_score', sa.INTEGER(), nullable=False),
    sa.Column('created_at', sa.DATETIME(), nullable=False),
    sa.Column('updated_at', sa.DATETIME(), nullable=False),
    sa.Column('expires_at', sa.DATETIME(), nullable=False),
    sa.Column('is_active', sa.BOOLEAN(), nullable=False),
    sa.Column('view_count', sa.INTEGER(), nullable=False),
    sa.Column('last_viewed_at', sa.DATETIME(), nullable=True),
    sa.Column('user_rating', sa.INTEGER(), nullable=True),
    sa.Column('user_feedback', sa.TEXT(), nullable=True),
    sa.Column('dismissed_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_ai_insights_cache_user_id', 'ai_insights_cache', ['user_id'], unique=False)
    op.create_index('ix_ai_insights_cache_is_active', 'ai_insights_cache', ['is_active'], unique=False)
    op.create_index('ix_ai_insights_cache_insight_type', 'ai_insights_cache', ['insight_type'], unique=False)
    op.create_index('ix_ai_insights_cache_id', 'ai_insights_cache', ['id'], unique=False)
    op.create_index('ix_ai_insights_cache_expires_at', 'ai_insights_cache', ['expires_at'], unique=False)
    op.create_index('ix_ai_insights_cache_business_segment', 'ai_insights_cache', ['business_segment'], unique=False)
    op.create_index('idx_user_insights', 'ai_insights_cache', ['user_id', 'is_active', 'expires_at'], unique=False)
    op.create_index('idx_priority', 'ai_insights_cache', ['priority_score', 'is_active', 'expires_at'], unique=False)
    op.create_index('idx_insight_type', 'ai_insights_cache', ['insight_type', 'is_active'], unique=False)
    op.create_index('idx_expiry_cleanup', 'ai_insights_cache', ['expires_at', 'is_active'], unique=False)
    op.create_table('agent_instances',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('agent_id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('location_id', sa.INTEGER(), nullable=True),
    sa.Column('name', sa.VARCHAR(length=100), nullable=False),
    sa.Column('config', sqlite.JSON(), nullable=False),
    sa.Column('schedule_config', sqlite.JSON(), nullable=True),
    sa.Column('status', sa.VARCHAR(length=8), nullable=True),
    sa.Column('last_run_at', sa.DATETIME(), nullable=True),
    sa.Column('next_run_at', sa.DATETIME(), nullable=True),
    sa.Column('error_count', sa.INTEGER(), nullable=True),
    sa.Column('last_error', sa.TEXT(), nullable=True),
    sa.Column('total_conversations', sa.INTEGER(), nullable=True),
    sa.Column('successful_conversations', sa.INTEGER(), nullable=True),
    sa.Column('total_revenue_generated', sa.FLOAT(), nullable=True),
    sa.Column('activated_at', sa.DATETIME(), nullable=True),
    sa.Column('deactivated_at', sa.DATETIME(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['agent_id'], ['agents.id'], ),
    sa.ForeignKeyConstraint(['location_id'], ['barbershop_locations.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_agent_instances_status', 'agent_instances', ['status'], unique=False)
    op.create_index('ix_agent_instances_id', 'agent_instances', ['id'], unique=False)
    op.create_index('idx_agent_instance_user_status', 'agent_instances', ['user_id', 'status'], unique=False)
    op.create_index('idx_agent_instance_next_run', 'agent_instances', ['next_run_at', 'status'], unique=False)
    op.create_table('franchise_groups',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('region_id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(length=255), nullable=False),
    sa.Column('code', sa.VARCHAR(length=20), nullable=False),
    sa.Column('group_type', sa.VARCHAR(length=50), nullable=False),
    sa.Column('franchisee_id', sa.INTEGER(), nullable=True),
    sa.Column('corporate_manager_id', sa.INTEGER(), nullable=True),
    sa.Column('territory_definition', sqlite.JSON(), nullable=True),
    sa.Column('development_rights', sqlite.JSON(), nullable=True),
    sa.Column('exclusivity_agreements', sqlite.JSON(), nullable=True),
    sa.Column('shared_resources', sqlite.JSON(), nullable=True),
    sa.Column('cross_training_programs', sqlite.JSON(), nullable=True),
    sa.Column('group_purchasing_agreements', sqlite.JSON(), nullable=True),
    sa.Column('standardization_requirements', sqlite.JSON(), nullable=True),
    sa.Column('quality_assurance_protocols', sqlite.JSON(), nullable=True),
    sa.Column('cross_location_metrics', sqlite.JSON(), nullable=True),
    sa.Column('revenue_sharing_model', sqlite.JSON(), nullable=True),
    sa.Column('cost_sharing_agreements', sqlite.JSON(), nullable=True),
    sa.Column('group_financial_targets', sqlite.JSON(), nullable=True),
    sa.Column('status', sa.VARCHAR(length=11), nullable=True),
    sa.Column('formation_date', sa.DATETIME(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['corporate_manager_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['franchisee_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['region_id'], ['franchise_regions.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_franchise_groups_id', 'franchise_groups', ['id'], unique=False)
    op.create_index('ix_franchise_groups_code', 'franchise_groups', ['code'], unique=False)
    op.create_index('idx_franchise_group_type', 'franchise_groups', ['group_type'], unique=False)
    op.create_index('idx_franchise_group_region_status', 'franchise_groups', ['region_id', 'status'], unique=False)
    op.create_index('idx_franchise_group_franchisee', 'franchise_groups', ['franchisee_id'], unique=False)
    op.create_table('guest_bookings',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('guest_name', sa.VARCHAR(), nullable=False),
    sa.Column('guest_email', sa.VARCHAR(), nullable=False),
    sa.Column('guest_phone', sa.VARCHAR(), nullable=False),
    sa.Column('organization_id', sa.INTEGER(), nullable=False),
    sa.Column('barber_id', sa.INTEGER(), nullable=True),
    sa.Column('service_id', sa.INTEGER(), nullable=False),
    sa.Column('appointment_datetime', sa.DATETIME(), nullable=False),
    sa.Column('appointment_timezone', sa.VARCHAR(length=50), nullable=False),
    sa.Column('duration_minutes', sa.INTEGER(), nullable=False),
    sa.Column('service_price', sa.FLOAT(), nullable=False),
    sa.Column('deposit_amount', sa.FLOAT(), nullable=True),
    sa.Column('status', sa.VARCHAR(), nullable=True),
    sa.Column('confirmation_code', sa.VARCHAR(), nullable=True),
    sa.Column('payment_intent_id', sa.VARCHAR(), nullable=True),
    sa.Column('payment_status', sa.VARCHAR(), nullable=True),
    sa.Column('converted_to_user_id', sa.INTEGER(), nullable=True),
    sa.Column('converted_to_appointment_id', sa.INTEGER(), nullable=True),
    sa.Column('conversion_date', sa.DATETIME(), nullable=True),
    sa.Column('referral_source', sa.VARCHAR(), nullable=True),
    sa.Column('booking_page_url', sa.VARCHAR(), nullable=True),
    sa.Column('user_agent', sa.TEXT(), nullable=True),
    sa.Column('ip_address', sa.VARCHAR(), nullable=True),
    sa.Column('notes', sa.TEXT(), nullable=True),
    sa.Column('marketing_consent', sa.BOOLEAN(), nullable=True),
    sa.Column('reminder_preference', sa.VARCHAR(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['barber_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['converted_to_appointment_id'], ['appointments.id'], ),
    sa.ForeignKeyConstraint(['converted_to_user_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['organization_id'], ['organizations.id'], ),
    sa.ForeignKeyConstraint(['service_id'], ['services.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_guest_bookings_id', 'guest_bookings', ['id'], unique=False)
    op.create_index('ix_guest_bookings_guest_name', 'guest_bookings', ['guest_name'], unique=False)
    op.create_index('ix_guest_bookings_guest_email', 'guest_bookings', ['guest_email'], unique=False)
    op.create_index('ix_guest_bookings_created_at', 'guest_bookings', ['created_at'], unique=False)
    op.create_index('ix_guest_bookings_confirmation_code', 'guest_bookings', ['confirmation_code'], unique=1)
    op.create_index('idx_status_org', 'guest_bookings', ['status', 'organization_id'], unique=False)
    op.create_index('idx_guest_phone_org', 'guest_bookings', ['guest_phone', 'organization_id'], unique=False)
    op.create_index('idx_guest_email_org', 'guest_bookings', ['guest_email', 'organization_id'], unique=False)
    op.create_index('idx_appointment_date_org', 'guest_bookings', ['appointment_datetime', 'organization_id'], unique=False)
    op.create_table('orders',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('external_id', sa.VARCHAR(length=255), nullable=True),
    sa.Column('order_number', sa.VARCHAR(length=255), nullable=False),
    sa.Column('customer_id', sa.INTEGER(), nullable=True),
    sa.Column('customer_email', sa.VARCHAR(length=255), nullable=True),
    sa.Column('customer_phone', sa.VARCHAR(length=50), nullable=True),
    sa.Column('source', sa.VARCHAR(length=7), nullable=False),
    sa.Column('status', sa.VARCHAR(length=10), nullable=True),
    sa.Column('financial_status', sa.VARCHAR(length=50), nullable=True),
    sa.Column('fulfillment_status', sa.VARCHAR(length=50), nullable=True),
    sa.Column('subtotal', sa.NUMERIC(precision=10, scale=2), nullable=False),
    sa.Column('tax_amount', sa.NUMERIC(precision=10, scale=2), nullable=False),
    sa.Column('shipping_amount', sa.NUMERIC(precision=10, scale=2), nullable=False),
    sa.Column('discount_amount', sa.NUMERIC(precision=10, scale=2), nullable=False),
    sa.Column('total_amount', sa.NUMERIC(precision=10, scale=2), nullable=False),
    sa.Column('currency', sa.VARCHAR(length=3), nullable=True),
    sa.Column('location_id', sa.INTEGER(), nullable=True),
    sa.Column('processed_by', sa.INTEGER(), nullable=True),
    sa.Column('commission_barber_id', sa.INTEGER(), nullable=True),
    sa.Column('shipping_address', sqlite.JSON(), nullable=True),
    sa.Column('billing_address', sqlite.JSON(), nullable=True),
    sa.Column('shipping_method', sa.VARCHAR(length=100), nullable=True),
    sa.Column('tracking_number', sa.VARCHAR(length=255), nullable=True),
    sa.Column('payment_gateway', sa.VARCHAR(length=50), nullable=True),
    sa.Column('payment_reference', sa.VARCHAR(length=255), nullable=True),
    sa.Column('shopify_data', sqlite.JSON(), nullable=True),
    sa.Column('notes', sa.TEXT(), nullable=True),
    sa.Column('tags', sqlite.JSON(), nullable=True),
    sa.Column('ordered_at', sa.DATETIME(), nullable=True),
    sa.Column('processed_at', sa.DATETIME(), nullable=True),
    sa.Column('fulfilled_at', sa.DATETIME(), nullable=True),
    sa.Column('cancelled_at', sa.DATETIME(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['commission_barber_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['customer_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['location_id'], ['barbershop_locations.id'], ),
    sa.ForeignKeyConstraint(['processed_by'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_orders_order_number', 'orders', ['order_number'], unique=1)
    op.create_index('ix_orders_id', 'orders', ['id'], unique=False)
    op.create_index('ix_orders_external_id', 'orders', ['external_id'], unique=False)
    op.create_table('booking_settings',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('business_id', sa.INTEGER(), nullable=True),
    sa.Column('business_name', sa.VARCHAR(), nullable=True),
    sa.Column('business_phone', sa.VARCHAR(), nullable=True),
    sa.Column('business_timezone', sa.VARCHAR(length=50), nullable=True),
    sa.Column('default_user_timezone', sa.VARCHAR(length=50), nullable=True),
    sa.Column('allowed_timezones', sqlite.JSON(), nullable=True),
    sa.Column('timezone_auto_detect', sa.BOOLEAN(), nullable=True),
    sa.Column('min_lead_time_minutes', sa.INTEGER(), nullable=True),
    sa.Column('max_advance_days', sa.INTEGER(), nullable=True),
    sa.Column('same_day_cutoff_time', sa.TIME(), nullable=True),
    sa.Column('business_start_time', sa.TIME(), nullable=True),
    sa.Column('business_end_time', sa.TIME(), nullable=True),
    sa.Column('slot_duration_minutes', sa.INTEGER(), nullable=True),
    sa.Column('show_soonest_available', sa.BOOLEAN(), nullable=True),
    sa.Column('allow_same_day_booking', sa.BOOLEAN(), nullable=True),
    sa.Column('require_advance_booking', sa.BOOLEAN(), nullable=True),
    sa.Column('business_type', sa.VARCHAR(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_booking_settings_id', 'booking_settings', ['id'], unique=False)
    op.create_table('franchise_networks',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(length=255), nullable=False),
    sa.Column('legal_name', sa.VARCHAR(length=255), nullable=False),
    sa.Column('brand', sa.VARCHAR(length=100), nullable=False),
    sa.Column('network_type', sa.VARCHAR(length=16), nullable=False),
    sa.Column('parent_network_id', sa.INTEGER(), nullable=True),
    sa.Column('corporate_headquarters', sqlite.JSON(), nullable=True),
    sa.Column('primary_contact_info', sqlite.JSON(), nullable=True),
    sa.Column('legal_structure', sa.VARCHAR(length=100), nullable=True),
    sa.Column('total_locations_target', sa.INTEGER(), nullable=True),
    sa.Column('current_locations_count', sa.INTEGER(), nullable=True),
    sa.Column('territory_coverage', sqlite.JSON(), nullable=True),
    sa.Column('franchise_fee_structure', sqlite.JSON(), nullable=True),
    sa.Column('revenue_sharing_model', sqlite.JSON(), nullable=True),
    sa.Column('compliance_requirements', sqlite.JSON(), nullable=True),
    sa.Column('governance_policies', sqlite.JSON(), nullable=True),
    sa.Column('status', sa.VARCHAR(length=11), nullable=True),
    sa.Column('established_date', sa.DATETIME(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['parent_network_id'], ['franchise_networks.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_franchise_networks_name', 'franchise_networks', ['name'], unique=False)
    op.create_index('ix_franchise_networks_id', 'franchise_networks', ['id'], unique=False)
    op.create_index('ix_franchise_networks_brand', 'franchise_networks', ['brand'], unique=False)
    op.create_index('idx_franchise_network_type', 'franchise_networks', ['network_type'], unique=False)
    op.create_index('idx_franchise_network_brand_status', 'franchise_networks', ['brand', 'status'], unique=False)
    op.create_table('idempotency_keys',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('key', sa.VARCHAR(length=255), nullable=False),
    sa.Column('operation_type', sa.VARCHAR(length=100), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=True),
    sa.Column('request_hash', sa.VARCHAR(length=64), nullable=False),
    sa.Column('response_data', sqlite.JSON(), nullable=False),
    sa.Column('created_at', sa.DATETIME(), nullable=False),
    sa.Column('expires_at', sa.DATETIME(), nullable=False),
    sa.Column('operation_metadata', sqlite.JSON(), nullable=True),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('key', name='uq_idempotency_key')
    )
    op.create_index('ix_idempotency_operation_user', 'idempotency_keys', ['operation_type', 'user_id'], unique=False)
    op.create_index('ix_idempotency_keys_user_id', 'idempotency_keys', ['user_id'], unique=False)
    op.create_index('ix_idempotency_keys_operation_type', 'idempotency_keys', ['operation_type'], unique=False)
    op.create_index('ix_idempotency_keys_key', 'idempotency_keys', ['key'], unique=1)
    op.create_index('ix_idempotency_keys_id', 'idempotency_keys', ['id'], unique=False)
    op.create_index('ix_idempotency_keys_expires_at', 'idempotency_keys', ['expires_at'], unique=False)
    op.create_index('ix_idempotency_expires_created', 'idempotency_keys', ['expires_at', 'created_at'], unique=False)
    op.create_table('upsell_conversions',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('attempt_id', sa.INTEGER(), nullable=False),
    sa.Column('converted', sa.BOOLEAN(), nullable=False),
    sa.Column('conversion_channel', sa.VARCHAR(length=16), nullable=True),
    sa.Column('actual_service_booked', sa.VARCHAR(length=255), nullable=True),
    sa.Column('actual_revenue', sa.NUMERIC(precision=10, scale=2), nullable=True),
    sa.Column('revenue_difference', sa.NUMERIC(precision=10, scale=2), nullable=True),
    sa.Column('appointment_id', sa.INTEGER(), nullable=True),
    sa.Column('booking_date', sa.DATETIME(), nullable=True),
    sa.Column('service_date', sa.DATETIME(), nullable=True),
    sa.Column('client_satisfaction_score', sa.FLOAT(), nullable=True),
    sa.Column('relationship_improvement', sa.FLOAT(), nullable=True),
    sa.Column('retention_impact', sa.VARCHAR(length=50), nullable=True),
    sa.Column('time_to_conversion', sa.INTEGER(), nullable=True),
    sa.Column('touches_required', sa.INTEGER(), nullable=True),
    sa.Column('client_feedback', sa.TEXT(), nullable=True),
    sa.Column('conversion_notes', sa.TEXT(), nullable=True),
    sa.Column('barber_insights', sa.TEXT(), nullable=True),
    sa.Column('converted_at', sa.DATETIME(), nullable=True),
    sa.Column('recorded_at', sa.DATETIME(), nullable=False),
    sa.ForeignKeyConstraint(['appointment_id'], ['appointments.id'], ),
    sa.ForeignKeyConstraint(['attempt_id'], ['upsell_attempts.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_upsell_conversions_id', 'upsell_conversions', ['id'], unique=False)
    op.create_index('ix_upsell_conversions_attempt_id', 'upsell_conversions', ['attempt_id'], unique=False)
    op.create_index('ix_upsell_conversions_appointment_id', 'upsell_conversions', ['appointment_id'], unique=False)
    op.create_index('idx_conversion_success', 'upsell_conversions', ['converted'], unique=False)
    op.create_index('idx_conversion_date', 'upsell_conversions', ['converted_at'], unique=False)
    op.create_index('idx_conversion_attempt', 'upsell_conversions', ['attempt_id'], unique=False)
    op.create_index('idx_conversion_appointment', 'upsell_conversions', ['appointment_id'], unique=False)
    op.create_table('chair_inventory',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('location_id', sa.INTEGER(), nullable=False),
    sa.Column('chair_number', sa.VARCHAR(length=50), nullable=False),
    sa.Column('chair_type', sa.VARCHAR(length=13), nullable=False),
    sa.Column('status', sa.VARCHAR(length=11), nullable=False),
    sa.Column('assigned_barber_id', sa.INTEGER(), nullable=True),
    sa.Column('assignment_start', sa.DATETIME(), nullable=True),
    sa.Column('assignment_end', sa.DATETIME(), nullable=True),
    sa.Column('rental_rate_weekly', sa.FLOAT(), nullable=True),
    sa.Column('rental_rate_monthly', sa.FLOAT(), nullable=True),
    sa.Column('last_payment_date', sa.DATETIME(), nullable=True),
    sa.Column('next_payment_due', sa.DATETIME(), nullable=True),
    sa.Column('features', sqlite.JSON(), nullable=True),
    sa.Column('equipment', sqlite.JSON(), nullable=True),
    sa.Column('total_appointments_today', sa.INTEGER(), nullable=True),
    sa.Column('total_appointments_week', sa.INTEGER(), nullable=True),
    sa.Column('total_appointments_month', sa.INTEGER(), nullable=True),
    sa.Column('last_appointment_time', sa.DATETIME(), nullable=True),
    sa.Column('revenue_today', sa.FLOAT(), nullable=True),
    sa.Column('revenue_week', sa.FLOAT(), nullable=True),
    sa.Column('revenue_month', sa.FLOAT(), nullable=True),
    sa.Column('last_maintenance_date', sa.DATETIME(), nullable=True),
    sa.Column('next_maintenance_due', sa.DATETIME(), nullable=True),
    sa.Column('maintenance_notes', sa.VARCHAR(length=500), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.Column('updated_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.ForeignKeyConstraint(['assigned_barber_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['location_id'], ['barbershop_locations.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_chair_inventory_id', 'chair_inventory', ['id'], unique=False)
    op.create_table('ai_performance_metrics',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('date', sa.DATETIME(), nullable=False),
    sa.Column('period_type', sa.VARCHAR(length=20), nullable=True),
    sa.Column('opportunities_identified', sa.INTEGER(), nullable=True),
    sa.Column('opportunities_executed', sa.INTEGER(), nullable=True),
    sa.Column('conversions_achieved', sa.INTEGER(), nullable=True),
    sa.Column('total_revenue_generated', sa.FLOAT(), nullable=True),
    sa.Column('confidence_accuracy', sa.FLOAT(), nullable=True),
    sa.Column('personality_detection_accuracy', sa.FLOAT(), nullable=True),
    sa.Column('timing_optimization_accuracy', sa.FLOAT(), nullable=True),
    sa.Column('channel_selection_accuracy', sa.FLOAT(), nullable=True),
    sa.Column('new_patterns_discovered', sa.INTEGER(), nullable=True),
    sa.Column('patterns_refined', sa.INTEGER(), nullable=True),
    sa.Column('memory_records_created', sa.INTEGER(), nullable=True),
    sa.Column('avg_response_time_ms', sa.FLOAT(), nullable=True),
    sa.Column('cpu_usage_percent', sa.FLOAT(), nullable=True),
    sa.Column('memory_usage_mb', sa.FLOAT(), nullable=True),
    sa.Column('agent_version', sa.VARCHAR(length=20), nullable=True),
    sa.Column('model_version', sa.VARCHAR(length=50), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_ai_performance_metrics_id', 'ai_performance_metrics', ['id'], unique=False)
    op.create_index('ix_ai_performance_metrics_date', 'ai_performance_metrics', ['date'], unique=False)
    op.create_table('contact_segments',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(length=100), nullable=False),
    sa.Column('description', sa.VARCHAR(length=500), nullable=True),
    sa.Column('criteria', sqlite.JSON(), nullable=False),
    sa.Column('contact_count', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.Column('created_by_id', sa.INTEGER(), nullable=False),
    sa.ForeignKeyConstraint(['created_by_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_contact_segments_id', 'contact_segments', ['id'], unique=False)
    op.create_table('client_sentiments',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('message_id', sa.VARCHAR(length=100), nullable=True),
    sa.Column('conversation_id', sa.VARCHAR(length=100), nullable=True),
    sa.Column('sentiment_score', sa.FLOAT(), nullable=False),
    sa.Column('sentiment_label', sa.VARCHAR(length=50), nullable=False),
    sa.Column('confidence', sa.FLOAT(), nullable=False),
    sa.Column('detected_intent', sa.VARCHAR(length=19), nullable=True),
    sa.Column('intent_confidence', sa.FLOAT(), nullable=True),
    sa.Column('message_text', sa.TEXT(), nullable=False),
    sa.Column('message_channel', sa.VARCHAR(length=50), nullable=False),
    sa.Column('appointment_id', sa.INTEGER(), nullable=True),
    sa.Column('interaction_type', sa.VARCHAR(length=100), nullable=True),
    sa.Column('ai_provider', sa.VARCHAR(length=100), nullable=True),
    sa.Column('ai_model', sa.VARCHAR(length=100), nullable=True),
    sa.Column('processing_time_ms', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('analyzed_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['appointment_id'], ['appointments.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_client_sentiments_id', 'client_sentiments', ['id'], unique=False)
    op.create_table('six_fb_client_journeys',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('client_id', sa.INTEGER(), nullable=False),
    sa.Column('current_stage', sa.VARCHAR(), nullable=False),
    sa.Column('stage_entry_date', sa.DATE(), nullable=False),
    sa.Column('days_in_current_stage', sa.INTEGER(), nullable=True),
    sa.Column('journey_history', sqlite.JSON(), nullable=True),
    sa.Column('milestone_achievements', sqlite.JSON(), nullable=True),
    sa.Column('next_expected_milestone', sqlite.JSON(), nullable=True),
    sa.Column('relationship_building_score', sa.FLOAT(), nullable=True),
    sa.Column('value_creation_opportunities', sqlite.JSON(), nullable=True),
    sa.Column('premium_positioning_readiness', sa.FLOAT(), nullable=True),
    sa.Column('last_interaction_date', sa.DATE(), nullable=True),
    sa.Column('interaction_frequency', sa.FLOAT(), nullable=True),
    sa.Column('engagement_quality_score', sa.FLOAT(), nullable=True),
    sa.Column('conversion_events', sqlite.JSON(), nullable=True),
    sa.Column('retention_indicators', sqlite.JSON(), nullable=True),
    sa.Column('advocacy_actions', sqlite.JSON(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['client_id'], ['clients.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_six_fb_client_journeys_user_id', 'six_fb_client_journeys', ['user_id'], unique=False)
    op.create_index('ix_six_fb_client_journeys_id', 'six_fb_client_journeys', ['id'], unique=False)
    op.create_index('ix_six_fb_client_journeys_current_stage', 'six_fb_client_journeys', ['current_stage'], unique=False)
    op.create_index('ix_six_fb_client_journeys_client_id', 'six_fb_client_journeys', ['client_id'], unique=False)
    op.create_table('email_ab_tests',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(length=255), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('base_template_name', sa.VARCHAR(length=100), nullable=False),
    sa.Column('test_type', sa.VARCHAR(length=50), nullable=False),
    sa.Column('variants', sqlite.JSON(), nullable=False),
    sa.Column('traffic_split', sqlite.JSON(), nullable=False),
    sa.Column('sample_size', sa.INTEGER(), nullable=True),
    sa.Column('confidence_level', sa.FLOAT(), nullable=True),
    sa.Column('minimum_effect_size', sa.FLOAT(), nullable=True),
    sa.Column('status', sa.VARCHAR(length=20), nullable=True),
    sa.Column('winner_variant', sa.VARCHAR(length=10), nullable=True),
    sa.Column('winner_confidence', sa.FLOAT(), nullable=True),
    sa.Column('start_time', sa.DATETIME(), nullable=True),
    sa.Column('end_time', sa.DATETIME(), nullable=True),
    sa.Column('max_duration_hours', sa.INTEGER(), nullable=True),
    sa.Column('primary_metric', sa.VARCHAR(length=50), nullable=False),
    sa.Column('secondary_metrics', sqlite.JSON(), nullable=True),
    sa.Column('results', sqlite.JSON(), nullable=True),
    sa.Column('created_by_id', sa.INTEGER(), nullable=False),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['created_by_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_email_ab_tests_id', 'email_ab_tests', ['id'], unique=False)
    op.create_table('contact_list_members',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('list_id', sa.INTEGER(), nullable=False),
    sa.Column('contact_id', sa.INTEGER(), nullable=False),
    sa.Column('added_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['contact_id'], ['clients.id'], ),
    sa.ForeignKeyConstraint(['list_id'], ['contact_lists.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_contact_list_members_id', 'contact_list_members', ['id'], unique=False)
    op.create_index('idx_list_contact_unique', 'contact_list_members', ['list_id', 'contact_id'], unique=1)
    op.create_table('organizations',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(length=255), nullable=False),
    sa.Column('slug', sa.VARCHAR(length=100), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('street_address', sa.VARCHAR(length=255), nullable=True),
    sa.Column('city', sa.VARCHAR(length=100), nullable=True),
    sa.Column('state', sa.VARCHAR(length=50), nullable=True),
    sa.Column('zip_code', sa.VARCHAR(length=20), nullable=True),
    sa.Column('country', sa.VARCHAR(length=50), nullable=True),
    sa.Column('phone', sa.VARCHAR(length=20), nullable=True),
    sa.Column('email', sa.VARCHAR(length=255), nullable=True),
    sa.Column('website', sa.VARCHAR(length=255), nullable=True),
    sa.Column('timezone', sa.VARCHAR(length=50), nullable=True),
    sa.Column('business_hours', sqlite.JSON(), nullable=True),
    sa.Column('chairs_count', sa.INTEGER(), nullable=True),
    sa.Column('billing_plan', sa.VARCHAR(length=20), nullable=True),
    sa.Column('subscription_status', sa.VARCHAR(length=20), nullable=True),
    sa.Column('subscription_started_at', sa.DATETIME(), nullable=True),
    sa.Column('subscription_expires_at', sa.DATETIME(), nullable=True),
    sa.Column('stripe_account_id', sa.VARCHAR(length=100), nullable=True),
    sa.Column('stripe_subscription_id', sa.VARCHAR(length=100), nullable=True),
    sa.Column('stripe_customer_id', sa.VARCHAR(length=255), nullable=True),
    sa.Column('monthly_revenue_limit', sa.FLOAT(), nullable=True),
    sa.Column('features_enabled', sqlite.JSON(), nullable=True),
    sa.Column('billing_contact_email', sa.VARCHAR(length=255), nullable=True),
    sa.Column('tax_id', sa.VARCHAR(length=50), nullable=True),
    sa.Column('payment_status', sa.VARCHAR(length=20), nullable=True),
    sa.Column('last_payment_failure', sa.DATETIME(), nullable=True),
    sa.Column('next_payment_retry', sa.DATETIME(), nullable=True),
    sa.Column('payment_failure_history', sqlite.JSON(), nullable=True),
    sa.Column('gtm_container_id', sa.VARCHAR(length=50), nullable=True),
    sa.Column('ga4_measurement_id', sa.VARCHAR(length=50), nullable=True),
    sa.Column('meta_pixel_id', sa.VARCHAR(length=50), nullable=True),
    sa.Column('google_ads_conversion_id', sa.VARCHAR(length=50), nullable=True),
    sa.Column('google_ads_conversion_label', sa.VARCHAR(length=50), nullable=True),
    sa.Column('tracking_enabled', sa.BOOLEAN(), nullable=True),
    sa.Column('custom_tracking_code', sa.TEXT(), nullable=True),
    sa.Column('tracking_settings', sqlite.JSON(), nullable=True),
    sa.Column('landing_page_config', sqlite.JSON(), nullable=True),
    sa.Column('parent_organization_id', sa.INTEGER(), nullable=True),
    sa.Column('organization_type', sa.VARCHAR(length=20), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=False),
    sa.Column('updated_at', sa.DATETIME(), nullable=False),
    sa.ForeignKeyConstraint(['parent_organization_id'], ['organizations.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_organizations_slug', 'organizations', ['slug'], unique=1)
    op.create_index('ix_organizations_name', 'organizations', ['name'], unique=False)
    op.create_index('ix_organizations_id', 'organizations', ['id'], unique=False)
    op.create_table('appointments',
    sa.Column('id', sa.INTEGER(), nullable=True),
    sa.Column('user_id', sa.INTEGER(), nullable=True),
    sa.Column('barber_id', sa.INTEGER(), nullable=True),
    sa.Column('client_id', sa.INTEGER(), nullable=True),
    sa.Column('service_id', sa.INTEGER(), nullable=True),
    sa.Column('service_name', sa.VARCHAR(), nullable=True),
    sa.Column('start_time', sa.DATETIME(), nullable=False),
    sa.Column('duration_minutes', sa.INTEGER(), nullable=False),
    sa.Column('price', sa.FLOAT(), nullable=True),
    sa.Column('status', sa.VARCHAR(), server_default=sa.text("'pending'"), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('buffer_time_before', sa.INTEGER(), server_default=sa.text('0'), nullable=True),
    sa.Column('buffer_time_after', sa.INTEGER(), server_default=sa.text('0'), nullable=True),
    sa.Column('notes', sa.TEXT(), nullable=True),
    sa.Column('google_event_id', sa.VARCHAR(), nullable=True),
    sa.Column('created_timezone', sa.VARCHAR(length=50), nullable=True),
    sa.Column('user_timezone', sa.VARCHAR(length=50), nullable=True),
    sa.Column('client_timezone', sa.VARCHAR(length=50), nullable=True),
    sa.Column('barber_timezone', sa.VARCHAR(length=50), nullable=True),
    sa.Column('display_timezone', sa.VARCHAR(length=50), nullable=True),
    sa.Column('is_test_data', sa.BOOLEAN(), server_default=sa.text('0'), nullable=True),
    sa.Column('organization_id', sa.INTEGER(), nullable=True),
    sa.Column('recurring_pattern_id', sa.INTEGER(), nullable=True),
    sa.Column('recurring_series_id', sa.INTEGER(), nullable=True),
    sa.Column('is_recurring_instance', sa.BOOLEAN(), server_default=sa.text('0'), nullable=True),
    sa.Column('original_scheduled_date', sa.DATETIME(), nullable=True),
    sa.Column('recurrence_sequence', sa.INTEGER(), nullable=True),
    sa.Column('version', sa.INTEGER(), server_default=sa.text('1'), nullable=True),
    sa.ForeignKeyConstraint(['organization_id'], ['organizations.id'], ),
    sa.ForeignKeyConstraint(['recurring_pattern_id'], ['recurring_appointment_patterns.id'], ),
    sa.ForeignKeyConstraint(['recurring_series_id'], ['recurring_appointment_series.id'], ),
    sa.ForeignKeyConstraint(['service_id'], ['services.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_appointments_user_status', 'appointments', ['user_id', 'status'], unique=False)
    op.create_index('idx_appointments_user_start', 'appointments', ['user_id', 'start_time'], unique=False)
    op.create_index('idx_appointments_user_id', 'appointments', ['user_id'], unique=False)
    op.create_index('idx_appointments_status_starttime', 'appointments', ['status', 'start_time'], unique=False)
    op.create_index('idx_appointments_status_start', 'appointments', ['status', 'start_time'], unique=False)
    op.create_index('idx_appointments_status', 'appointments', ['status'], unique=False)
    op.create_index('idx_appointments_start_time', 'appointments', ['start_time'], unique=False)
    op.create_index('idx_appointments_service_start', 'appointments', ['service_id', 'start_time'], unique=False)
    op.create_index('idx_appointments_service_id', 'appointments', ['service_id'], unique=False)
    op.create_index('idx_appointments_org_start', 'appointments', ['organization_id', 'start_time'], unique=False)
    op.create_index('idx_appointments_client_status', 'appointments', ['client_id', 'status'], unique=False)
    op.create_index('idx_appointments_client_starttime', 'appointments', ['client_id', 'start_time'], unique=False)
    op.create_index('idx_appointments_client_id', 'appointments', ['client_id'], unique=False)
    op.create_index('idx_appointments_barber_status_start', 'appointments', ['barber_id', 'status', 'start_time'], unique=False)
    op.create_index('idx_appointments_barber_starttime', 'appointments', ['barber_id', 'start_time'], unique=False)
    op.create_index('idx_appointments_barber_start', 'appointments', ['barber_id', 'start_time'], unique=False)
    op.create_index('idx_appointments_barber_id', 'appointments', ['barber_id'], unique=False)
    op.create_table('email_analytics_events',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('message_id', sa.VARCHAR(length=255), nullable=False),
    sa.Column('email_address', sa.VARCHAR(length=255), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=True),
    sa.Column('notification_queue_id', sa.INTEGER(), nullable=True),
    sa.Column('event_type', sa.VARCHAR(length=50), nullable=False),
    sa.Column('timestamp', sa.DATETIME(), nullable=False),
    sa.Column('url', sa.VARCHAR(length=500), nullable=True),
    sa.Column('user_agent', sa.VARCHAR(length=500), nullable=True),
    sa.Column('ip_address', sa.VARCHAR(length=45), nullable=True),
    sa.Column('email_client', sa.VARCHAR(length=100), nullable=True),
    sa.Column('device_type', sa.VARCHAR(length=50), nullable=True),
    sa.Column('operating_system', sa.VARCHAR(length=100), nullable=True),
    sa.Column('country', sa.VARCHAR(length=2), nullable=True),
    sa.Column('region', sa.VARCHAR(length=100), nullable=True),
    sa.Column('city', sa.VARCHAR(length=100), nullable=True),
    sa.Column('bounce_type', sa.VARCHAR(length=50), nullable=True),
    sa.Column('bounce_reason', sa.VARCHAR(length=255), nullable=True),
    sa.Column('error_code', sa.VARCHAR(length=20), nullable=True),
    sa.Column('ab_test_id', sa.INTEGER(), nullable=True),
    sa.Column('ab_variant', sa.VARCHAR(length=10), nullable=True),
    sa.Column('event_metadata', sqlite.JSON(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['ab_test_id'], ['email_ab_tests.id'], ),
    sa.ForeignKeyConstraint(['notification_queue_id'], ['notification_queue.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_email_analytics_events_timestamp', 'email_analytics_events', ['timestamp'], unique=False)
    op.create_index('ix_email_analytics_events_message_id', 'email_analytics_events', ['message_id'], unique=False)
    op.create_index('ix_email_analytics_events_id', 'email_analytics_events', ['id'], unique=False)
    op.create_index('ix_email_analytics_events_event_type', 'email_analytics_events', ['event_type'], unique=False)
    op.create_index('ix_email_analytics_events_email_address', 'email_analytics_events', ['email_address'], unique=False)
    op.create_table('review_responses',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('review_id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('response_text', sa.TEXT(), nullable=False),
    sa.Column('response_type', sa.VARCHAR(length=50), nullable=True),
    sa.Column('template_id', sa.VARCHAR(length=100), nullable=True),
    sa.Column('is_draft', sa.BOOLEAN(), nullable=True),
    sa.Column('is_sent', sa.BOOLEAN(), nullable=True),
    sa.Column('sent_at', sa.DATETIME(), nullable=True),
    sa.Column('platform_response_id', sa.VARCHAR(length=255), nullable=True),
    sa.Column('keywords_used', sqlite.JSON(), nullable=True),
    sa.Column('cta_included', sa.BOOLEAN(), nullable=True),
    sa.Column('business_name_mentioned', sa.BOOLEAN(), nullable=True),
    sa.Column('view_count', sa.INTEGER(), nullable=True),
    sa.Column('helpful_votes', sa.INTEGER(), nullable=True),
    sa.Column('character_count', sa.INTEGER(), nullable=True),
    sa.Column('variant_id', sa.VARCHAR(length=50), nullable=True),
    sa.Column('test_group', sa.VARCHAR(length=50), nullable=True),
    sa.Column('send_errors', sqlite.JSON(), nullable=True),
    sa.Column('last_error', sa.TEXT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['review_id'], ['reviews.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_review_responses_template_id', 'review_responses', ['template_id'], unique=False)
    op.create_index('ix_review_responses_id', 'review_responses', ['id'], unique=False)
    op.create_table('service_subscriptions',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('client_id', sa.INTEGER(), nullable=False),
    sa.Column('barber_id', sa.INTEGER(), nullable=False),
    sa.Column('template_id', sa.INTEGER(), nullable=False),
    sa.Column('status', sa.VARCHAR(length=9), nullable=True),
    sa.Column('started_at', sa.DATETIME(), nullable=True),
    sa.Column('cancelled_at', sa.DATETIME(), nullable=True),
    sa.Column('expires_at', sa.DATETIME(), nullable=True),
    sa.Column('next_billing_date', sa.DATETIME(), nullable=True),
    sa.Column('stripe_subscription_id', sa.VARCHAR(), nullable=True),
    sa.Column('stripe_customer_id', sa.VARCHAR(), nullable=True),
    sa.Column('services_used_current_period', sa.INTEGER(), nullable=True),
    sa.Column('services_rolled_over', sa.INTEGER(), nullable=True),
    sa.Column('total_services_available', sa.INTEGER(), nullable=True),
    sa.Column('current_period_start', sa.DATETIME(), nullable=True),
    sa.Column('current_period_end', sa.DATETIME(), nullable=True),
    sa.Column('last_payment_date', sa.DATETIME(), nullable=True),
    sa.Column('last_payment_amount', sa.FLOAT(), nullable=True),
    sa.Column('failed_payment_count', sa.INTEGER(), nullable=True),
    sa.Column('custom_price', sa.FLOAT(), nullable=True),
    sa.Column('custom_services_per_period', sa.INTEGER(), nullable=True),
    sa.Column('custom_notes', sa.TEXT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['barber_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['client_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['template_id'], ['service_subscription_templates.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_service_subscriptions_id', 'service_subscriptions', ['id'], unique=False)
    op.create_table('staff_invitations',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('token', sa.VARCHAR(length=64), nullable=False),
    sa.Column('email', sa.VARCHAR(length=255), nullable=False),
    sa.Column('first_name', sa.VARCHAR(length=100), nullable=True),
    sa.Column('last_name', sa.VARCHAR(length=100), nullable=True),
    sa.Column('invited_role', sa.VARCHAR(length=12), nullable=False),
    sa.Column('message', sa.TEXT(), nullable=True),
    sa.Column('organization_id', sa.INTEGER(), nullable=False),
    sa.Column('invited_by_id', sa.INTEGER(), nullable=False),
    sa.Column('status', sa.VARCHAR(length=9), nullable=False),
    sa.Column('created_at', sa.DATETIME(), nullable=False),
    sa.Column('expires_at', sa.DATETIME(), nullable=False),
    sa.Column('accepted_at', sa.DATETIME(), nullable=True),
    sa.Column('accepted_by_id', sa.INTEGER(), nullable=True),
    sa.Column('email_sent_at', sa.DATETIME(), nullable=True),
    sa.Column('email_send_count', sa.INTEGER(), nullable=True),
    sa.Column('last_viewed_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['accepted_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['invited_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['organization_id'], ['organizations.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_staff_invitations_token', 'staff_invitations', ['token'], unique=1)
    op.create_index('ix_staff_invitations_id', 'staff_invitations', ['id'], unique=False)
    op.create_index('ix_staff_invitations_email', 'staff_invitations', ['email'], unique=False)
    op.create_table('insight_email_deliveries',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('weekly_insight_id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('email_address', sa.VARCHAR(length=255), nullable=False),
    sa.Column('subject_line', sa.VARCHAR(length=500), nullable=False),
    sa.Column('template_version', sa.VARCHAR(length=50), nullable=True),
    sa.Column('content_html', sa.TEXT(), nullable=True),
    sa.Column('content_text', sa.TEXT(), nullable=True),
    sa.Column('attachments', sqlite.JSON(), nullable=True),
    sa.Column('status', sa.VARCHAR(length=9), nullable=False),
    sa.Column('scheduled_send_time', sa.DATETIME(), nullable=True),
    sa.Column('actual_send_time', sa.DATETIME(), nullable=True),
    sa.Column('delivery_time', sa.DATETIME(), nullable=True),
    sa.Column('email_provider', sa.VARCHAR(length=50), nullable=True),
    sa.Column('message_id', sa.VARCHAR(length=255), nullable=True),
    sa.Column('opened_count', sa.INTEGER(), nullable=True),
    sa.Column('first_opened_at', sa.DATETIME(), nullable=True),
    sa.Column('last_opened_at', sa.DATETIME(), nullable=True),
    sa.Column('clicked_count', sa.INTEGER(), nullable=True),
    sa.Column('first_clicked_at', sa.DATETIME(), nullable=True),
    sa.Column('last_clicked_at', sa.DATETIME(), nullable=True),
    sa.Column('clicked_links', sqlite.JSON(), nullable=True),
    sa.Column('bounce_reason', sa.VARCHAR(length=255), nullable=True),
    sa.Column('error_message', sa.TEXT(), nullable=True),
    sa.Column('retry_count', sa.INTEGER(), nullable=True),
    sa.Column('unsubscribed_at', sa.DATETIME(), nullable=True),
    sa.Column('unsubscribe_reason', sa.VARCHAR(length=255), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=False),
    sa.Column('updated_at', sa.DATETIME(), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['weekly_insight_id'], ['weekly_insights.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('message_id')
    )
    op.create_index('ix_insight_email_deliveries_weekly_insight_id', 'insight_email_deliveries', ['weekly_insight_id'], unique=False)
    op.create_index('ix_insight_email_deliveries_user_id', 'insight_email_deliveries', ['user_id'], unique=False)
    op.create_index('ix_insight_email_deliveries_id', 'insight_email_deliveries', ['id'], unique=False)
    op.create_table('payouts',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('barber_id', sa.INTEGER(), nullable=True),
    sa.Column('amount', sa.FLOAT(), nullable=True),
    sa.Column('status', sa.VARCHAR(), nullable=True),
    sa.Column('period_start', sa.DATETIME(), nullable=True),
    sa.Column('period_end', sa.DATETIME(), nullable=True),
    sa.Column('payment_count', sa.INTEGER(), nullable=True),
    sa.Column('stripe_payout_id', sa.VARCHAR(), nullable=True),
    sa.Column('stripe_transfer_id', sa.VARCHAR(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('processed_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['barber_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_payouts_id', 'payouts', ['id'], unique=False)
    op.create_index('idx_payouts_period', 'payouts', ['barber_id', 'period_start', 'period_end'], unique=False)
    op.create_index('idx_payouts_created_status', 'payouts', ['created_at', 'status'], unique=False)
    op.create_index('idx_payouts_barber_status', 'payouts', ['barber_id', 'status'], unique=False)
    op.create_table('service_templates',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(), nullable=False),
    sa.Column('display_name', sa.VARCHAR(), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('category', sa.VARCHAR(length=14), nullable=False),
    sa.Column('six_fb_tier', sa.VARCHAR(), nullable=False),
    sa.Column('methodology_score', sa.FLOAT(), nullable=True),
    sa.Column('revenue_impact', sa.VARCHAR(), nullable=False),
    sa.Column('client_relationship_impact', sa.VARCHAR(), nullable=False),
    sa.Column('suggested_base_price', sa.FLOAT(), nullable=False),
    sa.Column('suggested_min_price', sa.FLOAT(), nullable=True),
    sa.Column('suggested_max_price', sa.FLOAT(), nullable=True),
    sa.Column('duration_minutes', sa.INTEGER(), nullable=False),
    sa.Column('buffer_time_minutes', sa.INTEGER(), nullable=True),
    sa.Column('requires_consultation', sa.BOOLEAN(), nullable=True),
    sa.Column('upsell_opportunities', sqlite.JSON(), nullable=True),
    sa.Column('client_value_tier', sa.VARCHAR(), nullable=True),
    sa.Column('profit_margin_target', sa.FLOAT(), nullable=True),
    sa.Column('template_type', sa.VARCHAR(), nullable=True),
    sa.Column('is_six_fb_certified', sa.BOOLEAN(), nullable=True),
    sa.Column('popularity_score', sa.FLOAT(), nullable=True),
    sa.Column('success_rate', sa.FLOAT(), nullable=True),
    sa.Column('target_market', sa.VARCHAR(), nullable=True),
    sa.Column('recommended_for', sqlite.JSON(), nullable=True),
    sa.Column('service_details', sqlite.JSON(), nullable=True),
    sa.Column('pricing_strategy', sqlite.JSON(), nullable=True),
    sa.Column('business_rules', sqlite.JSON(), nullable=True),
    sa.Column('template_image_url', sa.VARCHAR(), nullable=True),
    sa.Column('demo_images', sqlite.JSON(), nullable=True),
    sa.Column('usage_count', sa.INTEGER(), nullable=True),
    sa.Column('created_by_id', sa.INTEGER(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('is_featured', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['created_by_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_service_templates_six_fb_tier', 'service_templates', ['six_fb_tier'], unique=False)
    op.create_index('ix_service_templates_name', 'service_templates', ['name'], unique=False)
    op.create_index('ix_service_templates_id', 'service_templates', ['id'], unique=False)
    op.create_index('ix_service_templates_category', 'service_templates', ['category'], unique=False)
    op.create_table('notification_preference_audit',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('preferences_id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('field_changed', sa.VARCHAR(length=100), nullable=False),
    sa.Column('old_value', sa.TEXT(), nullable=True),
    sa.Column('new_value', sa.TEXT(), nullable=True),
    sa.Column('change_reason', sa.VARCHAR(length=200), nullable=True),
    sa.Column('changed_at', sa.DATETIME(), nullable=True),
    sa.Column('changed_by_ip', sa.VARCHAR(length=45), nullable=True),
    sa.Column('user_agent', sa.VARCHAR(length=500), nullable=True),
    sa.ForeignKeyConstraint(['preferences_id'], ['notification_preferences_v2.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_notification_preference_audit_id', 'notification_preference_audit', ['id'], unique=False)
    op.create_table('business_insights',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('agent_id', sa.INTEGER(), nullable=True),
    sa.Column('coaching_session_id', sa.INTEGER(), nullable=True),
    sa.Column('title', sa.VARCHAR(length=200), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=False),
    sa.Column('insight_category', sa.VARCHAR(length=50), nullable=False),
    sa.Column('priority', sa.VARCHAR(length=13), nullable=False),
    sa.Column('data_source', sa.VARCHAR(length=50), nullable=False),
    sa.Column('analysis_period_start', sa.DATETIME(), nullable=False),
    sa.Column('analysis_period_end', sa.DATETIME(), nullable=False),
    sa.Column('sample_size', sa.INTEGER(), nullable=True),
    sa.Column('current_performance', sqlite.JSON(), nullable=True),
    sa.Column('benchmark_performance', sqlite.JSON(), nullable=True),
    sa.Column('improvement_potential', sqlite.JSON(), nullable=True),
    sa.Column('recommended_actions', sqlite.JSON(), nullable=True),
    sa.Column('six_fb_compliance_impact', sa.FLOAT(), nullable=True),
    sa.Column('six_fb_principle_alignment', sqlite.JSON(), nullable=True),
    sa.Column('expected_revenue_impact', sa.FLOAT(), nullable=True),
    sa.Column('implementation_difficulty', sa.VARCHAR(length=20), nullable=True),
    sa.Column('is_actionable', sa.BOOLEAN(), nullable=True),
    sa.Column('has_been_acted_on', sa.BOOLEAN(), nullable=True),
    sa.Column('action_taken_date', sa.DATETIME(), nullable=True),
    sa.Column('outcome_measured', sa.BOOLEAN(), nullable=True),
    sa.Column('actual_impact', sqlite.JSON(), nullable=True),
    sa.Column('confidence_score', sa.FLOAT(), nullable=True),
    sa.Column('expires_at', sa.DATETIME(), nullable=True),
    sa.Column('is_recurring', sa.BOOLEAN(), nullable=True),
    sa.Column('tags', sqlite.JSON(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['agent_id'], ['business_intelligence_agents.id'], ),
    sa.ForeignKeyConstraint(['coaching_session_id'], ['business_coaching_sessions.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_business_insights_user_id', 'business_insights', ['user_id'], unique=False)
    op.create_index('ix_business_insights_priority', 'business_insights', ['priority'], unique=False)
    op.create_index('ix_business_insights_insight_category', 'business_insights', ['insight_category'], unique=False)
    op.create_index('ix_business_insights_id', 'business_insights', ['id'], unique=False)
    op.create_index('ix_business_insights_created_at', 'business_insights', ['created_at'], unique=False)
    op.create_index('ix_business_insights_coaching_session_id', 'business_insights', ['coaching_session_id'], unique=False)
    op.create_index('ix_business_insights_agent_id', 'business_insights', ['agent_id'], unique=False)
    op.create_table('xp_transactions',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('user_xp_profile_id', sa.INTEGER(), nullable=False),
    sa.Column('xp_amount', sa.INTEGER(), nullable=False),
    sa.Column('xp_source', sa.VARCHAR(length=22), nullable=False),
    sa.Column('source_description', sa.VARCHAR(), nullable=True),
    sa.Column('related_achievement_id', sa.INTEGER(), nullable=True),
    sa.Column('related_appointment_id', sa.INTEGER(), nullable=True),
    sa.Column('related_metric_value', sa.FLOAT(), nullable=True),
    sa.Column('base_xp', sa.INTEGER(), nullable=False),
    sa.Column('multiplier_applied', sa.FLOAT(), nullable=True),
    sa.Column('bonus_reason', sa.VARCHAR(), nullable=True),
    sa.Column('level_before', sa.INTEGER(), nullable=True),
    sa.Column('level_after', sa.INTEGER(), nullable=True),
    sa.Column('caused_level_up', sa.BOOLEAN(), nullable=True),
    sa.Column('transaction_date', sa.DATETIME(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['related_achievement_id'], ['achievement_definitions.id'], ),
    sa.ForeignKeyConstraint(['related_appointment_id'], ['appointments.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['user_xp_profile_id'], ['user_xp_profiles.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_xp_transactions_xp_source', 'xp_transactions', ['xp_source'], unique=False)
    op.create_index('ix_xp_transactions_user_id', 'xp_transactions', ['user_id'], unique=False)
    op.create_index('ix_xp_transactions_transaction_date', 'xp_transactions', ['transaction_date'], unique=False)
    op.create_index('ix_xp_transactions_id', 'xp_transactions', ['id'], unique=False)
    op.create_index('idx_xp_transaction_user_date', 'xp_transactions', ['user_id', 'transaction_date'], unique=False)
    op.create_index('idx_xp_transaction_source', 'xp_transactions', ['xp_source', 'transaction_date'], unique=False)
    op.create_table('six_fb_revenue_goals',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('goal_name', sa.VARCHAR(), nullable=False),
    sa.Column('target_annual_revenue', sa.NUMERIC(precision=12, scale=2), nullable=False),
    sa.Column('target_monthly_revenue', sa.NUMERIC(precision=10, scale=2), nullable=False),
    sa.Column('target_weekly_revenue', sa.NUMERIC(precision=10, scale=2), nullable=False),
    sa.Column('target_daily_revenue', sa.NUMERIC(precision=8, scale=2), nullable=False),
    sa.Column('start_date', sa.DATE(), nullable=False),
    sa.Column('target_date', sa.DATE(), nullable=False),
    sa.Column('achieved_date', sa.DATE(), nullable=True),
    sa.Column('current_annual_pace', sa.NUMERIC(precision=12, scale=2), nullable=True),
    sa.Column('progress_percentage', sa.FLOAT(), nullable=True),
    sa.Column('days_ahead_behind_schedule', sa.INTEGER(), nullable=True),
    sa.Column('sfb_principle_focus', sa.VARCHAR(length=27), nullable=False),
    sa.Column('milestone_requirements', sqlite.JSON(), nullable=True),
    sa.Column('coaching_recommendations', sqlite.JSON(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('is_achieved', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_six_fb_revenue_goals_user_id', 'six_fb_revenue_goals', ['user_id'], unique=False)
    op.create_index('ix_six_fb_revenue_goals_id', 'six_fb_revenue_goals', ['id'], unique=False)
    op.create_table('data_processing_logs',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('purpose', sa.VARCHAR(length=18), nullable=False),
    sa.Column('operation', sa.VARCHAR(length=255), nullable=False),
    sa.Column('data_categories', sqlite.JSON(), nullable=True),
    sa.Column('legal_basis', sa.VARCHAR(length=255), nullable=True),
    sa.Column('retention_period_days', sa.INTEGER(), nullable=True),
    sa.Column('third_party_involved', sa.BOOLEAN(), nullable=False),
    sa.Column('third_party_details', sqlite.JSON(), nullable=True),
    sa.Column('processing_date', sa.DATETIME(), nullable=False),
    sa.Column('ip_address', sa.VARCHAR(length=45), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_data_processing_logs_id', 'data_processing_logs', ['id'], unique=False)
    op.create_table('insight_metrics',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('weekly_insight_id', sa.INTEGER(), nullable=True),
    sa.Column('metric_name', sa.VARCHAR(length=255), nullable=False),
    sa.Column('metric_value', sa.FLOAT(), nullable=False),
    sa.Column('metric_category', sa.VARCHAR(length=100), nullable=False),
    sa.Column('measurement_date', sa.DATETIME(), nullable=False),
    sa.Column('data_period_start', sa.DATETIME(), nullable=True),
    sa.Column('data_period_end', sa.DATETIME(), nullable=True),
    sa.Column('accuracy_score', sa.FLOAT(), nullable=True),
    sa.Column('relevance_score', sa.FLOAT(), nullable=True),
    sa.Column('actionability_score', sa.FLOAT(), nullable=True),
    sa.Column('insight_metadata', sqlite.JSON(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['weekly_insight_id'], ['weekly_insights.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_insight_metrics_weekly_insight_id', 'insight_metrics', ['weekly_insight_id'], unique=False)
    op.create_index('ix_insight_metrics_user_id', 'insight_metrics', ['user_id'], unique=False)
    op.create_index('ix_insight_metrics_metric_name', 'insight_metrics', ['metric_name'], unique=False)
    op.create_index('ix_insight_metrics_id', 'insight_metrics', ['id'], unique=False)
    op.create_table('inventory_items',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('product_id', sa.INTEGER(), nullable=False),
    sa.Column('location_id', sa.INTEGER(), nullable=False),
    sa.Column('external_id', sa.VARCHAR(length=255), nullable=True),
    sa.Column('quantity_available', sa.INTEGER(), nullable=True),
    sa.Column('quantity_reserved', sa.INTEGER(), nullable=True),
    sa.Column('quantity_committed', sa.INTEGER(), nullable=True),
    sa.Column('reorder_point', sa.INTEGER(), nullable=True),
    sa.Column('reorder_quantity', sa.INTEGER(), nullable=True),
    sa.Column('cost_per_item', sa.NUMERIC(precision=10, scale=2), nullable=True),
    sa.Column('currency', sa.VARCHAR(length=3), nullable=True),
    sa.Column('track_inventory', sa.BOOLEAN(), nullable=True),
    sa.Column('allow_oversell', sa.BOOLEAN(), nullable=True),
    sa.Column('shopify_data', sqlite.JSON(), nullable=True),
    sa.Column('last_inventory_sync', sa.DATETIME(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['location_id'], ['barbershop_locations.id'], ),
    sa.ForeignKeyConstraint(['product_id'], ['products.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_inventory_items_id', 'inventory_items', ['id'], unique=False)
    op.create_index('ix_inventory_items_external_id', 'inventory_items', ['external_id'], unique=False)
    op.create_table('user_achievements',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('achievement_id', sa.INTEGER(), nullable=False),
    sa.Column('current_progress', sa.FLOAT(), nullable=True),
    sa.Column('target_progress', sa.FLOAT(), nullable=True),
    sa.Column('progress_percentage', sa.FLOAT(), nullable=True),
    sa.Column('is_unlocked', sa.BOOLEAN(), nullable=True),
    sa.Column('unlocked_at', sa.DATETIME(), nullable=True),
    sa.Column('is_notified', sa.BOOLEAN(), nullable=True),
    sa.Column('unlock_context', sqlite.JSON(), nullable=True),
    sa.Column('progress_history', sqlite.JSON(), nullable=True),
    sa.Column('milestone_snapshots', sqlite.JSON(), nullable=True),
    sa.Column('is_featured', sa.BOOLEAN(), nullable=True),
    sa.Column('is_shared', sa.BOOLEAN(), nullable=True),
    sa.Column('sharing_platforms', sqlite.JSON(), nullable=True),
    sa.Column('xp_awarded', sa.INTEGER(), nullable=True),
    sa.Column('xp_claimed_at', sa.DATETIME(), nullable=True),
    sa.Column('rewards_claimed', sqlite.JSON(), nullable=True),
    sa.Column('first_progress_at', sa.DATETIME(), nullable=True),
    sa.Column('last_progress_at', sa.DATETIME(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['achievement_id'], ['achievement_definitions.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_user_achievements_user_id', 'user_achievements', ['user_id'], unique=False)
    op.create_index('ix_user_achievements_is_unlocked', 'user_achievements', ['is_unlocked'], unique=False)
    op.create_index('ix_user_achievements_id', 'user_achievements', ['id'], unique=False)
    op.create_index('ix_user_achievements_achievement_id', 'user_achievements', ['achievement_id'], unique=False)
    op.create_index('idx_user_achievement_user_unlocked', 'user_achievements', ['user_id', 'is_unlocked'], unique=False)
    op.create_index('idx_user_achievement_unlocked_at', 'user_achievements', ['unlocked_at'], unique=False)
    op.create_table('booking_rules',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('business_id', sa.INTEGER(), nullable=True),
    sa.Column('rule_name', sa.VARCHAR(), nullable=False),
    sa.Column('rule_type', sa.VARCHAR(), nullable=False),
    sa.Column('rule_params', sqlite.JSON(), nullable=False),
    sa.Column('applies_to', sa.VARCHAR(), nullable=True),
    sa.Column('service_ids', sqlite.JSON(), nullable=True),
    sa.Column('barber_ids', sqlite.JSON(), nullable=True),
    sa.Column('client_types', sqlite.JSON(), nullable=True),
    sa.Column('priority', sa.INTEGER(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.Column('created_by_id', sa.INTEGER(), nullable=True),
    sa.ForeignKeyConstraint(['created_by_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('rule_name')
    )
    op.create_index('ix_booking_rules_id', 'booking_rules', ['id'], unique=False)
    op.create_table('external_transactions',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('connection_id', sa.INTEGER(), nullable=False),
    sa.Column('appointment_id', sa.INTEGER(), nullable=True),
    sa.Column('external_transaction_id', sa.VARCHAR(length=255), nullable=False),
    sa.Column('external_charge_id', sa.VARCHAR(length=255), nullable=True),
    sa.Column('external_customer_id', sa.VARCHAR(length=255), nullable=True),
    sa.Column('amount', sa.FLOAT(), nullable=False),
    sa.Column('currency', sa.VARCHAR(length=3), nullable=True),
    sa.Column('processing_fee', sa.FLOAT(), nullable=True),
    sa.Column('net_amount', sa.FLOAT(), nullable=False),
    sa.Column('payment_method', sa.VARCHAR(length=50), nullable=True),
    sa.Column('last_four', sa.VARCHAR(length=4), nullable=True),
    sa.Column('brand', sa.VARCHAR(length=20), nullable=True),
    sa.Column('status', sa.VARCHAR(length=20), nullable=False),
    sa.Column('processed_at', sa.DATETIME(), nullable=True),
    sa.Column('refunded_at', sa.DATETIME(), nullable=True),
    sa.Column('refund_amount', sa.FLOAT(), nullable=True),
    sa.Column('commission_rate', sa.FLOAT(), nullable=True),
    sa.Column('commission_amount', sa.FLOAT(), nullable=True),
    sa.Column('commission_collected', sa.BOOLEAN(), nullable=True),
    sa.Column('external_metadata', sqlite.JSON(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['appointment_id'], ['appointments.id'], ),
    sa.ForeignKeyConstraint(['connection_id'], ['payment_processor_connections.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_external_transactions_id', 'external_transactions', ['id'], unique=False)
    op.create_index('ix_external_transactions_external_transaction_id', 'external_transactions', ['external_transaction_id'], unique=False)
    op.create_index('ix_external_transactions_connection_id', 'external_transactions', ['connection_id'], unique=False)
    op.create_index('ix_external_transactions_appointment_id', 'external_transactions', ['appointment_id'], unique=False)
    op.create_table('six_fb_operational_excellence',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('area_name', sa.VARCHAR(), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('methodology_alignment', sa.VARCHAR(length=27), nullable=False),
    sa.Column('current_score', sa.FLOAT(), nullable=True),
    sa.Column('target_score', sa.FLOAT(), nullable=True),
    sa.Column('last_assessment_date', sa.DATE(), nullable=True),
    sa.Column('score_trend_30_days', sa.FLOAT(), nullable=True),
    sa.Column('score_trend_90_days', sa.FLOAT(), nullable=True),
    sa.Column('improvement_rate', sa.FLOAT(), nullable=True),
    sa.Column('process_documentation', sqlite.JSON(), nullable=True),
    sa.Column('automation_opportunities', sqlite.JSON(), nullable=True),
    sa.Column('efficiency_gains_implemented', sqlite.JSON(), nullable=True),
    sa.Column('revenue_impact', sa.NUMERIC(precision=8, scale=2), nullable=True),
    sa.Column('time_savings_minutes_per_day', sa.FLOAT(), nullable=True),
    sa.Column('client_satisfaction_impact', sa.FLOAT(), nullable=True),
    sa.Column('coaching_recommendations', sqlite.JSON(), nullable=True),
    sa.Column('milestone_integration', sqlite.JSON(), nullable=True),
    sa.Column('success_metrics', sqlite.JSON(), nullable=True),
    sa.Column('improvement_plan', sqlite.JSON(), nullable=True),
    sa.Column('action_items', sqlite.JSON(), nullable=True),
    sa.Column('next_review_date', sa.DATE(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('priority_level', sa.VARCHAR(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_six_fb_operational_excellence_user_id', 'six_fb_operational_excellence', ['user_id'], unique=False)
    op.create_index('ix_six_fb_operational_excellence_id', 'six_fb_operational_excellence', ['id'], unique=False)
    op.create_table('six_fb_client_engagement_history',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('client_id', sa.INTEGER(), nullable=False),
    sa.Column('engagement_type', sa.VARCHAR(length=19), nullable=False),
    sa.Column('engagement_date', sa.DATETIME(), nullable=False),
    sa.Column('engagement_value', sa.FLOAT(), nullable=True),
    sa.Column('source_type', sa.VARCHAR(), nullable=True),
    sa.Column('source_details', sqlite.JSON(), nullable=True),
    sa.Column('appointment_id', sa.INTEGER(), nullable=True),
    sa.Column('communication_id', sa.INTEGER(), nullable=True),
    sa.Column('engagement_quality_score', sa.FLOAT(), nullable=True),
    sa.Column('engagement_duration_seconds', sa.INTEGER(), nullable=True),
    sa.Column('engagement_depth', sa.VARCHAR(), nullable=True),
    sa.Column('relationship_building_contribution', sa.FLOAT(), nullable=True),
    sa.Column('value_demonstration_score', sa.FLOAT(), nullable=True),
    sa.Column('premium_brand_alignment', sa.FLOAT(), nullable=True),
    sa.Column('revenue_impact', sa.NUMERIC(precision=8, scale=2), nullable=True),
    sa.Column('retention_impact_score', sa.FLOAT(), nullable=True),
    sa.Column('advocacy_impact_score', sa.FLOAT(), nullable=True),
    sa.Column('engagement_metadata', sqlite.JSON(), nullable=True),
    sa.Column('tags', sqlite.JSON(), nullable=True),
    sa.Column('notes', sa.TEXT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['appointment_id'], ['appointments.id'], ),
    sa.ForeignKeyConstraint(['client_id'], ['clients.id'], ),
    sa.ForeignKeyConstraint(['communication_id'], ['six_fb_client_communications.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_six_fb_client_engagement_history_user_id', 'six_fb_client_engagement_history', ['user_id'], unique=False)
    op.create_index('ix_six_fb_client_engagement_history_id', 'six_fb_client_engagement_history', ['id'], unique=False)
    op.create_index('ix_six_fb_client_engagement_history_client_id', 'six_fb_client_engagement_history', ['client_id'], unique=False)
    op.create_index('idx_engagement_user_client_date', 'six_fb_client_engagement_history', ['user_id', 'client_id', 'engagement_date'], unique=False)
    op.create_index('idx_engagement_type_value', 'six_fb_client_engagement_history', ['engagement_type', 'engagement_value'], unique=False)
    op.create_index('idx_engagement_quality', 'six_fb_client_engagement_history', ['engagement_quality_score'], unique=False)
    op.create_table('mfa_device_trusts',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('device_fingerprint', sa.VARCHAR(length=255), nullable=False),
    sa.Column('device_name', sa.VARCHAR(length=255), nullable=True),
    sa.Column('browser', sa.VARCHAR(length=100), nullable=True),
    sa.Column('platform', sa.VARCHAR(length=100), nullable=True),
    sa.Column('trust_token', sa.VARCHAR(length=255), nullable=False),
    sa.Column('trusted_until', sa.DATETIME(), nullable=False),
    sa.Column('last_used_at', sa.DATETIME(), nullable=True),
    sa.Column('usage_count', sa.INTEGER(), nullable=False),
    sa.Column('ip_address', sa.VARCHAR(length=45), nullable=True),
    sa.Column('location', sa.VARCHAR(length=255), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=False),
    sa.Column('revoked_at', sa.DATETIME(), nullable=True),
    sa.Column('revoked_reason', sa.VARCHAR(length=255), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('trust_token')
    )
    op.create_index('ix_mfa_device_trusts_id', 'mfa_device_trusts', ['id'], unique=False)
    op.create_index('idx_device_trust_user', 'mfa_device_trusts', ['user_id', 'trusted_until'], unique=False)
    op.create_index('idx_device_trust_token', 'mfa_device_trusts', ['trust_token'], unique=False)
    op.create_index('idx_device_trust_fingerprint', 'mfa_device_trusts', ['user_id', 'device_fingerprint'], unique=False)
    op.create_table('notification_preferences_v2',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('email_enabled', sa.BOOLEAN(), nullable=True),
    sa.Column('sms_enabled', sa.BOOLEAN(), nullable=True),
    sa.Column('timezone', sa.VARCHAR(length=50), nullable=True),
    sa.Column('email_appointment_confirmation', sa.BOOLEAN(), nullable=True),
    sa.Column('email_appointment_reminder', sa.BOOLEAN(), nullable=True),
    sa.Column('email_appointment_changes', sa.BOOLEAN(), nullable=True),
    sa.Column('email_appointment_cancellation', sa.BOOLEAN(), nullable=True),
    sa.Column('email_payment_confirmation', sa.BOOLEAN(), nullable=True),
    sa.Column('email_payment_failed', sa.BOOLEAN(), nullable=True),
    sa.Column('email_marketing', sa.BOOLEAN(), nullable=True),
    sa.Column('email_news_updates', sa.BOOLEAN(), nullable=True),
    sa.Column('email_promotional', sa.BOOLEAN(), nullable=True),
    sa.Column('email_system_alerts', sa.BOOLEAN(), nullable=True),
    sa.Column('sms_appointment_confirmation', sa.BOOLEAN(), nullable=True),
    sa.Column('sms_appointment_reminder', sa.BOOLEAN(), nullable=True),
    sa.Column('sms_appointment_changes', sa.BOOLEAN(), nullable=True),
    sa.Column('sms_appointment_cancellation', sa.BOOLEAN(), nullable=True),
    sa.Column('sms_payment_confirmation', sa.BOOLEAN(), nullable=True),
    sa.Column('sms_payment_failed', sa.BOOLEAN(), nullable=True),
    sa.Column('sms_marketing', sa.BOOLEAN(), nullable=True),
    sa.Column('sms_promotional', sa.BOOLEAN(), nullable=True),
    sa.Column('sms_system_alerts', sa.BOOLEAN(), nullable=True),
    sa.Column('email_frequency', sa.VARCHAR(length=20), nullable=True),
    sa.Column('sms_frequency', sa.VARCHAR(length=20), nullable=True),
    sa.Column('reminder_hours', sqlite.JSON(), nullable=True),
    sa.Column('quiet_hours_enabled', sa.BOOLEAN(), nullable=True),
    sa.Column('quiet_hours_start', sa.VARCHAR(length=5), nullable=True),
    sa.Column('quiet_hours_end', sa.VARCHAR(length=5), nullable=True),
    sa.Column('weekend_notifications', sa.BOOLEAN(), nullable=True),
    sa.Column('consent_given_at', sa.DATETIME(), nullable=True),
    sa.Column('consent_ip_address', sa.VARCHAR(length=45), nullable=True),
    sa.Column('last_updated_at', sa.DATETIME(), nullable=True),
    sa.Column('data_processing_consent', sa.BOOLEAN(), nullable=True),
    sa.Column('marketing_consent', sa.BOOLEAN(), nullable=True),
    sa.Column('unsubscribe_token', sa.VARCHAR(length=64), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('user_id')
    )
    op.create_index('ix_notification_preferences_v2_unsubscribe_token', 'notification_preferences_v2', ['unsubscribe_token'], unique=1)
    op.create_index('ix_notification_preferences_v2_id', 'notification_preferences_v2', ['id'], unique=False)
    op.create_table('franchise_compliance',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('entity_type', sa.VARCHAR(length=50), nullable=False),
    sa.Column('entity_id', sa.INTEGER(), nullable=False),
    sa.Column('jurisdiction', sa.VARCHAR(length=17), nullable=False),
    sa.Column('requirement_type', sa.VARCHAR(length=100), nullable=False),
    sa.Column('requirement_name', sa.VARCHAR(length=255), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('compliance_status', sa.VARCHAR(length=50), nullable=False),
    sa.Column('required_by_date', sa.DATETIME(), nullable=True),
    sa.Column('last_compliance_check', sa.DATETIME(), nullable=True),
    sa.Column('next_review_date', sa.DATETIME(), nullable=True),
    sa.Column('compliance_documents', sqlite.JSON(), nullable=True),
    sa.Column('audit_history', sqlite.JSON(), nullable=True),
    sa.Column('remediation_actions', sqlite.JSON(), nullable=True),
    sa.Column('risk_level', sa.VARCHAR(length=20), nullable=True),
    sa.Column('non_compliance_penalties', sqlite.JSON(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_franchise_compliance_id', 'franchise_compliance', ['id'], unique=False)
    op.create_index('idx_franchise_compliance_status', 'franchise_compliance', ['compliance_status'], unique=False)
    op.create_index('idx_franchise_compliance_review_date', 'franchise_compliance', ['next_review_date'], unique=False)
    op.create_index('idx_franchise_compliance_jurisdiction', 'franchise_compliance', ['jurisdiction'], unique=False)
    op.create_index('idx_franchise_compliance_entity', 'franchise_compliance', ['entity_type', 'entity_id'], unique=False)
    op.create_table('legal_consent_audit',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('consent_id', sa.INTEGER(), nullable=True),
    sa.Column('action', sa.VARCHAR(length=50), nullable=False),
    sa.Column('consent_type', sa.VARCHAR(length=100), nullable=True),
    sa.Column('old_status', sa.VARCHAR(length=50), nullable=True),
    sa.Column('new_status', sa.VARCHAR(length=50), nullable=True),
    sa.Column('reason', sa.TEXT(), nullable=True),
    sa.Column('audit_metadata', sqlite.JSON(), nullable=True),
    sa.Column('ip_address', sa.VARCHAR(length=45), nullable=True),
    sa.Column('user_agent', sa.TEXT(), nullable=True),
    sa.Column('performed_by', sa.INTEGER(), nullable=True),
    sa.Column('timestamp', sa.DATETIME(), nullable=False),
    sa.ForeignKeyConstraint(['performed_by'], ['users.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_legal_consent_audit_timestamp', 'legal_consent_audit', ['timestamp'], unique=False)
    op.create_index('ix_legal_consent_audit_id', 'legal_consent_audit', ['id'], unique=False)
    op.create_table('recommendation_categories',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('category', sa.VARCHAR(length=24), nullable=False),
    sa.Column('display_name', sa.VARCHAR(length=255), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=False),
    sa.Column('six_fb_principle', sa.VARCHAR(length=100), nullable=False),
    sa.Column('methodology_weight', sa.FLOAT(), nullable=True),
    sa.Column('title_template', sa.VARCHAR(length=500), nullable=True),
    sa.Column('description_template', sa.TEXT(), nullable=True),
    sa.Column('action_items_template', sqlite.JSON(), nullable=True),
    sa.Column('icon_name', sa.VARCHAR(length=50), nullable=True),
    sa.Column('color_hex', sa.VARCHAR(length=7), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=False),
    sa.Column('sort_order', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=False),
    sa.Column('updated_at', sa.DATETIME(), nullable=False),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('category')
    )
    op.create_index('ix_recommendation_categories_id', 'recommendation_categories', ['id'], unique=False)
    op.create_table('ai_learning_patterns',
    sa.Column('id', sa.INTEGER(), nullable=True),
    sa.Column('pattern_name', sa.VARCHAR(length=200), nullable=False),
    sa.Column('pattern_type', sa.VARCHAR(length=50), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('trigger_conditions', sqlite.JSON(), nullable=False),
    sa.Column('predicted_outcomes', sqlite.JSON(), nullable=False),
    sa.Column('confidence_score', sa.FLOAT(), nullable=False),
    sa.Column('times_applied', sa.INTEGER(), server_default=sa.text('0'), nullable=True),
    sa.Column('success_rate', sa.FLOAT(), server_default=sa.text('(0.0)'), nullable=True),
    sa.Column('average_revenue', sa.FLOAT(), server_default=sa.text('(0.0)'), nullable=True),
    sa.Column('discovery_date', sa.TIMESTAMP(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('last_refined', sa.TIMESTAMP(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('refinement_count', sa.INTEGER(), server_default=sa.text('0'), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), server_default=sa.text('(true)'), nullable=True),
    sa.Column('validation_status', sa.VARCHAR(length=20), server_default=sa.text("'learning'"), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('agent_conversations',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('conversation_id', sa.VARCHAR(length=36), nullable=True),
    sa.Column('agent_instance_id', sa.INTEGER(), nullable=False),
    sa.Column('client_id', sa.INTEGER(), nullable=False),
    sa.Column('channel', sa.VARCHAR(length=20), nullable=False),
    sa.Column('status', sa.VARCHAR(length=16), nullable=True),
    sa.Column('messages', sqlite.JSON(), nullable=True),
    sa.Column('message_count', sa.INTEGER(), nullable=True),
    sa.Column('total_tokens_used', sa.INTEGER(), nullable=True),
    sa.Column('prompt_tokens', sa.INTEGER(), nullable=True),
    sa.Column('completion_tokens', sa.INTEGER(), nullable=True),
    sa.Column('token_cost', sa.FLOAT(), nullable=True),
    sa.Column('goal_achieved', sa.BOOLEAN(), nullable=True),
    sa.Column('revenue_generated', sa.FLOAT(), nullable=True),
    sa.Column('appointment_id', sa.INTEGER(), nullable=True),
    sa.Column('context_data', sqlite.JSON(), nullable=True),
    sa.Column('scheduled_at', sa.DATETIME(), nullable=True),
    sa.Column('started_at', sa.DATETIME(), nullable=True),
    sa.Column('last_message_at', sa.DATETIME(), nullable=True),
    sa.Column('completed_at', sa.DATETIME(), nullable=True),
    sa.Column('expires_at', sa.DATETIME(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['agent_instance_id'], ['agent_instances.id'], ),
    sa.ForeignKeyConstraint(['appointment_id'], ['appointments.id'], ),
    sa.ForeignKeyConstraint(['client_id'], ['clients.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_agent_conversations_status', 'agent_conversations', ['status'], unique=False)
    op.create_index('ix_agent_conversations_id', 'agent_conversations', ['id'], unique=False)
    op.create_index('ix_agent_conversations_conversation_id', 'agent_conversations', ['conversation_id'], unique=1)
    op.create_index('idx_conversation_status_scheduled', 'agent_conversations', ['status', 'scheduled_at'], unique=False)
    op.create_index('idx_conversation_client_agent', 'agent_conversations', ['client_id', 'agent_instance_id'], unique=False)
    op.create_table('api_keys',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(length=255), nullable=False),
    sa.Column('key_hash', sa.VARCHAR(length=64), nullable=False),
    sa.Column('key_prefix', sa.VARCHAR(length=20), nullable=False),
    sa.Column('key_type', sa.VARCHAR(length=50), nullable=False),
    sa.Column('permissions', sqlite.JSON(), nullable=False),
    sa.Column('allowed_ips', sqlite.JSON(), nullable=True),
    sa.Column('allowed_origins', sqlite.JSON(), nullable=True),
    sa.Column('status', sa.VARCHAR(length=9), nullable=False),
    sa.Column('expires_at', sa.DATETIME(), nullable=True),
    sa.Column('last_used_at', sa.DATETIME(), nullable=True),
    sa.Column('usage_count', sa.INTEGER(), nullable=True),
    sa.Column('key_metadata', sqlite.JSON(), nullable=True),
    sa.Column('rate_limit_override', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=False),
    sa.Column('updated_at', sa.DATETIME(), nullable=False),
    sa.Column('revoked_at', sa.DATETIME(), nullable=True),
    sa.Column('revoked_reason', sa.VARCHAR(length=500), nullable=True),
    sa.Column('revoked_by_id', sa.INTEGER(), nullable=True),
    sa.ForeignKeyConstraint(['revoked_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_api_keys_key_hash', 'api_keys', ['key_hash'], unique=1)
    op.create_index('ix_api_keys_id', 'api_keys', ['id'], unique=False)
    op.create_index('idx_api_keys_user_status', 'api_keys', ['user_id', 'status'], unique=False)
    op.create_index('idx_api_keys_type_status', 'api_keys', ['key_type', 'status'], unique=False)
    op.create_index('idx_api_keys_expires_at', 'api_keys', ['expires_at'], unique=False)
    op.create_table('email_deliverability_tests',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('test_name', sa.VARCHAR(length=255), nullable=False),
    sa.Column('template_name', sa.VARCHAR(length=100), nullable=True),
    sa.Column('test_type', sa.VARCHAR(length=50), nullable=False),
    sa.Column('test_email_addresses', sqlite.JSON(), nullable=False),
    sa.Column('from_address', sa.VARCHAR(length=255), nullable=False),
    sa.Column('from_name', sa.VARCHAR(length=100), nullable=False),
    sa.Column('subject_line', sa.VARCHAR(length=255), nullable=False),
    sa.Column('overall_score', sa.FLOAT(), nullable=True),
    sa.Column('spam_score', sa.FLOAT(), nullable=True),
    sa.Column('provider_results', sqlite.JSON(), nullable=True),
    sa.Column('spam_filter_results', sqlite.JSON(), nullable=True),
    sa.Column('content_issues', sqlite.JSON(), nullable=True),
    sa.Column('recommendations', sqlite.JSON(), nullable=True),
    sa.Column('spf_valid', sa.BOOLEAN(), nullable=True),
    sa.Column('dkim_valid', sa.BOOLEAN(), nullable=True),
    sa.Column('dmarc_valid', sa.BOOLEAN(), nullable=True),
    sa.Column('status', sa.VARCHAR(length=20), nullable=True),
    sa.Column('started_at', sa.DATETIME(), nullable=True),
    sa.Column('completed_at', sa.DATETIME(), nullable=True),
    sa.Column('raw_results', sqlite.JSON(), nullable=True),
    sa.Column('created_by_id', sa.INTEGER(), nullable=False),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['created_by_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_email_deliverability_tests_id', 'email_deliverability_tests', ['id'], unique=False)
    op.create_table('ai_intervention_learning',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('campaign_id', sa.INTEGER(), nullable=False),
    sa.Column('client_segment', sa.VARCHAR(length=100), nullable=True),
    sa.Column('appointment_type', sa.VARCHAR(length=100), nullable=True),
    sa.Column('risk_level', sa.VARCHAR(length=50), nullable=True),
    sa.Column('intervention_type', sa.VARCHAR(length=23), nullable=False),
    sa.Column('message_template', sa.VARCHAR(length=255), nullable=True),
    sa.Column('delivery_channel', sa.VARCHAR(length=50), nullable=True),
    sa.Column('timing_offset', sa.INTEGER(), nullable=True),
    sa.Column('was_successful', sa.BOOLEAN(), nullable=False),
    sa.Column('outcome_type', sa.VARCHAR(length=23), nullable=False),
    sa.Column('engagement_score', sa.FLOAT(), nullable=True),
    sa.Column('conversion_rate', sa.FLOAT(), nullable=True),
    sa.Column('weather_condition', sa.VARCHAR(length=50), nullable=True),
    sa.Column('day_of_week', sa.VARCHAR(length=20), nullable=True),
    sa.Column('time_of_day', sa.VARCHAR(length=20), nullable=True),
    sa.Column('season', sa.VARCHAR(length=20), nullable=True),
    sa.Column('client_tier', sa.VARCHAR(length=8), nullable=True),
    sa.Column('feature_importance', sqlite.JSON(), nullable=True),
    sa.Column('confidence_score', sa.FLOAT(), nullable=True),
    sa.Column('sample_size', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('learned_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['campaign_id'], ['ai_intervention_campaigns.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_ai_intervention_learning_id', 'ai_intervention_learning', ['id'], unique=False)
    op.create_table('waitlist_entries',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('client_id', sa.INTEGER(), nullable=True),
    sa.Column('service_id', sa.INTEGER(), nullable=True),
    sa.Column('barber_id', sa.INTEGER(), nullable=True),
    sa.Column('location_id', sa.INTEGER(), nullable=True),
    sa.Column('preferred_date', sa.DATETIME(), nullable=True),
    sa.Column('earliest_acceptable_date', sa.DATETIME(), nullable=True),
    sa.Column('latest_acceptable_date', sa.DATETIME(), nullable=True),
    sa.Column('preferred_time_start', sa.TIME(), nullable=True),
    sa.Column('preferred_time_end', sa.TIME(), nullable=True),
    sa.Column('flexible_on_barber', sa.BOOLEAN(), nullable=True),
    sa.Column('flexible_on_time', sa.BOOLEAN(), nullable=True),
    sa.Column('flexible_on_date', sa.BOOLEAN(), nullable=True),
    sa.Column('notify_via_sms', sa.BOOLEAN(), nullable=True),
    sa.Column('notify_via_email', sa.BOOLEAN(), nullable=True),
    sa.Column('notify_via_push', sa.BOOLEAN(), nullable=True),
    sa.Column('auto_book_if_available', sa.BOOLEAN(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('priority_score', sa.INTEGER(), nullable=True),
    sa.Column('times_notified', sa.INTEGER(), nullable=True),
    sa.Column('last_notified_at', sa.DATETIME(), nullable=True),
    sa.Column('current_offer_appointment_id', sa.INTEGER(), nullable=True),
    sa.Column('offer_expires_at', sa.DATETIME(), nullable=True),
    sa.Column('declined_appointment_ids', sqlite.JSON(), nullable=True),
    sa.Column('fulfilled_at', sa.DATETIME(), nullable=True),
    sa.Column('fulfilled_appointment_id', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.Column('expires_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['barber_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['client_id'], ['clients.id'], ),
    sa.ForeignKeyConstraint(['current_offer_appointment_id'], ['appointments.id'], ),
    sa.ForeignKeyConstraint(['fulfilled_appointment_id'], ['appointments.id'], ),
    sa.ForeignKeyConstraint(['location_id'], ['barbershop_locations.id'], ),
    sa.ForeignKeyConstraint(['service_id'], ['services.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_waitlist_entries_id', 'waitlist_entries', ['id'], unique=False)
    op.create_table('google_calendar_settings',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('is_connected', sa.BOOLEAN(), nullable=True),
    sa.Column('connection_date', sa.DATETIME(), nullable=True),
    sa.Column('last_sync_date', sa.DATETIME(), nullable=True),
    sa.Column('google_email', sa.VARCHAR(length=255), nullable=True),
    sa.Column('calendar_id', sa.VARCHAR(length=255), nullable=True),
    sa.Column('auto_sync_enabled', sa.BOOLEAN(), nullable=True),
    sa.Column('sync_on_create', sa.BOOLEAN(), nullable=True),
    sa.Column('sync_on_update', sa.BOOLEAN(), nullable=True),
    sa.Column('sync_on_delete', sa.BOOLEAN(), nullable=True),
    sa.Column('sync_all_appointments', sa.BOOLEAN(), nullable=True),
    sa.Column('sync_only_confirmed', sa.BOOLEAN(), nullable=True),
    sa.Column('sync_only_paid', sa.BOOLEAN(), nullable=True),
    sa.Column('include_client_email', sa.BOOLEAN(), nullable=True),
    sa.Column('include_client_phone', sa.BOOLEAN(), nullable=True),
    sa.Column('include_service_price', sa.BOOLEAN(), nullable=True),
    sa.Column('include_notes', sa.BOOLEAN(), nullable=True),
    sa.Column('enable_reminders', sa.BOOLEAN(), nullable=True),
    sa.Column('reminder_email_minutes', sa.INTEGER(), nullable=True),
    sa.Column('reminder_popup_minutes', sa.INTEGER(), nullable=True),
    sa.Column('event_visibility', sa.VARCHAR(length=20), nullable=True),
    sa.Column('show_client_name', sa.BOOLEAN(), nullable=True),
    sa.Column('show_service_details', sa.BOOLEAN(), nullable=True),
    sa.Column('timezone', sa.VARCHAR(length=50), nullable=True),
    sa.Column('last_error', sa.TEXT(), nullable=True),
    sa.Column('error_count', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_google_calendar_settings_user_id', 'google_calendar_settings', ['user_id'], unique=1)
    op.create_index('ix_google_calendar_settings_is_connected', 'google_calendar_settings', ['is_connected'], unique=False)
    op.create_index('ix_google_calendar_settings_id', 'google_calendar_settings', ['id'], unique=False)
    op.create_table('cancellation_policy_history',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('policy_id', sa.INTEGER(), nullable=False),
    sa.Column('changed_by_id', sa.INTEGER(), nullable=False),
    sa.Column('change_reason', sa.VARCHAR(length=255), nullable=True),
    sa.Column('previous_config', sqlite.JSON(), nullable=True),
    sa.Column('new_config', sqlite.JSON(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['changed_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['policy_id'], ['cancellation_policies.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_cancellation_policy_history_id', 'cancellation_policy_history', ['id'], unique=False)
    op.create_table('message_personalizations',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('rule_name', sa.VARCHAR(length=255), nullable=False),
    sa.Column('rule_type', sa.VARCHAR(length=100), nullable=False),
    sa.Column('client_tier', sa.VARCHAR(length=8), nullable=True),
    sa.Column('appointment_type', sa.VARCHAR(length=100), nullable=True),
    sa.Column('risk_level', sa.VARCHAR(length=50), nullable=True),
    sa.Column('time_of_day', sa.VARCHAR(length=50), nullable=True),
    sa.Column('day_of_week', sa.VARCHAR(length=20), nullable=True),
    sa.Column('weather_condition', sa.VARCHAR(length=50), nullable=True),
    sa.Column('content_variations', sqlite.JSON(), nullable=True),
    sa.Column('tone_style', sa.VARCHAR(length=100), nullable=True),
    sa.Column('urgency_level', sa.VARCHAR(length=50), nullable=True),
    sa.Column('usage_count', sa.INTEGER(), nullable=True),
    sa.Column('success_rate', sa.FLOAT(), nullable=True),
    sa.Column('conversion_rate', sa.FLOAT(), nullable=True),
    sa.Column('is_test_rule', sa.BOOLEAN(), nullable=True),
    sa.Column('test_description', sa.TEXT(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_message_personalizations_id', 'message_personalizations', ['id'], unique=False)
    op.create_table('barber_profiles',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('bio', sa.TEXT(), nullable=True),
    sa.Column('years_experience', sa.INTEGER(), nullable=True),
    sa.Column('profile_image_url', sa.VARCHAR(), nullable=True),
    sa.Column('instagram_handle', sa.VARCHAR(), nullable=True),
    sa.Column('website_url', sa.VARCHAR(), nullable=True),
    sa.Column('specialties', sqlite.JSON(), nullable=True),
    sa.Column('certifications', sqlite.JSON(), nullable=True),
    sa.Column('hourly_rate', sa.FLOAT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=False),
    sa.Column('updated_at', sa.DATETIME(), nullable=False),
    sa.Column('is_active', sa.BOOLEAN(), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_barber_profiles_user_id', 'barber_profiles', ['user_id'], unique=1)
    op.create_table('gift_certificates',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('code', sa.VARCHAR(), nullable=True),
    sa.Column('amount', sa.FLOAT(), nullable=True),
    sa.Column('balance', sa.FLOAT(), nullable=True),
    sa.Column('status', sa.VARCHAR(), nullable=True),
    sa.Column('purchaser_name', sa.VARCHAR(), nullable=True),
    sa.Column('purchaser_email', sa.VARCHAR(), nullable=True),
    sa.Column('recipient_name', sa.VARCHAR(), nullable=True),
    sa.Column('recipient_email', sa.VARCHAR(), nullable=True),
    sa.Column('message', sa.TEXT(), nullable=True),
    sa.Column('valid_from', sa.DATETIME(), nullable=True),
    sa.Column('valid_until', sa.DATETIME(), nullable=True),
    sa.Column('created_by_id', sa.INTEGER(), nullable=True),
    sa.Column('stripe_payment_intent_id', sa.VARCHAR(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('used_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['created_by_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_gift_certificates_id', 'gift_certificates', ['id'], unique=False)
    op.create_index('ix_gift_certificates_code', 'gift_certificates', ['code'], unique=1)
    op.create_table('subscription_template_services',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('template_id', sa.INTEGER(), nullable=False),
    sa.Column('service_id', sa.INTEGER(), nullable=False),
    sa.Column('quantity_per_period', sa.INTEGER(), nullable=True),
    sa.ForeignKeyConstraint(['service_id'], ['services.id'], ),
    sa.ForeignKeyConstraint(['template_id'], ['service_subscription_templates.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_subscription_template_services_id', 'subscription_template_services', ['id'], unique=False)
    op.create_table('client_tier_data',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('current_tier', sa.VARCHAR(length=8), nullable=False),
    sa.Column('previous_tier', sa.VARCHAR(length=8), nullable=True),
    sa.Column('tier_since', sa.DATETIME(), nullable=True),
    sa.Column('total_spent', sa.FLOAT(), nullable=True),
    sa.Column('total_appointments', sa.INTEGER(), nullable=True),
    sa.Column('no_show_rate', sa.FLOAT(), nullable=True),
    sa.Column('avg_tip_percentage', sa.FLOAT(), nullable=True),
    sa.Column('referrals_made', sa.INTEGER(), nullable=True),
    sa.Column('loyalty_points', sa.INTEGER(), nullable=True),
    sa.Column('last_appointment_date', sa.DATETIME(), nullable=True),
    sa.Column('avg_time_between_appointments', sa.INTEGER(), nullable=True),
    sa.Column('preferred_services', sqlite.JSON(), nullable=True),
    sa.Column('preferred_times', sqlite.JSON(), nullable=True),
    sa.Column('communication_preferences', sqlite.JSON(), nullable=True),
    sa.Column('loyalty_score', sa.FLOAT(), nullable=True),
    sa.Column('value_score', sa.FLOAT(), nullable=True),
    sa.Column('engagement_score', sa.FLOAT(), nullable=True),
    sa.Column('retention_risk', sa.FLOAT(), nullable=True),
    sa.Column('upsell_potential', sa.FLOAT(), nullable=True),
    sa.Column('tier_benefits', sqlite.JSON(), nullable=True),
    sa.Column('benefits_used', sqlite.JSON(), nullable=True),
    sa.Column('next_tier_requirements', sqlite.JSON(), nullable=True),
    sa.Column('personality_profile', sqlite.JSON(), nullable=True),
    sa.Column('booking_patterns', sqlite.JSON(), nullable=True),
    sa.Column('price_sensitivity', sa.FLOAT(), nullable=True),
    sa.Column('service_preferences', sqlite.JSON(), nullable=True),
    sa.Column('eligible_promotions', sqlite.JSON(), nullable=True),
    sa.Column('promotion_response_history', sqlite.JSON(), nullable=True),
    sa.Column('marketing_preferences', sqlite.JSON(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.Column('last_calculated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('user_id')
    )
    op.create_index('ix_client_tier_data_id', 'client_tier_data', ['id'], unique=False)
    op.create_table('insight_templates',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(length=255), nullable=False),
    sa.Column('version', sa.VARCHAR(length=50), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('email_subject_template', sa.VARCHAR(length=500), nullable=False),
    sa.Column('email_html_template', sa.TEXT(), nullable=False),
    sa.Column('email_text_template', sa.TEXT(), nullable=False),
    sa.Column('pdf_template', sa.TEXT(), nullable=True),
    sa.Column('variables', sqlite.JSON(), nullable=True),
    sa.Column('styling_config', sqlite.JSON(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=False),
    sa.Column('is_default', sa.BOOLEAN(), nullable=False),
    sa.Column('usage_count', sa.INTEGER(), nullable=True),
    sa.Column('ab_test_group', sa.VARCHAR(length=50), nullable=True),
    sa.Column('conversion_rate', sa.FLOAT(), nullable=True),
    sa.Column('engagement_score', sa.FLOAT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=False),
    sa.Column('updated_at', sa.DATETIME(), nullable=False),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('name')
    )
    op.create_index('ix_insight_templates_id', 'insight_templates', ['id'], unique=False)
    op.create_table('cookie_consents',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=True),
    sa.Column('session_id', sa.VARCHAR(length=255), nullable=False),
    sa.Column('functional', sa.BOOLEAN(), nullable=False),
    sa.Column('analytics', sa.BOOLEAN(), nullable=False),
    sa.Column('marketing', sa.BOOLEAN(), nullable=False),
    sa.Column('preferences', sa.BOOLEAN(), nullable=False),
    sa.Column('consent_date', sa.DATETIME(), nullable=False),
    sa.Column('expiry_date', sa.DATETIME(), nullable=False),
    sa.Column('ip_address', sa.VARCHAR(length=45), nullable=True),
    sa.Column('user_agent', sa.TEXT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=False),
    sa.Column('updated_at', sa.DATETIME(), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_cookie_consents_session_id', 'cookie_consents', ['session_id'], unique=False)
    op.create_index('ix_cookie_consents_id', 'cookie_consents', ['id'], unique=False)
    # ### end Alembic commands ###
