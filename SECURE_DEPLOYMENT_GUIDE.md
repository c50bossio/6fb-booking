# 🔐 Secure Deployment Guide for BookedBarber V2

## ⚠️ Important Security Notice

GitHub has blocked our push due to exposed API keys. This is actually GOOD - it means their security is working! Here's how to deploy V2 securely without exposing secrets.

## 🚀 Deployment Options

### Option 1: Deploy from GitHub Web Interface (Recommended)

1. **Manually upload render.yaml**:
   - Go to https://github.com/c50bossio/6fb-booking
   - Navigate to the repository root
   - Click "Add file" → "Upload files"
   - Upload the updated `render.yaml` file
   - Commit directly to your branch

2. **Connect to Render**:
   - Go to https://dashboard.render.com
   - Click "New +" → "Blueprint"
   - Connect your GitHub repo
   - Select branch: `feature/marketing-integrations-20250702`
   - Render will create services from render.yaml

3. **Add Environment Variables in Render Dashboard**:
   ```
   Backend V2 (sixfb-backend-v2):
   - STRIPE_SECRET_KEY = [copy from your .env]
   - STRIPE_PUBLISHABLE_KEY = [copy from your .env]
   - STRIPE_WEBHOOK_SECRET = [copy from your .env]
   - SENDGRID_API_KEY = [copy from your .env]
   - TWILIO_ACCOUNT_SID = [copy from your .env]
   - TWILIO_AUTH_TOKEN = [copy from your .env]
   
   Frontend V2 (sixfb-frontend-v2):
   - NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY = [copy from your .env]
   ```

### Option 2: Remove Secrets and Push

1. **Create .env.example without secrets**:
   ```bash
   cp backend-v2/.env backend-v2/.env.backup
   cp backend-v2/.env backend-v2/.env.example
   # Edit .env.example and replace all actual keys with placeholders
   ```

2. **Remove .env from git**:
   ```bash
   git rm --cached backend-v2/.env
   echo "backend-v2/.env" >> .gitignore
   git add .gitignore
   git commit -m "fix: remove secrets from repository"
   ```

3. **Push clean code**:
   ```bash
   git push origin feature/marketing-integrations-20250702
   ```

### Option 3: Direct Render Connection (No GitHub)

1. **Create services manually in Render**:
   - Go to https://dashboard.render.com
   - Create Web Service → "sixfb-backend-v2"
   - Create Web Service → "sixfb-frontend-v2"
   - Create PostgreSQL → "sixfb-db"

2. **Configure each service**:
   
   **Backend V2**:
   - Build Command: `cd backend-v2 && pip install -r requirements.txt`
   - Start Command: `cd backend-v2 && uvicorn main:app --host 0.0.0.0 --port $PORT`
   - Add all environment variables from .env

   **Frontend V2**:
   - Build Command: `cd backend-v2/frontend-v2 && npm ci && npm run build`
   - Start Command: `cd backend-v2/frontend-v2 && npm start`
   - Environment: `NEXT_PUBLIC_API_URL=https://sixfb-backend-v2.onrender.com`

## 📋 Current Services Status

- **V1 Backend**: ✅ Running at https://sixfb-backend.onrender.com
- **V2 Backend**: ❌ Not deployed (https://sixfb-backend-v2.onrender.com)
- **V2 Frontend**: ❌ Not deployed (https://sixfb-frontend-v2.onrender.com)

## 🔄 Migration Plan

1. Deploy V2 services alongside V1
2. Test V2 thoroughly
3. Update DNS/domains to point to V2
4. Keep V1 running as backup
5. Shut down V1 after V2 is stable

## 🛡️ Security Best Practices

1. **Never commit .env files** - Always use .env.example with placeholders
2. **Use Render's environment variables** - Add secrets directly in Render dashboard
3. **Rotate keys regularly** - Especially after any exposure
4. **Use different keys for dev/prod** - Never use production keys locally

## 📊 Post-Deployment Verification

After deployment:

1. Check backend health:
   ```
   curl https://sixfb-backend-v2.onrender.com/health
   ```

2. Check frontend:
   ```
   https://sixfb-frontend-v2.onrender.com
   ```

3. Run database migrations in Render shell:
   ```
   cd backend-v2 && alembic upgrade head
   ```

4. Test core functionality:
   - Login/Registration
   - Booking flow
   - Payment processing
   - Calendar integration

## 🆘 If You Need Help

1. The render.yaml is already configured correctly
2. All services are defined with proper settings
3. You just need to get it deployed without exposing secrets
4. Use Option 1 (GitHub web upload) for the quickest deployment

## 📝 Environment Variables Reference

Copy these from your backend-v2/.env file to Render:

**Production Secrets** (from your .env):
- All Stripe keys (they're live keys, not test)
- SendGrid API key
- Twilio credentials
- JWT and SECRET keys

**Auto-generated by Render**:
- DATABASE_URL (from database connection)
- PORT (auto-assigned)

Remember: V2 is production-ready with your live Stripe keys. Once deployed, it will process real payments!